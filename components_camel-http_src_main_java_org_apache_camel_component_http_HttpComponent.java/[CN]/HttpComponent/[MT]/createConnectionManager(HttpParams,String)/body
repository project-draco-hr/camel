{
  SchemeRegistry schemeRegistry=new SchemeRegistry();
  if (isSecureConnection(uri)) {
    schemeRegistry.register(new Scheme("https",SSLSocketFactory.getSocketFactory(),443));
  }
 else {
    schemeRegistry.register(new Scheme("http",PlainSocketFactory.getSocketFactory(),80));
  }
  ConnManagerParamBean param=new ConnManagerParamBean(clientParams);
  if (getMaxTotalConnections() > 0) {
    param.setMaxTotalConnections(getMaxTotalConnections());
  }
  if (getConnectionsPerRoute() > 0) {
    param.setConnectionsPerRoute(new ConnPerRouteBean(getConnectionsPerRoute()));
  }
  ThreadSafeClientConnManager answer;
  answer=new ThreadSafeClientConnManager(clientParams,schemeRegistry);
  LOG.info("Created ClientConnectionManager " + answer);
  return answer;
}
