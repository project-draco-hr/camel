{
  HttpClientParams params=new HttpClientParams();
  IntrospectionSupport.setProperties(params,parameters,"httpClient.");
  String ref=getAndRemoveParameter(parameters,"httpBindingRef",String.class);
  if (ref != null) {
    httpBinding=CamelContextHelper.mandatoryLookup(getCamelContext(),ref,HttpBinding.class);
  }
  String username=getAndRemoveParameter(parameters,"username",String.class);
  String password=getAndRemoveParameter(parameters,"password",String.class);
  if (username != null && password != null) {
    httpClientConfigurer=new BasicAuthenticationHttpClientConfigurer(username,password);
  }
  ref=getAndRemoveParameter(parameters,"httpClientConfigurerRef",String.class);
  if (ref != null) {
    httpClientConfigurer=CamelContextHelper.mandatoryLookup(getCamelContext(),ref,HttpClientConfigurer.class);
  }
  URI httpUri=URISupport.createRemainingURI(new URI(uri),parameters);
  uri=httpUri.toString();
  String part=httpUri.getSchemeSpecificPart();
  if (part != null) {
    part=part.toLowerCase();
    if (part.startsWith("//http//") || part.startsWith("//https//")) {
      throw new ResolveEndpointFailedException(uri,"The uri part is not configured correctly. You have duplicated the http(s) protocol.");
    }
  }
  HttpEndpoint endpoint=new HttpEndpoint(uri,this,httpUri,params,httpConnectionManager,httpClientConfigurer);
  if (httpBinding != null) {
    endpoint.setBinding(httpBinding);
  }
  return endpoint;
}
