{
  ZooKeeper connection=zkm.getConnection();
  ProductionContext context=new ProductionContext(connection,exchange);
  if (ExchangeHelper.isOutCapable(exchange)) {
    if (log.isDebugEnabled()) {
      log.debug(format("Storing data to znode '%s', waiting for confirmation",context.node));
    }
    OperationResult result=synchronouslySetData(context);
    if (configuration.listChildren()) {
      result=listChildren(context);
    }
    updateExchangeWithResult(context,result);
  }
 else {
    asynchronouslySetDataOnNode(connection,context);
  }
}
