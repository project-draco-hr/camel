{
  RabbitMQConsumer consumer=new RabbitMQConsumer(endpoint,processor);
  Mockito.when(endpoint.createExecutor()).thenReturn((ThreadPoolExecutor)Executors.newFixedThreadPool(3));
  Mockito.when(endpoint.connect(Matchers.any(ExecutorService.class))).thenReturn(conn);
  Mockito.when(conn.createChannel()).thenReturn(channel);
  consumer.doStart();
  consumer.doStop();
  Mockito.verify(conn).close();
}
