{
  ResultSetMetaData meta=rs.getMetaData();
  boolean jdbc4=getEndpoint().isUseJDBC4ColumnNameAndLabelSemantics();
  int count=meta.getColumnCount();
  List<Map<String,Object>> data=new ArrayList<Map<String,Object>>();
  int rowNumber=0;
  while (rs.next() && (readSize == 0 || rowNumber < readSize)) {
    Map<String,Object> row=new LinkedHashMap<String,Object>();
    for (int i=0; i < count; i++) {
      int columnNumber=i + 1;
      String columnName;
      if (jdbc4) {
        columnName=meta.getColumnLabel(columnNumber);
      }
 else {
        try {
          columnName=meta.getColumnLabel(columnNumber);
        }
 catch (        SQLException e) {
          columnName=meta.getColumnName(columnNumber);
        }
      }
      int columnType=meta.getColumnType(columnNumber);
      if (columnType == Types.CLOB || columnType == Types.BLOB) {
        row.put(columnName,rs.getString(columnNumber));
      }
 else {
        row.put(columnName,rs.getObject(columnNumber));
      }
    }
    data.add(row);
    rowNumber++;
  }
  return data;
}
