{
  Message message=exchange.getIn();
  Long delay=message.getHeader(Exchange.REDELIVERY_DELAY,Long.class);
  if (delay == null) {
    delay=redeliveryPolicy.calculateRedeliveryDelay(redeliveryDelay,redeliveryCounter);
  }
 else {
    if (log.isDebugEnabled()) {
      log.debug("Redelivery delay is {} from Message.getHeader(Exchange.REDELIVERY_DELAY)",new Object[]{delay});
    }
  }
  return delay;
}
