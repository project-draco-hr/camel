{
  boolean stoppingCamel=false;
  CamelContext context=exchange.getContext();
  if (context instanceof ServiceSupport) {
    stoppingCamel=!((ServiceSupport)context).isRunAllowed();
  }
  if (stoppingCamel || !isRunAllowed()) {
    if (log.isDebugEnabled()) {
      boolean stopping=isStopping() || isStopped();
      if (stopping) {
        log.debug("Rejected execution as we are stopping for exchange: " + exchange);
      }
 else {
        log.debug("Rejected execution as we are not started for exchange: " + exchange);
      }
    }
    if (exchange.getException() == null) {
      exchange.setException(new RejectedExecutionException());
    }
    exchange.setProperty(Exchange.ROUTE_STOP,Boolean.TRUE);
    return false;
  }
  return true;
}
