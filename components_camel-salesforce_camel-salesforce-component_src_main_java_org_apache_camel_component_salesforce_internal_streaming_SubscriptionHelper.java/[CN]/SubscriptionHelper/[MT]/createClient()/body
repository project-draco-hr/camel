{
  final SalesforceHttpClient httpClient=component.getConfig().getHttpClient();
  Map<String,Object> options=new HashMap<String,Object>();
  options.put(ClientTransport.MAX_NETWORK_DELAY_OPTION,httpClient.getTimeout());
  if (session.getAccessToken() == null) {
    session.login(null);
  }
  LongPollingTransport transport=new LongPollingTransport(options,httpClient){
    @Override protected void customize(    Request request){
      super.customize(request);
      request.header(HttpHeader.AUTHORIZATION,"OAuth " + session.getAccessToken());
    }
  }
;
  BayeuxClient client=new BayeuxClient(getEndpointUrl(),transport);
  return client;
}
