{
  Throwable e=null;
  try {
    tryProcessor.process(exchange);
    e=exchange.getException();
    if (e != null && DeadLetterChannel.isFailureHandled(exchange)) {
      e=null;
    }
  }
 catch (  Exception ex) {
    e=ex;
    exchange.setException(e);
  }
  if (e != null) {
    try {
      DeadLetterChannel.setFailureHandled(exchange,true);
      handleException(exchange,e);
    }
 catch (    Exception ex) {
      throw ex;
    }
catch (    Throwable ex) {
      throw new RuntimeCamelException(ex);
    }
  }
  try {
    finallyProcessor.process(exchange);
  }
 catch (  Exception e2) {
    LOG.warn("Caught exception in finally block while handling other exception: " + e2,e2);
  }
}
