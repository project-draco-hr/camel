{
  final Exception caught=exchange.getException();
  if (caught == null) {
    return true;
  }
  if (exchange.getProperty(Exchange.FAILURE_ENDPOINT) == null) {
    exchange.setProperty(Exchange.FAILURE_ENDPOINT,exchange.getProperty(Exchange.TO_ENDPOINT));
  }
  exchange.setProperty(Exchange.EXCEPTION_CAUGHT,caught);
  exchange.setException(null);
  exchange.removeProperty(Exchange.REDELIVERY_EXHAUSTED);
  final Boolean handled=catchClause.handles(exchange);
  if (LOG.isDebugEnabled()) {
    LOG.debug("The exception is handled: {} for the exception: {} caused by: {}",new Object[]{handled,caught.getClass().getName(),caught.getMessage()});
  }
  boolean sync=super.processNext(exchange,new AsyncCallback(){
    public void done(    boolean doneSync){
      if (doneSync) {
        return;
      }
      if (!handled) {
        if (exchange.getException() == null) {
          exchange.setException(exchange.getProperty(Exchange.EXCEPTION_CAUGHT,Exception.class));
        }
      }
      exchange.removeProperty(Exchange.REDELIVERY_EXHAUSTED);
      ExchangeHelper.prepareOutToIn(exchange);
      callback.done(false);
    }
  }
);
  if (sync) {
    if (!handled) {
      if (exchange.getException() == null) {
        exchange.setException(exchange.getProperty(Exchange.EXCEPTION_CAUGHT,Exception.class));
      }
    }
    exchange.removeProperty(Exchange.REDELIVERY_EXHAUSTED);
  }
  return sync;
}
