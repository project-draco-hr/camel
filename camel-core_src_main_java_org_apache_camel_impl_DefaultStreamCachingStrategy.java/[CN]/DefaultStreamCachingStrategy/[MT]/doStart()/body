{
  if (!enabled) {
    LOG.debug("StreamCaching is not enabled");
    return;
  }
  String bufferSize=camelContext.getProperty(BUFFER_SIZE);
  String hold=camelContext.getProperty(THRESHOLD);
  String chiper=camelContext.getProperty(CIPHER_TRANSFORMATION);
  String dir=camelContext.getProperty(TEMP_DIR);
  boolean warn=false;
  if (bufferSize != null) {
    warn=true;
    this.bufferSize=camelContext.getTypeConverter().convertTo(Integer.class,bufferSize);
  }
  if (hold != null) {
    warn=true;
    this.spoolThreshold=camelContext.getTypeConverter().convertTo(Long.class,hold);
  }
  if (chiper != null) {
    warn=true;
    this.spoolChiper=chiper;
  }
  if (dir != null) {
    warn=true;
    this.spoolDirectory=camelContext.getTypeConverter().convertTo(File.class,dir);
  }
  if (warn) {
    LOG.warn("Configuring of StreamCaching using CamelContext properties is deprecated - use StreamCachingStrategy instead.");
  }
  if (spoolThreshold > 0) {
    if (spoolDirectory == null) {
      spoolDirectory=FileUtil.createNewTempDir();
      LOG.debug("Created temporary spool directory: {}",spoolDirectory);
    }
 else     if (spoolDirectory.exists()) {
      if (spoolDirectory.isDirectory()) {
        LOG.debug("Using spool directory: {}",spoolDirectory);
      }
 else {
        LOG.warn("Spool directory: {} is not a directory. This may cause problems spooling to disk for the stream caching!",spoolDirectory);
      }
    }
 else {
      boolean created=spoolDirectory.mkdirs();
      if (!created) {
        LOG.warn("Cannot create spool directory: {}. This may cause problems spooling to disk for the stream caching!",spoolDirectory);
      }
 else {
        LOG.debug("Created spool directory: {}",spoolDirectory);
      }
    }
  }
  LOG.debug("StreamCaching configuration {}",this.toString());
  if (spoolThreshold > 0) {
    LOG.info("StreamCaching in use and overflow to disk enabled when > {} bytes to directory: {}",spoolThreshold,spoolDirectory);
  }
 else {
    LOG.info("StreamCaching in use with no overflow to disk (memory only)");
  }
}
