{
  Message message=exchange.hasOut() ? exchange.getOut() : exchange.getIn();
  StreamCache cache=message.getBody(StreamCache.class);
  if (cache != null) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Cached stream to {} -> {}",cache.inMemory() ? "memory" : "spool",cache);
    }
    if (statistics.isStatisticsEnabled()) {
      try {
        if (cache.inMemory()) {
          statistics.updateMemory(cache.length());
        }
 else {
          statistics.updateSpool(cache.length());
        }
      }
 catch (      Exception e) {
        LOG.debug("Error updating cache statistics. This exception is ignored.",e);
      }
    }
  }
  return cache;
}
