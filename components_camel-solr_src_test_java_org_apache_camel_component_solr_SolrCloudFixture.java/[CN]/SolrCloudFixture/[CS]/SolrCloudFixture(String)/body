{
  String xml=IOHelper.loadText(new FileInputStream(new File(solrHome,"solr-no-core.xml")));
  miniCluster=new MiniSolrCloudCluster(1,"/solr",new File("target/tmp").toPath(),xml,null,null);
  String zkAddr=miniCluster.getZkServer().getZkAddress();
  String zkHost=miniCluster.getZkServer().getZkHost();
  buildZooKeeper(zkHost,zkAddr,new File(solrHome),"solrconfig.xml","schema.xml");
  List<JettySolrRunner> jettys=miniCluster.getJettySolrRunners();
  for (  JettySolrRunner jetty : jettys) {
    if (!jetty.isRunning()) {
      log.warn("JETTY NOT RUNNING!");
    }
 else {
      log.info("JETTY RUNNING AT " + jetty.getBaseUrl() + " PORT "+ jetty.getLocalPort());
    }
  }
  solrClient=new CloudSolrClient(zkAddr,true);
  solrClient.connect();
  createCollection(solrClient,"collection1",1,1,"conf1");
  Thread.sleep(1000);
  solrClient.setDefaultCollection("collection1");
  SolrInputDocument doc=new SolrInputDocument();
  doc.setField("id","1");
  solrClient.add(doc);
  solrClient.commit();
}
