{
  boolean pubSubDomain=false;
  boolean tempDestination=false;
  if (remaining.startsWith(JmsConfiguration.QUEUE_PREFIX)) {
    pubSubDomain=false;
    remaining=removeStartingCharacters(remaining.substring(JmsConfiguration.QUEUE_PREFIX.length()),'/');
  }
 else   if (remaining.startsWith(JmsConfiguration.TOPIC_PREFIX)) {
    pubSubDomain=true;
    remaining=removeStartingCharacters(remaining.substring(JmsConfiguration.TOPIC_PREFIX.length()),'/');
  }
 else   if (remaining.startsWith(JmsConfiguration.TEMP_QUEUE_PREFIX)) {
    pubSubDomain=false;
    tempDestination=true;
    remaining=removeStartingCharacters(remaining.substring(JmsConfiguration.TEMP_QUEUE_PREFIX.length()),'/');
  }
 else   if (remaining.startsWith(JmsConfiguration.TEMP_TOPIC_PREFIX)) {
    pubSubDomain=true;
    tempDestination=true;
    remaining=removeStartingCharacters(remaining.substring(JmsConfiguration.TEMP_TOPIC_PREFIX.length()),'/');
  }
  final String subject=convertPathToActualDestination(remaining,parameters);
  JmsConfiguration newConfiguration=getConfiguration().copy();
  JmsEndpoint endpoint;
  if (pubSubDomain) {
    if (tempDestination) {
      endpoint=new JmsTemporaryTopicEndpoint(uri,this,subject,newConfiguration);
    }
 else {
      endpoint=new JmsEndpoint(uri,this,subject,pubSubDomain,newConfiguration);
    }
  }
 else {
    QueueBrowseStrategy strategy=getQueueBrowseStrategy();
    if (tempDestination) {
      endpoint=new JmsTemporaryQueueEndpoint(uri,this,subject,newConfiguration,strategy);
    }
 else {
      endpoint=new JmsQueueEndpoint(uri,this,subject,newConfiguration,strategy);
    }
  }
  String selector=getAndRemoveParameter(parameters,"selector",String.class);
  if (selector != null) {
    endpoint.setSelector(selector);
  }
  String username=getAndRemoveParameter(parameters,"username",String.class);
  String password=getAndRemoveParameter(parameters,"password",String.class);
  if (username != null && password != null) {
    ConnectionFactory cf=endpoint.getConfiguration().getConnectionFactory();
    UserCredentialsConnectionFactoryAdapter ucfa=new UserCredentialsConnectionFactoryAdapter();
    ucfa.setTargetConnectionFactory(cf);
    ucfa.setPassword(password);
    ucfa.setUsername(username);
    endpoint.getConfiguration().setConnectionFactory(ucfa);
  }
 else {
    if (username != null || password != null) {
      throw new IllegalArgumentException("The JmsComponent's username or password is null");
    }
  }
  String strategy=getAndRemoveParameter(parameters,"jmsKeyFormatStrategy",String.class);
  if (strategy != null) {
    if (EndpointHelper.isReferenceParameter(strategy)) {
      String key=strategy.substring(1);
      endpoint.setJmsKeyFormatStrategy(getCamelContext().getRegistry().lookup(key,JmsKeyFormatStrategy.class));
    }
 else {
      if ("default".equalsIgnoreCase(strategy)) {
        endpoint.setJmsKeyFormatStrategy(new DefaultJmsKeyFormatStrategy());
      }
 else       if ("passthrough".equalsIgnoreCase(strategy)) {
        endpoint.setJmsKeyFormatStrategy(new PassThroughJmsKeyFormatStrategy());
      }
 else {
        throw new IllegalArgumentException("Unknown jmsKeyFormatStrategy option: " + strategy);
      }
    }
  }
  setProperties(endpoint.getConfiguration(),parameters);
  endpoint.setHeaderFilterStrategy(getHeaderFilterStrategy());
  return endpoint;
}
