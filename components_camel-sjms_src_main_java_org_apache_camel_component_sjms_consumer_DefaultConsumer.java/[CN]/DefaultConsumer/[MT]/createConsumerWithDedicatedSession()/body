{
  Connection conn=getConnectionResource().borrowConnection();
  Session session=null;
  if (isTransacted()) {
    session=conn.createSession(true,Session.SESSION_TRANSACTED);
  }
 else {
    session=conn.createSession(false,Session.AUTO_ACKNOWLEDGE);
  }
  MessageConsumer messageConsumer=null;
  if (isTopic()) {
    messageConsumer=JmsObjectFactory.createTopicConsumer(session,getDestinationName(),getMessageSelector());
  }
 else {
    messageConsumer=JmsObjectFactory.createQueueConsumer(session,getDestinationName(),getMessageSelector());
  }
  MessageListener handler=createMessageHandler(session);
  messageConsumer.setMessageListener(handler);
  getConnectionResource().returnConnection(conn);
  return new MessageConsumerResources(session,messageConsumer);
}
