{
  DataSource target=null;
  DataSource ds=resolveAndRemoveReferenceParameter(parameters,"dataSource",DataSource.class);
  if (ds != null) {
    target=ds;
  }
  if (target == null) {
    target=dataSource;
  }
  if (target == null) {
    throw new IllegalArgumentException("DataSource must be configured");
  }
  JdbcTemplate jdbcTemplate=new JdbcTemplate(target);
  String template=remaining;
  SqlStoredEndpoint endpoint=new SqlStoredEndpoint(uri,this,jdbcTemplate);
  endpoint.setTemplate(template);
  return endpoint;
}
