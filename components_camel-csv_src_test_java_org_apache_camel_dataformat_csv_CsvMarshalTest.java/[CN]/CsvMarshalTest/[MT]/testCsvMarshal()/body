{
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedMessageCount(1);
  List<Map<String,Object>> data=new ArrayList<Map<String,Object>>();
  Map<String,Object> row1=new LinkedHashMap<String,Object>();
  row1.put("orderId",123);
  row1.put("item","Camel in Action");
  row1.put("amount",1);
  data.add(row1);
  Map<String,Object> row2=new LinkedHashMap<String,Object>();
  row2.put("orderId",124);
  row2.put("item","ActiveMQ in Action");
  row2.put("amount",2);
  data.add(row2);
  template.sendBody("direct:toCsv",data);
  assertMockEndpointsSatisfied();
  String body=mock.getReceivedExchanges().get(0).getIn().getBody(String.class);
  String[] lines=body.split("\n");
  assertEquals("There should be 2 rows",2,lines.length);
  assertEquals("123,Camel in Action,1",lines[0]);
  assertEquals("124,ActiveMQ in Action,2",lines[1]);
}
