{
  if (context instanceof DefaultCamelContext) {
    try {
      initialized=true;
      DefaultCamelContext dc=(DefaultCamelContext)context;
      dc.addService(agent);
      namingStrategy=new CamelNamingStrategy(agent.getMBeanObjectDomainName());
      ManagedService ms=new ManagedService(dc);
      agent.register(ms,getNamingStrategy().getObjectName(dc));
    }
 catch (    Exception e) {
      LOG.warn("Could not register CamelContext MBean",e);
    }
  }
}
