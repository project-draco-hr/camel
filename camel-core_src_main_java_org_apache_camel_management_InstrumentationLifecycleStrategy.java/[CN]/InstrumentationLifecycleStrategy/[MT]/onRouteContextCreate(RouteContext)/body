{
  if (!initialized) {
    return;
  }
  Map<ProcessorDefinition,PerformanceCounter> registeredCounters=new HashMap<ProcessorDefinition,PerformanceCounter>();
  RouteDefinition route=routeContext.getRoute();
  for (  ProcessorDefinition processor : route.getOutputs()) {
    ObjectName name=null;
    try {
      name=getNamingStrategy().getObjectName(routeContext,processor);
      PerformanceCounter pc=new PerformanceCounter();
      agent.register(pc,name);
      registeredCounters.put(processor,pc);
    }
 catch (    MalformedObjectNameException e) {
      LOG.warn("Could not create MBean name: " + name,e);
    }
catch (    JMException e) {
      LOG.warn("Could not register PerformanceCounter MBean: " + name,e);
    }
  }
  routeContext.addInterceptStrategy(new InstrumentationInterceptStrategy(registeredCounters));
  routeContext.setErrorHandlerWrappingStrategy(new DefaultErrorHandlerWrappingStrategy(routeContext));
}
