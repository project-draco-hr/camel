{
  NodeState nodeState=null;
  String state=((JcloudsComputeEndpoint)getEndpoint()).getNodeState();
  if (state != null) {
    nodeState=NodeState.valueOf(state);
  }
  if (exchange.getIn().getHeader(JcloudsConstants.NODE_STATE) != null) {
    Object stateHeader=exchange.getIn().getHeader(JcloudsConstants.NODE_STATE);
    if (stateHeader == null) {
      nodeState=null;
    }
 else     if (stateHeader instanceof NodeState) {
      nodeState=(NodeState)stateHeader;
    }
 else {
      nodeState=NodeState.valueOf(String.valueOf(stateHeader));
    }
  }
  return nodeState;
}
