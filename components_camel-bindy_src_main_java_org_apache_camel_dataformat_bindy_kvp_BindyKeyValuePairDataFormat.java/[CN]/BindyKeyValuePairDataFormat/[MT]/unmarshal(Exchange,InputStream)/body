{
  BindyKeyValuePairFactory factory=getFactory(exchange.getContext().getPackageScanClassResolver());
  List<Map<String,Object>> models=new ArrayList<Map<String,Object>>();
  Map<String,Object> model;
  InputStreamReader in=new InputStreamReader(inputStream);
  Scanner scanner=new Scanner(in);
  ObjectHelper.notNull(factory.getPairSeparator(),"The pair separator property of the annotation @Message");
  String separator=factory.getPairSeparator();
  int count=0;
  try {
    while (scanner.hasNextLine()) {
      String line=scanner.nextLine().trim();
      if (ObjectHelper.isEmpty(line)) {
        continue;
      }
      count++;
      model=factory.factory();
      List<String> result=Arrays.asList(line.split(separator));
      if (result.size() == 0 || result.isEmpty()) {
        throw new java.lang.IllegalArgumentException("No records have been defined in the KVP !");
      }
      if (result.size() > 0) {
        factory.bind(result,model,count);
        factory.link(model);
        models.add(model);
        if (LOG.isDebugEnabled()) {
          LOG.debug("Graph of objects created : " + model);
        }
      }
    }
    if (models.size() == 0) {
      throw new java.lang.IllegalArgumentException("No records have been defined in the KVP !");
    }
 else {
      return models;
    }
  }
  finally {
    scanner.close();
    ObjectHelper.close(in,"in",LOG);
  }
}
