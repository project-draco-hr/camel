{
  int id=BATCH_COUNT.getAndIncrement();
  int batchSize=exchange.getProperty(SjmsBatchEndpoint.PROPERTY_BATCH_SIZE,Integer.class);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Processing batch[" + id + "]:size="+ batchSize+ ":total="+ MESSAGE_RECEIVED.addAndGet(batchSize));
  }
  SessionCompletion sessionCompletion=new SessionCompletion(session);
  exchange.addOnCompletion(sessionCompletion);
  try {
    processor.process(exchange);
    long total=MESSAGE_PROCESSED.addAndGet(batchSize);
    LOG.debug("Completed processing[{}]:total={}",id,total);
  }
 catch (  Exception e) {
    getExceptionHandler().handleException("Error processing exchange",exchange,e);
  }
}
