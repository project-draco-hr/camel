{
  String baseUri=uri;
  if (uri.indexOf("?") != -1) {
    baseUri=uri.substring(0,uri.indexOf("?"));
  }
  FtpConfiguration config=new FtpConfiguration(new URI(baseUri));
  FtpEndpoint answer=new FtpEndpoint(uri,this,config);
  if (IntrospectionSupport.hasProperties(parameters,"ftpClientConfig.")) {
    Map<String,Object> param=IntrospectionSupport.extractProperties(parameters,"ftpClientConfig.");
    answer.setFtpClientConfigParameters(param);
  }
  if (IntrospectionSupport.hasProperties(parameters,"ftpClient.")) {
    Map<String,Object> param=IntrospectionSupport.extractProperties(parameters,"ftpClient.");
    answer.setFtpClientParameters(param);
  }
  return answer;
}
