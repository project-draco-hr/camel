{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Received body: " + object);
  }
  Exchange exchange=endpoint.createExchange(session,object);
  if (endpoint.getCharsetName() != null) {
    exchange.setProperty(Exchange.CHARSET_NAME,endpoint.getCharsetName());
  }
  getProcessor().process(exchange);
  if (sync) {
    Object body;
    if (ExchangeHelper.isOutCapable(exchange)) {
      body=MinaPayloadHelper.getOut(endpoint,exchange);
    }
 else {
      body=MinaPayloadHelper.getIn(endpoint,exchange);
    }
    boolean failed=exchange.isFailed();
    if (failed && !endpoint.isTransferExchange()) {
      if (exchange.getException() != null) {
        body=exchange.getException();
      }
 else {
        body=exchange.getFault().getBody();
      }
    }
    if (body == null) {
      LOG.warn("Cannot write body since its null, closing session: " + exchange);
      session.close();
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Writing body: " + body);
      }
      MinaHelper.writeBody(session,body,exchange);
    }
  }
}
