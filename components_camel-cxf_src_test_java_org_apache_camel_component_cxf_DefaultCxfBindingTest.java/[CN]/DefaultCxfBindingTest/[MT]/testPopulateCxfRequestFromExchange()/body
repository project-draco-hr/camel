{
  DefaultCxfBinding cxfBinding=new DefaultCxfBinding();
  cxfBinding.setHeaderFilterStrategy(new DefaultHeaderFilterStrategy());
  Exchange exchange=new DefaultExchange(context);
  org.apache.cxf.message.Exchange cxfExchange=new org.apache.cxf.message.ExchangeImpl();
  exchange.setProperty(CxfConstants.CXF_EXCHANGE,cxfExchange);
  exchange.setProperty(CxfConstants.DATA_FORMAT_PROPERTY,DataFormat.PAYLOAD);
  Map<String,Object> requestContext=new HashMap<String,Object>();
  exchange.getIn().setHeader("soapAction","urn:hello:world");
  exchange.getIn().setHeader("MyFruitHeader","peach");
  exchange.getIn().addAttachment("att-1",new DataHandler(new FileDataSource("pom.xml")));
  cxfBinding.populateCxfRequestFromExchange(cxfExchange,exchange,requestContext);
  Map<String,List<String>> headers=CastUtils.cast((Map)requestContext.get(Message.PROTOCOL_HEADERS));
  assertNotNull(headers);
  assertTrue(headers.size() == 2);
  verifyHeader(headers,"soapaction","urn:hello:world");
  verifyHeader(headers,"SoapAction","urn:hello:world");
  verifyHeader(headers,"SOAPAction","urn:hello:world");
  verifyHeader(headers,"myfruitheader","peach");
  verifyHeader(headers,"myFruitHeader","peach");
  verifyHeader(headers,"MYFRUITHEADER","peach");
  Set<Attachment> attachments=CastUtils.cast((Set)requestContext.get(CxfConstants.CAMEL_CXF_ATTACHMENTS));
  assertNotNull(attachments);
  assertNotNull(attachments.size() == 1);
  Attachment att=attachments.iterator().next();
  assertEquals("att-1",att.getId());
}
