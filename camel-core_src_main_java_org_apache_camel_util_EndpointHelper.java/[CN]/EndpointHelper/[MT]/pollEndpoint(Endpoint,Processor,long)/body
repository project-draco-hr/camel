{
  PollingConsumer consumer=endpoint.createPollingConsumer();
  try {
    ServiceHelper.startService(consumer);
    while (true) {
      Exchange exchange=consumer.receive(timeout);
      if (exchange == null) {
        break;
      }
 else {
        processor.process(exchange);
      }
    }
  }
  finally {
    try {
      ServiceHelper.stopAndShutdownService(consumer);
    }
 catch (    Exception e) {
      LOG.warn("Failed to stop PollingConsumer: " + consumer + ". This example is ignored.",e);
    }
  }
}
