{
  PollingConsumer consumer=endpoint.createPollingConsumer();
  try {
    consumer.start();
    while (true) {
      Exchange exchange=consumer.receive(timeout);
      if (exchange == null) {
        break;
      }
 else {
        processor.process(exchange);
      }
    }
  }
  finally {
    try {
      consumer.stop();
    }
 catch (    Exception e) {
      LOG.warn("Failed to stop PollingConsumer: " + e,e);
    }
  }
}
