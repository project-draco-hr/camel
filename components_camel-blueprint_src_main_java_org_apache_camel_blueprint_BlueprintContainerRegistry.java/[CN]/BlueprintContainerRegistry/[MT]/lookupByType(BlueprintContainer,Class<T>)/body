{
  Map<String,T> objects=new LinkedHashMap<String,T>();
  for (  ComponentMetadata metadata : blueprintContainer.getMetadata(ComponentMetadata.class)) {
    boolean isSingleton=metadata instanceof BeanMetadata && (BeanMetadata.SCOPE_SINGLETON.equals(((BeanMetadata)metadata).getScope()) || ((BeanMetadata)metadata).getScope() == null);
    boolean isReference=metadata instanceof ReferenceMetadata;
    if (isSingleton || isReference) {
      Object o=blueprintContainer.getComponentInstance(metadata.getId());
      if (type.isInstance(o)) {
        objects.put(metadata.getId(),type.cast(o));
      }
    }
  }
  return objects;
}
