{
  LOG.debug("Creating DefaultCamelContext");
  DefaultCamelContext context=newCamelContext();
  if (bundleContext != null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Using OSGI resolvers");
    }
    updateRegistry(context);
    LOG.debug("Using OsgiFactoryFinderResolver");
    context.setFactoryFinderResolver(new OsgiFactoryFinderResolver());
    LOG.debug("Using OsgiPackageScanClassResolver");
    context.setPackageScanClassResolver(new OsgiPackageScanClassResolver(bundleContext));
    LOG.debug("Using OsgiComponentResolver");
    context.setComponentResolver(new OsgiComponentResolver());
    LOG.debug("Using OsgiLanguageResolver");
    context.setLanguageResolver(new OsgiLanguageResolver());
    addOsgiAnnotationTypeConverterLoader(context,bundleContext);
  }
 else {
    LOG.warn("BundleContext not set, cannot run in OSGI container");
  }
  return context;
}
