{
  String previousTransformerFactoryClassName=null;
  if (transformerFactoryClassName != null) {
    previousTransformerFactoryClassName=System.setProperty(XSLT_SYSTEM_PROPERTY_KEY,transformerFactoryClassName);
    getLog().info("Set the XSLT factory class name to be '" + transformerFactoryClassName + "'");
  }
  String contentTag="<div class=\"" + contentDivClass + "\"";
  getLog().info("Downloading: " + page);
  URL url=new URL(page);
  try {
    TidyMarkupDataFormat dataFormat=new TidyMarkupDataFormat();
    dataFormat.setMethod("html");
    Node doc=dataFormat.asNodeTidyMarkup(IOHelper.buffered(url.openStream()));
    XPath xpath=XPathFactory.newInstance().newXPath();
    Node nd=(Node)xpath.evaluate("//div[@class='" + contentDivClass + "']",doc,XPathConstants.NODE);
    if (nd != null) {
      return new XmlConverter().toString(nd,null);
    }
  }
 catch (  Throwable e) {
    if (errorOnDownloadFailure) {
      throw new MojoExecutionException("Download or validation of '" + page + "' failed: "+ e);
    }
 else {
      getLog().error("Download or validation of '" + page + "' failed: "+ e);
      return null;
    }
  }
 finally {
    if (transformerFactoryClassName != null) {
      if (previousTransformerFactoryClassName == null) {
        System.getProperties().remove(XSLT_SYSTEM_PROPERTY_KEY);
        getLog().info("Removed the set XSLT factory class name '" + transformerFactoryClassName + "' from the system properties");
      }
 else {
        System.setProperty(XSLT_SYSTEM_PROPERTY_KEY,previousTransformerFactoryClassName);
        getLog().info("Resetted the XSLT factory class name to be '" + previousTransformerFactoryClassName + "'");
      }
    }
  }
  throw new MojoExecutionException("The '" + page + "' page did not have a "+ contentTag+ " element.");
}
