{
  while (isRunAllowed()) {
    Exchange exchange;
    try {
      exchange=completedTasks.poll(1000,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Sleep interrupted, are we stopping? " + (isStopping() || isStopped()));
      }
      continue;
    }
    if (exchange != null) {
      try {
        if (exchange.hasOut()) {
          exchange.setIn(exchange.getOut());
          exchange.setOut(null);
        }
        if (LOG.isDebugEnabled()) {
          LOG.debug("Async reply received now routing the Exchange: " + exchange);
        }
        target.process(exchange);
      }
 catch (      Exception e) {
        getExceptionHandler().handleException(e);
      }
    }
  }
}
