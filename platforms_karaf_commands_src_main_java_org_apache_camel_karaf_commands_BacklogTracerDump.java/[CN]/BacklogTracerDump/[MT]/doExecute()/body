{
  CamelContext camel=camelController.getCamelContext(context);
  if (camel == null) {
    System.err.println("CamelContext " + context + " not found.");
    return null;
  }
  BacklogTracer backlogTracer=BacklogTracer.getBacklogTracer(camel);
  if (backlogTracer == null) {
    backlogTracer=(BacklogTracer)camel.getDefaultBacklogTracer();
  }
  if (format == null || "xml".equals(format)) {
    System.out.println("--------------------------------------------------------");
    if (pattern != null) {
      System.out.println("BacklogTracer messages:\n" + backlogTracer.dumpTracedMessages(pattern));
    }
 else {
      System.out.println("BacklogTracer messages:\n" + backlogTracer.dumpAllTracedMessagesAsXml());
    }
    return null;
  }
 else   if ("table".equals(format)) {
    JAXBContext context=JAXBContext.newInstance(MessageDump.class);
    Unmarshaller unmarshaller=context.createUnmarshaller();
    SimpleDateFormat sdf=new SimpleDateFormat(BacklogTracerEventMessage.TIMESTAMP_FORMAT);
    List<BacklogTracerEventMessage> events;
    if (pattern != null) {
      events=backlogTracer.dumpTracedMessages(pattern);
    }
 else {
      events=backlogTracer.dumpAllTracedMessages();
    }
    for (    BacklogTracerEventMessage event : events) {
      System.out.println("--------------------------------------------------------");
      System.out.println("#" + event.getUid() + "\tExchangeId: "+ event.getExchangeId());
      System.out.println("Timestamp: " + sdf.format(event.getTimestamp()));
      System.out.println("Route: " + event.getRouteId() + " --> "+ event.getToNode());
      MessageDump msg=(MessageDump)unmarshaller.unmarshal(new StringReader(event.getMessageAsXml()));
      String breadcrumb=getBreadcrumbId(msg.getHeaders());
      if (breadcrumb != null) {
        System.out.println("Breadcrumb: " + breadcrumb);
      }
      System.out.println("Body: " + msg.getBody().getValue());
    }
  }
  return null;
}
