{
  NotifyBuilder notify=new NotifyBuilder(context).whenExactlyFailed(2).create();
  assertEquals(false,notify.matches());
  template.sendBody("direct:foo","A");
  template.sendBody("direct:foo","B");
  template.sendBody("direct:foo","C");
  try {
    template.sendBody("direct:fail","D");
    fail("Should have thrown exception");
  }
 catch (  Exception e) {
  }
  template.sendBody("direct:bar","E");
  assertEquals(false,notify.matches());
  try {
    template.sendBody("direct:fail","F");
    fail("Should have thrown exception");
  }
 catch (  Exception e) {
  }
  assertEquals(true,notify.matches());
  template.sendBody("direct:bar","G");
  assertEquals(true,notify.matches());
  try {
    template.sendBody("direct:fail","H");
    fail("Should have thrown exception");
  }
 catch (  Exception e) {
  }
  assertEquals(false,notify.matches());
}
