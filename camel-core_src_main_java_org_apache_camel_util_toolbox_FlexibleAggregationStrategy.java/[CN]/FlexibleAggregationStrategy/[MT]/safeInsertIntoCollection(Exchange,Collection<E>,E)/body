{
  Collection<E> collection=null;
  try {
    if (oldValue == null || oldExchange.getProperty(COLLECTION_AGGR_GUARD_PROPERTY,Boolean.class) == null) {
      try {
        collection=(Collection<E>)collectionType.newInstance();
      }
 catch (      Exception e) {
        LOG.warn("Could not instantiate collection of type {}. Aborting aggregation.",collectionType);
        throw ObjectHelper.wrapCamelExecutionException(oldExchange,e);
      }
      oldExchange.setProperty(COLLECTION_AGGR_GUARD_PROPERTY,Boolean.FALSE);
    }
 else {
      collection=(Collection<E>)collectionType.cast(oldValue);
    }
    if (collection != null) {
      collection.add(toInsert);
    }
  }
 catch (  ClassCastException exception) {
    if (!ignoreInvalidCasts) {
      throw exception;
    }
  }
  return collection;
}
