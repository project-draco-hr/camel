{
  ChannelFuture answer;
  if (isTcp()) {
    ClientBootstrap clientBootstrap=new ClientBootstrap(channelFactory);
    clientBootstrap.setOption("keepAlive",configuration.isKeepAlive());
    clientBootstrap.setOption("tcpNoDelay",configuration.isTcpNoDelay());
    clientBootstrap.setOption("reuseAddress",configuration.isReuseAddress());
    clientBootstrap.setOption("connectTimeoutMillis",configuration.getConnectTimeout());
    if (configuration.getOptions() != null) {
      for (      Map.Entry<String,Object> entry : configuration.getOptions().entrySet()) {
        clientBootstrap.setOption(entry.getKey(),entry.getValue());
      }
    }
    clientBootstrap.setPipelineFactory(pipelineFactory);
    answer=clientBootstrap.connect(new InetSocketAddress(configuration.getHost(),configuration.getPort()));
    if (LOG.isDebugEnabled()) {
      LOG.debug("Created new TCP client bootstrap connecting to {}:{} with options: {}",new Object[]{configuration.getHost(),configuration.getPort(),clientBootstrap.getOptions()});
    }
    return answer;
  }
 else {
    ConnectionlessBootstrap connectionlessClientBootstrap=new ConnectionlessBootstrap(datagramChannelFactory);
    connectionlessClientBootstrap.setOption("child.keepAlive",configuration.isKeepAlive());
    connectionlessClientBootstrap.setOption("child.tcpNoDelay",configuration.isTcpNoDelay());
    connectionlessClientBootstrap.setOption("child.reuseAddress",configuration.isReuseAddress());
    connectionlessClientBootstrap.setOption("child.connectTimeoutMillis",configuration.getConnectTimeout());
    connectionlessClientBootstrap.setOption("child.broadcast",configuration.isBroadcast());
    connectionlessClientBootstrap.setOption("sendBufferSize",configuration.getSendBufferSize());
    connectionlessClientBootstrap.setOption("receiveBufferSize",configuration.getReceiveBufferSize());
    if (configuration.getOptions() != null) {
      for (      Map.Entry<String,Object> entry : configuration.getOptions().entrySet()) {
        connectionlessClientBootstrap.setOption(entry.getKey(),entry.getValue());
      }
    }
    connectionlessClientBootstrap.setPipelineFactory(pipelineFactory);
    Channel channel=connectionlessClientBootstrap.bind(new InetSocketAddress(0));
    ALL_CHANNELS.add(channel);
    answer=connectionlessClientBootstrap.connect(new InetSocketAddress(configuration.getHost(),configuration.getPort()));
    if (LOG.isDebugEnabled()) {
      LOG.debug("Created new UDP client bootstrap connecting to {}:{} with options: {}",new Object[]{configuration.getHost(),configuration.getPort(),connectionlessClientBootstrap.getOptions()});
    }
    return answer;
  }
}
