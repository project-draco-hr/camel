{
  super.doStart();
  ObjectHelper.notNull(camelContext,"CamelContext",this);
  if (spanCollector == null) {
    String host=camelContext.resolvePropertyPlaceholders("{{service.host:zipkin}}");
    String port=camelContext.resolvePropertyPlaceholders("{{service.port:zipkin}}");
    if (ObjectHelper.isNotEmpty(host) && ObjectHelper.isNotEmpty(port)) {
      log.info("Auto-configuring ZipkinScribeSpanCollector using host: {} and port: {}",host,port);
      int num=camelContext.getTypeConverter().mandatoryConvertTo(Integer.class,port);
      spanCollector=new ScribeSpanCollector(host,num);
    }
  }
  ObjectHelper.notNull(spanCollector,"SpanCollector",this);
  if (serviceMappings.isEmpty()) {
    log.warn("No service name(s) has been configured. Camel will fallback and use endpoint uris as service names.");
    useFallbackServiceNames=true;
  }
  for (  Map.Entry<String,String> entry : serviceMappings.entrySet()) {
    String pattern=entry.getKey();
    String serviceName=entry.getValue();
    Brave brave=braves.get(pattern);
    if (brave == null) {
      Brave.Builder builder=new Brave.Builder(serviceName);
      builder=builder.traceSampler(Sampler.create(rate));
      if (spanCollector != null) {
        builder=builder.spanCollector(spanCollector);
      }
      brave=builder.build();
      braves.put(serviceName,brave);
    }
  }
  ServiceHelper.startService(spanCollector);
}
