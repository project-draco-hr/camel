{
  final CountDownLatch latch=new CountDownLatch(1);
  CamelContainer container=new CamelContainer();
  JmsTemplate template=new JmsTemplate(new ActiveMQConnectionFactory("vm://localhost?broker.persistent=false"));
  template.setSessionAcknowledgeMode(Session.AUTO_ACKNOWLEDGE);
  template.setSessionTransacted(false);
  container.addComponent("activemq",jmsComponent(template));
  container.routes(new RouteBuilder(){
    public void configure(){
      from("jms:activemq:test.a").to("jms:activemq:test.b");
      from("jms:activemq:test.b").process(new Processor<JmsExchange>(){
        public void onExchange(        JmsExchange exchange){
          System.out.println("Received exchange: " + exchange.getRequest());
          latch.countDown();
        }
      }
);
    }
  }
);
  Endpoint<JmsExchange> endpoint=container.endpoint("jms:activemq:test.a");
  JmsExchange exchange2=endpoint.createExchange();
  exchange2.setHeader("cheese",123);
  endpoint.send(exchange2);
  boolean received=latch.await(5,TimeUnit.SECONDS);
  assertTrue("Did not recieve the message!",received);
}
