{
  int messages=0;
  shutdownRunningTask=null;
  pendingExchanges=0;
  Queue<Exchange> queue=new LinkedList<Exchange>();
  ListContainerOptions opt=new ListContainerOptions();
  for (  StorageMetadata md : blobStore.list(endpoint.getContainer(),opt.maxResults(maxMessagesPerPoll))) {
    messages++;
    String blobName=md.getName();
    Object body=JcloudsBlobStoreHelper.readBlob(blobStore,endpoint.getContainer(),blobName,Thread.currentThread().getContextClassLoader());
    Exchange exchange=endpoint.createExchange();
    exchange.getIn().setBody(body);
    exchange.setProperty(JcloudsConstants.BLOB_NAME,blobName);
    queue.add(exchange);
  }
  return queue.isEmpty() ? 0 : processBatch(CastUtils.cast(queue));
}
