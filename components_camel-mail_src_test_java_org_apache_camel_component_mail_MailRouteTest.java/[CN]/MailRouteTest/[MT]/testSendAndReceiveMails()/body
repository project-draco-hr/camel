{
  Mailbox.clearAll();
  MockEndpoint resultEndpoint=getMockEndpoint("mock:result");
  resultEndpoint.expectedBodiesReceived("hello world!");
  HashMap<String,Object> headers=new HashMap<String,Object>();
  headers.put("reply-to","route-test-reply@localhost");
  template.sendBodyAndHeaders("smtp://route-test-james@localhost","hello world!",headers);
  assertMailboxReceivedMessages("route-test-james@localhost");
  Thread.sleep(3000);
  resultEndpoint.assertIsSatisfied();
  Exchange exchange=resultEndpoint.getReceivedExchanges().get(0);
  String replyTo=(String)exchange.getIn().getHeader("reply-to");
  assertEquals("route-test-reply@localhost",replyTo);
  assertMailboxReceivedMessages("route-test-copy@localhost");
}
