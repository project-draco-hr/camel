{
  getMockEndpoint("mock:bar").expectedMessageCount(1);
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedBodiesReceived("Hello World");
  mock.expectedHeaderReceived("JMSReplyTo","topic://bar");
  template.send("activemq:queue:foo?preserveMessageQos=true",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("World");
      exchange.getIn().setHeader("JMSReplyTo","topic:bar");
    }
  }
);
  assertMockEndpointsSatisfied();
}
