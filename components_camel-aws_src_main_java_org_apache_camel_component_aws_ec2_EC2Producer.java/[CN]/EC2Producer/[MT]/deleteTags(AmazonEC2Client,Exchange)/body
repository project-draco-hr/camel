{
  Collection instanceIds;
  Collection tags;
  DeleteTagsRequest request=new DeleteTagsRequest();
  if (ObjectHelper.isNotEmpty(exchange.getIn().getHeader(EC2Constants.INSTANCES_IDS))) {
    instanceIds=exchange.getIn().getHeader(EC2Constants.INSTANCES_IDS,Collection.class);
    request.withResources(instanceIds);
  }
 else {
    throw new IllegalArgumentException("Instances Ids must be specified");
  }
  if (ObjectHelper.isNotEmpty(exchange.getIn().getHeader(EC2Constants.INSTANCES_TAGS))) {
    tags=exchange.getIn().getHeader(EC2Constants.INSTANCES_TAGS,Collection.class);
    request.withTags(tags);
  }
 else {
    throw new IllegalArgumentException("Tags must be specified");
  }
  DeleteTagsResult result=new DeleteTagsResult();
  try {
    result=ec2Client.deleteTags(request);
  }
 catch (  AmazonServiceException ase) {
    LOG.trace("Delete tags command returned the error code {}",ase.getErrorCode());
    throw ase;
  }
  LOG.trace("Delete tags [{}] on resources with Ids [{}] ",Arrays.toString(tags.toArray()),Arrays.toString(instanceIds.toArray()));
  Message message=getMessageForResponse(exchange);
  message.setBody(result);
}
