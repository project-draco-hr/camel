{
  GroupedExchange grouped=null;
  Iterator<Exchange> iter=collection.iterator();
  while (iter.hasNext()) {
    Exchange exchange=iter.next();
    iter.remove();
    if (!groupExchanges) {
      processExchange(exchange);
    }
 else {
      if (grouped == null) {
        grouped=new GroupedExchange(exchange.getContext());
      }
      grouped.addExchange(exchange);
    }
  }
  if (grouped != null) {
    processExchange(grouped);
  }
}
