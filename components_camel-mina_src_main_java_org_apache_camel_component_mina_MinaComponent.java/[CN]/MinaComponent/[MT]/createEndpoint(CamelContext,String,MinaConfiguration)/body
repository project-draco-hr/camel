{
  String protocol=config.getProtocol();
  if (protocol != null) {
    if (protocol.equals("tcp")) {
      return createSocketEndpoint(context,uri,config);
    }
 else     if (protocol.equals("udp") || protocol.equals("mcast") || protocol.equals("multicast")) {
      return createDatagramEndpoint(context,uri,config);
    }
 else     if (protocol.equals("vm")) {
      return createVmEndpoint(context,uri,config);
    }
  }
  throw new IllegalArgumentException("Unrecognised MINA protocol: " + protocol + " for uri: "+ uri);
}
