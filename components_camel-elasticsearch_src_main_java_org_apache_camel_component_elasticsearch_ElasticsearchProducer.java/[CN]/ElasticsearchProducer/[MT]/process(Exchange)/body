{
  String operation=(String)exchange.getIn().getHeader(ElasticsearchConfiguration.PARAM_OPERATION);
  if (operation == null) {
    operation=endpoint.getConfig().getOperation();
  }
  if (operation == null) {
    throw new IllegalArgumentException(ElasticsearchConfiguration.PARAM_OPERATION + " is missing");
  }
  Client client=endpoint.getClient();
  if (operation.equalsIgnoreCase(ElasticsearchConfiguration.OPERATION_INDEX)) {
    addToIndex(client,exchange);
  }
 else   if (operation.equalsIgnoreCase(ElasticsearchConfiguration.OPERATION_GET_BY_ID)) {
    getById(client,exchange);
  }
 else {
    throw new IllegalArgumentException(ElasticsearchConfiguration.PARAM_OPERATION + " value '" + operation+ "' is not supported");
  }
}
