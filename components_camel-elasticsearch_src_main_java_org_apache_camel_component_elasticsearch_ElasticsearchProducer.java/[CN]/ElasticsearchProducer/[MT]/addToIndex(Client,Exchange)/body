{
  String indexName=exchange.getIn().getHeader(ElasticsearchConfiguration.PARAM_INDEX_NAME,String.class);
  if (indexName == null) {
    indexName=getEndpoint().getConfig().getIndexName();
  }
  String indexType=exchange.getIn().getHeader(ElasticsearchConfiguration.PARAM_INDEX_TYPE,String.class);
  if (indexType == null) {
    indexType=getEndpoint().getConfig().getIndexType();
  }
  String indexId=exchange.getIn().getHeader(ElasticsearchConfiguration.PARAM_INDEX_ID,String.class);
  IndexRequestBuilder prepareIndex=client.prepareIndex(indexName,indexType,indexId);
  Object document=extractDocumentFromMessage(exchange.getIn());
  if (!setIndexRequestSource(document,prepareIndex)) {
    throw new ExpectedBodyTypeException(exchange,XContentBuilder.class);
  }
  ListenableActionFuture<IndexResponse> future=prepareIndex.execute();
  IndexResponse response=future.actionGet();
  exchange.getIn().setBody(response.getId());
}
