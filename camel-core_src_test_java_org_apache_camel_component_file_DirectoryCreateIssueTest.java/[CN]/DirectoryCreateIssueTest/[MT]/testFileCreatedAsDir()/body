{
  log.debug("testFileCreatedAsDir");
  final String path="target/a/b/c/d/e/f/g/h";
  final int numFiles=10;
  context.addRoutes(new RouteBuilder(){
    @Override public void configure(){
      String[] destinations=new String[numFiles];
      for (int i=0; i < numFiles; i++) {
        destinations[i]="seda:file" + i;
        from("seda:file" + i).setHeader(FileComponent.HEADER_FILE_NAME,constant("file" + i + ".txt")).to("file://" + path + "/?append=false&noop=true");
      }
      from("seda:testFileCreatedAsDir").to(destinations);
    }
  }
);
  deleteDirectory(new File("a"));
  template.send("seda:testFileCreatedAsDir",new Processor(){
    public void process(    Exchange exchange){
      Message in=exchange.getIn();
      in.setBody("Contents of test file");
    }
  }
);
  Thread.sleep(2 * 1000);
  for (int i=0; i < numFiles; i++) {
    assertTrue((new File(path + "/file" + i+ ".txt")).isFile());
  }
}
