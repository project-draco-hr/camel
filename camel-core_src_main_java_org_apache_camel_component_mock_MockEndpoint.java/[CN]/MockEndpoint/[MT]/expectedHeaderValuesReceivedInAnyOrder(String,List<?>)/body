{
  expectedMessageCount(values.size());
  expects(new Runnable(){
    public void run(){
      final Set<Object> actualHeaderValues=new CopyOnWriteArraySet<Object>(values);
      for (int i=0; i < getReceivedExchanges().size(); i++) {
        Exchange exchange=getReceivedExchange(i);
        Object actualValue=exchange.getIn().getHeader(name);
        for (        Object expectedValue : actualHeaderValues) {
          actualValue=extractActualValue(exchange,actualValue,expectedValue);
          actualHeaderValues.remove(actualValue);
        }
      }
      assertTrue("Expected " + values.size() + " headers with key["+ name+ "], received "+ (values.size() - actualHeaderValues.size())+ " headers. Expected header values: "+ actualHeaderValues,actualHeaderValues.isEmpty());
    }
  }
);
}
