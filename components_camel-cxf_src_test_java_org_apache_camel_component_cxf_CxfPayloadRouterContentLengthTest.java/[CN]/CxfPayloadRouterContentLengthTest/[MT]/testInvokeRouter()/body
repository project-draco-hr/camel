{
  CloseableHttpClient httpclient=HttpClients.createDefault();
  long contentLength=0;
  boolean isChunked=false;
  String receivedContent=null;
  try {
    HttpPost httppost=new HttpPost("http://localhost:" + CXFTestSupport.getPort1() + "/TEST/PROXY");
    StringEntity reqEntity=new StringEntity(REQUEST_MESSAGE,ContentType.TEXT_XML);
    reqEntity.setChunked(false);
    httppost.setEntity(reqEntity);
    CloseableHttpResponse response=httpclient.execute(httppost);
    try {
      HttpEntity respEntity=response.getEntity();
      contentLength=respEntity.getContentLength();
      isChunked=respEntity.isChunked();
      receivedContent=EntityUtils.toString(respEntity);
      EntityUtils.consume(response.getEntity());
    }
  finally {
      response.close();
    }
  }
  finally {
    httpclient.close();
  }
  assertNotNull(receivedContent);
  if (!isChunked) {
    assertEquals(receivedContent.length(),contentLength);
  }
  assertTrue("[" + receivedContent + "] does not contain ["+ RESPONSE_STRING+ "]",receivedContent.contains(RESPONSE_STRING));
  assertTrue("[" + receivedContent + "] does not contain the closing Envelope tag.",receivedContent.matches(".*\\</.*:Envelope\\>"));
}
