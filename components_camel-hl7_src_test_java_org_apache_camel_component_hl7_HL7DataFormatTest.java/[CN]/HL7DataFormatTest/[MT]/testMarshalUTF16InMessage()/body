{
  String charsetName="UTF-16";
  MockEndpoint mock=getMockEndpoint("mock:marshal");
  mock.expectedMessageCount(1);
  Message message=createHL7WithCharsetAsMessage(HL7Charset.getHL7Charset(charsetName));
  template.sendBodyAndProperty("direct:marshal",message,Exchange.CHARSET_NAME,charsetName);
  assertMockEndpointsSatisfied();
  byte[] body=(byte[])mock.getExchanges().get(0).getIn().getBody();
  String msg=new String(body,Charset.forName(charsetName));
  assertTrue(msg.contains("MSA|AA|123"));
  assertTrue(msg.contains("QRD|20080805120000"));
}
