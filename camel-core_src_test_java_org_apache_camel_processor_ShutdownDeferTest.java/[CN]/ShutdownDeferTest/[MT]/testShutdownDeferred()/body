{
  deleteDirectory("target/deferred");
  MockEndpoint bar=getMockEndpoint("mock:bar");
  bar.expectedMinimumMessageCount(1);
  bar.setResultWaitTime(3000);
  template.sendBody("seda:foo","A");
  template.sendBody("seda:foo","B");
  template.sendBody("seda:foo","C");
  template.sendBody("seda:foo","D");
  template.sendBody("seda:foo","E");
  template.sendBody("seda:foo","F");
  template.sendBody("seda:foo","G");
  template.sendBody("seda:foo","H");
  assertMockEndpointsSatisfied();
  context.stop();
  assertEquals("Should complete all 8 messages",8,bar.getReceivedCounter());
}
