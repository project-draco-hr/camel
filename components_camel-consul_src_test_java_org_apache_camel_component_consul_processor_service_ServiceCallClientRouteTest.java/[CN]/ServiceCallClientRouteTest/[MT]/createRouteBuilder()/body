{
  return new RouteBuilder(){
    @Override public void configure() throws Exception {
      ConsulConfigurationDefinition config=new ConsulConfigurationDefinition();
      config.setComponent("http");
      config.setLoadBalancer(new RoundRobinServiceCallLoadBalancer());
      config.setServerListStrategy(ConsulServiceCallServerListStrategies.onDemand(new ConsulConfiguration(context()),SERVICE_NAME));
      context.setServiceCallConfiguration(config);
      from("direct:start").serviceCall(SERVICE_NAME).to("log:org.apache.camel.component.consul.processor.service?level=INFO&showAll=true&multiline=true").to("mock:result");
      for (int i=SERVICE_PORT_BASE; i < SERVICE_PORT_BASE + SERVICE_COUNT; i++) {
        fromF("jetty:http://127.0.0.1:%d",i).transform().simple("${in.body} on " + i);
      }
    }
  }
;
}
