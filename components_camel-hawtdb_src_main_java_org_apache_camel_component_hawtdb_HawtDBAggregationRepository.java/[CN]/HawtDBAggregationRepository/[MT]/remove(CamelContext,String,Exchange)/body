{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Removing key [" + key + "]");
  }
  try {
    final Buffer keyBuffer=codec.marshallKey(key);
    final Buffer confirmKeyBuffer=codec.marshallKey(exchange.getExchangeId());
    final Buffer exchangeBuffer=codec.marshallExchange(camelContext,exchange);
    hawtDBFile.execute(new Work<Buffer>(){
      public Buffer execute(      Transaction tx){
        SortedIndex<Buffer,Buffer> index=hawtDBFile.getRepositoryIndex(tx,repositoryName,true);
        index.remove(keyBuffer);
        SortedIndex<Buffer,Buffer> indexCompleted=hawtDBFile.getRepositoryIndex(tx,getRepositoryNameCompleted(),true);
        indexCompleted.put(confirmKeyBuffer,exchangeBuffer);
        return null;
      }
      @Override public String toString(){
        return "Removing key [" + key + "]";
      }
    }
);
  }
 catch (  IOException e) {
    throw new RuntimeException("Error removing key " + key + " from repository "+ repositoryName,e);
  }
}
