{
  try {
    final Buffer keyBuffer=marshallKey(key);
    final Buffer exchangeBuffer=marshallExchange(camelContext,exchange);
    Buffer rc=file.execute(new Work<Buffer>(){
      public Buffer execute(      Transaction tx){
        Index<Buffer,Buffer> index=file.getRepositoryIndex(tx,name);
        return index.put(keyBuffer,exchangeBuffer);
      }
    }
);
    if (rc == null) {
      return null;
    }
    return unmarshallExchange(camelContext,rc);
  }
 catch (  IOException e) {
    throw new RuntimeException("Error adding to repository " + name + " with key "+ key,e);
  }
}
