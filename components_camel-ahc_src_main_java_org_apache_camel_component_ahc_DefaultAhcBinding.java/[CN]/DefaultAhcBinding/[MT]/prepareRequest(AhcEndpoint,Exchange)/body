{
  if (endpoint.isBridgeEndpoint()) {
    exchange.setProperty(Exchange.SKIP_GZIP_ENCODING,Boolean.TRUE);
    exchange.getIn().getHeaders().remove("host");
  }
  RequestBuilder builder=new RequestBuilder();
  URI uri;
  try {
    String url=AhcHelper.createURL(exchange,endpoint);
    uri=AhcHelper.createURI(exchange,url,endpoint);
    url=uri.toASCIIString();
    log.trace("Setting url {}",url);
    builder.setUrl(url);
  }
 catch (  Exception e) {
    throw new CamelExchangeException("Error creating URL",exchange,e);
  }
  String method=extractMethod(exchange);
  log.trace("Setting method {}",method);
  builder.setMethod(method);
  populateHeaders(builder,endpoint,exchange);
  populateCookieHeaders(builder,endpoint,exchange,uri);
  populateBody(builder,endpoint,exchange);
  return builder.build();
}
