{
  HeaderFilterStrategy strategy=endpoint.getHeaderFilterStrategy();
  for (  Map.Entry<String,Object> entry : exchange.getIn().getHeaders().entrySet()) {
    String headerValue=exchange.getIn().getHeader(entry.getKey(),String.class);
    if (strategy != null && !strategy.applyFilterToCamelHeaders(entry.getKey(),headerValue,exchange)) {
      if (log.isTraceEnabled()) {
        log.trace("Adding header {} = {}",entry.getKey(),headerValue);
      }
      builder.addHeader(entry.getKey(),headerValue);
    }
  }
}
