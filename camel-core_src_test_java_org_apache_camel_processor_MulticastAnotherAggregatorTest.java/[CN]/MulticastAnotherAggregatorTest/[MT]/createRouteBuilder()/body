{
  return new RouteBuilder(){
    public void configure(){
      ThreadPoolExecutor tpExecutor=new ThreadPoolExecutor(1,10,0,TimeUnit.MILLISECONDS,new ArrayBlockingQueue<Runnable>(10));
      tpExecutor.setRejectedExecutionHandler(new WorkQueuePolicy());
      from("direct:parallel").multicast(new BodyOutAggregatingStrategy(),true).executorService(tpExecutor).to("direct:x","direct:y","direct:z");
      from("direct:sequential").multicast(new BodyOutAggregatingStrategy()).to("direct:x","direct:y","direct:z");
      from("direct:x").process(new AppendingProcessor("x")).to("direct:aggregator");
      from("direct:y").process(new AppendingProcessor("y")).to("direct:aggregator");
      from("direct:z").process(new AppendingProcessor("z")).to("direct:aggregator");
      from("direct:aggregator").aggregate(header("cheese"),new BodyInAggregatingStrategy()).completionPredicate(property(Exchange.AGGREGATED_SIZE).isEqualTo(3)).to("mock:result");
    }
  }
;
}
