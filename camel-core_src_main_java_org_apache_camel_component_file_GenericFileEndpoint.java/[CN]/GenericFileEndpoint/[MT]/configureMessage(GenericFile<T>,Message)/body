{
  message.setBody(file);
  if (flatten) {
    message.setHeader(Exchange.FILE_NAME,file.getFileNameOnly());
  }
 else {
    String name=file.isAbsolute() ? file.getAbsoluteFilePath() : file.getRelativeFilePath();
    String endpointPath=getConfiguration().getDirectory() + getFileSeparator();
    endpointPath=FileUtil.normalizePath(endpointPath);
    String copyOfName=FileUtil.normalizePath(name);
    if (ObjectHelper.isNotEmpty(endpointPath) && copyOfName.startsWith(endpointPath)) {
      name=name.substring(endpointPath.length());
    }
    message.setHeader(Exchange.FILE_NAME,name);
  }
}
