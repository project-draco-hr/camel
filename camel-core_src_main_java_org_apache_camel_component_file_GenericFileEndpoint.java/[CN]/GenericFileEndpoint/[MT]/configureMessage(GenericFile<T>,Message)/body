{
  message.setBody(file);
  if (flatten) {
    message.setHeader(Exchange.FILE_NAME,file.getFileNameOnly());
  }
 else {
    String name=file.isAbsolute() ? file.getAbsoluteFilePath() : file.getRelativeFilePath();
    String endpointPath=getConfiguration().getDirectory() + getFileSeparator();
    if (ObjectHelper.isNotEmpty(endpointPath) && name.startsWith(endpointPath)) {
      name=ObjectHelper.after(name,endpointPath);
    }
    message.setHeader(Exchange.FILE_NAME,name);
  }
}
