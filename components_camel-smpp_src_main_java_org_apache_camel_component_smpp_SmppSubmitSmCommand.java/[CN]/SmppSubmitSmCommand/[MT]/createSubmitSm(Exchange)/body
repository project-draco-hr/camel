{
  String body=exchange.getIn().getBody(String.class);
  byte providedAlphabet=getProvidedAlphabet(exchange);
  Alphabet determinedAlphabet=determineAlphabet(exchange);
  Charset charset=determineCharset(providedAlphabet,determinedAlphabet.value());
  byte[] shortMessage=body.getBytes(charset);
  SubmitSm template=createSubmitSmTemplate(exchange);
  SmppSplitter splitter=createSplitter(exchange);
  byte[][] segments=splitter.split(shortMessage);
  if (segments.length > 1) {
    template.setEsmClass(new ESMClass(MessageMode.DEFAULT,MessageType.DEFAULT,GSMSpecificFeature.UDHI).value());
  }
  SubmitSm[] submitSms=new SubmitSm[segments.length];
  for (int i=0; i < segments.length; i++) {
    SubmitSm submitSm=SmppUtils.copySubmitSm(template);
    submitSm.setShortMessage(segments[i]);
    submitSms[i]=submitSm;
  }
  return submitSms;
}
