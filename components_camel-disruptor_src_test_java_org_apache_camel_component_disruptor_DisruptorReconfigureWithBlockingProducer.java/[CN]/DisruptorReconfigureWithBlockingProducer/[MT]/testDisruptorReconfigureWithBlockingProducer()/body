{
  getMockEndpoint("mock:a").expectedMessageCount(20);
  getMockEndpoint("mock:b").expectedMinimumMessageCount(10);
  long beforeStart=System.currentTimeMillis();
  ProducerThread producerThread=new ProducerThread();
  producerThread.start();
  assertTrue(producerThread.awaitFullBufferProduced());
  context.addRoutes(new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("disruptor:foo?multipleConsumers=true&size=8").id("testRoute").to("mock:b");
    }
  }
);
  assertTrue("Reconfigure of Disruptor blocked",(System.currentTimeMillis() - beforeStart) < 2000);
  assertTrue(producerThread.checkResult());
  assertMockEndpointsSatisfied();
}
