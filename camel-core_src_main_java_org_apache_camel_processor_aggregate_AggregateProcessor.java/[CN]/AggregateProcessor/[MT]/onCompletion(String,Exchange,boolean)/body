{
  exchange.setProperty(Exchange.AGGREGATED_CORRELATION_KEY,key);
  aggregationRepository.remove(exchange.getContext(),key,exchange);
  if (!fromTimeout && timeoutMap != null) {
    timeoutMap.remove(key);
  }
  if (closedCorrelationKeys != null) {
    closedCorrelationKeys.put(key,key);
  }
  if (fromTimeout) {
    if (aggregationStrategy instanceof TimeoutAwareAggregationStrategy) {
      long timeout=getCompletionTimeout() > 0 ? getCompletionTimeout() : -1;
      ((TimeoutAwareAggregationStrategy)aggregationStrategy).timeout(exchange,-1,-1,timeout);
    }
  }
  if (fromTimeout && isDiscardOnCompletionTimeout()) {
    LOG.debug("Aggregation for correlation key {} discarding aggregated exchange: ()",key,exchange);
    aggregationRepository.confirm(exchange.getContext(),exchange.getExchangeId());
    redeliveryState.remove(exchange.getExchangeId());
  }
 else {
    onSubmitCompletion(key,exchange);
  }
}
