{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Aggregation complete for correlation key " + key + " sending aggregated exchange: "+ exchange);
  }
  inProgressCompleteExchanges.add(exchange.getExchangeId());
  executorService.submit(new Runnable(){
    public void run(){
      try {
        processor.process(exchange);
      }
 catch (      Exception e) {
        exchange.setException(e);
      }
catch (      Throwable t) {
        exchange.setException(new CamelExchangeException("Error processing aggregated exchange",exchange,t));
      }
      try {
        if (exchange.getException() == null) {
          aggregationRepository.confirm(exchange.getContext(),exchange.getExchangeId());
        }
 else {
          getExceptionHandler().handleException("Error processing aggregated exchange",exchange,exchange.getException());
        }
      }
  finally {
        inProgressCompleteExchanges.remove(exchange.getExchangeId());
      }
    }
  }
);
}
