{
  if (!camelContext.getStatus().isStarted()) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Recover check cannot start due CamelContext(" + camelContext.getName() + ") has not been started yet");
    }
    return;
  }
  LOG.trace("Starting recover check");
  Set<String> exchangeIds=recoverable.scan(camelContext);
  for (  String exchangeId : exchangeIds) {
    if (!isRunAllowed()) {
      LOG.info("We are shutting down so stop recovering");
      return;
    }
    boolean inProgress=inProgressCompleteExchanges.contains(exchangeId);
    if (inProgress) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Aggregated exchange with id " + exchangeId + " is already in progress.");
      }
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Recovering aggregated exchange with id " + exchangeId);
      }
      Exchange exchange=recoverable.recover(camelContext,exchangeId);
      if (exchange != null) {
        String key=exchange.getProperty(Exchange.AGGREGATED_CORRELATION_KEY,String.class);
        exchange.getIn().setHeader(Exchange.REDELIVERED,Boolean.TRUE);
        onSubmitCompletion(key,exchange);
      }
    }
  }
  LOG.trace("Recover check complete");
}
