{
  String value=getAndRemoveParameter(parameters,key,String.class);
  if (value == null) {
    return defaultValue;
  }
 else   if (EndpointHelper.isReferenceParameter(value)) {
    return EndpointHelper.resolveReferenceParameter(getCamelContext(),value,type);
  }
 else {
    return getCamelContext().getTypeConverter().convertTo(type,value);
  }
}
