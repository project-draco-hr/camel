{
  String value=getAndRemoveParameter(parameters,key,String.class);
  if (EndpointHelper.isReferenceParameter(value)) {
    T result=EndpointHelper.resolveReferenceParameter(getCamelContext(),value.toString(),type);
    return result == null ? defaultValue : result;
  }
 else   if (value == null) {
    return defaultValue;
  }
 else {
    throw new IllegalArgumentException("Parameter value " + value + " is not a valid reference");
  }
}
