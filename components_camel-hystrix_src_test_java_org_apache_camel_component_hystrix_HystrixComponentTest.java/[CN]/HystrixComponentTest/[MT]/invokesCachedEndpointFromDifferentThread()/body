{
  resultEndpoint.expectedMessageCount(1);
  errorEndpoint.expectedMessageCount(0);
  template.sendBodyAndHeader("body","key","cachedKey");
  final CountDownLatch latch=new CountDownLatch(1);
  new Thread(new Runnable(){
    @Override public void run(){
      template.sendBodyAndHeader("body","key","cachedKey");
      latch.countDown();
    }
  }
).start();
  latch.await(2,TimeUnit.SECONDS);
  assertMockEndpointsSatisfied();
}
