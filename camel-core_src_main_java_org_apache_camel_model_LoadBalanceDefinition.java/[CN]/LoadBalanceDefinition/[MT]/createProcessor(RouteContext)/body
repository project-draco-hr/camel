{
  LoadBalancer loadBalancer=loadBalancerType.getLoadBalancer(routeContext);
  if (loadBalancer == null) {
    loadBalancer=loadBalancerType.createLoadBalancer(routeContext);
    loadBalancerType.setLoadBalancer(loadBalancer);
    int max=loadBalancerType.getMaximumNumberOfOutputs();
    int size=getOutputs().size();
    if (size > max) {
      throw new IllegalArgumentException("To many outputs configured on " + loadBalancerType + ": "+ size+ " > "+ max);
    }
    for (    ProcessorDefinition<?> processorType : getOutputs()) {
      if (LoadBalanceDefinition.class.isInstance(processorType)) {
        throw new IllegalArgumentException("Loadbalancer already configured to: " + loadBalancerType + ". Cannot set it to: "+ processorType);
      }
      Processor processor=createProcessor(routeContext,processorType);
      processor=wrapChannel(routeContext,processor,processorType);
      loadBalancer.addProcessor(processor);
    }
  }
  return loadBalancer;
}
