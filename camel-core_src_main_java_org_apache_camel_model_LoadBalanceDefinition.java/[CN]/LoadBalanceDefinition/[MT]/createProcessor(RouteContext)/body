{
  LoadBalancer loadBalancer=LoadBalancerDefinition.getLoadBalancer(routeContext,loadBalancerType,ref);
  for (  ProcessorDefinition<?> processorType : getOutputs()) {
    if (LoadBalanceDefinition.class.isInstance(processorType)) {
      throw new IllegalArgumentException("Loadbalancer already configured to: " + loadBalancerType + ". Cannot set it to: "+ processorType);
    }
    Processor processor=processorType.createProcessor(routeContext);
    processor=wrapChannel(routeContext,processor,processorType);
    loadBalancer.addProcessor(processor);
  }
  return loadBalancer;
}
