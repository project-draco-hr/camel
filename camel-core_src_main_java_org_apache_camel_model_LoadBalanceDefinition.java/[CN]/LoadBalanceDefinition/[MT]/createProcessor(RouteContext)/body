{
  LoadBalancer loadBalancer=LoadBalancerDefinition.getLoadBalancer(routeContext,loadBalancerType,ref);
  for (  ProcessorDefinition<?> processorType : getOutputs()) {
    if (processorType instanceof LoadBalanceDefinition) {
      throw new IllegalArgumentException("Loadbalancer already configured to: " + loadBalancerType + ". Cannot set it to: "+ processorType);
    }
    Processor processor=processorType.createProcessor(routeContext);
    processor=wrapProcessor(routeContext,processor);
    loadBalancer.addProcessor(processor);
  }
  return loadBalancer;
}
