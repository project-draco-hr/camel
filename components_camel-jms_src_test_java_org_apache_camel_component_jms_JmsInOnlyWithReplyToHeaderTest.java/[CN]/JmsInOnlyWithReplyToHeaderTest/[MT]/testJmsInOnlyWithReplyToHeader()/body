{
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedBodiesReceived("Hello World");
  mock.expectedHeaderReceived("JMSReplyTo","queue://bar");
  template.send("activemq:queue:foo?preserveMessageQos=true",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("World");
      exchange.getIn().setHeader("JMSReplyTo","bar");
    }
  }
);
  assertMockEndpointsSatisfied();
  String reply=consumer.receiveBody("activemq:queue:bar",5000,String.class);
  assertEquals("Hello World",reply);
}
