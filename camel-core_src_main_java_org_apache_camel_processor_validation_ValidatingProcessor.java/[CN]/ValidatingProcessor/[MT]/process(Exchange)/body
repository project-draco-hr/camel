{
  Schema schema;
  if (isUseSharedSchema()) {
    schema=getSchema();
  }
 else {
    schema=createSchema();
  }
  Validator validator=schema.newValidator();
  Source source;
  Result result;
  try {
    if (useDom) {
      source=exchange.getIn().getBody(DOMSource.class);
      result=new DOMResult();
    }
 else {
      source=exchange.getIn().getBody(SAXSource.class);
      result=new SAXResult();
    }
  }
 catch (  Exception e) {
    throw new NoXmlBodyValidationException(exchange,e);
  }
  if (source == null) {
    throw new NoXmlBodyValidationException(exchange);
  }
  ValidatorErrorHandler handler=errorHandler.getClass().newInstance();
  validator.setErrorHandler(handler);
  try {
    validator.validate(source,result);
  }
 catch (  SAXParseException e) {
    throw new SchemaValidationException(exchange,schema,Collections.singletonList(e),Collections.<SAXParseException>emptyList(),Collections.<SAXParseException>emptyList());
  }
  handler.handleErrors(exchange,schema,result);
}
