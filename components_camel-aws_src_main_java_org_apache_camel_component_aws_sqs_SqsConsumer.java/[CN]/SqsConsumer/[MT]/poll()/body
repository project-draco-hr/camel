{
  shutdownRunningTask=null;
  pendingExchanges=0;
  ReceiveMessageRequest request=new ReceiveMessageRequest(getQueueUrl());
  request.setMaxNumberOfMessages(getMaxMessagesPerPoll() > 0 ? getMaxMessagesPerPoll() : null);
  request.setVisibilityTimeout(getConfiguration().getVisibilityTimeout() != null ? getConfiguration().getVisibilityTimeout() : null);
  request.setAttributeNames(getConfiguration().getAttributeNames() != null ? getConfiguration().getAttributeNames() : null);
  request.setWaitTimeSeconds(getConfiguration().getWaitTimeSeconds() != null ? getConfiguration().getWaitTimeSeconds() : null);
  LOG.trace("Receiving messages with request [{}]...",request);
  ReceiveMessageResult messageResult=getClient().receiveMessage(request);
  if (LOG.isTraceEnabled()) {
    LOG.trace("Received {} messages",messageResult.getMessages().size());
  }
  Queue<Exchange> exchanges=createExchanges(messageResult.getMessages());
  return processBatch(CastUtils.cast(exchanges));
}
