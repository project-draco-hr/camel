{
  return new RouteBuilder(){
    @Override public void configure() throws Exception {
      context.getStreamCachingStrategy().setSpoolDirectory("target/cachedir");
      context.getStreamCachingStrategy().addSpoolRule(spoolRule);
      context.getStreamCachingStrategy().setAnySpoolRules(true);
      context.setStreamCaching(true);
      from("direct:a").choice().when(xpath("//hello")).to("mock:english").when(xpath("//hallo")).to("mock:dutch","mock:german").otherwise().to("mock:french").end().process(new Processor(){
        @Override public void process(        Exchange exchange) throws Exception {
          if (spoolRule.isSpool()) {
            String[] names=new File("target/cachedir").list();
            assertEquals("There should be a cached spool file",1,names.length);
          }
        }
      }
);
    }
  }
;
}
