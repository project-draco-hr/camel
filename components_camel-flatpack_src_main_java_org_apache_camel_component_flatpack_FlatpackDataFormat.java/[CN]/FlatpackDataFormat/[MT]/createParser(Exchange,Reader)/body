{
  if (isFixed()) {
    InputStream is=ResourceHelper.resolveMandatoryResourceAsInputStream(exchange.getContext().getClassResolver(),getDefinition());
    InputStreamReader reader=new InputStreamReader(is,IOConverter.getCharsetName(exchange));
    return getParserFactory().newFixedLengthParser(reader,bodyReader);
  }
 else {
    if (ObjectHelper.isEmpty(getDefinition())) {
      return getParserFactory().newDelimitedParser(bodyReader,delimiter,textQualifier);
    }
 else {
      InputStream is=ResourceHelper.resolveMandatoryResourceAsInputStream(exchange.getContext().getClassResolver(),getDefinition());
      InputStreamReader reader=new InputStreamReader(is,IOConverter.getCharsetName(exchange));
      return getParserFactory().newDelimitedParser(reader,bodyReader,delimiter,textQualifier,ignoreFirstRecord);
    }
  }
}
