{
  if (isFixed()) {
    Resource resource=getDefinition();
    ObjectHelper.notNull(resource,"resource");
    FixedWriterFactory factory=new FixedWriterFactory(new InputStreamReader(resource.getInputStream(),IOConverter.getCharsetName(exchange)));
    return factory.createWriter(new OutputStreamWriter(stream,IOConverter.getCharsetName(exchange)));
  }
 else {
    Resource resource=getDefinition();
    if (resource == null) {
      DelimiterWriterFactory factory=new DelimiterWriterFactory(delimiter,textQualifier);
      for (      String key : firstRow.keySet()) {
        factory.addColumnTitle(key);
      }
      return factory.createWriter(new OutputStreamWriter(stream,IOConverter.getCharsetName(exchange)));
    }
 else {
      DelimiterWriterFactory factory=new DelimiterWriterFactory(new InputStreamReader(resource.getInputStream(),IOConverter.getCharsetName(exchange)),delimiter,textQualifier);
      return factory.createWriter(new OutputStreamWriter(stream,IOConverter.getCharsetName(exchange)));
    }
  }
}
