{
  if (isFixed()) {
    Resource resource=getDefinition();
    ObjectHelper.notNull(resource,"resource property");
    FixedWriterFactory factory=new FixedWriterFactory(new InputStreamReader(resource.getInputStream()));
    return factory.createWriter(new OutputStreamWriter(stream));
  }
 else {
    Resource resource=getDefinition();
    if (resource == null) {
      DelimiterWriterFactory factory=new DelimiterWriterFactory(delimiter,textQualifier);
      for (      String key : firstRow.keySet()) {
        factory.addColumnTitle(key);
      }
      return factory.createWriter(new OutputStreamWriter(stream));
    }
 else {
      DelimiterWriterFactory factory=new DelimiterWriterFactory(new InputStreamReader(resource.getInputStream()),delimiter,textQualifier);
      return factory.createWriter(new OutputStreamWriter(stream));
    }
  }
}
