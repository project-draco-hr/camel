{
  int messagesPolled=0;
  while (isPollAllowed()) {
    Exchange exchange=pollingConsumer.receiveNoWait();
    if (exchange == null) {
      break;
    }
    messagesPolled++;
    log.trace("Polled {} {}",messagesPolled,exchange);
    if (exchange.hasOut()) {
      Exchange newExchange=getEndpoint().createExchange();
      newExchange.getIn().copyFrom(exchange.getOut());
      exchange=newExchange;
    }
    getProcessor().process(exchange);
  }
  return messagesPolled;
}
