{
  GaugeMonitor monitorMBean=new GaugeMonitor();
  ObjectName monitorName=new ObjectName("examples","monitor","gauge");
  server.registerMBean(monitorMBean,monitorName);
  monitorMBean.setThresholds(new Integer(8),new Integer(4));
  monitorMBean.setNotifyHigh(true);
  monitorMBean.setNotifyLow(true);
  monitorMBean.setDifferenceMode(false);
  monitorMBean.addObservedObject(serviceName);
  monitorMBean.setObservedAttribute("SimpleCounter");
  monitorMBean.setGranularityPeriod(50L);
  MBeanServerConnection connection=connector.getMBeanServerConnection();
  final AtomicBoolean notificationSet=new AtomicBoolean(false);
  connection.addNotificationListener(monitorName,new NotificationListener(){
    public void handleNotification(    Notification notification,    Object handback){
      System.out.println("Notification = " + notification);
synchronized (notificationSet) {
        notificationSet.set(true);
        notificationSet.notify();
      }
    }
  }
,null,null);
  service.start();
  monitorMBean.start();
synchronized (notificationSet) {
    if (!notificationSet.get()) {
      notificationSet.wait(5000);
    }
  }
  assertTrue(notificationSet.get());
}
