{
  TEST_XML_WITH_XML_HEADER_ISO_8859_1_AS_BYTE_ARRAY_STREAM.reset();
  XMLEventReader reader=null;
  XMLEventWriter writer=null;
  ByteArrayOutputStream output=null;
  try {
    reader=context.getTypeConverter().mandatoryConvertTo(XMLEventReader.class,TEST_XML_WITH_XML_HEADER_ISO_8859_1_AS_BYTE_ARRAY_STREAM);
    output=new ByteArrayOutputStream();
    Exchange exchange=new DefaultExchange(context);
    exchange.setProperty(Exchange.CHARSET_NAME,UTF_8.name());
    writer=context.getTypeConverter().mandatoryConvertTo(XMLEventWriter.class,exchange,output);
    while (reader.hasNext()) {
      writer.add(reader.nextEvent());
    }
  }
  finally {
    if (reader != null) {
      reader.close();
    }
    if (writer != null) {
      writer.close();
    }
  }
  assertNotNull(output);
  String result=new String(output.toByteArray(),UTF_8.name());
  assertEquals(TEST_XML_WITH_XML_HEADER,result);
}
