{
  String dataSourceRef=getAndRemoveParameter(parameters,"dataSourceRef",String.class);
  if (dataSourceRef != null) {
    dataSource=CamelContextHelper.mandatoryLookup(getCamelContext(),dataSourceRef,DataSource.class);
  }
  String parameterPlaceholderSubstitute=getAndRemoveParameter(parameters,"placeholder",String.class,"#");
  JdbcTemplate jdbcTemplate=new JdbcTemplate(dataSource);
  IntrospectionSupport.setProperties(jdbcTemplate,parameters,"template.");
  String query=remaining.replaceAll(parameterPlaceholderSubstitute,"?");
  String onConsume=getAndRemoveParameter(parameters,"consumer.onConsume",String.class);
  if (onConsume == null) {
    onConsume=getAndRemoveParameter(parameters,"onConsume",String.class);
  }
  if (onConsume != null) {
    onConsume=onConsume.replaceAll(parameterPlaceholderSubstitute,"?");
  }
  String onConsumeBatchComplete=getAndRemoveParameter(parameters,"consumer.onConsumeBatchComplete",String.class);
  if (onConsumeBatchComplete == null) {
    onConsumeBatchComplete=getAndRemoveParameter(parameters,"onConsumeBatchComplete",String.class);
  }
  if (onConsumeBatchComplete != null) {
    onConsumeBatchComplete=onConsumeBatchComplete.replaceAll(parameterPlaceholderSubstitute,"?");
  }
  SqlEndpoint endpoint=new SqlEndpoint(uri,this,jdbcTemplate,query);
  endpoint.setOnConsume(onConsume);
  endpoint.setOnConsumeBatchComplete(onConsumeBatchComplete);
  return endpoint;
}
