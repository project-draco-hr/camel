{
  String dataSourceRef=getAndRemoveParameter(parameters,"dataSourceRef",String.class);
  if (dataSourceRef != null) {
    dataSource=getCamelContext().getRegistry().lookup(dataSourceRef,DataSource.class);
    if (dataSource == null) {
      throw new IllegalArgumentException("DataSource " + dataSourceRef + " not found in registry");
    }
  }
  return new SqlEndpoint(uri,remaining.replaceAll("#","?"),this,dataSource,parameters);
}
