{
  Map<String,Object> camelHeaders=camelExchange.getIn().getHeaders();
  extractInvocationContextFromCamel(camelExchange,camelHeaders,requestContext,Client.REQUEST_CONTEXT);
  propagateHeadersFromCamelToCxf(camelExchange,camelHeaders,cxfExchange,requestContext);
  String overrideAddress=camelExchange.getIn().getHeader(Exchange.DESTINATION_OVERRIDE_URL,String.class);
  if (overrideAddress != null) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Client address is overridden by header '" + Exchange.DESTINATION_OVERRIDE_URL + "' to value '"+ overrideAddress+ "'");
    }
    requestContext.put(Message.ENDPOINT_ADDRESS,overrideAddress);
  }
  Set<Attachment> attachments=null;
  boolean isXop=Boolean.valueOf(camelExchange.getProperty(Message.MTOM_ENABLED,String.class));
  for (  Map.Entry<String,DataHandler> entry : camelExchange.getIn().getAttachments().entrySet()) {
    if (attachments == null) {
      attachments=new HashSet<Attachment>();
    }
    AttachmentImpl attachment=new AttachmentImpl(entry.getKey(),entry.getValue());
    attachment.setXOP(isXop);
    attachments.add(attachment);
  }
  if (attachments != null) {
    requestContext.put(CxfConstants.CAMEL_CXF_ATTACHMENTS,attachments);
  }
}
