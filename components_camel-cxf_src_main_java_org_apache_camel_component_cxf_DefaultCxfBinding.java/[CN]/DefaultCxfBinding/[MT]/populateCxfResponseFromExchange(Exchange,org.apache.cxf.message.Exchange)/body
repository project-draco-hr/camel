{
  Map<String,Object> responseContext=new HashMap<String,Object>();
  Map<String,Object> camelHeaders=camelExchange.getOut().getHeaders();
  extractInvocationContextFromCamel(camelExchange,camelHeaders,responseContext,Client.RESPONSE_CONTEXT);
  propagateHeadersFromCamelToCxf(camelExchange,camelHeaders,cxfExchange,responseContext);
  Endpoint ep=cxfExchange.get(Endpoint.class);
  Message outMessage=ep.getBinding().createMessage();
  cxfExchange.setOutMessage(outMessage);
  DataFormat dataFormat=camelExchange.getProperty(CxfConstants.DATA_FORMAT_PROPERTY,DataFormat.class);
  responseContext.remove(Message.REQUESTOR_ROLE);
  if (dataFormat != DataFormat.POJO) {
    outMessage.putAll(responseContext);
  }
  outMessage.put(Client.RESPONSE_CONTEXT,responseContext);
  if (LOG.isTraceEnabled()) {
    LOG.trace("Set out response context = " + responseContext);
  }
  Object outBody=DefaultCxfBinding.getBodyFromCamel(camelExchange.getOut(),dataFormat);
  if (outBody != null) {
    if (dataFormat == DataFormat.PAYLOAD) {
      CxfPayload<?> payload=(CxfPayload<?>)outBody;
      outMessage.setContent(List.class,getResponsePayloadList(cxfExchange,payload.getBody()));
      outMessage.put(Header.HEADER_LIST,payload.getHeaders());
    }
 else {
      if (responseContext.get(Header.HEADER_LIST) != null) {
        outMessage.put(Header.HEADER_LIST,responseContext.get(Header.HEADER_LIST));
      }
      MessageContentsList resList=null;
      if (outBody instanceof MessageContentsList) {
        resList=(MessageContentsList)outBody;
      }
 else       if (outBody instanceof List) {
        resList=new MessageContentsList((List<?>)outBody);
      }
 else       if (outBody.getClass().isArray()) {
        resList=new MessageContentsList((Object[])outBody);
      }
 else {
        resList=new MessageContentsList(outBody);
      }
      if (resList != null) {
        outMessage.setContent(List.class,resList);
        if (LOG.isTraceEnabled()) {
          LOG.trace("Set Out CXF message content = " + resList);
        }
      }
    }
  }
  Set<Attachment> attachments=null;
  for (  Map.Entry<String,DataHandler> entry : camelExchange.getOut().getAttachments().entrySet()) {
    if (attachments == null) {
      attachments=new HashSet<Attachment>();
    }
    AttachmentImpl attachment=new AttachmentImpl(entry.getKey(),entry.getValue());
    attachment.setXOP(true);
    attachments.add(attachment);
  }
  if (attachments != null) {
    outMessage.setAttachments(attachments);
  }
  BindingOperationInfo boi=cxfExchange.get(BindingOperationInfo.class);
  if (boi != null) {
    cxfExchange.put(BindingMessageInfo.class,boi.getOutput());
  }
}
