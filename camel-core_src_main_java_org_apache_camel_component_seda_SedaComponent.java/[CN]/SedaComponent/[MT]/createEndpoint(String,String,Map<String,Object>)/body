{
  int consumers=getAndRemoveParameter(parameters,"concurrentConsumers",Integer.class,concurrentConsumers);
  boolean limitConcurrentConsumers=getAndRemoveParameter(parameters,"limitConcurrentConsumers",Boolean.class,true);
  if (limitConcurrentConsumers && consumers > maxConcurrentConsumers) {
    throw new IllegalArgumentException("The limitConcurrentConsumers flag in set to true. ConcurrentConsumers cannot be set at a value greater than " + maxConcurrentConsumers + " was "+ consumers);
  }
  BlockingQueue<Exchange> queue=resolveAndRemoveReferenceParameter(parameters,"queue",BlockingQueue.class);
  SedaEndpoint answer;
  if (queue == null) {
    BlockingQueueFactory<Exchange> queueFactory=resolveAndRemoveReferenceParameter(parameters,"queueFactory",BlockingQueueFactory.class);
    answer=createEndpoint(uri,this,queueFactory,consumers);
  }
 else {
    answer=createEndpoint(uri,this,queue,consumers);
  }
  answer.configureProperties(parameters);
  answer.setConcurrentConsumers(consumers);
  answer.setLimitConcurrentConsumers(limitConcurrentConsumers);
  return answer;
}
