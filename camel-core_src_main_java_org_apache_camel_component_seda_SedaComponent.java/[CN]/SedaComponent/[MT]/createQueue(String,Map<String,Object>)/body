{
  String key=getQueueKey(uri);
  QueueReference ref=getQueues().get(key);
  if (ref != null) {
    ref.addReference();
    return ref.getQueue();
  }
  BlockingQueue<Exchange> queue;
  Integer size=getAndRemoveParameter(parameters,"size",Integer.class);
  if (size != null && size > 0) {
    queue=new LinkedBlockingQueue<Exchange>(size);
  }
 else {
    if (getQueueSize() > 0) {
      queue=new LinkedBlockingQueue<Exchange>(getQueueSize());
    }
 else {
      queue=new LinkedBlockingQueue<Exchange>();
    }
  }
  ref=new QueueReference(queue);
  ref.addReference();
  getQueues().put(key,ref);
  return queue;
}
