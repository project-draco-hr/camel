{
  CamelContext context=new DefaultCamelContext();
  ConnectionFactory connectionFactory=new ActiveMQConnectionFactory("vm://localhost?broker.persistent=false");
  context.addComponent("jms",jmsComponentAutoAcknowledge(connectionFactory));
  context.addRoutes(new RouteBuilder(){
    public void configure(){
      from("jms:queue:test.a").to("file://test");
    }
  }
);
  CamelClient client=new CamelClient(context);
  context.start();
  client.send("jms:queue:test.a",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("foo");
    }
  }
);
  Thread.sleep(1000);
  context.stop();
}
