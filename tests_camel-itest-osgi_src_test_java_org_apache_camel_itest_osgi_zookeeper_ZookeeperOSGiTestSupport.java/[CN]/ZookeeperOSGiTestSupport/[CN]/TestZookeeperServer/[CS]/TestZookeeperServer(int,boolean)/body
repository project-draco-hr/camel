{
  if (clearServerData) {
    File working=new File("./target/zookeeper");
    deleteDir(working);
    if (working.exists()) {
      throw new Exception("Could not delete Test Zookeeper Server working dir ./target/zookeeper");
    }
  }
  zkServer=new ZooKeeperServer();
  File dataDir=new File("./target/zookeeper/log");
  File snapDir=new File("./target/zookeeper/data");
  FileTxnSnapLog ftxn=new FileTxnSnapLog(dataDir,snapDir);
  zkServer.setTxnLogFactory(ftxn);
  zkServer.setTickTime(1000);
  connectionFactory=new NIOServerCnxnFactory();
  connectionFactory.configure(new InetSocketAddress("localhost",clientPort),0);
  connectionFactory.startup(zkServer);
}
