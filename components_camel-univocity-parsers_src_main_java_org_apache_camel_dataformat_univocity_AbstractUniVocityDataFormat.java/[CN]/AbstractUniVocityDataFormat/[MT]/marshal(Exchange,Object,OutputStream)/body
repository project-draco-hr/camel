{
  if (writerSettings == null) {
synchronized (writerSettingsToken) {
      if (writerSettings == null) {
        writerSettings=createAndConfigureWriterSettings();
        marshaller=new Marshaller<>(headers,headers == null);
      }
    }
  }
  try (Writer writer=new OutputStreamWriter(stream,getCharsetName(exchange))){
    marshaller.marshal(exchange,body,createWriter(writer,writerSettings));
  }
 }
