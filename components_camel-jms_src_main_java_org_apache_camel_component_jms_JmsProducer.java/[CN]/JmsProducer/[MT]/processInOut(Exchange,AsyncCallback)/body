{
  final org.apache.camel.Message in=exchange.getIn();
  String destinationName=in.getHeader(JmsConstants.JMS_DESTINATION_NAME,String.class);
  in.removeHeader(JmsConstants.JMS_DESTINATION_NAME);
  if (destinationName == null) {
    destinationName=endpoint.getDestinationName();
  }
  Destination destination=in.getHeader(JmsConstants.JMS_DESTINATION,Destination.class);
  in.removeHeader(JmsConstants.JMS_DESTINATION);
  if (destination == null) {
    destination=endpoint.getDestination();
  }
  if (destination != null) {
    destinationName=null;
  }
  initReplyManager(in);
  final boolean msgIdAsCorrId=endpoint.getConfiguration().isUseMessageIDAsCorrelationID();
  final String provisionalCorrelationId=msgIdAsCorrId ? getUuidGenerator().generateUuid() : null;
  MessageSentCallback messageSentCallback=null;
  if (msgIdAsCorrId) {
    messageSentCallback=new UseMessageIdAsCorrelationIdMessageSentCallback(replyManager,provisionalCorrelationId,endpoint.getRequestTimeout());
  }
  final ValueHolder<MessageSentCallback> sentCallback=new ValueHolder<MessageSentCallback>(messageSentCallback);
  final String originalCorrelationId=in.getHeader("JMSCorrelationID",String.class);
  if (originalCorrelationId == null && !msgIdAsCorrId) {
    in.setHeader("JMSCorrelationID",getUuidGenerator().generateUuid());
  }
  MessageCreator messageCreator=new MessageCreator(){
    public Message createMessage(    Session session) throws JMSException {
      Message message=endpoint.getBinding().makeJmsMessage(exchange,in,session,null);
      Destination replyTo=replyManager.getReplyTo();
      if (replyTo == null) {
        throw new RuntimeExchangeException("Failed to resolve replyTo destination",exchange);
      }
      JmsMessageHelper.setJMSReplyTo(message,replyTo);
      replyManager.setReplyToSelectorHeader(in,message);
      String correlationId=determineCorrelationId(message,provisionalCorrelationId);
      replyManager.registerReply(replyManager,exchange,callback,originalCorrelationId,correlationId,endpoint.getRequestTimeout());
      return message;
    }
  }
;
  doSend(true,destinationName,destination,messageCreator,sentCallback.get());
  setMessageId(exchange);
  return false;
}
