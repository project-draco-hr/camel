{
  final org.apache.camel.Message in=exchange.getIn();
  String destinationName=in.getHeader(JmsConstants.JMS_DESTINATION_NAME,String.class);
  if (destinationName != null) {
    in.removeHeader(JmsConstants.JMS_DESTINATION_NAME);
  }
  if (destinationName == null) {
    destinationName=endpoint.getDestinationName();
  }
  Destination destination=in.getHeader(JmsConstants.JMS_DESTINATION,Destination.class);
  if (destination != null) {
    in.removeHeader(JmsConstants.JMS_DESTINATION);
  }
  if (destination == null) {
    destination=endpoint.getDestination();
  }
  if (destination != null) {
    destinationName=null;
  }
  if (!endpoint.isPreserveMessageQos() && !endpoint.isExplicitQosEnabled()) {
    Object replyTo=exchange.getIn().getHeader("JMSReplyTo");
    if (replyTo != null) {
      String to=destinationName != null ? destinationName : "" + destination;
      LOG.warn("Disabling JMSReplyTo as this Exchange is not OUT capable with JMSReplyTo: " + replyTo + " for destination: "+ to+ ". Use preserveMessageQos=true to force Camel to keep the JMSReplyTo."+ " Exchange: "+ exchange);
      exchange.getIn().setHeader("JMSReplyTo",null);
    }
  }
  MessageCreator messageCreator=new MessageCreator(){
    public Message createMessage(    Session session) throws JMSException {
      return endpoint.getBinding().makeJmsMessage(exchange,in,session,null);
    }
  }
;
  doSend(false,destinationName,destination,messageCreator,null);
  setMessageId(exchange);
  callback.done(true);
  return true;
}
