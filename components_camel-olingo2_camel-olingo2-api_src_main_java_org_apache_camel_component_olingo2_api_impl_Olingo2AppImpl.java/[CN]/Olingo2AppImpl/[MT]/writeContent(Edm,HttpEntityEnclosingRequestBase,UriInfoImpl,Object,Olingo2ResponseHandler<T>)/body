{
  try {
    final ODataResponse response=writeContent(edm,uriInfo,content);
    for (    String header : response.getHeaderNames()) {
      httpEntityRequest.setHeader(header,response.getHeader(header));
    }
    if (response.getEntity() instanceof InputStream) {
      httpEntityRequest.setEntity(new InputStreamEntity((InputStream)response.getEntity()));
    }
    execute(httpEntityRequest,contentType,new AbstractFutureCallback<T>(responseHandler){
      @SuppressWarnings("unchecked") @Override public void onCompleted(      HttpResponse result) throws IOException, EntityProviderException, BatchException, ODataApplicationException {
        HttpStatusCodes statusCode=HttpStatusCodes.fromStatusCode(result.getStatusLine().getStatusCode());
        if (statusCode != HttpStatusCodes.NO_CONTENT) {
switch (uriInfo.getUriType()) {
case URI9:
            final List<BatchSingleResponse> singleResponses=EntityProvider.parseBatchResponse(result.getEntity().getContent(),result.getFirstHeader(HttpHeaders.CONTENT_TYPE).getValue());
          final List<Olingo2BatchResponse> responses=new ArrayList<Olingo2BatchResponse>();
        Map<String,String> contentIdLocationMap=new HashMap<String,String>();
      final List<Olingo2BatchRequest> batchRequests=(List<Olingo2BatchRequest>)content;
    final Iterator<Olingo2BatchRequest> iterator=batchRequests.iterator();
  for (  BatchSingleResponse response : singleResponses) {
    final Olingo2BatchRequest request=iterator.next();
    if (request instanceof Olingo2BatchChangeRequest && ((Olingo2BatchChangeRequest)request).getContentId() != null) {
      contentIdLocationMap.put("$" + ((Olingo2BatchChangeRequest)request).getContentId(),response.getHeader(HttpHeaders.LOCATION));
    }
    try {
      responses.add(parseResponse(edm,contentIdLocationMap,request,response));
    }
 catch (    Exception e) {
      responses.add(new Olingo2BatchResponse(Integer.parseInt(response.getStatusCode()),response.getStatusInfo(),response.getContentId(),response.getHeaders(),new ODataApplicationException("Error parsing response for " + request + ": "+ e.getMessage(),Locale.ENGLISH,e)));
    }
  }
responseHandler.onResponse((T)responses);
break;
default :
responseHandler.onResponse((T)EntityProvider.readEntry(response.getContentHeader(),uriInfo.getTargetEntitySet(),result.getEntity().getContent(),EntityProviderReadProperties.init().build()));
break;
}
}
 else {
responseHandler.onResponse((T)HttpStatusCodes.fromStatusCode(result.getStatusLine().getStatusCode()));
}
}
}
);
}
 catch (ODataException e) {
responseHandler.onException(e);
}
catch (URISyntaxException e) {
responseHandler.onException(e);
}
catch (UnsupportedEncodingException e) {
responseHandler.onException(e);
}
catch (IOException e) {
responseHandler.onException(e);
}
}
