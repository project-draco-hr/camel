{
  String messageId=ExpressionHelper.evaluateAsString(messageIdExpression,exchange);
  if (messageId == null) {
    throw new NoMessageIdException(exchange,messageIdExpression);
  }
  if (!messageIdRepository.contains(messageId)) {
    nextProcessor.process(exchange);
  }
 else {
    onDuplicateMessage(exchange,messageId);
  }
}
