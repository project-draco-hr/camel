{
  try {
    Destination requestDestination=ActiveMQDestination.createDestination(REQUEST_QUEUE,ActiveMQDestination.QUEUE_TYPE);
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=session.createConsumer(requestDestination);
    connection.start();
    int i=0;
    while (true) {
      TextMessage msg=(TextMessage)consumer.receive(1000 * 100);
      if (msg == null) {
        LOG.debug("Response timed out.");
      }
 else {
        Destination replyDestination=msg.getJMSReplyTo();
        String correlationId=msg.getJMSCorrelationID();
        LOG.debug("replyDestination: " + replyDestination);
        MessageProducer sender=session.createProducer(replyDestination);
        LOG.debug("Request No. " + (++i));
        LOG.debug("msg: " + msg);
        TextMessage response=session.createTextMessage();
        response.setText("I was here: " + msg.getText());
        response.setJMSCorrelationID(correlationId);
        LOG.debug("reponse: " + response);
        sender.send(response);
      }
    }
  }
 catch (  JMSException exception) {
    LOG.info("Get the exception [" + exception + "], stop receive message");
  }
}
