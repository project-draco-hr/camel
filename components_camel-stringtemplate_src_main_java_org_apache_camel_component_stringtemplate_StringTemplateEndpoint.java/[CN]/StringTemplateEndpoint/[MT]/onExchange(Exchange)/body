{
  StringWriter buffer=new StringWriter();
  Map<String,Object> variableMap=ExchangeHelper.createVariableMap(exchange);
  String text=exchange.getContext().getTypeConverter().mandatoryConvertTo(String.class,getResourceAsInputStream());
  StringTemplate template=new StringTemplate(text);
  template.setAttributes(variableMap);
  log.debug("StringTemplate is writing using attributes: {}",variableMap);
  template.write(new AutoIndentWriter(buffer));
  Message out=exchange.getOut();
  out.setBody(buffer.toString());
  out.setHeader(StringTemplateConstants.STRINGTEMPLATE_RESOURCE_URI,getResourceUri());
  Map<String,Object> headers=(Map<String,Object>)variableMap.get("headers");
  for (  Entry<String,Object> entry : headers.entrySet()) {
    out.setHeader(entry.getKey(),entry.getValue());
  }
}
