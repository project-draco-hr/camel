{
  StringWriter buffer=new StringWriter();
  Map variableMap=ExchangeHelper.createVariableMap(exchange);
  String text=exchange.getContext().getTypeConverter().mandatoryConvertTo(String.class,getResourceAsInputStream());
  StringTemplate template=new StringTemplate(text);
  template.setAttributes(variableMap);
  if (log.isDebugEnabled()) {
    log.debug("StringTemplate is writing using attributes: " + variableMap);
  }
  template.write(new AutoIndentWriter(buffer));
  Message out=exchange.getOut();
  out.setBody(buffer.toString());
  out.setHeader(StringTemplateConstants.STRINGTEMPLATE_RESOURCE,getResource());
}
