{
  if (StreamCache.class.isAssignableFrom(value.getClass())) {
    return null;
  }
  if (JettyHttpMessage.class.isAssignableFrom(value.getClass())) {
    JettyHttpMessage message=(JettyHttpMessage)value;
    Object body=message.getBody();
    if (body == null) {
      return null;
    }
    if (body instanceof JettyFutureGetBody) {
      JettyFutureGetBody future=(JettyFutureGetBody)body;
      if (future.isCancelled()) {
        return Void.TYPE;
      }
      if (LOG.isTraceEnabled()) {
        LOG.trace("Getting future response");
      }
      Object reply=future.get();
      if (LOG.isTraceEnabled()) {
        LOG.trace("Got future response");
      }
      if (reply == null) {
        return Void.TYPE;
      }
      if (type.isAssignableFrom(reply.getClass())) {
        return type.cast(reply);
      }
      TypeConverter tc=registry.lookup(type,reply.getClass());
      if (tc != null) {
        return tc.convertTo(type,exchange,reply);
      }
    }
 else {
      TypeConverter tc=registry.lookup(type,body.getClass());
      if (tc != null) {
        return tc.convertTo(type,exchange,body);
      }
    }
  }
  return null;
}
