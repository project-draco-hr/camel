{
  StopWatch watch=new StopWatch();
  List<RouteStartupOrder> routesOrdered=new ArrayList<RouteStartupOrder>(routes);
  Collections.sort(routesOrdered,new Comparator<RouteStartupOrder>(){
    public int compare(    RouteStartupOrder o1,    RouteStartupOrder o2){
      return o1.getStartupOrder() - o2.getStartupOrder();
    }
  }
);
  if (shutdownRoutesInReverseOrder) {
    Collections.reverse(routesOrdered);
  }
  if (timeout > 0) {
    LOG.info("Starting to graceful shutdown " + routesOrdered.size() + " routes (timeout "+ timeout+ " "+ timeUnit.toString().toLowerCase()+ ")");
  }
 else {
    LOG.info("Starting to graceful shutdown " + routesOrdered.size() + " routes (no timeout)");
  }
  Future<?> future=getExecutorService().submit(new ShutdownTask(context,routesOrdered,timeout,timeUnit,suspendOnly,abortAfterTimeout));
  try {
    if (timeout > 0) {
      future.get(timeout,timeUnit);
    }
 else {
      future.get();
    }
  }
 catch (  TimeoutException e) {
    future.cancel(true);
    this.forceShutdown=forceShutdown;
    if (!forceShutdown && abortAfterTimeout) {
      LOG.warn("Timeout occurred. Aborting the shutdown now.");
      return false;
    }
 else {
      if (forceShutdown || shutdownNowOnTimeout) {
        LOG.warn("Timeout occurred. Now forcing the routes to be shutdown now.");
        shutdownRoutesNow(routesOrdered);
      }
 else {
        LOG.warn("Timeout occurred. Will ignore shutting down the remainder routes.");
      }
    }
  }
catch (  ExecutionException e) {
    throw ObjectHelper.wrapRuntimeCamelException(e.getCause());
  }
  long seconds=TimeUnit.SECONDS.convert(watch.stop(),TimeUnit.MILLISECONDS);
  LOG.info("Graceful shutdown of " + routesOrdered.size() + " routes completed in "+ seconds+ " seconds");
  return true;
}
