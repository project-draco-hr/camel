{
  boolean doSend=false;
synchronized (calculationLock) {
    long now=System.nanoTime();
    if (now >= timeOfLastExchange + periodInNanos) {
      doSend=true;
      if (log.isTraceEnabled()) {
        log.trace(sampled.sample());
      }
      timeOfLastExchange=now;
    }
 else {
      if (log.isTraceEnabled()) {
        log.trace(sampled.drop());
      }
    }
  }
  if (doSend) {
    super.process(exchange);
  }
 else {
    stopper.process(exchange);
  }
}
