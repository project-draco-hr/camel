{
  Mailbox.clearAll();
  context.addRoutes(new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("pop3://jones@localhost?password=secret&delay=1000&ignoreUnsupportedCharset=true").to("mock:result");
    }
  }
);
  context.start();
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedBodiesReceived("Hello World","Bye World");
  mock.allMessages().header("Content-Type").isEqualTo("text/plain");
  Map headers=new HashMap();
  headers.put("To","jones@localhost");
  headers.put("Content-Type","text/plain");
  template.sendBodyAndHeaders("smtp://localhost?ignoreUnsupportedCharset=true","Hello World",headers);
  headers.clear();
  headers.put("To","jones@localhost");
  headers.put("Content-Type","text/plain; charset=ansi_x3.110-1983");
  template.sendBodyAndHeaders("smtp://localhost?ignoreUnsupportedCharset=true","Bye World",headers);
  mock.assertIsSatisfied();
}
