{
  if (processor == null) {
    callback.done(true);
    return true;
  }
  if (processor instanceof AsyncProcessor) {
    return ((AsyncProcessor)processor).process(exchange,new AsyncCallback(){
      public void done(      boolean doneSynchronously){
        callback.done(doneSynchronously);
        Message faultMessage=exchange.getFault(false);
        if (faultMessage != null) {
          final Object faultBody=faultMessage.getBody();
          if (faultBody != null) {
            faultMessage.setBody(null);
            if (faultBody instanceof Throwable) {
              exchange.setException((Throwable)faultBody);
            }
 else {
              exchange.setException(new CamelException("Message contains fault of type " + faultBody.getClass().getName() + ":\n"+ faultBody));
            }
          }
        }
      }
    }
);
  }
  try {
    processor.process(exchange);
  }
 catch (  Throwable e) {
    exchange.setException(e);
  }
  final Message faultMessage=exchange.getFault(false);
  if (faultMessage != null) {
    final Object faultBody=faultMessage.getBody();
    if (faultBody != null) {
      faultMessage.setBody(null);
      if (faultBody instanceof Throwable) {
        exchange.setException((Throwable)faultBody);
      }
 else {
        exchange.setException(new CamelException("Message contains fault of type " + faultBody.getClass().getName() + ":\n"+ faultBody));
      }
    }
  }
  callback.done(true);
  return true;
}
