{
  Message in=exchange.getIn();
  if (charset != null) {
    exchange.setProperty(Exchange.CHARSET_NAME,IOConverter.normalizeCharset(charset));
  }
  if (in.getBody() != null) {
    Object value=in.getMandatoryBody(type);
    if (exchange.getPattern().isOutCapable()) {
      Message out=exchange.getOut();
      out.copyFrom(in);
      out.setBody(value);
    }
 else {
      in.setBody(value);
    }
  }
}
