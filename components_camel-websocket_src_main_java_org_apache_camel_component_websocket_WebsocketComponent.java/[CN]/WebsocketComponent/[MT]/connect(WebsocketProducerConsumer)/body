{
  Server server=null;
  WebsocketEndpoint endpoint=prodcon.getEndpoint();
  String connectorKey=getConnectorKey(endpoint);
synchronized (CONNECTORS) {
    ConnectorRef connectorRef=CONNECTORS.get(connectorKey);
    if (connectorRef == null) {
      Connector connector;
      if (endpoint.getSslContextParameters() != null) {
        connector=getSslSocketConnector(endpoint.getSslContextParameters());
      }
 else {
        connector=new SelectChannelConnector();
      }
      LOG.trace("Jetty Connector added: {}",connector.getName());
      if (endpoint.getPort() != null) {
        connector.setPort(endpoint.getPort());
      }
 else {
        connector.setPort(port);
      }
      if (endpoint.getHost() != null) {
        connector.setHost(endpoint.getHost());
      }
 else {
        connector.setHost(host);
      }
      server=createServer();
      if (endpoint.isEnableJmx()) {
        enableJmx(server);
      }
      server.addConnector(connector);
      ServletContextHandler context=createContext(server,connector,endpoint.getHandlers());
      server.setHandler(context);
      applyCrossOriginFiltering(endpoint,context);
      if (endpoint.getStaticResources() != null) {
        server=createStaticResourcesServer(server,context,endpoint.getStaticResources());
      }
      connectorRef=new ConnectorRef(server,connector,null);
      if (endpoint.isSessionSupport()) {
        enableSessionSupport(connectorRef.server,connectorKey);
      }
      LOG.info("Jetty Server starting on host: {}:{}",connector.getHost(),connector.getPort());
      connectorRef.server.start();
      CONNECTORS.put(connectorKey,connectorRef);
    }
 else {
      connectorRef.increment();
    }
    if (endpoint.isSessionSupport()) {
      enableSessionSupport(connectorRef.server,connectorKey);
    }
    if (prodcon instanceof WebsocketConsumer) {
      connectorRef.servlet.connect((WebsocketConsumer)prodcon);
    }
  }
}
