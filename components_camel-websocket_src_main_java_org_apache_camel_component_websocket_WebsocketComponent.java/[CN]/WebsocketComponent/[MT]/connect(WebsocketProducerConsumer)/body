{
  Server server=null;
  String baseResource=null;
  WebsocketEndpoint endpoint=prodcon.getEndpoint();
  String connectorKey=getConnectorKey(endpoint);
synchronized (CONNECTORS) {
    ConnectorRef connectorRef=CONNECTORS.get(connectorKey);
    if (connectorRef == null) {
      Connector connector;
      if (endpoint.getSslContextParameters() != null) {
        connector=getSslSocketConnector(endpoint.getSslContextParameters());
      }
 else {
        connector=new SelectChannelConnector();
      }
      LOG.debug("Jetty Connector added : " + connector.getName());
      if (port != null) {
        connector.setPort(port);
      }
 else {
        connector.setPort(endpoint.getPort());
      }
      if (host != null) {
        connector.setHost(host);
      }
 else {
        connector.setHost(endpoint.getHost());
      }
      connector.setHost(endpoint.getHost());
      if (endpoint.getHome() != null) {
        ServletContextHandler context=new ServletContextHandler(server,"/",ServletContextHandler.NO_SECURITY | ServletContextHandler.NO_SESSIONS);
        if (endpoint.getHome().startsWith("classpath:")) {
          baseResource=ObjectHelper.after(endpoint.getHome(),"classpath:");
          LOG.debug("Using base resource from classpath: {}",baseResource);
          context.setBaseResource(new JettyClassPathResource(getCamelContext().getClassResolver(),baseResource));
        }
 else {
          LOG.debug("Using base resource: {}",baseResource);
          context.setResourceBase(baseResource);
        }
        DefaultServlet defaultServlet=new DefaultServlet();
        ServletHolder holder=new ServletHolder(defaultServlet);
        holder.setInitParameter("useFileMappedBuffer","false");
        context.addServlet(holder,"/");
      }
      server=createServer();
      if (endpoint.isEnableJmx()) {
        enableJmx(server);
      }
      server.addConnector(connector);
      context=createContext(server,connector,endpoint.getHandlers());
      server.setHandler(context);
      connectorRef=new ConnectorRef(server,connector,null);
      if (endpoint.isSessionSupport()) {
        enableSessionSupport(connectorRef.server,connectorKey);
      }
      connectorRef.server.start();
      CONNECTORS.put(connectorKey,connectorRef);
      LOG.debug("Jetty Server started for host : " + connector.getHost() + ", on port : "+ connector.getPort());
      server.start();
    }
 else {
      connectorRef.increment();
    }
    if (endpoint.isSessionSupport()) {
      enableSessionSupport(connectorRef.server,connectorKey);
    }
  }
}
