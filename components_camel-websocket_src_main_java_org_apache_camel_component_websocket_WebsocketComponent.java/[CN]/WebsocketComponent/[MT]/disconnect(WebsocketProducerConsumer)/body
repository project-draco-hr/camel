{
  WebsocketEndpoint endpoint=prodcon.getEndpoint();
  String connectorKey=getConnectorKey(endpoint);
synchronized (CONNECTORS) {
    ConnectorRef connectorRef=CONNECTORS.get(connectorKey);
    if (connectorRef != null) {
      if (connectorRef.decrement() == 0) {
        connectorRef.server.removeConnector(connectorRef.connector);
        if (connectorRef.connector != null) {
          connectorRef.connector.stop();
        }
        connectorRef.server.stop();
        CONNECTORS.remove(connectorKey);
        if (mbContainer != null) {
          mbContainer.removeBean(connectorRef.server);
          mbContainer.removeBean(connectorRef.connector);
        }
      }
      if (prodcon instanceof WebsocketConsumer) {
        connectorRef.servlet.disconnect((WebsocketConsumer)prodcon);
      }
    }
  }
}
