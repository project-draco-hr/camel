{
  context.addRoutes(new RouteBuilder(){
    public void configure() throws Exception {
      from("direct:start").aggregator().header("id").batchTimeout(500L).to("mock:result");
    }
  }
);
  startCamelContext();
  MockEndpoint result=getMockEndpoint("mock:result");
  result.expectedMinimumMessageCount(3);
  result.expectedBodiesReceived("Message 1c","Message 2b","Message 3a");
  template.sendBodyAndHeader("direct:start","Message 1a","id","1");
  template.sendBodyAndHeader("direct:start","Message 2a","id","2");
  template.sendBodyAndHeader("direct:start","Message 1b","id","1");
  template.sendBodyAndHeader("direct:start","Message 2b","id","2");
  template.sendBodyAndHeader("direct:start","Message 1c","id","1");
  template.sendBodyAndHeader("direct:start","Message 3a","id","3");
  Thread.sleep(600L);
  template.sendBodyAndHeader("direct:start","Message 4","id","4");
  template.sendBodyAndHeader("direct:start","Message 3b","id","3");
  template.sendBodyAndHeader("direct:start","Message 3c","id","3");
  template.sendBodyAndHeader("direct:start","Message 1d","id","1");
  assertMockEndpointsSatisfied();
}
