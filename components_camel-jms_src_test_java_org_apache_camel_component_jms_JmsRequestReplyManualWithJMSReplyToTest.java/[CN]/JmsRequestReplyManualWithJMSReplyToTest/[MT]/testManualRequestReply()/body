{
  context.start();
  template.send("activemq:queue:foo?preserveMessageQos=true",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("Hello World");
      exchange.getIn().setHeader("JMSReplyTo","bar");
    }
  }
);
  String reply=consumer.receiveBody("activemq:queue:bar",5000,String.class);
  assertEquals("Bye World",reply);
}
