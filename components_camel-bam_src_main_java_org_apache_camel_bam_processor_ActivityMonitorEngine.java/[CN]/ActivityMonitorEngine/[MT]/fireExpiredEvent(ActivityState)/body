{
  LOG.debug("Trying to fire expiration of: {}",activityState);
  entityManagerTemplate.execute(new EntityManagerCallback<Object>(){
    public Object execute(    EntityManager entityManager) throws PersistenceException {
      if (isUseLocking()) {
        LOG.debug("Attempting to lock: {}",activityState);
        entityManager.lock(activityState,LockModeType.WRITE);
        LOG.debug("Grabbed lock: {}",activityState);
      }
      try {
        rules.processExpired(activityState);
      }
 catch (      Exception e) {
        LOG.error("Failed to process expiration of: " + activityState + ". Reason: "+ e,e);
      }
      activityState.setTimeOverdue(null);
      return null;
    }
  }
);
}
