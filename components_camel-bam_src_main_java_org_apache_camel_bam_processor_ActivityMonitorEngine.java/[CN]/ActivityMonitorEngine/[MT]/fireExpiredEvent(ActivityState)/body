{
  LOG.debug("Trying to fire expiration of: {}",activityState);
  template.execute(new JpaCallback(){
    public Object doInJpa(    EntityManager entityManager) throws PersistenceException {
      if (isUseLocking()) {
        LOG.info("Attempting to lock: " + activityState);
        entityManager.lock(activityState,LockModeType.WRITE);
        LOG.info("Grabbed lock: " + activityState);
      }
      try {
        rules.processExpired(activityState);
      }
 catch (      Exception e) {
        LOG.error("Failed to process expiration of: " + activityState + ". Reason: "+ e,e);
      }
      activityState.setTimeOverdue(null);
      return null;
    }
  }
);
}
