{
  final int completionTimeout=2000;
  final int completionSize=-1;
  final String queueName=getQueueName();
  context.addRoutes(new TransactedSendHarness(queueName));
  context.addRoutes(new RouteBuilder(){
    public void configure() throws Exception {
      fromF("sjmsbatch:%s?completionTimeout=%s&completionSize=%s&aggregationStrategy=#testStrategy",queueName,completionTimeout,completionSize).routeId("batchConsumer").startupOrder(10).to("mock:batches");
    }
  }
);
  context.start();
  int messageCount=50;
  assertTrue(messageCount < SjmsBatchEndpoint.DEFAULT_COMPLETION_SIZE);
  MockEndpoint mockBatches=getMockEndpoint("mock:batches");
  mockBatches.expectedMessageCount(1);
  template.sendBody("direct:in",generateStrings(messageCount));
  mockBatches.assertIsSatisfied();
  assertFirstMessageBodyOfLength(mockBatches,messageCount);
}
