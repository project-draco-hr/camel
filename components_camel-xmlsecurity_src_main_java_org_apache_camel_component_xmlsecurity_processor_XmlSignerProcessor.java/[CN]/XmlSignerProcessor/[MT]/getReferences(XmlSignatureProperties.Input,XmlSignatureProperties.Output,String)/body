{
  Reference ref=createReference(input.getSignatureFactory(),input.getContentReferenceUri(),getContentReferenceType(input.getMessage()),input.getSignatureType());
  Reference keyInfoRef=createKeyInfoReference(input.getSignatureFactory(),keyInfoId,input.getContentDigestAlgorithm());
  int propsRefsSize=properties == null || properties.getReferences() == null || properties.getReferences().isEmpty() ? 0 : properties.getReferences().size();
  int size=keyInfoRef == null ? propsRefsSize + 1 : propsRefsSize + 2;
  List<Reference> referenceList=new ArrayList<Reference>(size);
  referenceList.add(ref);
  if (keyInfoRef != null) {
    referenceList.add(keyInfoRef);
  }
  if (properties != null && properties.getReferences() != null && !properties.getReferences().isEmpty()) {
    referenceList.addAll(properties.getReferences());
  }
  return referenceList;
}
