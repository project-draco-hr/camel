{
  if (executorService == null) {
    ExecutorServiceManager executorServiceManager=routeContext.getCamelContext().getExecutorServiceManager();
    String id=(executorServiceRef != null) ? executorServiceRef : getId();
    ThreadPoolProfile profile=new ThreadPoolBuilder(id).threadName(getThreadName()).poolSize(getPoolSize()).maxPoolSize(getMaxPoolSize()).keepAliveTime(getKeepAliveTime(),getTimeUnit()).rejectedPolicy(rejectedPolicy).build();
    executorService=executorServiceManager.getExecutorService(profile,this);
  }
  ThreadsProcessor thread=new ThreadsProcessor(routeContext.getCamelContext(),executorService);
  if (getCallerRunsWhenRejected() == null) {
    thread.setCallerRunsWhenRejected(true);
  }
 else {
    thread.setCallerRunsWhenRejected(getCallerRunsWhenRejected());
  }
  List<Processor> pipe=new ArrayList<Processor>(2);
  pipe.add(thread);
  pipe.add(createChildProcessor(routeContext,true));
  return new Pipeline(routeContext.getCamelContext(),pipe);
}
