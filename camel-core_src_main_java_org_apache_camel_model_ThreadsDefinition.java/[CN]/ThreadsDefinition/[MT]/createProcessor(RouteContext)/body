{
  executorService=ExecutorServiceHelper.getConfiguredExecutorService(routeContext,this);
  if (executorService == null) {
    String name=getThreadName() != null ? getThreadName() : "Threads";
    if (poolSize == null || poolSize <= 0) {
      executorService=routeContext.getCamelContext().getExecutorServiceStrategy().newDefaultThreadPool(this,name);
    }
 else {
      int max=getMaxPoolSize() != null ? getMaxPoolSize() : poolSize;
      RejectedExecutionHandler rejected=null;
      if (rejectedPolicy != null) {
        rejected=rejectedPolicy.asRejectedExecutionHandler();
      }
      executorService=routeContext.getCamelContext().getExecutorServiceStrategy().newThreadPool(this,name,poolSize,max,getKeepAliveTime(),getUnits(),getMaxQueueSize(),rejected,true);
    }
  }
  Processor childProcessor=routeContext.createProcessor(this);
  UnitOfWorkProcessor uow=new UnitOfWorkProcessor(routeContext,childProcessor);
  return new ThreadsProcessor(routeContext.getCamelContext(),uow,executorService,waitForTaskToComplete);
}
