{
  Processor childProcessor=this.createChildProcessor(routeContext,true);
  IdempotentRepository<String> idempotentRepository=(IdempotentRepository<String>)resolveMessageIdRepository(routeContext);
  ObjectHelper.notNull(idempotentRepository,"idempotentRepository",this);
  routeContext.getCamelContext().addService(idempotentRepository);
  Expression expression=getExpression().createExpression(routeContext);
  boolean eager=getEager() == null || getEager();
  boolean duplicate=getSkipDuplicate() == null || getSkipDuplicate();
  boolean remove=getRemoveOnFailure() == null || getRemoveOnFailure();
  boolean scopeBlockOnly=getScope() != null && IdempotentConsumerScope.BlockOnly == getScope();
  return new IdempotentConsumer(expression,idempotentRepository,eager,duplicate,remove,scopeBlockOnly,childProcessor);
}
