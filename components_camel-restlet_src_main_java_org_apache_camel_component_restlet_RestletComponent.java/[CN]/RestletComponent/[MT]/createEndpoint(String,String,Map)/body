{
  RestletBinding restletBinding=null;
  String ref=getAndRemoveParameter(parameters,"restletBindingRef",String.class);
  if (ref != null) {
    restletBinding=CamelContextHelper.mandatoryLookup(getCamelContext(),ref,RestletBinding.class);
  }
  if (restletBinding == null) {
    restletBinding=new DefaultRestletBinding();
  }
  if (restletBinding instanceof HeaderFilterStrategyAware) {
    ((HeaderFilterStrategyAware)restletBinding).setHeaderFilterStrategy(headerFilterStrategy);
  }
  Map<String,String> realm=null;
  ref=getAndRemoveParameter(parameters,"restletRealmRef",String.class);
  if (ref != null) {
    realm=CamelContextHelper.mandatoryLookup(getCamelContext(),ref,Map.class);
  }
  Method method=getAndRemoveParameter(parameters,"restletMethod",Method.class);
  URI u=new URI(UnsafeUriCharactersEncoder.encode(remaining));
  String protocol=u.getScheme();
  String uriPattern=u.getPath();
  if (parameters.size() > 0) {
    uriPattern=uriPattern + "?" + URISupport.createQueryString(parameters);
  }
  int port=0;
  String host=u.getHost();
  if (u.getPort() > 0) {
    port=u.getPort();
  }
  RestletEndpoint result=new RestletEndpoint(this,remaining,restletBinding);
  result.setProtocol(protocol);
  result.setUriPattern(uriPattern);
  result.setHost(host);
  if (port > 0) {
    result.setPort(port);
  }
  if (method != null) {
    result.setRestletMethod(method);
  }
  if (realm != null) {
    result.setRealm(realm);
  }
  return result;
}
