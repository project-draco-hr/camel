{
  return doInProducer(endpoint,exchange,pattern,new ProducerCallback<Exchange>(){
    public Exchange doInProducer(    Producer producer,    Exchange exchange,    ExchangePattern pattern) throws Exception {
      if (exchange == null) {
        exchange=pattern != null ? producer.createExchange(pattern) : producer.createExchange();
      }
      if (processor != null) {
        processor.process(exchange);
      }
      if (LOG.isDebugEnabled()) {
        LOG.debug(">>>> " + endpoint + " "+ exchange);
      }
      exchange.setProperty(Exchange.TO_ENDPOINT,endpoint.getEndpointUri());
      StopWatch watch=new StopWatch();
      try {
        Producer target=new UnitOfWorkProducer(producer);
        target.process(exchange);
      }
  finally {
        long timeTaken=watch.stop();
        EventHelper.notifyExchangeSent(exchange.getContext(),exchange,endpoint,timeTaken);
      }
      return exchange;
    }
  }
);
}
