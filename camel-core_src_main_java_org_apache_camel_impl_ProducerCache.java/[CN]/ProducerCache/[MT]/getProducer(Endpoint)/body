{
  String key=endpoint.getEndpointUri();
  Producer answer=producers.get(key);
  if (answer == null) {
    try {
      answer=endpoint.createProducer();
      answer.start();
    }
 catch (    Exception e) {
      throw new FailedToCreateProducerException(endpoint,e);
    }
    boolean singleton=true;
    if (answer instanceof IsSingleton) {
      singleton=((IsSingleton)answer).isSingleton();
    }
    if (singleton) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Adding to producer cache with key: " + endpoint + " for producer: "+ answer);
      }
      producers.put(key,answer);
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Producer for endpoint: " + key + " is not singleton and thus not added to producer cache");
      }
    }
  }
  return answer;
}
