{
  if (!eventDrivenProcessors.isEmpty()) {
    Processor target=Pipeline.newInstance(getCamelContext(),eventDrivenProcessors);
    String routeId=route.idOrCreate(getCamelContext().getNodeIdFactory());
    CamelInternalProcessor internal=new CamelInternalProcessor(target);
    internal.addAdvice(new CamelInternalProcessor.UnitOfWorkProcessorAdvice(routeId));
    internal.addAdvice(new CamelInternalProcessor.RouteContextAdvice(this));
    List<RoutePolicy> routePolicyList=getRoutePolicyList();
    if (routePolicyList != null && !routePolicyList.isEmpty()) {
      for (      RoutePolicy policy : routePolicyList) {
        if (!camelContext.hasService(policy)) {
          try {
            camelContext.addService(policy);
          }
 catch (          Exception e) {
            throw ObjectHelper.wrapRuntimeCamelException(e);
          }
        }
      }
      internal.addAdvice(new CamelInternalProcessor.RoutePolicyAdvice(routePolicyList));
    }
    internal.addAdvice(new CamelInternalProcessor.RouteInflightRepositoryAdvice(camelContext.getInflightRepository(),routeId));
    internal.addAdvice(new CamelInternalProcessor.InstrumentationAdvice("route"));
    Route edcr=new EventDrivenConsumerRoute(this,getEndpoint(),internal);
    edcr.getProperties().put(Route.ID_PROPERTY,routeId);
    edcr.getProperties().put(Route.PARENT_PROPERTY,Integer.toHexString(route.hashCode()));
    if (route.getGroup() != null) {
      edcr.getProperties().put(Route.GROUP_PROPERTY,route.getGroup());
    }
    CamelInternalProcessor.RoutePolicyAdvice task=internal.getAdvice(CamelInternalProcessor.RoutePolicyAdvice.class);
    if (task != null) {
      task.setRoute(edcr);
    }
    if (routePolicyList != null && !routePolicyList.isEmpty()) {
      for (      RoutePolicy policy : routePolicyList) {
        policy.onInit(edcr);
      }
    }
    routes.add(edcr);
  }
}
