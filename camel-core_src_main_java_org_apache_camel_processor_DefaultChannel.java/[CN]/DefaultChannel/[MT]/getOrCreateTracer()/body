{
  InterceptStrategy tracer=Tracer.getTracer(camelContext);
  if (tracer == null) {
    if (camelContext.getRegistry() != null) {
      Map<String,Tracer> map=camelContext.getRegistry().lookupByType(Tracer.class);
      if (map.size() == 1) {
        tracer=map.values().iterator().next();
      }
    }
    if (tracer == null) {
      tracer=camelContext.getDefaultTracer();
      Map<String,TraceFormatter> formatters=camelContext.getRegistry().lookupByType(TraceFormatter.class);
      if (formatters.size() == 1) {
        TraceFormatter formatter=formatters.values().iterator().next();
        if (tracer instanceof Tracer) {
          ((Tracer)tracer).setFormatter(formatter);
        }
      }
    }
  }
  for (  LifecycleStrategy strategy : camelContext.getLifecycleStrategies()) {
    if (tracer instanceof Service) {
      strategy.onServiceAdd(camelContext,(Service)tracer,null);
    }
  }
  return tracer;
}
