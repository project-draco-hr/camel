{
  Exchange resourceExchange=createResourceExchange(exchange,ExchangePattern.InOut);
  producer.process(resourceExchange);
  if (resourceExchange.isFailed()) {
    copyResultsPreservePattern(exchange,resourceExchange);
  }
 else {
    prepareResult(exchange);
    ExchangeHelper.prepareAggregation(exchange,resourceExchange);
    Exchange aggregatedExchange=aggregationStrategy.aggregate(exchange,resourceExchange);
    if (aggregatedExchange != null) {
      copyResultsPreservePattern(exchange,aggregatedExchange);
    }
  }
}
