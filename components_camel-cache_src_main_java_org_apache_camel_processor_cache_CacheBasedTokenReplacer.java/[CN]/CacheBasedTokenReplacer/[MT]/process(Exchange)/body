{
  cacheManager=new DefaultCacheManagerFactory().instantiateCacheManager();
  if (isValid(cacheManager,cacheName,key)) {
    cache=cacheManager.getCache(cacheName);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Replacing Token " + replacementToken + "in Message with value stored against key "+ key+ " in CacheName "+ cacheName);
    }
    exchange.getIn().setHeader(CacheConstants.CACHE_KEY,key);
    Object body=exchange.getIn().getBody();
    InputStream is=exchange.getContext().getTypeConverter().convertTo(InputStream.class,body);
    byte[] buffer;
    try {
      buffer=IOConverter.toBytes(is);
    }
  finally {
      IOHelper.close(is,"is",LOG);
    }
    String cacheValue=exchange.getContext().getTypeConverter().convertTo(String.class,cache.get(key).getObjectValue());
    String replacedTokenString=new String(buffer).replaceAll(replacementToken,cacheValue);
    LOG.trace("replacedTokenString = {}",replacedTokenString);
    exchange.getIn().setBody(replacedTokenString.getBytes());
  }
}
