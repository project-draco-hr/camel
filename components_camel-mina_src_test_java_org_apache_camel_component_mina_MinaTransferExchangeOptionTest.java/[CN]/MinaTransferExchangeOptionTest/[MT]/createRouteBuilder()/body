{
  return new RouteBuilder(){
    public void configure(){
      from("mina:tcp://localhost:{{port}}?sync=true&encoding=UTF-8&transferExchange=true").process(new Processor(){
        public void process(        Exchange e) throws InterruptedException {
          Assert.assertNotNull(e.getIn().getBody());
          Assert.assertNotNull(e.getIn().getHeaders());
          Assert.assertNotNull(e.getProperties());
          Assert.assertEquals("Hello!",e.getIn().getBody());
          Assert.assertEquals("feta",e.getIn().getHeader("cheese"));
          Assert.assertEquals("old",e.getProperty("ham"));
          Assert.assertEquals(ExchangePattern.InOut,e.getPattern());
          Boolean setException=(Boolean)e.getProperty("setException");
          if (setException) {
            e.getOut().setFault(true);
            e.getOut().setBody(new InterruptedException());
            e.getOut().setHeader("hello","nihao");
          }
 else {
            e.getOut().setBody("Goodbye!");
            e.getOut().setHeader("cheese","cheddar");
          }
          e.setProperty("salami","fresh");
          e.setProperty("Charset",Charset.defaultCharset());
        }
      }
);
    }
  }
;
}
