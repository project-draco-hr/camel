{
  Endpoint endpoint=context.getEndpoint(URI);
  Exchange exchange=endpoint.createExchange();
  Message message=exchange.getIn();
  message.setBody("Hello!");
  message.setHeader("cheese","feta");
  exchange.setProperty("ham","old");
  Producer producer=endpoint.createProducer();
  producer.start();
  producer.process(exchange);
  Message out=exchange.getOut();
  assertNotNull(out);
  assertEquals("Goodbye!",out.getBody());
  assertEquals("cheddar",out.getHeader("cheese"));
  assertEquals("fresh",exchange.getProperty("salami"));
  Message in=exchange.getIn();
  assertNotNull(in);
  assertEquals("Hello!",in.getBody());
  assertEquals("feta",in.getHeader("cheese"));
  assertEquals("fresh",exchange.getProperty("salami"));
}
