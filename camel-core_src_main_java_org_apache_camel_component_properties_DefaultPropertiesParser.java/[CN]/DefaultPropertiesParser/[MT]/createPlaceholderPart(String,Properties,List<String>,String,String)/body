{
  replaced.add(key);
  String propertyValue=System.getProperty(key);
  if (propertyValue != null) {
    log.debug("Found a JVM system property: {} with value: {} to be used.",key,propertyValue);
  }
 else   if (properties != null) {
    propertyValue=properties.getProperty(key);
  }
  List<String> visited=new ArrayList<String>();
  while (isNestProperty(propertyValue,prefixToken,suffixToken)) {
    visited.add(key);
    String value=takeOffNestTokes(propertyValue,prefixToken,suffixToken);
    key=parseUri(value,properties,prefixToken,suffixToken);
    if (visited.contains(key)) {
      throw new IllegalArgumentException("Circular reference detected with key [" + key + "] from text: "+ propertyValue);
    }
    propertyValue=System.getProperty(key);
    if (propertyValue != null) {
      log.debug("Found a JVM system property: {} with value: {} to be used.",key,propertyValue);
    }
 else     if (properties != null) {
      propertyValue=properties.getProperty(key);
    }
  }
  return parseProperty(key,propertyValue,properties);
}
