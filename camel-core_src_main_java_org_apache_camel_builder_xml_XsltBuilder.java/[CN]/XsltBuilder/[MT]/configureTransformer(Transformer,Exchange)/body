{
  if (uriResolver == null) {
    uriResolver=new XsltUriResolver(exchange.getContext(),null);
  }
  transformer.setURIResolver(uriResolver);
  if (errorListener == null) {
    transformer.setErrorListener(new DefaultTransformErrorHandler(exchange));
  }
 else {
    transformer.setErrorListener(errorListener);
  }
  transformer.clearParameters();
  addParameters(transformer,exchange.getProperties());
  addParameters(transformer,exchange.getIn().getHeaders());
  addParameters(transformer,getParameters());
  transformer.setParameter("exchange",exchange);
  transformer.setParameter("in",exchange.getIn());
  transformer.setParameter("out",exchange.getOut());
}
