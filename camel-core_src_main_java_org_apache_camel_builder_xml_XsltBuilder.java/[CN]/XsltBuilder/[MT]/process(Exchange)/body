{
  notNull(getTemplate(),"template");
  if (isDeleteOutputFile()) {
    String fileName=ExchangeHelper.getMandatoryHeader(exchange,Exchange.XSLT_FILE_NAME,String.class);
    exchange.addOnCompletion(new XsltBuilderOnCompletion(fileName));
  }
  Transformer transformer=getTemplate().newTransformer();
  configureTransformer(transformer,exchange);
  Source source=getSource(exchange);
  ResultHandler resultHandler=resultHandlerFactory.createResult(exchange);
  Result result=resultHandler.getResult();
  Message out=exchange.getOut();
  out.copyFrom(exchange.getIn());
  transformer.transform(source,result);
  resultHandler.setBody(out);
}
