{
  Bus bus=null;
  if (endpoint.getApplicationContext() != null) {
    bus=endpoint.getCxfEndpointBean().getBus();
    if (CxfEndpointUtils.getSetDefaultBus(endpoint)) {
      BusFactory.setThreadDefaultBus(bus);
    }
  }
 else {
    bus=BusFactory.getThreadDefaultBus();
  }
  Class serviceClass=CxfEndpointUtils.getServiceClass(endpoint);
  if (cfb == null) {
    cfb=CxfEndpointUtils.getClientFactoryBean(serviceClass);
  }
  if (endpoint.isSpringContextEndpoint()) {
    endpoint.configure(cfb);
  }
 else {
    cfb.setAddress(endpoint.getAddress());
    if (null != endpoint.getServiceClass()) {
      cfb.setServiceClass(ObjectHelper.loadClass(endpoint.getServiceClass()));
    }
    if (null != endpoint.getWsdlURL()) {
      cfb.setWsdlURL(endpoint.getWsdlURL());
    }
    if (endpoint.getWsdlURL() != null) {
      cfb.setWsdlURL(endpoint.getWsdlURL());
    }
  }
  cfb.setServiceClass(serviceClass);
  if (CxfEndpointUtils.getServiceName(endpoint) != null) {
    cfb.setServiceName(CxfEndpointUtils.getServiceName(endpoint));
  }
  if (CxfEndpointUtils.getPortName(endpoint) != null) {
    cfb.setEndpointName(CxfEndpointUtils.getPortName(endpoint));
  }
  if (dataFormat.equals(DataFormat.MESSAGE)) {
    cfb.getFeatures().add(new MessageDataFormatFeature());
  }
 else   if (dataFormat.equals(DataFormat.PAYLOAD)) {
    cfb.getFeatures().add(new PayLoadDataFormatFeature());
  }
  cfb.setBus(bus);
  return ((ClientProxy)Proxy.getInvocationHandler(cfb.create())).getClient();
}
