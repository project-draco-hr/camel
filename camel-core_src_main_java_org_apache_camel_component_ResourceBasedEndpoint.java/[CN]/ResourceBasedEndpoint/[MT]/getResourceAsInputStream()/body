{
  InputStream is;
  if (contentCache) {
synchronized (this) {
      if (buffer == null) {
        log.debug("Reading resource: {} into the content cache",resourceUri);
        is=getResourceAsInputStreamWithoutCache();
        buffer=IOConverter.toBytes(is);
        IOHelper.close(is,resourceUri,log);
      }
    }
    log.debug("Using resource: {} from the content cache",resourceUri);
    return new ByteArrayInputStream(buffer);
  }
  return getResourceAsInputStreamWithoutCache();
}
