{
  String uri=getEndpoint().getEndpointUri();
  HttpEntity entity=createEntity(exchange);
  HttpRequest req;
  if (entity == null) {
    req=new BasicHttpRequest("GET",getEndpoint().getPath());
  }
 else {
    req=new BasicHttpEntityEnclosingRequest("POST",getEndpoint().getPath());
    ((BasicHttpEntityEnclosingRequest)req).setEntity(entity);
  }
  for (  String headerName : exchange.getIn().getHeaders().keySet()) {
    String headerValue=exchange.getIn().getHeader(headerName,String.class);
    if (shouldHeaderBePropagated(headerName,headerValue)) {
      req.addHeader(headerName,headerValue);
    }
  }
  return req;
}
