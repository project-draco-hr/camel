{
  Message in=exchange.getIn();
  HttpEntity entity=in.getBody(HttpEntity.class);
  if (entity == null) {
    byte[] data=in.getBody(byte[].class);
    if (data == null) {
      return null;
    }
    entity=new ByteArrayEntity(data);
    String contentType=MessageHelper.getContentType(in);
    if (contentType != null) {
      ((ByteArrayEntity)entity).setContentType(contentType);
    }
    String contentEncoding=in.getHeader("Content-Encoding",String.class);
    if (contentEncoding != null) {
      ((ByteArrayEntity)entity).setContentEncoding(contentEncoding);
    }
  }
  return entity;
}
