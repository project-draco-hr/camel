{
  StringBuilder normalize=new StringBuilder(hexString.length());
  for (int x=0; x < hexString.length(); x++) {
    char current=Character.toLowerCase(hexString.charAt(x));
    if (isHexChar(current)) {
      normalize.append(current);
    }
 else     if (!Character.isWhitespace(current)) {
      throw new IllegalStateException(String.format("Conversion of hex string to array failed. '%c' is not a valid hex character",current));
    }
  }
  if (normalize.length() % 2 > 0) {
    normalize.append('0');
  }
  byte[] hexArray=new byte[hexString.length() + 1 >> 1];
  for (int x=0; x < hexArray.length; x++) {
    int ni=x << 1;
    int mostSignificantNybble=Character.digit(normalize.charAt(ni),16);
    int leastSignificantNybble=Character.digit(normalize.charAt(ni + 1),16);
    int value=((mostSignificantNybble << 4)) | (leastSignificantNybble & 0x0F);
    hexArray[x]=(byte)value;
  }
  return hexArray;
}
