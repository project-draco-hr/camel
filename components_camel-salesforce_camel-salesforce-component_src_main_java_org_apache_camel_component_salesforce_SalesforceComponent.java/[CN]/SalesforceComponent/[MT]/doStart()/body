{
  ObjectHelper.notNull(loginConfig,"loginConfig");
  if (null == httpClient) {
    if (config != null && config.getHttpClient() != null) {
      httpClient=config.getHttpClient();
    }
 else {
      httpClient=new HttpClient();
      httpClient.setConnectorType(HttpClient.CONNECTOR_SELECT_CHANNEL);
      httpClient.setConnectTimeout(CONNECTION_TIMEOUT);
      httpClient.setTimeout(RESPONSE_TIMEOUT);
    }
  }
  final SSLContextParameters contextParameters=sslContextParameters != null ? sslContextParameters : new SSLContextParameters();
  final SslContextFactory sslContextFactory=httpClient.getSslContextFactory();
  sslContextFactory.setSslContext(contextParameters.createSSLContext());
  if (httpClientProperties != null && !httpClientProperties.isEmpty()) {
    IntrospectionSupport.setProperties(getCamelContext().getTypeConverter(),httpClient,new HashMap<String,Object>(httpClientProperties));
  }
  if (this.httpProxyHost != null && httpProxyPort != null) {
    httpClient.setProxy(new Address(this.httpProxyHost,this.httpProxyPort));
  }
  if (this.httpProxyUsername != null && httpProxyPassword != null) {
    httpClient.setProxyAuthentication(new ProxyAuthorization(this.httpProxyUsername,this.httpProxyPassword));
  }
  String listenerClass=RedirectListener.class.getName();
  if (httpClient.getRegisteredListeners() == null || !httpClient.getRegisteredListeners().contains(listenerClass)) {
    httpClient.registerListener(listenerClass);
  }
  httpClient.start();
  if (null == this.session) {
    this.session=new SalesforceSession(httpClient,loginConfig);
  }
  if (!loginConfig.isLazyLogin()) {
    ServiceHelper.startService(session);
  }
  if (packages != null && packages.length > 0) {
    classMap=parsePackages();
    LOG.info("Found {} generated classes in packages: {}",classMap.size(),Arrays.asList(packages));
  }
 else {
    LOG.warn("Missing property packages, getSObject* operations will NOT work");
    classMap=new HashMap<String,Class<?>>(0);
  }
  if (subscriptionHelper != null) {
    ServiceHelper.startService(subscriptionHelper);
  }
}
