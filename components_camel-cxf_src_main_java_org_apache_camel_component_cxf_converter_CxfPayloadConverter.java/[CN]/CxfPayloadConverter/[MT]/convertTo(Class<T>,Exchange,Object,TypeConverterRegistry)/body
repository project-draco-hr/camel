{
  if (type.isAssignableFrom(CxfPayload.class)) {
    if (!value.getClass().isArray()) {
      TypeConverter tc=registry.lookup(Source.class,value.getClass());
      if (tc != null) {
        Source src=tc.convertTo(Source.class,exchange,value);
        return (T)sourceToCxfPayload(src,exchange);
      }
    }
    TypeConverter tc=registry.lookup(NodeList.class,value.getClass());
    if (tc != null) {
      NodeList nodeList=tc.convertTo(NodeList.class,exchange,value);
      return (T)nodeListToCxfPayload(nodeList,exchange);
    }
    tc=registry.lookup(Document.class,value.getClass());
    if (tc != null) {
      Document document=tc.convertTo(Document.class,exchange,value);
      return (T)documentToCxfPayload(document,exchange);
    }
    CxfPayload<?> p;
    p=convertVia(InputStream.class,exchange,value,registry);
    if (p != null) {
      return (T)p;
    }
    p=convertVia(String.class,exchange,value,registry);
    if (p != null) {
      return (T)p;
    }
    return (T)Void.TYPE;
  }
  if (CxfPayload.class.isAssignableFrom(value.getClass())) {
    CxfPayload<?> payload=(CxfPayload<?>)value;
    if (payload.getBodySources().size() == 1) {
      if (type.isAssignableFrom(Document.class)) {
        Source s=payload.getBodySources().get(0);
        Document d;
        try {
          d=StaxUtils.read(s);
        }
 catch (        XMLStreamException e) {
          throw new RuntimeException(e);
        }
        payload.getBodySources().set(0,new DOMSource(d.getDocumentElement()));
        return type.cast(d);
      }
      TypeConverter tc=registry.lookup(type,Source.class);
      if (tc != null) {
        T t=tc.convertTo(type,payload.getBodySources().get(0));
        if (t instanceof Document) {
          payload.getBodySources().set(0,new DOMSource(((Document)t).getDocumentElement()));
        }
 else         if (t instanceof Source) {
          payload.getBodySources().set(0,(Source)t);
        }
        return t;
      }
    }
    TypeConverter tc=registry.lookup(type,NodeList.class);
    if (tc != null) {
      Object result=tc.convertTo(type,cxfPayloadToNodeList((CxfPayload<?>)value,exchange));
      if (result == null) {
        return (T)Void.TYPE;
      }
 else {
        return (T)result;
      }
    }
    tc=registry.lookup(type,Node.class);
    if (tc != null) {
      NodeList nodeList=cxfPayloadToNodeList((CxfPayload<?>)value,exchange);
      if (nodeList.getLength() > 0) {
        return tc.convertTo(type,nodeList.item(0));
      }
 else {
        return (T)Void.TYPE;
      }
    }
  }
  return null;
}
