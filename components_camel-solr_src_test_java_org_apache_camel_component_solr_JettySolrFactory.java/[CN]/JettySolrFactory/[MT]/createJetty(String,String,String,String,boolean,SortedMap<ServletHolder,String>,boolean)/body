{
  if (!mockedSslClient) {
    installAllTrustingClientSsl();
    mockedSslClient=true;
  }
  System.setProperty("solr.solr.home",solrHome);
  System.setProperty("jetty.testMode","true");
  System.setProperty("solr.data.dir","target/test-classes/solr/data" + (data_dir_no++));
  System.setProperty("solr.directoryFactory","solr.RAMDirectoryFactory");
  SSLConfig sslConfig=buildSSLConfig(ssl,false);
  context=context == null ? "/solr" : context;
  JettySolrRunner jetty=new JettySolrRunner(solrHome,context,0,configFile,schemaFile,stopAtShutdown,extraServlets,sslConfig);
  jetty.start();
  int port=jetty.getLocalPort();
  return jetty;
}
