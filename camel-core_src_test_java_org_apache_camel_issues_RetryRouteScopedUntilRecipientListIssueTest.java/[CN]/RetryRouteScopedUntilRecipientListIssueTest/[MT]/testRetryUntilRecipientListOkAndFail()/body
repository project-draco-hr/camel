{
  invoked.set(0);
  NotifyBuilder notify=new NotifyBuilder(context).whenFailed(1).create();
  getMockEndpoint("mock:result").expectedMessageCount(0);
  getMockEndpoint("mock:foo").expectedMessageCount(1);
  template.sendBodyAndHeader("seda:start","Hello World","recipientListHeader","direct:foo,fail");
  assertMockEndpointsSatisfied();
  boolean matches=notify.matches(10,TimeUnit.SECONDS);
  assertTrue(matches);
  context.stop();
  assertEquals(3,invoked.get());
}
