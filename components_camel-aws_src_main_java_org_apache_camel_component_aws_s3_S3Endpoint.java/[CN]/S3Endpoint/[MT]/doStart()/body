{
  super.doStart();
  String fileName=getConfiguration().getFileName();
  if (fileName != null) {
    LOG.trace("File name [{}] requested, so skipping bucket check...",fileName);
    return;
  }
  String bucketName=getConfiguration().getBucketName();
  LOG.trace("Quering whether bucket [{}] already exists...",bucketName);
  try {
    getS3Client().listObjects(new ListObjectsRequest(bucketName,null,null,null,0));
    LOG.trace("Bucket [{}] already exists",bucketName);
    return;
  }
 catch (  AmazonServiceException ase) {
    if (ase.getStatusCode() != 404) {
      throw ase;
    }
  }
  LOG.trace("Bucket [{}] doesn't exist yet",bucketName);
  CreateBucketRequest createBucketRequest=new CreateBucketRequest(getConfiguration().getBucketName());
  if (getConfiguration().getRegion() != null) {
    createBucketRequest.setRegion(getConfiguration().getRegion());
  }
  LOG.trace("Creating bucket [{}] in region [{}] with request [{}]...",new Object[]{configuration.getBucketName(),configuration.getRegion(),createBucketRequest});
  getS3Client().createBucket(createBucketRequest);
  LOG.trace("Bucket created");
  if (configuration.getPolicy() != null) {
    LOG.trace("Updating bucket [{}] with policy [{}]",bucketName,configuration.getPolicy());
    getS3Client().setBucketPolicy(bucketName,configuration.getPolicy());
    LOG.trace("Bucket policy updated");
  }
}
