{
  int processed=0;
  for (  MessageAndMetadata<byte[],byte[]> mm : stream) {
    Exchange exchange=endpoint.createKafkaExchange(mm);
    try {
      processor.process(exchange);
    }
 catch (    Exception e) {
      LOG.error(e.getMessage(),e);
    }
    processed++;
    if (processed >= endpoint.getBatchSize()) {
      try {
        berrier.await(endpoint.getBarrierAwaitTimeoutMs(),TimeUnit.MILLISECONDS);
        processed=0;
      }
 catch (      InterruptedException e) {
        LOG.error(e.getMessage(),e);
        break;
      }
catch (      BrokenBarrierException e) {
        LOG.error(e.getMessage(),e);
        break;
      }
catch (      TimeoutException e) {
        LOG.error(e.getMessage(),e);
      }
    }
  }
}
