{
  int processed=0;
  boolean consumerTimeout;
  MessageAndMetadata<byte[],byte[]> mm=null;
  ConsumerIterator<byte[],byte[]> it=stream.iterator();
  while (true) {
    try {
      consumerTimeout=false;
      if (it.hasNext()) {
        mm=it.next();
      }
 else {
        break;
      }
      Exchange exchange=endpoint.createKafkaExchange(mm);
      try {
        processor.process(exchange);
      }
 catch (      Exception e) {
        LOG.error(e.getMessage(),e);
      }
      processed++;
    }
 catch (    ConsumerTimeoutException e) {
      LOG.debug(e.getMessage(),e);
      consumerTimeout=true;
    }
    if (processed >= endpoint.getBatchSize() || consumerTimeout) {
      try {
        berrier.await(endpoint.getBarrierAwaitTimeoutMs(),TimeUnit.MILLISECONDS);
        if (!consumerTimeout) {
          processed=0;
        }
      }
 catch (      InterruptedException e) {
        LOG.error(e.getMessage(),e);
        break;
      }
catch (      BrokenBarrierException e) {
        LOG.error(e.getMessage(),e);
        break;
      }
catch (      TimeoutException e) {
        LOG.error(e.getMessage(),e);
      }
    }
  }
}
