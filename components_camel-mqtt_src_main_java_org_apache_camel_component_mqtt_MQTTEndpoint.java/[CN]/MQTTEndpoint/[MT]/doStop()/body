{
  if (connection != null) {
    final Promise promise=new Promise();
    connection.disconnect(new Callback<Void>(){
      public void onSuccess(      Void value){
        promise.onSuccess(value);
      }
      public void onFailure(      Throwable value){
        promise.onFailure(value);
      }
    }
);
    promise.await(configuration.getDisconnectWaitInSeconds(),TimeUnit.SECONDS);
  }
  super.doStop();
}
