{
  CachedOutputStream cos=new CachedOutputStream(exchange);
  cos.write(TEST_STRING.getBytes("UTF-8"));
  File file=new File("./target/cachedir");
  String[] files=file.list();
  assertEquals("we should have a temp file",files.length,1);
  assertTrue("The file name should start with cos",files[0].startsWith("cos"));
  StreamCache cache=cos.getStreamCache();
  assertTrue("Should get the FileInputStreamCache",cache instanceof FileInputStreamCache);
  String temp=toString((InputStream)cache);
  assertEquals("Cached a wrong file",temp,TEST_STRING);
  cache.reset();
  temp=toString((InputStream)cache);
  assertEquals("Cached a wrong file",temp,TEST_STRING);
  if (System.getProperty("os.name").startsWith("Windows")) {
    ((InputStream)cache).close();
  }
  exchange.getUnitOfWork().done(exchange);
  ((InputStream)cache).close();
  files=file.list();
  assertEquals("we should have no temp file",files.length,0);
}
