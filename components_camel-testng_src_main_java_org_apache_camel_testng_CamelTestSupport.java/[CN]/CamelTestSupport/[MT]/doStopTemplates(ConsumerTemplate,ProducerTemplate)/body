{
  if (consumer != null) {
    if (consumer == threadConsumer.get()) {
      threadConsumer.remove();
    }
    consumer.stop();
    consumer=null;
  }
  if (template != null) {
    if (template == threadTemplate.get()) {
      threadTemplate.remove();
    }
    template.stop();
    template=null;
  }
}
