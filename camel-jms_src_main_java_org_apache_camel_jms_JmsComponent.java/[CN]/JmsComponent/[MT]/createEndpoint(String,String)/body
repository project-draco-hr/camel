{
  ObjectHelper.notNull(container,"container");
  if (path.startsWith(QUEUE_PREFIX)) {
    template.setPubSubDomain(false);
    path=path.substring(QUEUE_PREFIX.length());
  }
 else   if (path.startsWith(TOPIC_PREFIX)) {
    template.setPubSubDomain(false);
    path=path.substring(TOPIC_PREFIX.length());
  }
  final String subject=convertPathToActualDestination(path);
  template.setDefaultDestinationName(subject);
  AbstractMessageListenerContainer listenerContainer=createMessageListenerContainer(template);
  listenerContainer.setDestinationName(subject);
  listenerContainer.setPubSubDomain(template.isPubSubDomain());
  listenerContainer.setConnectionFactory(template.getConnectionFactory());
  return new JmsEndpoint(uri,container,subject,template,listenerContainer);
}
