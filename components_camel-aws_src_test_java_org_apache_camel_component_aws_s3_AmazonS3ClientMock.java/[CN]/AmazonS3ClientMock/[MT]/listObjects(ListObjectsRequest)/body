{
  if ("nonExistingBucket".equals(listObjectsRequest.getBucketName()) && !nonExistingBucketCreated) {
    AmazonServiceException ex=new AmazonServiceException("Unknow bucket");
    ex.setStatusCode(404);
    throw ex;
  }
  int capacity;
  ObjectListing objectListing=new ObjectListing();
  if (!ObjectHelper.isEmpty(listObjectsRequest.getMaxKeys()) && listObjectsRequest.getMaxKeys() != null) {
    capacity=listObjectsRequest.getMaxKeys();
  }
 else {
    capacity=maxCapacity;
  }
  for (int index=0; index < objects.size() && index < capacity; index++) {
    S3ObjectSummary s3ObjectSummary=new S3ObjectSummary();
    s3ObjectSummary.setBucketName(objects.get(index).getBucketName());
    s3ObjectSummary.setKey(objects.get(index).getKey());
    objectListing.getObjectSummaries().add(s3ObjectSummary);
  }
  return objectListing;
}
