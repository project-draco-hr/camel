{
  final JpaTemplate jpaTemplate=(JpaTemplate)applicationContext.getBean("jpaTemplate");
  return new RouteBuilder(){
    public void configure(){
      from(endpointUri).idempotentConsumer(header("messageId"),jpaMessageIdRepository(jpaTemplate,"myProcessorName")).process(processor);
    }
  }
;
}
