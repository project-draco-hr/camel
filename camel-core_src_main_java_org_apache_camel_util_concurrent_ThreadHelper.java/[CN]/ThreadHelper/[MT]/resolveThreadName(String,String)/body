{
  if (pattern == null) {
    pattern=DEFAULT_PATTERN;
  }
  String longName=name;
  String shortName=name.contains("?") ? ObjectHelper.before(name,"?") : name;
  shortName=Matcher.quoteReplacement(shortName);
  longName=Matcher.quoteReplacement(longName);
  String answer=pattern.replaceFirst("#counter#","" + nextThreadCounter());
  answer=answer.replaceFirst("#longName#",longName);
  answer=answer.replaceFirst("#name#",shortName);
  if (INVALID_PATTERN.matcher(answer).matches()) {
    throw new IllegalArgumentException("Pattern is invalid: " + pattern);
  }
  return answer;
}
