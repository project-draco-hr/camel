{
  Queue<Exchange> answer=new LinkedList<Exchange>();
  int fetchSize=getEndpoint().getConfiguration().getFetchSize();
  int count=fetchSize == -1 ? messages.length : Math.min(fetchSize,messages.length);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Fetching {} messages. Total {} messages.",count,messages.length);
  }
  for (int i=0; i < count; i++) {
    Message message=messages[i];
    if (LOG.isTraceEnabled()) {
      LOG.trace("Mail #{} is of type: {} - {}",new Object[]{i,ObjectHelper.classCanonicalName(message),message});
    }
    if (!message.getFlags().contains(Flags.Flag.DELETED)) {
      Exchange exchange=getEndpoint().createExchange(message);
      if (getEndpoint().getConfiguration().isMapMailMessage()) {
        LOG.trace("Mapping #{} from javax.mail.Message to Camel MailMessage",i);
        exchange.getIn().getBody();
        exchange.getIn().getHeaders();
        exchange.getIn().getAttachments();
      }
      if (getEndpoint().getConfiguration().getProtocol().startsWith("pop3")) {
        String uid=generatePop3Uid(message);
        if (uid != null) {
          exchange.setProperty(POP3_UID,uid);
          LOG.trace("POP3 mail message using uid {}",uid);
        }
      }
      answer.add(exchange);
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Skipping message as it was flagged as deleted: {}",MailUtils.dumpMessage(message));
      }
    }
  }
  return answer;
}
