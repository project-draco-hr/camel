{
  try {
    if (!folder.isOpen()) {
      folder.open(Folder.READ_WRITE);
    }
    if (getEndpoint().getConfiguration().isDelete()) {
      LOG.debug("Exchange processed, so flagging message as DELETED");
      mail.setFlag(Flags.Flag.DELETED,true);
    }
 else {
      LOG.debug("Exchange processed, so flagging message as SEEN");
      mail.setFlag(Flags.Flag.SEEN,true);
    }
  }
 catch (  MessagingException e) {
    LOG.warn("Error occurred during flagging message as DELETED/SEEN",e);
    exchange.setException(e);
  }
}
