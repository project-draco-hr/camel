{
  int fetchSize=endpoint.getConfiguration().getFetchSize();
  int count=fetchSize == -1 ? messages.length : Math.min(fetchSize,messages.length);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Fetching " + count + " messages. Total "+ messages.length+ " messages.");
  }
  for (int i=0; i < count; i++) {
    Message message=messages[i];
    if (!message.getFlags().contains(Flags.Flag.DELETED)) {
      MailExchange exchange=endpoint.createExchange(message);
      process(exchange);
      if (!exchange.isFailed()) {
        processCommit(exchange);
      }
 else {
        processRollback(exchange);
      }
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Skipping message as it was flagged as deleted: " + MailUtils.dumpMessage(message));
      }
    }
  }
}
