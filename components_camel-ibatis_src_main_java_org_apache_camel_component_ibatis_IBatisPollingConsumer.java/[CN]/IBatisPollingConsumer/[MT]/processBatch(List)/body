{
  final IBatisEndpoint endpoint=getEndpoint();
  final List<DataHolder> list=exchanges;
  int total=list.size();
  for (int index=0; index < total && isRunAllowed(); index++) {
    Exchange exchange=list.get(index).exchange;
    Object data=list.get(index).data;
    exchange.setProperty(Exchange.BATCH_INDEX,index);
    exchange.setProperty(Exchange.BATCH_SIZE,total);
    exchange.setProperty(Exchange.BATCH_COMPLETE,index == total - 1);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Processing exchange: " + exchange);
    }
    getProcessor().process(exchange);
    try {
      if (onConsume != null) {
        endpoint.getProcessingStrategy().commit(endpoint,exchange,data,onConsume);
      }
    }
 catch (    Exception e) {
      handleException(e);
    }
  }
}
