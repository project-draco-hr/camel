{
  final boolean fault;
  if (exchange.hasOut()) {
    fault=exchange.getOut().isFault();
    exchange.getOut().setFault(false);
  }
 else {
    fault=exchange.getIn().isFault();
    exchange.getIn().setFault(false);
  }
  final Exception exception=exchange.getException();
  exchange.setException(null);
  if (exception != null) {
    exchange.setProperty(Exchange.EXCEPTION_CAUGHT,exception);
  }
  if (exchange.getProperty(Exchange.FAILURE_ENDPOINT) == null) {
    exchange.setProperty(Exchange.FAILURE_ENDPOINT,exchange.getProperty(Exchange.TO_ENDPOINT));
  }
  return processor.process(exchange,new FinallyAsyncCallback(exchange,callback,exception,fault));
}
