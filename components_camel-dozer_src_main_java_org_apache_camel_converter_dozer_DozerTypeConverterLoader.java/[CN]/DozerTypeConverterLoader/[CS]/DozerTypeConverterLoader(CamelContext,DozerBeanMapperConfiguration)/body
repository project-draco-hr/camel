{
  GlobalSettings settings=GlobalSettings.getInstance();
  try {
    log.info("Configuring GlobalSettings to use Camel classloader: {}",DozerThreadContextClassLoader.class.getName());
    Field field=settings.getClass().getDeclaredField("classLoaderBeanName");
    ReflectionHelper.setField(field,settings,DozerThreadContextClassLoader.class.getName());
  }
 catch (  Exception e) {
    throw new IllegalStateException("Cannot configure Dozer GlobalSettings to use CamelToDozerClassResolverAdapter as classloader due " + e.getMessage(),e);
  }
  ClassLoader tccl=Thread.currentThread().getContextClassLoader();
  try {
    ClassLoader appcl=camelContext.getApplicationContextClassLoader();
    if (appcl != null) {
      Thread.currentThread().setContextClassLoader(appcl);
    }
    log.info("Using DozerBeanMapperConfiguration: {}",configuration);
    DozerBeanMapper mapper=createDozerBeanMapper(configuration);
    this.camelContext=camelContext;
    this.mapper=mapper;
    this.configuration=configuration;
    camelContext.addService(this);
  }
 catch (  Exception e) {
    throw ObjectHelper.wrapRuntimeCamelException(e);
  }
 finally {
    Thread.currentThread().setContextClassLoader(tccl);
  }
}
