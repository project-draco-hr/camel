{
  List<PGPPublicKey> result=new ArrayList<PGPPublicKey>(3);
  PGPPublicKeyRingCollection pgpSec=new PGPPublicKeyRingCollection(PGPUtil.getDecoderStream(input));
  for (Iterator<PGPPublicKeyRing> keyRingIter=pgpSec.getKeyRings(); keyRingIter.hasNext(); ) {
    PGPPublicKeyRing keyRing=keyRingIter.next();
    Set<String> keyUserIds=getUserIds(keyRing);
    for (Iterator<PGPPublicKey> keyIter=keyRing.getPublicKeys(); keyIter.hasNext(); ) {
      PGPPublicKey key=keyIter.next();
      for (      String userid : userids) {
        for (        String keyUserId : keyUserIds) {
          if (keyUserId != null && keyUserId.contains(userid)) {
            if (forEncryption && key.isEncryptionKey()) {
              result.add(key);
            }
 else             if (!forEncryption && isSignatureKey(key)) {
              result.add(key);
            }
          }
        }
      }
    }
  }
  return result;
}
