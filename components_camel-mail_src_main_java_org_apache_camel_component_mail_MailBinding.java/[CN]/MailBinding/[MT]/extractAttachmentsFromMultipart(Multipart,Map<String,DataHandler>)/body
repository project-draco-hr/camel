{
  for (int i=0; i < mp.getCount(); i++) {
    Part part=mp.getBodyPart(i);
    LOG.trace("Part #" + i + ": "+ part);
    if (part.isMimeType("multipart/*")) {
      LOG.trace("Part #" + i + ": is mimetype: multipart/*");
      extractAttachmentsFromMultipart((Multipart)part.getContent(),map);
    }
 else {
      String disposition=part.getDisposition();
      if (LOG.isTraceEnabled()) {
        LOG.trace("Part #" + i + ": Disposition: "+ part.getDisposition());
        LOG.trace("Part #" + i + ": Description: "+ part.getDescription());
        LOG.trace("Part #" + i + ": ContentType: "+ part.getContentType());
        LOG.trace("Part #" + i + ": FileName: "+ part.getFileName());
        LOG.trace("Part #" + i + ": Size: "+ part.getSize());
        LOG.trace("Part #" + i + ": LineCount: "+ part.getLineCount());
      }
      if (disposition != null && (disposition.equalsIgnoreCase(Part.ATTACHMENT) || disposition.equalsIgnoreCase(Part.INLINE))) {
        String fileName=part.getFileName();
        if (fileName != null) {
          LOG.debug("Mail contains file attachment: " + fileName);
          CollectionHelper.appendValue(map,fileName,part.getDataHandler());
        }
      }
    }
  }
}
