{
  try {
    appendHeadersFromCamel(mimeMessage,exchange,exchange.getIn());
    String destination=endpoint.getConfiguration().getDestination();
    if (destination != null) {
      mimeMessage.setRecipients(Message.RecipientType.TO,destination);
    }
    if (mimeMessage.getAllRecipients() == null) {
      throw new IllegalArgumentException("The MineMessage does not have any recipients set. " + "Add a destination (Recipient.TO) to the MailConfiguration.");
    }
    if (empty(mimeMessage.getFrom())) {
      String from=endpoint.getConfiguration().getFrom();
      mimeMessage.setFrom(new InternetAddress(from));
    }
    if (exchange.getIn().getAttachments() != null && exchange.getIn().getAttachments().size() > 0) {
      appendAttachmentsFromCamel(mimeMessage,exchange,exchange.getIn());
    }
 else {
      mimeMessage.setText(exchange.getIn().getBody(String.class));
    }
  }
 catch (  Exception e) {
    throw new RuntimeMailException("Failed to populate body due to: " + e.getMessage() + ". Exchange: "+ exchange,e);
  }
}
