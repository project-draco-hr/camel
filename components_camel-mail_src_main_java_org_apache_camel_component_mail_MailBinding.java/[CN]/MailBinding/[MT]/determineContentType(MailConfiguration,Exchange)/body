{
  String contentType=configuration.getContentType();
  if (exchange.getIn().getHeader("contentType") != null) {
    contentType=exchange.getIn().getHeader("contentType",String.class);
  }
 else   if (exchange.getIn().getHeader(Exchange.CONTENT_TYPE) != null) {
    contentType=exchange.getIn().getHeader(Exchange.CONTENT_TYPE,String.class);
  }
  if (contentType != null && contentType.contains(";")) {
    String before=ObjectHelper.before(contentType,";");
    String after=ObjectHelper.after(contentType,";");
    if (after != null) {
      String charset=ObjectHelper.after(after,"=");
      charset=determineCharSet(configuration,charset);
      if (charset != null) {
        after="charset=" + charset;
      }
 else {
        after=null;
      }
    }
    if (before != null && after == null) {
      contentType=before.trim();
    }
 else     if (before != null && after != null) {
      contentType=before.trim() + "; " + after;
    }
  }
  if (LOG.isTraceEnabled()) {
    LOG.trace("Determined Content-Type: " + contentType);
  }
  return contentType;
}
