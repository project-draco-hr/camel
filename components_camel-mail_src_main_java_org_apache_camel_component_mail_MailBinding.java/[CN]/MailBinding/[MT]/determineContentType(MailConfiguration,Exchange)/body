{
  String contentType=configuration.getContentType();
  if (exchange.getIn().getHeader("contentType") != null) {
    contentType=exchange.getIn().getHeader("contentType",String.class);
  }
 else   if (exchange.getIn().getHeader(Exchange.CONTENT_TYPE) != null) {
    contentType=exchange.getIn().getHeader(Exchange.CONTENT_TYPE,String.class);
  }
  if (contentType != null && contentType.contains(";")) {
    String before=ObjectHelper.before(contentType,";");
    String charset=determineCharSet(configuration,exchange);
    if (before != null && charset == null) {
      contentType=before.trim();
    }
 else     if (before != null && charset != null) {
      contentType=before.trim() + "; charset=" + charset;
    }
  }
  if (contentType != null && !contentType.contains(";") && IOConverter.getCharsetName(exchange,false) != null) {
    contentType=contentType.trim() + "; charset=" + IOConverter.getCharsetName(exchange,false);
  }
  if (LOG.isTraceEnabled()) {
    LOG.trace("Determined Content-Type: " + contentType);
  }
  return contentType;
}
