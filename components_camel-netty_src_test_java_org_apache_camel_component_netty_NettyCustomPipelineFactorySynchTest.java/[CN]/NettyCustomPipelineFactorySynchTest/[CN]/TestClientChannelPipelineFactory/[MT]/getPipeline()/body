{
  invoked=true;
  ChannelPipeline channelPipeline=Channels.pipeline();
  if (producer.getConfiguration().getTimeout() > 0) {
    channelPipeline.addLast("timeout",new ReadTimeoutHandler(producer.getEndpoint().getTimer(),producer.getConfiguration().getTimeout(),TimeUnit.MILLISECONDS));
  }
  channelPipeline.addLast("decoder-DELIM",new DelimiterBasedFrameDecoder(maxLineSize,true,Delimiters.lineDelimiter()));
  channelPipeline.addLast("decoder-SD",new StringDecoder(CharsetUtil.UTF_8));
  channelPipeline.addLast("encoder-SD",new StringEncoder(CharsetUtil.UTF_8));
  channelPipeline.addLast("handler",new ClientChannelHandler(producer,exchange,callback));
  return channelPipeline;
}
