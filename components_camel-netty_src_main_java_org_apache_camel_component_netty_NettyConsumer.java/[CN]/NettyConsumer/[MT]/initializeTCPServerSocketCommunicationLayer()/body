{
  ThreadPoolProfile bossProfile=new ThreadPoolBuilder("NettyTCPBoss").poolSize(configuration.getCorePoolSize()).maxPoolSize(configuration.getMaxPoolSize()).build();
  ThreadPoolProfile workerProfile=new ThreadPoolBuilder("NettyTCPWorker").poolSize(configuration.getCorePoolSize()).maxPoolSize(configuration.getMaxPoolSize()).build();
  ExecutorService bossExecutor=context.getExecutorServiceManager().getExecutorService(bossProfile,this);
  ExecutorService workerExecutor=context.getExecutorServiceManager().getExecutorService(workerProfile,this);
  channelFactory=new NioServerSocketChannelFactory(bossExecutor,workerExecutor);
  serverBootstrap=new ServerBootstrap(channelFactory);
  if (configuration.getServerPipelineFactory() != null) {
    configuration.getServerPipelineFactory().setConsumer(this);
    serverBootstrap.setPipelineFactory(configuration.getServerPipelineFactory());
  }
 else {
    serverBootstrap.setPipelineFactory(new DefaultServerPipelineFactory(this));
  }
  serverBootstrap.setOption("child.keepAlive",configuration.isKeepAlive());
  serverBootstrap.setOption("child.tcpNoDelay",configuration.isTcpNoDelay());
  serverBootstrap.setOption("child.reuseAddress",configuration.isReuseAddress());
  serverBootstrap.setOption("child.connectTimeoutMillis",configuration.getConnectTimeout());
  channel=serverBootstrap.bind(new InetSocketAddress(configuration.getHost(),configuration.getPort()));
  allChannels.add(channel);
}
