{
  boolean exclusive=false;
  LOG.trace("Waiting for exclusive read lock to file: " + file);
  try {
    long lastModified=Long.MIN_VALUE;
    long length=Long.MIN_VALUE;
    StopWatch watch=new StopWatch();
    while (!exclusive) {
      if (timeout > 0) {
        long delta=watch.taken();
        if (delta > timeout) {
          LOG.warn("Cannot acquire read lock within " + timeout + " millis. Will skip the file: "+ file);
          return false;
        }
      }
      long newLastModified=0;
      long newLength=0;
      List<FTPFile> files=operations.listFiles(file.getParent());
      for (      FTPFile f : files) {
        if (f.getName().equals(file.getFileName())) {
          newLastModified=f.getTimestamp().getTimeInMillis();
          newLength=f.getSize();
        }
      }
      LOG.trace("Previous last modified: " + lastModified + ", new last modified: "+ newLastModified);
      LOG.trace("Previous length: " + length + ", new length: "+ newLength);
      if (newLastModified == lastModified && newLength == length && length != 0) {
        LOG.trace("Read lock acquired.");
        exclusive=true;
      }
 else {
        lastModified=newLastModified;
        length=newLength;
        boolean interrupted=sleep();
        if (interrupted) {
          return false;
        }
      }
    }
  }
 catch (  Exception e) {
    if (timeout == 0) {
      throw e;
    }
    LOG.debug("Cannot acquire read lock. Will try again.",e);
    boolean interrupted=sleep();
    if (interrupted) {
      return false;
    }
  }
  return exclusive;
}
