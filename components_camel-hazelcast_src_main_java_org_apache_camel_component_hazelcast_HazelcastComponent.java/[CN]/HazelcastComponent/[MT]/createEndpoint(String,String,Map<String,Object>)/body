{
  HazelcastInstance hzInstance=resolveAndRemoveReferenceParameter(parameters,"hazelcastInstance",HazelcastInstance.class);
  if (hzInstance == null) {
    hzInstance=hazelcastInstance;
  }
  HazelcastDefaultEndpoint endpoint=null;
  if (remaining.startsWith(HazelcastConstants.MAP_PREFIX)) {
    remaining=removeStartingCharacters(remaining.substring(HazelcastConstants.MAP_PREFIX.length()),'/');
    endpoint=new HazelcastMapEndpoint(hzInstance,uri,remaining,this);
  }
  if (remaining.startsWith(HazelcastConstants.MULTIMAP_PREFIX)) {
    remaining=removeStartingCharacters(remaining.substring(HazelcastConstants.MULTIMAP_PREFIX.length()),'/');
    endpoint=new HazelcastMultimapEndpoint(hzInstance,uri,remaining,this);
  }
  if (remaining.startsWith(HazelcastConstants.ATOMICNUMBER_PREFIX)) {
    remaining=removeStartingCharacters(remaining.substring(HazelcastConstants.ATOMICNUMBER_PREFIX.length()),'/');
    endpoint=new HazelcastAtomicnumberEndpoint(hzInstance,uri,this,remaining);
  }
  if (remaining.startsWith(HazelcastConstants.INSTANCE_PREFIX)) {
    remaining=removeStartingCharacters(remaining.substring(HazelcastConstants.INSTANCE_PREFIX.length()),'/');
    endpoint=new HazelcastInstanceEndpoint(hzInstance,uri,this);
  }
  if (remaining.startsWith(HazelcastConstants.QUEUE_PREFIX)) {
    remaining=removeStartingCharacters(remaining.substring(HazelcastConstants.QUEUE_PREFIX.length()),'/');
    endpoint=new HazelcastQueueEndpoint(hzInstance,uri,this,remaining);
  }
  if (remaining.startsWith(HazelcastConstants.SEDA_PREFIX)) {
    final HazelcastSedaConfiguration config=new HazelcastSedaConfiguration();
    setProperties(config,parameters);
    config.setQueueName(remaining.substring(remaining.indexOf(":") + 1,remaining.length()));
    endpoint=new HazelcastSedaEndpoint(hzInstance,uri,this,config);
  }
  if (remaining.startsWith(HazelcastConstants.LIST_PREFIX)) {
    remaining=removeStartingCharacters(remaining.substring(HazelcastConstants.LIST_PREFIX.length()),'/');
    endpoint=new HazelcastListEndpoint(hzInstance,uri,this,remaining);
  }
  if (endpoint == null) {
    throw new IllegalArgumentException(String.format("Your URI does not provide a correct 'type' prefix. It should be anything like 'hazelcast:[%s|%s|%s|%s|%s|%s|%s]name' but is '%s'.",HazelcastConstants.MAP_PREFIX,HazelcastConstants.MULTIMAP_PREFIX,HazelcastConstants.ATOMICNUMBER_PREFIX,HazelcastConstants.INSTANCE_PREFIX,HazelcastConstants.QUEUE_PREFIX,HazelcastConstants.SEDA_PREFIX,HazelcastConstants.LIST_PREFIX,uri));
  }
  return endpoint;
}
