{
  notNull(entityManagerFactory,"entityManagerFactory");
  transactionTemplate.execute(new TransactionCallbackWithoutResult(){
    protected void doInTransactionWithoutResult(    TransactionStatus status){
      processRules.setProcessDefinition(getProcessDefinition());
    }
  }
);
  return new JpaBamProcessor(transactionTemplate,entityManagerFactory,activityBuilder.getCorrelationExpression(),activityBuilder.getActivityRules(),getEntityType());
}
