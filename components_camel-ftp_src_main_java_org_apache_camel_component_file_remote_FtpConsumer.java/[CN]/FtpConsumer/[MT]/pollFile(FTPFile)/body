{
  if (ftpFile.getTimestamp().getTimeInMillis() > lastPollTime) {
    if (isMatched(ftpFile)) {
      String fullFileName=getFullFileName(ftpFile);
      final ByteArrayOutputStream byteArrayOutputStream=new ByteArrayOutputStream();
      client.retrieveFile(ftpFile.getName(),byteArrayOutputStream);
      RemoteFileExchange exchange=endpoint.createExchange(fullFileName,byteArrayOutputStream);
      if (isSetNames()) {
        String ftpBasePath=endpoint.getConfiguration().getFile();
        String relativePath=fullFileName.substring(ftpBasePath.length() + 1);
        relativePath=relativePath.replaceFirst("/","");
        if (LOG.isDebugEnabled()) {
          LOG.debug("Setting exchange filename to " + relativePath);
        }
        exchange.getIn().setHeader(FileComponent.HEADER_FILE_NAME,relativePath);
      }
      getProcessor().process(exchange);
    }
  }
}
