{
  if (log.isTraceEnabled()) {
    log.trace("pollDirectory from fileName: " + fileName);
  }
  if (fileName == null) {
    return true;
  }
  fileName=FileUtil.stripTrailingSeparator(fileName);
  if (log.isTraceEnabled()) {
    log.trace("Polling directory: " + fileName);
  }
  List<FTPFile> files=operations.listFiles(fileName);
  if (files == null || files.isEmpty()) {
    if (log.isTraceEnabled()) {
      log.trace("No files found in directory: " + fileName);
    }
    return true;
  }
 else {
    if (log.isTraceEnabled()) {
      log.trace("Found " + files.size() + " in directory: "+ fileName);
    }
  }
  for (  FTPFile file : files) {
    if (!canPollMoreFiles(fileList)) {
      return false;
    }
    if (file.isDirectory()) {
      RemoteFile<FTPFile> remote=asRemoteFile(fileName,file);
      if (endpoint.isRecursive() && isValidFile(remote,true)) {
        String subDirectory=fileName + "/" + file.getName();
        boolean canPollMore=pollDirectory(subDirectory,fileList);
        if (!canPollMore) {
          return false;
        }
      }
    }
 else     if (file.isFile()) {
      RemoteFile<FTPFile> remote=asRemoteFile(fileName,file);
      if (isValidFile(remote,false)) {
        if (isInProgress(remote)) {
          if (log.isTraceEnabled()) {
            log.trace("Skipping as file is already in progress: " + remote.getFileName());
          }
        }
 else {
          fileList.add(remote);
        }
      }
    }
 else {
      log.debug("Ignoring unsupported remote file type: " + file);
    }
  }
  return true;
}
