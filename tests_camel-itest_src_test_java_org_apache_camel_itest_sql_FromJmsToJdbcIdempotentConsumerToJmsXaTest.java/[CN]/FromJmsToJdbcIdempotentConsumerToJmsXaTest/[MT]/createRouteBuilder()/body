{
  return new RouteBuilder(){
    @SuppressWarnings("unchecked") @Override public void configure() throws Exception {
      IdempotentRepository<String> repository=context.getRegistry().lookup("messageIdRepository",IdempotentRepository.class);
      from("activemq:queue:inbox").transacted("required").to("mock:a").idempotentConsumer(header("uid"),repository).to("mock:b").transform(simple("DONE-${body}")).to("activemq:queue:outbox");
    }
  }
;
}
