{
  File camelMetaDir=new File(outDir,"META-INF/services/org/apache/camel/");
  Set<File> jsonFiles=new TreeSet<File>();
  if (buildDir != null && buildDir.isDirectory()) {
    File target=new File(buildDir,"classes/org/apache/camel/model");
    PackageHelper.findJsonFiles(target,jsonFiles,new PackageHelper.CamelComponentsModelFilter());
  }
  File outFile=new File(camelMetaDir,"model.properties");
  try {
    camelMetaDir.mkdirs();
    Properties properties=new Properties();
    properties.store(new FileWriter(outFile),"Generated by camel-package-maven-plugin");
    List<String> models=new ArrayList<String>();
    for (    File file : jsonFiles) {
      String name=file.getName();
      if (name.endsWith(".json")) {
        String modelName=name.substring(0,name.length() - 5);
        models.add(modelName);
      }
    }
    Collections.sort(models);
    FileOutputStream fos=new FileOutputStream(outFile,true);
    for (    String name : models) {
      fos.write(name.getBytes());
      fos.write("\n".getBytes());
    }
    fos.close();
    getLog().info("Generated " + outFile + " containing "+ models.size()+ " Camel models");
    if (projectHelper != null) {
      List<String> includes=new ArrayList<String>();
      includes.add("**/model.properties");
      projectHelper.addResource(this.project,outDir.getPath(),includes,new ArrayList<String>());
      projectHelper.attachArtifact(this.project,"properties","camelModel",outFile);
    }
  }
 catch (  IOException e) {
    throw new MojoFailureException("Error writing to file " + outFile);
  }
}
