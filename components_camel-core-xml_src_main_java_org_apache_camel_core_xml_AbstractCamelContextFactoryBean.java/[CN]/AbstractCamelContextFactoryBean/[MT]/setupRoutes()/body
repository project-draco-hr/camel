{
  if (routesSetupDone.compareAndSet(false,true)) {
    LOG.debug("Setting up routes");
    getContext().setupRoutes(false);
    initRouteRefs();
    initRestRefs();
    getContext().addRestDefinitions(getRests());
    for (    RestDefinition rest : getRests()) {
      List<RouteDefinition> routes=rest.asRouteDefinition(getContext());
      for (      RouteDefinition route : routes) {
        getRoutes().add(route);
      }
    }
    prepareRoutes();
    getContext().addRouteDefinitions(getRoutes());
    LOG.debug("Found JAXB created routes: {}",getRoutes());
    findRouteBuilders();
    installRoutes();
    getContext().setupRoutes(true);
  }
}
