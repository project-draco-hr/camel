{
  BlueprintCamelContext ctx=new BlueprintCamelContext();
  ctx.setName(getId());
  if (streamCache != null) {
    ctx.setStreamCaching(streamCache);
  }
  if (trace != null) {
    ctx.setTracing(trace);
  }
  if (delayer != null) {
    ctx.setDelayer(delayer);
  }
  if (handleFault != null) {
    ctx.setHandleFault(handleFault);
  }
  if (errorHandlerRef != null) {
    ctx.setErrorHandlerBuilder(new ErrorHandlerBuilderRef(errorHandlerRef));
  }
  if (shouldStartContext != null) {
    ctx.setShouldStartContext(shouldStartContext);
  }
  BundleContext bundleContext=FrameworkUtil.getBundle(this.getClass()).getBundleContext();
  OsgiServiceRegistry registry=new OsgiServiceRegistry(bundleContext);
  ctx.setRegistry(registry);
  OsgiCamelContextHelper.updateRegistry(ctx,bundleContext);
  ctx.setClassResolver(new OsgiClassResolver(bundleContext));
  ctx.setFactoryFinderResolver(new OsgiFactoryFinderResolver());
  ctx.setPackageScanClassResolver(new OsgiPackageScanClassResolver(bundleContext));
  ctx.setComponentResolver(new OsgiComponentResolver());
  ctx.setLanguageResolver(new OsgiLanguageResolver());
  return ctx;
}
