{
  failUntilAttempt=5;
  deadEndpoint.expectedBodiesReceived(body);
  deadEndpoint.message(0).header(DeadLetterChannel.REDELIVERED).isEqualTo(true);
  deadEndpoint.message(0).header(DeadLetterChannel.REDELIVERY_COUNTER).isEqualTo(2);
  successEndpoint.expectedMessageCount(0);
  sendBody("direct:start",body);
  assertMockEndpointsSatisfied();
  Throwable t=deadEndpoint.getExchanges().get(0).getProperty(DeadLetterChannel.EXCEPTION_CAUSE_PROPERTY,Throwable.class);
  assertNotNull("Should have been a cause property",t);
  assertTrue(t instanceof RuntimeException);
  assertEquals("Failed to process due to attempt: 3 being less than: 5",t.getMessage());
  Throwable t2=deadEndpoint.getExchanges().get(0).getException();
  assertEquals(t,t2);
}
