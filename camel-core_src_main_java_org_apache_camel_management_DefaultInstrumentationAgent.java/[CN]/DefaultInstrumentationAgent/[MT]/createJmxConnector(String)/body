{
  try {
    LocateRegistry.createRegistry(registryPort);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Created JMXConnector RMI regisry on port " + registryPort);
    }
  }
 catch (  RemoteException ex) {
  }
  final JMXServiceURL url;
  if (connectorPort > 0) {
    url=new JMXServiceURL("service:jmx:rmi://" + host + ":"+ connectorPort+ "/jndi/rmi://"+ host+ ":"+ registryPort+ serviceUrlPath);
  }
 else {
    url=new JMXServiceURL("service:jmx:rmi:///jndi/rmi://" + host + ":"+ registryPort+ serviceUrlPath);
  }
  cs=JMXConnectorServerFactory.newJMXConnectorServer(url,null,server);
  if (executorService == null) {
    executorService=Executors.newSingleThreadExecutor(new ThreadFactory(){
      public Thread newThread(      Runnable runnable){
        Thread thread=new Thread(runnable,getThreadName("Camel JMXConnector: " + url));
        thread.setDaemon(true);
        return thread;
      }
    }
);
  }
  executorService.execute(new Runnable(){
    public void run(){
      try {
        cs.start();
      }
 catch (      IOException ioe) {
        LOG.warn("Could not start JMXConnector thread.",ioe);
      }
    }
  }
);
  LOG.info("JMX Connector thread started and listening at: " + url);
}
