{
  DefaultMessageListenerContainer answer;
  String replyToSelectorName=endpoint.getReplyToDestinationSelectorName();
  if (replyToSelectorName != null) {
    replyToSelectorValue="ID:" + new BigInteger(24 * 8,new Random()).toString(16);
    String fixedMessageSelector=replyToSelectorName + "='" + replyToSelectorValue+ "'";
    answer=new PersistentQueueMessageListenerContainer(fixedMessageSelector);
  }
 else {
    dynamicMessageSelector=new MessageSelectorCreator();
    answer=new PersistentQueueMessageListenerContainer(dynamicMessageSelector);
  }
  answer.setConnectionFactory(endpoint.getListenerConnectionFactory());
  DestinationResolver resolver=endpoint.getDestinationResolver();
  if (resolver == null) {
    resolver=answer.getDestinationResolver();
  }
  answer.setDestinationResolver(new DestinationResolverDelegate(resolver));
  answer.setDestinationName(endpoint.getReplyTo());
  answer.setAutoStartup(true);
  answer.setMessageListener(this);
  answer.setPubSubDomain(false);
  answer.setSubscriptionDurable(false);
  answer.setConcurrentConsumers(1);
  answer.setCacheLevel(DefaultMessageListenerContainer.CACHE_SESSION);
  answer.setSessionTransacted(false);
  if (endpoint.getExceptionListener() != null) {
    answer.setExceptionListener(endpoint.getExceptionListener());
  }
  if (endpoint.getReceiveTimeout() >= 0) {
    answer.setReceiveTimeout(endpoint.getReceiveTimeout());
  }
  if (endpoint.getRecoveryInterval() >= 0) {
    answer.setRecoveryInterval(endpoint.getRecoveryInterval());
  }
  if (endpoint.getTaskExecutor() != null) {
    answer.setTaskExecutor(endpoint.getTaskExecutor());
  }
  return answer;
}
