{
  camel.addRoutes(createRouteBuilder("ldap:localhost:" + port + "?base=ou=system"));
  camel.start();
  final DataHandler dataHandler=new DataHandler("test","text");
  Exchange out=template.request("direct:start",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("(!(ou=test1))");
      exchange.getIn().setHeader("ldapTest","Camel");
      exchange.getIn().addAttachment("ldapAttachment",dataHandler);
    }
  }
);
  Collection<SearchResult> searchResults=defaultLdapModuleOutAssertions(out);
  assertFalse(contains("uid=test1,ou=test,ou=system",searchResults));
  assertTrue(contains("uid=test2,ou=test,ou=system",searchResults));
  assertTrue(contains("uid=testNoOU,ou=test,ou=system",searchResults));
  assertTrue(contains("uid=tcruise,ou=actors,ou=system",searchResults));
  assertEquals("Camel",out.getOut().getHeader("ldapTest"));
  assertSame(dataHandler,out.getOut().getAttachment("ldapAttachment"));
}
