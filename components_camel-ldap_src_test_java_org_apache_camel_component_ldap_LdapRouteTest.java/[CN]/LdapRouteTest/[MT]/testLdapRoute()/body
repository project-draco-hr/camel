{
  port=ldapServer.getPort();
  LdapContext ctx=getWiredContext(ldapServer);
  SimpleRegistry reg=new SimpleRegistry();
  reg.put("localhost:" + port,ctx);
  camel=new DefaultCamelContext(reg);
  template=camel.createProducerTemplate();
  camel.addRoutes(createRouteBuilder());
  camel.start();
  Endpoint endpoint=camel.getEndpoint("direct:start");
  Exchange exchange=endpoint.createExchange();
  exchange.getIn().setBody("(!(ou=test1))");
  Exchange out=template.send(endpoint,exchange);
  Assert.assertNotNull(out);
  Assert.assertNotNull(out.getOut());
  Collection<SearchResult> data=out.getOut().getBody(Collection.class);
  Assert.assertNotNull("out body could not be converted to a Collection - was: " + out.getOut().getBody(),data);
  Assert.assertFalse(contains("uid=test1,ou=test,ou=system",data));
  Assert.assertTrue(contains("uid=test2,ou=test,ou=system",data));
  Assert.assertTrue(contains("uid=testNoOU,ou=test,ou=system",data));
  Assert.assertTrue(contains("uid=tcruise,ou=actors,ou=system",data));
  camel.stop();
}
