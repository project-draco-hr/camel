{
  log=logger;
  if (log.isTraceEnabled()) {
    log.trace("UnitOfWork created for ExchangeId: {} with {}",exchange.getExchangeId(),exchange);
  }
  tracedRouteNodes=new DefaultTracedRouteNodes();
  context=exchange.getContext();
  if (context.isAllowUseOriginalMessage()) {
    if (exchange.getIn().getClass().getName().equals("org.apache.camel.component.jms.JmsMessage")) {
      this.originalInMessage=new DefaultMessage();
      this.originalInMessage.setBody(exchange.getIn().getBody());
      this.originalInMessage.getHeaders().putAll(exchange.getIn().getHeaders());
    }
 else {
      this.originalInMessage=exchange.getIn().copy();
    }
  }
  if (exchange.getProperty(Exchange.CREATED_TIMESTAMP) == null) {
    exchange.setProperty(Exchange.CREATED_TIMESTAMP,new Date());
  }
  if (exchange.getContext().isUseBreadcrumb()) {
    String breadcrumbId=exchange.getIn().getHeader(Exchange.BREADCRUMB_ID,String.class);
    if (breadcrumbId == null) {
      breadcrumbId=exchange.getIn().getMessageId();
      exchange.getIn().setHeader(Exchange.BREADCRUMB_ID,breadcrumbId);
    }
  }
  if (exchange.getProperty(Exchange.EXTERNAL_REDELIVERED) == null) {
    exchange.setProperty(Exchange.EXTERNAL_REDELIVERED,exchange.isExternalRedelivered());
  }
  try {
    EventHelper.notifyExchangeCreated(exchange.getContext(),exchange);
  }
 catch (  Throwable e) {
    log.warn("Exception occurred during event notification. This exception will be ignored.",e);
  }
  if (exchange.getContext() != null) {
    exchange.getContext().getInflightRepository().add(exchange);
  }
}
