{
  log=logger;
  if (log.isTraceEnabled()) {
    log.trace("UnitOfWork created for ExchangeId: {} with {}",exchange.getExchangeId(),exchange);
  }
  tracedRouteNodes=new DefaultTracedRouteNodes();
  context=exchange.getContext();
  if (exchange.getIn().getClass().getSimpleName().equals("JmsMessage")) {
    this.originalInMessage=new DefaultMessage();
    this.originalInMessage.setBody(exchange.getIn().getBody());
  }
 else {
    this.originalInMessage=exchange.getIn().copy();
  }
  if (exchange.getProperty(Exchange.CREATED_TIMESTAMP) == null) {
    exchange.setProperty(Exchange.CREATED_TIMESTAMP,new Date());
  }
  if (exchange.getContext().isUseBreadcrumb()) {
    String breadcrumbId=exchange.getIn().getHeader(Exchange.BREADCRUMB_ID,String.class);
    if (breadcrumbId == null) {
      breadcrumbId=exchange.getIn().getMessageId();
      exchange.getIn().setHeader(Exchange.BREADCRUMB_ID,breadcrumbId);
    }
  }
  if (exchange.getProperty(Exchange.TRANSACTED_REDELIVERED) == null) {
    exchange.setProperty(Exchange.TRANSACTED_REDELIVERED,exchange.isTransactedRedelivered());
  }
  try {
    EventHelper.notifyExchangeCreated(exchange.getContext(),exchange);
  }
 catch (  Throwable e) {
    log.warn("Exception occurred during event notification. This exception will be ignored.",e);
  }
  if (exchange.getContext() != null) {
    exchange.getContext().getInflightRepository().add(exchange);
  }
}
