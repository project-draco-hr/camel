{
  if (LOG.isTraceEnabled()) {
    LOG.trace("UnitOfWork done for ExchangeId: " + exchange.getExchangeId() + " with "+ exchange);
  }
  boolean failed=exchange.isFailed();
  try {
    if (failed) {
      EventHelper.notifyExchangeFailed(exchange.getContext(),exchange);
    }
 else {
      EventHelper.notifyExchangeDone(exchange.getContext(),exchange);
    }
  }
 catch (  Exception e) {
    LOG.warn("Exception occurred during event notification. This exception will be ignored.",e);
  }
  if (synchronizations != null && !synchronizations.isEmpty()) {
    Collections.reverse(synchronizations);
    Collections.sort(synchronizations,new OrderedComparator());
    for (    Synchronization synchronization : synchronizations) {
      try {
        if (failed) {
          if (LOG.isTraceEnabled()) {
            LOG.trace("Invoking synchronization.onFailure: " + synchronization + " with "+ exchange);
          }
          synchronization.onFailure(exchange);
        }
 else {
          if (LOG.isTraceEnabled()) {
            LOG.trace("Invoking synchronization.onComplete: " + synchronization + " with "+ exchange);
          }
          synchronization.onComplete(exchange);
        }
      }
 catch (      Exception e) {
        LOG.warn("Exception occurred during onCompletion. This exception will be ignored.",e);
      }
    }
  }
  if (exchange.getContext() != null) {
    exchange.getContext().getInflightRepository().remove(exchange);
  }
}
