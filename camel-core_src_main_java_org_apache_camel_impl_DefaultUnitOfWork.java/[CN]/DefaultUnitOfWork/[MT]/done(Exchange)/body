{
  if (LOG.isTraceEnabled()) {
    LOG.trace("UnitOfWork done for ExchangeId: " + exchange.getExchangeId() + " with "+ exchange);
  }
  boolean failed=exchange.isFailed();
  UnitOfWorkHelper.doneSynchronizations(exchange,synchronizations,LOG);
  try {
    if (failed) {
      EventHelper.notifyExchangeFailed(exchange.getContext(),exchange);
    }
 else {
      EventHelper.notifyExchangeDone(exchange.getContext(),exchange);
    }
  }
 catch (  Throwable e) {
    LOG.warn("Exception occurred during event notification. This exception will be ignored.",e);
  }
 finally {
    if (exchange.getContext() != null) {
      exchange.getContext().getInflightRepository().remove(exchange);
    }
  }
}
