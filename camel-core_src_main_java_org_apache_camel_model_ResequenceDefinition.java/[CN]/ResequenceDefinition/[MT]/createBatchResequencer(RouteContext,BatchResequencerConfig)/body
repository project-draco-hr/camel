{
  Processor processor=this.createChildProcessor(routeContext,true);
  Expression expression=getExpression().createExpression(routeContext);
  String routeId=routeContext.getRoute().idOrCreate(routeContext.getCamelContext().getNodeIdFactory());
  CamelInternalProcessor internal=new CamelInternalProcessor(processor);
  internal.addAdvice(new CamelInternalProcessor.UnitOfWorkProcessorAdvice(routeId));
  internal.addAdvice(new CamelInternalProcessor.RouteContextAdvice(routeContext));
  ObjectHelper.notNull(config,"config",this);
  ObjectHelper.notNull(expression,"expression",this);
  boolean isReverse=config.getReverse() != null && config.getReverse();
  boolean isAllowDuplicates=config.getAllowDuplicates() != null && config.getAllowDuplicates();
  Resequencer resequencer=new Resequencer(routeContext.getCamelContext(),internal,expression,isAllowDuplicates,isReverse);
  resequencer.setBatchSize(config.getBatchSize());
  resequencer.setBatchTimeout(config.getBatchTimeout());
  if (config.getIgnoreInvalidExchanges() != null) {
    resequencer.setIgnoreInvalidExchanges(config.getIgnoreInvalidExchanges());
  }
  return resequencer;
}
