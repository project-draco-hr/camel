{
  return new SpringRouteBuilder(){
    public void configure() throws Exception {
      context.setUseMDCLogging(true);
      from("direct:okay").routeId("route-a").transacted().process(new Processor(){
        public void process(        Exchange exchange) throws Exception {
          assertEquals("route-a",MDC.get("routeId"));
          assertEquals(exchange.getExchangeId(),MDC.get("exchangeId"));
          assertNotNull(MDC.get("transactionKey"));
        }
      }
).to("log:foo").setBody(constant("Tiger in Action")).beanRef("bookService").to("log:bar").setBody(constant("Elephant in Action")).beanRef("bookService");
      from("direct:fail").routeId("route-b").transacted().process(new Processor(){
        public void process(        Exchange exchange) throws Exception {
          assertEquals("route-b",MDC.get("routeId"));
          assertEquals(exchange.getExchangeId(),MDC.get("exchangeId"));
          assertNotNull(MDC.get("transactionKey"));
        }
      }
).to("log:foo2").setBody(constant("Tiger in Action")).beanRef("bookService").to("log:bar2").setBody(constant("Donkey in Action")).beanRef("bookService");
    }
  }
;
}
