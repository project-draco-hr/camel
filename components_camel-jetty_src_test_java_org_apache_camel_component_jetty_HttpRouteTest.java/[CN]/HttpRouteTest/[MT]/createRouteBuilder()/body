{
  return new RouteBuilder(){
    public void configure(){
      context.setStreamCaching(true);
      from("jetty:http://localhost:9080/test").to("mock:a");
      Processor proc=new Processor(){
        public void process(        Exchange exchange) throws Exception {
          try {
            HttpMessage message=(HttpMessage)exchange.getIn();
            HttpSession session=message.getRequest().getSession();
            assertNotNull("we should get session here",session);
          }
 catch (          Exception e) {
            exchange.getFault().setBody(e);
          }
          exchange.getOut().setBody("<b>Hello World</b>");
        }
      }
;
      Processor printProcessor=new Processor(){
        public void process(        Exchange exchange) throws Exception {
          Message out=exchange.getOut();
          out.copyFrom(exchange.getIn());
          log.info("The body's object is " + exchange.getIn().getBody());
          log.info("Process body = " + exchange.getIn().getBody(String.class));
          InputStreamCache cache=out.getBody(InputStreamCache.class);
          cache.reset();
        }
      }
;
      from("jetty:http://localhost:9080/hello?sessionSupport=true").process(proc);
      from("jetty:http://localhost:9080/echo").process(printProcessor).process(printProcessor);
      Processor procPostParameters=new Processor(){
        public void process(        Exchange exchange) throws Exception {
          HttpServletRequest req=exchange.getIn().getBody(HttpServletRequest.class);
          String value=req.getParameter("request");
          String requestValue=exchange.getIn().getHeader("request",String.class);
          if (value != null) {
            assertEquals("We should get the same request header value from message",value,requestValue);
            exchange.getOut().setBody(value);
          }
 else {
            exchange.getOut().setBody("Can't get a right parameter");
          }
        }
      }
;
      from("jetty:http://localhost:9080/post").process(procPostParameters);
    }
  }
;
}
