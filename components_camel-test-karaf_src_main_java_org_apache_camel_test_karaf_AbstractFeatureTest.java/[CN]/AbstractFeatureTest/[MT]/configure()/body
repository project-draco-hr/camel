{
  switchPlatformEncodingToUTF8();
  String karafVersion=getKarafVersion();
  LOG.info("*** Apache Karaf version is " + karafVersion + " ***");
  Option[] options=new Option[]{new LogLevelOption(LogLevelOption.LogLevel.INFO),KarafDistributionOption.karafDistributionConfiguration().frameworkUrl(maven().groupId("org.apache.karaf").artifactId("apache-karaf").type("tar.gz").versionAsInProject()).karafVersion(karafVersion).name("Apache Karaf").useDeployFolder(false).unpackDirectory(new File("target/paxexam/unpack/")),logLevel(LogLevelOption.LogLevel.WARN),keepRuntimeFolder(),configureConsole().ignoreRemoteShell(),KarafDistributionOption.replaceConfigurationFile("etc/jre.properties",new File("src/test/resources/jre.properties")),vmOption("-Dfile.encoding=UTF-8"),editConfigurationFilePut("etc/custom.properties","karaf.shutdown.port","-1"),editConfigurationFilePut("etc/org.ops4j.pax.web.cfg","org.osgi.service.http.port",Integer.toString(AvailablePortFinder.getNextAvailable())),editConfigurationFilePut("etc/org.apache.karaf.management.cfg","rmiRegistryPort",Integer.toString(AvailablePortFinder.getNextAvailable())),editConfigurationFilePut("etc/org.apache.karaf.management.cfg","rmiServerPort",Integer.toString(AvailablePortFinder.getNextAvailable())),CoreOptions.junitBundles(),KarafDistributionOption.features(getCamelKarafFeatureUrl(),"camel"),mavenBundle().groupId("org.apache.camel").artifactId("camel-test-karaf").versionAsInProject()};
  return options;
}
