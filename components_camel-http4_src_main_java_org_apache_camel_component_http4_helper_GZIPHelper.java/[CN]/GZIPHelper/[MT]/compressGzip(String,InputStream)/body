{
  if (isGzip(contentEncoding)) {
    ByteArrayOutputStream os=new ByteArrayOutputStream();
    GZIPOutputStream gzip=new GZIPOutputStream(os);
    try {
      IOHelper.copy(in,gzip);
      gzip.finish();
      return new ByteArrayInputStream(os.toByteArray());
    }
  finally {
      IOHelper.close(gzip,"gzip");
      IOHelper.close(os,"byte array output stream");
    }
  }
 else {
    return in;
  }
}
