{
  Endpoint endpoint=resolveEndpoint(routeContext);
  WireTapProcessor answer=new WireTapProcessor(endpoint,getPattern());
  if (newExchangeProcessorRef != null) {
    newExchangeProcessor=routeContext.lookup(newExchangeProcessorRef,Processor.class);
  }
  answer.setNewExchangeProcessor(newExchangeProcessor);
  if (newExchangeExpression != null) {
    answer.setNewExchangeExpression(newExchangeExpression.createExpression(routeContext));
  }
  if (executorServiceRef != null) {
    executorService=routeContext.lookup(executorServiceRef,ExecutorService.class);
    if (executorService == null) {
      throw new IllegalArgumentException("ExecutorServiceRef " + executorServiceRef + " not found in registry.");
    }
  }
  answer.setExecutorService(executorService);
  return answer;
}
