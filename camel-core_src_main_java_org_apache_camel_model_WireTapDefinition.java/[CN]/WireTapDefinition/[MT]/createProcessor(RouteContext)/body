{
  Endpoint endpoint=resolveEndpoint(routeContext);
  executorService=ExecutorServiceHelper.getConfiguredExecutorService(routeContext,"WireTap",this);
  if (executorService == null) {
    executorService=routeContext.getCamelContext().getExecutorServiceStrategy().newDefaultThreadPool(this,"WireTap");
  }
  WireTapProcessor answer=new WireTapProcessor(endpoint,getPattern(),executorService);
  answer.setCopy(isCopy());
  if (newExchangeProcessorRef != null) {
    newExchangeProcessor=routeContext.lookup(newExchangeProcessorRef,Processor.class);
  }
  if (newExchangeProcessor != null) {
    answer.addNewExchangeProcessor(newExchangeProcessor);
  }
  if (newExchangeExpression != null) {
    answer.setNewExchangeExpression(newExchangeExpression.createExpression(routeContext));
  }
  if (headers != null && !headers.isEmpty()) {
    for (    SetHeaderDefinition header : headers) {
      Processor processor=header.createProcessor(routeContext);
      answer.addNewExchangeProcessor(processor);
    }
  }
  if (onPrepareRef != null) {
    onPrepare=CamelContextHelper.mandatoryLookup(routeContext.getCamelContext(),onPrepareRef,Processor.class);
  }
  if (onPrepare != null) {
    answer.setOnPrepare(onPrepare);
  }
  return answer;
}
