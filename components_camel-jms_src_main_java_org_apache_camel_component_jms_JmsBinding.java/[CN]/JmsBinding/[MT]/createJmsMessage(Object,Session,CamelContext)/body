{
  if (body instanceof Node) {
    try {
      body=xmlConverter.toString((Node)body);
    }
 catch (    TransformerException e) {
      JMSException jmsException=new JMSException(e.getMessage());
      jmsException.setLinkedException(e);
      throw jmsException;
    }
  }
  if (body instanceof byte[]) {
    BytesMessage result=session.createBytesMessage();
    result.writeBytes((byte[])body);
    return result;
  }
  if (body instanceof Map) {
    MapMessage result=session.createMapMessage();
    Map<?,?> map=(Map<?,?>)body;
    try {
      populateMapMessage(result,map,context);
      return result;
    }
 catch (    JMSException e) {
      LOG.warn("Can not populate MapMessage will fall back to ObjectMessage, cause by: " + e.getMessage());
    }
  }
  if (body instanceof String) {
    return session.createTextMessage((String)body);
  }
  if (body instanceof File || body instanceof Reader || body instanceof InputStream|| body instanceof ByteBuffer) {
    BytesMessage result=session.createBytesMessage();
    byte[] bytes=context.getTypeConverter().convertTo(byte[].class,body);
    result.writeBytes(bytes);
    return result;
  }
  if (body instanceof Serializable) {
    return session.createObjectMessage((Serializable)body);
  }
  return session.createMessage();
}
