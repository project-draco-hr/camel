{
  if (propertyPrefix == null) {
    propertyPrefix="";
  }
  Class clazz=classMap.get(propertyPrefix + key);
  if (clazz == null) {
    URL url=bundle.getEntry(getResourcePath() + key);
    if (url != null) {
      InputStream in=url.openStream();
      BufferedInputStream reader=null;
      try {
        reader=new BufferedInputStream(in);
        Properties properties=new Properties();
        properties.load(reader);
        String className=properties.getProperty(propertyPrefix + "class");
        if (className == null) {
          throw new IOException("Expected property is missing: " + propertyPrefix + "class");
        }
        clazz=bundle.loadClass(className);
        classMap.put(propertyPrefix + key,clazz);
      }
  finally {
        IOHelper.close(reader,key,null);
        IOHelper.close(in,key,null);
      }
    }
 else {
      throw new NoFactoryAvailableException(propertyPrefix + key);
    }
  }
  return clazz;
}
