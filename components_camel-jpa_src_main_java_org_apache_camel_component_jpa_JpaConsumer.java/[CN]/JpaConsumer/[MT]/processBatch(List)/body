{
  final List<DataHolder> list=exchanges;
  if (list.isEmpty()) {
    return;
  }
  EntityManager entityManager=list.get(0).manager;
  int total=list.size();
  for (int index=0; index < total && isRunAllowed(); index++) {
    Exchange exchange=list.get(index).exchange;
    Object result=list.get(index).result;
    exchange.setProperty(Exchange.BATCH_INDEX,index);
    exchange.setProperty(Exchange.BATCH_SIZE,total);
    exchange.setProperty(Exchange.BATCH_COMPLETE,index == total - 1);
    if (lockEntity(result,entityManager)) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Processing exchange: " + exchange);
      }
      try {
        getProcessor().process(exchange);
      }
 catch (      Exception e) {
        throw new PersistenceException(e);
      }
      getDeleteHandler().deleteObject(entityManager,result);
    }
  }
}
