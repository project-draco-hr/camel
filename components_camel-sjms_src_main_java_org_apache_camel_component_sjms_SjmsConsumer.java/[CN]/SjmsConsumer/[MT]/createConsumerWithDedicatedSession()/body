{
  Connection conn=getConnectionResource().borrowConnection();
  Session session=null;
  if (isTransacted()) {
    session=conn.createSession(true,Session.SESSION_TRANSACTED);
  }
 else {
    session=conn.createSession(false,Session.AUTO_ACKNOWLEDGE);
  }
  MessageConsumer messageConsumer=JmsObjectFactory.createMessageConsumer(session,getDestinationName(),getMessageSelector(),isTopic(),getDurableSubscriptionId());
  MessageListener handler=createMessageHandler(session);
  messageConsumer.setMessageListener(handler);
  getConnectionResource().returnConnection(conn);
  return new MessageConsumerResources(session,messageConsumer);
}
