{
  Assert.isInstanceOf(SoapMessage.class,messageContext.getRequest());
  SoapMessage request=(SoapMessage)messageContext.getRequest();
  for (  AddressingVersion version : versions) {
    if (supports(version,request)) {
      if (logger.isDebugEnabled()) {
        logger.debug("Request [" + request + "] uses ["+ version+ "]");
      }
      MessageAddressingProperties requestMap=version.getMessageAddressingProperties(request);
      if (requestMap == null) {
        return null;
      }
      Object endpoint=getEndpointInternal(requestMap);
      if (endpoint == null) {
        return null;
      }
      return getEndpointInvocationChain(endpoint,version,requestMap);
    }
  }
  return null;
}
