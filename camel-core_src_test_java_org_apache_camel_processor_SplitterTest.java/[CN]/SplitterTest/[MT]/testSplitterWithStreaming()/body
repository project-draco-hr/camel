{
  MockEndpoint resultEndpoint=getMockEndpoint("mock:result");
  resultEndpoint.expectedMessageCount(5);
  resultEndpoint.expectedHeaderReceived("foo","bar");
  Exchange result=template.send("direct:streaming",new Processor(){
    public void process(    Exchange exchange){
      Message in=exchange.getIn();
      in.setBody("James,Guillaume,Hiram,Rob,Roman");
      in.setHeader("foo","bar");
    }
  }
);
  assertMockEndpointsSatisfied();
  for (  Exchange exchange : resultEndpoint.getReceivedExchanges()) {
    assertNotNull(exchange.getIn().getHeader(Splitter.SPLIT_COUNTER));
    assertNull(exchange.getIn().getHeader(Splitter.SPLIT_SIZE));
  }
}
