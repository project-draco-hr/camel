{
  return new SpringRouteBuilder(){
    public void configure() throws Exception {
      TransactionTemplate tt=context.getRegistry().lookup("PROPAGATION_REQUIRED",TransactionTemplate.class);
      SpringTransactionPolicy required=new SpringTransactionPolicy(tt);
      if (useTransactionErrorHandler) {
        errorHandler(transactionErrorHandler(required).maximumRedeliveries(3).initialRedeliveryDelay(5 * 1000L));
      }
      from("direct:okay").policy(required).setBody(constant("Tiger in Action")).beanRef("bookService").setBody(constant("Elephant in Action")).beanRef("bookService");
      from("direct:fail").policy(required).setBody(constant("Tiger in Action")).beanRef("bookService").setBody(constant("Donkey in Action")).beanRef("bookService");
    }
  }
;
}
