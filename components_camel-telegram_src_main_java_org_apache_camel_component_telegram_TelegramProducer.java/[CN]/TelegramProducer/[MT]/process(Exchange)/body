{
  if (exchange.getIn().getBody() == null) {
    log.debug("Received exchange with empty body, skipping");
    return;
  }
  TelegramConfiguration config=endpoint.getConfiguration();
  OutgoingMessage message=exchange.getIn().getBody(OutgoingMessage.class);
  if (message == null) {
    throw new IllegalArgumentException("Cannot convert the content to a Telegram OutgoingMessage");
  }
  if (message.getChatId() == null) {
    log.debug("Chat id is null on outgoing message, trying resolution");
    String chatId=resolveChatId(config,message,exchange);
    log.debug("Resolved chat id is {}",chatId);
    message.setChatId(chatId);
  }
  TelegramService service=TelegramServiceProvider.get().getService();
  log.debug("Message being sent is: {}",message);
  log.debug("Headers of message being sent are: {}",exchange.getIn().getHeaders());
  service.sendMessage(config.getAuthorizationToken(),message);
}
