{
  while (isRunAllowed()) {
    final Exchange exchange;
    try {
      exchange=endpoint.getQueue().poll(1000,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Interupted: " + e,e);
      }
      continue;
    }
    if (exchange != null && isRunAllowed()) {
      try {
        processor.process(exchange,new AsyncCallback(){
          public void done(          boolean sync){
          }
        }
);
      }
 catch (      Exception e) {
        LOG.error("Seda queue caught: " + e,e);
      }
    }
 else     if (exchange != null) {
      LOG.warn("This consumer is stopped during polling an exchange, so putting it back on the seda queue: " + exchange);
      try {
        endpoint.getQueue().put(exchange);
      }
 catch (      InterruptedException e) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Interupted: " + e,e);
        }
      }
    }
  }
}
