{
  BlockingQueue<Exchange> queue=endpoint.getQueue();
  while (queue != null && isRunAllowed()) {
    final Exchange exchange;
    try {
      exchange=queue.poll(1000,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Sleep interrupted, are we stopping? " + (isStopping() || isStopped()));
      }
      continue;
    }
    if (exchange != null) {
      if (isRunAllowed()) {
        try {
          sendToConsumers(exchange);
        }
 catch (        Exception e) {
          getExceptionHandler().handleException(e);
        }
      }
 else {
        if (LOG.isWarnEnabled()) {
          LOG.warn("This consumer is stopped during polling an exchange, so putting it back on the seda queue: " + exchange);
        }
        try {
          queue.put(exchange);
        }
 catch (        InterruptedException e) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Sleep interrupted, are we stopping? " + (isStopping() || isStopped()));
          }
          continue;
        }
      }
    }
  }
}
