{
  if (source == null) {
    return null;
  }
 else   if (source instanceof StringSource) {
    return ((StringSource)source).getText();
  }
 else   if (source instanceof BytesSource) {
    return new String(((BytesSource)source).getData());
  }
 else {
    StringWriter buffer=new StringWriter();
    if (exchange != null) {
      Properties properties=ObjectHelper.getCamelPropertiesWithPrefix(OUTPUT_PROPERTIES_PREFIX,exchange.getContext());
      if (properties.size() > 0) {
        toResult(source,new StreamResult(buffer),properties);
        return buffer.toString();
      }
    }
    toResult(source,new StreamResult(buffer));
    return buffer.toString();
  }
}
