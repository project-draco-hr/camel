{
  getMockEndpoint("mock:dead").expectedMessageCount(1);
  MockEndpoint mock=getMockEndpoint("mock:rollback");
  mock.expectedMessageCount(2);
  Exchange out=template.request("direct:start",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("bad");
    }
  }
);
  assertMockEndpointsSatisfied();
  assertNotNull(out.getException());
  assertIsInstanceOf(RollbackExchangeException.class,out.getException());
  assertEquals("Should be marked as rollback",true,out.isRollbackOnly());
}
