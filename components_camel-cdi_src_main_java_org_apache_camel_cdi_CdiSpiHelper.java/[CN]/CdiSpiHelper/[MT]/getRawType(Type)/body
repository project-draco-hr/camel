{
  if (type instanceof Class<?>) {
    return Class.class.cast(type);
  }
 else   if (type instanceof ParameterizedType) {
    return getRawType(ParameterizedType.class.cast(type).getRawType());
  }
 else   if (type instanceof TypeVariable<?>) {
    return getBound(TypeVariable.class.cast(type).getBounds());
  }
 else   if (type instanceof WildcardType) {
    return getBound(WildcardType.class.cast(type).getUpperBounds());
  }
 else   if (type instanceof GenericArrayType) {
    Class<?> rawType=getRawType(GenericArrayType.class.cast(type).getGenericComponentType());
    if (rawType != null) {
      return Array.newInstance(rawType,0).getClass();
    }
  }
  throw new UnsupportedOperationException("Unable to retrieve raw type for [" + type + "]");
}
