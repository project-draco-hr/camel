{
  MessageProducer messageProducer=null;
  Destination destination=null;
  if (topic) {
    if (destinationName.startsWith("topic://")) {
      destinationName=destinationName.substring("topic://".length());
    }
    destination=session.createTopic(destinationName);
  }
 else {
    if (destinationName.startsWith("queue://")) {
      destinationName=destinationName.substring("queue://".length());
    }
    destination=session.createQueue(destinationName);
  }
  messageProducer=session.createProducer(destination);
  if (persitent) {
    messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT);
  }
 else {
    messageProducer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);
  }
  if (ttl > 0) {
    messageProducer.setTimeToLive(ttl);
  }
  return messageProducer;
}
