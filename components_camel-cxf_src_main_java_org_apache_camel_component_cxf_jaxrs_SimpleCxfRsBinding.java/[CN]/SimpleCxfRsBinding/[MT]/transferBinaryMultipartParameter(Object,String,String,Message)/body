{
  DataHandler dh=null;
  if (toMap instanceof Attachment) {
    dh=((Attachment)toMap).getDataHandler();
  }
 else   if (toMap instanceof DataSource) {
    dh=new DataHandler((DataSource)toMap);
  }
 else   if (toMap instanceof DataHandler) {
    dh=(DataHandler)toMap;
  }
 else   if (toMap instanceof InputStream) {
    dh=new DataHandler(new InputStreamDataSource((InputStream)toMap,multipartType == null ? "application/octet-stream" : multipartType));
  }
  if (dh != null) {
    in.addAttachment(parameterName,dh);
  }
}
