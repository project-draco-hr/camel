{
  EntityManager em=getEntityManager();
  EntityTransaction transaction=em.getTransaction();
  transaction.begin();
  try {
    Object answer=callback.doInJpa(em);
    transaction.commit();
    return answer;
  }
 catch (  RuntimeException e) {
    if (transaction != null) {
      transaction.rollback();
    }
    throw e;
  }
}
