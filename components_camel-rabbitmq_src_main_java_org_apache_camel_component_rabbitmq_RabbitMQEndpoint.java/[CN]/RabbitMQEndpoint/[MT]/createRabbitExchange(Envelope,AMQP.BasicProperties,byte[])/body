{
  Exchange exchange=new DefaultExchange(getCamelContext(),getExchangePattern());
  Message message=new DefaultMessage();
  exchange.setIn(message);
  message.setHeader(RabbitMQConstants.ROUTING_KEY,envelope.getRoutingKey());
  message.setHeader(RabbitMQConstants.EXCHANGE_NAME,envelope.getExchange());
  message.setHeader(RabbitMQConstants.DELIVERY_TAG,envelope.getDeliveryTag());
  Map<String,Object> headers=properties.getHeaders();
  if (headers != null) {
    for (    Map.Entry<String,Object> entry : headers.entrySet()) {
      if (entry.getValue() instanceof LongString) {
        message.setHeader(entry.getKey(),entry.getValue().toString());
      }
 else {
        message.setHeader(entry.getKey(),entry.getValue());
      }
    }
  }
  message.setBody(body);
  return exchange;
}
