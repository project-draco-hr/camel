{
  stopping=true;
  if (channel == null) {
    return;
  }
  if (tag != null && isChannelOpen()) {
    channel.basicCancel(tag);
  }
  try {
    if (isChannelOpen()) {
      channel.close();
    }
  }
 catch (  TimeoutException e) {
    log.error("Timeout occured");
    throw e;
  }
}
