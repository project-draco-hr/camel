{
  this.template=camelContext.createProducerTemplate();
  log.info("Initializing ZookeeperRoutePolicy with uri {}",uri);
  ZooKeeperEndpoint zep=camelContext.getEndpoint(uri,ZooKeeperEndpoint.class);
  zep.getConfiguration().setCreate(true);
  String fullpath=createFullPathToCandidate(zep);
  Exchange e=zep.createExchange();
  e.setPattern(ExchangePattern.InOut);
  e.getIn().setHeader(ZooKeeperMessage.ZOOKEEPER_NODE,fullpath);
  e.getIn().setHeader(ZooKeeperMessage.ZOOKEEPER_CREATE_MODE,CreateMode.EPHEMERAL_SEQUENTIAL);
  template.send(zep,e);
  if (e.isFailed()) {
    log.warn("Error setting up election node " + fullpath,e.getException());
  }
 else {
    log.info("Candidate node {} has been created",fullpath);
    try {
      camelContext.addRoutes(new ElectoralMonitorRoute(zep));
    }
 catch (    Exception ex) {
      log.warn("Error configuring ZookeeperRoutePolicy. This exception is ignored.",ex);
    }
  }
  return zep;
}
