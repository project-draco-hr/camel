{
  byte[] body=exchange.getIn().getBody(byte[].class);
  if (body != null) {
    MQTTConfiguration configuration=mqttEndpoint.getConfiguration();
    boolean retain=configuration.isByDefaultRetain();
    if (exchange.getProperty(configuration.getMqttRetainPropertyName()) != null) {
      retain=exchange.getProperty(configuration.getMqttRetainPropertyName(),Boolean.class);
    }
    QoS qoS=configuration.getQoS();
    Object qoSValue=exchange.getProperty(configuration.getMqttQosPropertyName());
    if (qoSValue != null) {
      qoS=MQTTConfiguration.getQoS(qoSValue.toString());
    }
    String topicName=configuration.getPublishTopicName();
    Object topicValue=exchange.getProperty(configuration.getMqttTopicPropertyName());
    if (topicValue != null) {
      topicName=topicValue.toString();
    }
    mqttEndpoint.publish(topicName,body,qoS,retain);
  }
}
