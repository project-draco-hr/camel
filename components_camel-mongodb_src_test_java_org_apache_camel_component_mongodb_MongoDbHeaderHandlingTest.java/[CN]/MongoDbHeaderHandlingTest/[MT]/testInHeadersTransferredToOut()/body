{
  assertEquals(0,testCollection.count());
  Exchange result=template.request("direct:count",new Processor(){
    @Override public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("irrelevant body");
      exchange.getIn().setHeader("abc","def");
    }
  }
);
  assertTrue("Result is not of type Long",result.getOut().getBody() instanceof Long);
  assertEquals("Test collection should not contain any records",0L,result.getOut().getBody());
  assertEquals("An input header was not returned","def",result.getOut().getHeader("abc"));
  result=template.request("direct:insert",new Processor(){
    @Override public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("{\"_id\":\"testInsertString\", \"scientist\":\"Einstein\"}");
      exchange.getIn().setHeader("abc","def");
    }
  }
);
  assertTrue(result.getOut().getBody() instanceof WriteResult);
  assertEquals("An input header was not returned","def",result.getOut().getHeader("abc"));
  DBObject b=testCollection.findOne("testInsertString");
  assertNotNull("No record with 'testInsertString' _id",b);
}
