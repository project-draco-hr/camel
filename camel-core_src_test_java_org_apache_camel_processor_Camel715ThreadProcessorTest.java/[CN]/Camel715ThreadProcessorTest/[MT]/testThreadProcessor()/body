{
  try {
    CamelContext context=new DefaultCamelContext();
    final CountDownLatch latch=new CountDownLatch(ITERS);
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:a").thread(4).process(new Processor(){
          public void process(          Exchange ex) throws Exception {
            latch.countDown();
          }
        }
);
      }
    }
);
    final ProducerTemplate<Exchange> template=context.createProducerTemplate();
    final Endpoint e=context.getEndpoint("direct:a");
    context.start();
    for (int i=0; i < ITERS; i++) {
      template.send(e,new SendingProcessor(i),new AsyncCallback(){
        public void done(        boolean arg0){
        }
      }
);
    }
    latch.await();
    context.stop();
  }
 catch (  Exception ex) {
    fail("Get the exception " + ex + "here");
    System.exit(-1);
  }
}
