{
  long start=System.currentTimeMillis();
  try {
    CamelContext context=new DefaultCamelContext();
    final CountDownLatch latch=new CountDownLatch(ITERS);
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:a").thread(4).process(new Processor(){
          public void process(          Exchange ex) throws Exception {
            latch.countDown();
          }
        }
);
      }
    }
);
    final ProducerTemplate template=context.createProducerTemplate();
    final Endpoint e=context.getEndpoint("direct:a");
    context.start();
    for (int i=0; i < ITERS; i++) {
      template.send(e,new SendingProcessor(i),new AsyncCallback(){
        public void done(        boolean sync){
        }
      }
);
    }
    latch.await();
    long delta=System.currentTimeMillis() - start;
    assertTrue("Should be faster than 10 sec, took: " + delta,delta < 10000);
    context.stop();
  }
 catch (  Exception ex) {
    fail("Get the exception " + ex + "here");
    System.exit(-1);
  }
}
