{
  Exchange out=template.request("http4://" + localServer.getInetAddress().getHostName() + ":"+ localServer.getLocalPort()+ "/hello",new Processor(){
    @Override public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setHeader(Exchange.CONTENT_TYPE,"text/plain");
      exchange.getIn().setHeader(Exchange.FILE_NAME,"hello.txt");
      exchange.getIn().setBody("This is content");
    }
  }
);
  assertNotNull(out);
  assertFalse("Should not fail",out.isFailed());
  assertEquals("dude",out.getOut().getHeader("MyApp"));
  assertNull(out.getOut().getHeader(Exchange.TO_ENDPOINT));
}
