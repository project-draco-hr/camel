{
  switchPlatformEncodingToUTF8();
  String karafVersion=getKarafVersion();
  LOG.info("*** The karaf version is " + karafVersion + " ***");
  List<String> list=new ArrayList<String>();
  list.add("cxf-jaxb");
  list.add("camel-core");
  list.add("camel-spring");
  list.add("camel-" + mainFeature);
  for (  String extra : extraFeatures) {
    list.add("camel-" + extra);
  }
  String[] features=list.toArray(new String[list.size()]);
  Option[] options=new Option[]{KarafDistributionOption.karafDistributionConfiguration().frameworkUrl(maven().groupId("org.apache.karaf").artifactId("apache-karaf").type("tar.gz").versionAsInProject()).karafVersion(karafVersion).name("Apache Karaf").useDeployFolder(false).unpackDirectory(new File("target/paxexam/unpack/")),vmOption("-Dfile.encoding=UTF-8"),KarafDistributionOption.replaceConfigurationFile("etc/jre.properties",new File("src/test/resources/org/apache/camel/itest/karaf/jre.properties")),KarafDistributionOption.replaceConfigurationFile("etc/custom.properties",new File("src/test/resources/org/apache/camel/itest/karaf/custom.properties")),KarafDistributionOption.replaceConfigurationFile("etc/org.ops4j.pax.url.mvn.cfg",new File("src/test/resources/org/apache/camel/itest/karaf/org.ops4j.pax.url.mvn.cfg")),getJUnitBundle(),new LogLevelOption(LogLevelOption.LogLevel.INFO),KarafDistributionOption.features(getCamelKarafFeatureUrl(),features)};
  return options;
}
