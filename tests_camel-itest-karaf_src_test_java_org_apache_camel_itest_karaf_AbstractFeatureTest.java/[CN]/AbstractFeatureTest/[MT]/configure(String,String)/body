{
  switchPlatformEncodingToUTF8();
  String karafVersion=getKarafVersion();
  LOG.info("*** Apache Karaf version is " + karafVersion + " ***");
  List<String> list=new ArrayList<String>();
  list.add("camel-core");
  list.add("camel-blueprint");
  list.add("camel-" + mainFeature);
  for (  String extra : extraFeatures) {
    list.add("camel-" + extra);
  }
  String[] features=list.toArray(new String[list.size()]);
  Option[] options=new Option[]{new LogLevelOption(LogLevelOption.LogLevel.INFO),org.ops4j.pax.exam.CoreOptions.systemProperty(Constants.RMI_HOST_PROPERTY).value("localhost"),KarafDistributionOption.karafDistributionConfiguration().frameworkUrl(maven().groupId("org.apache.karaf").artifactId("apache-karaf").type("tar.gz").versionAsInProject()).karafVersion(karafVersion).name("Apache Karaf").useDeployFolder(false).unpackDirectory(new File("target/paxexam/unpack/")),KarafDistributionOption.keepRuntimeFolder(),vmOption("-Dfile.encoding=UTF-8"),getJUnitBundle(),KarafDistributionOption.features(getCamelKarafFeatureUrl(),features)};
  return options;
}
