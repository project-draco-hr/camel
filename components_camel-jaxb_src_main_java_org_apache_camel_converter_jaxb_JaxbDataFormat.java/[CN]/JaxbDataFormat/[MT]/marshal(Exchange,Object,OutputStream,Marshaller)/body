{
  if (needFiltering(exchange)) {
    XMLStreamWriter writer=XMLOutputFactory.newInstance().createXMLStreamWriter(stream);
    FilteringXmlStreamWriter filteringWriter=new FilteringXmlStreamWriter(writer);
    marshaller.marshal(graph,filteringWriter);
  }
 else {
    marshaller.marshal(graph,stream);
  }
}
