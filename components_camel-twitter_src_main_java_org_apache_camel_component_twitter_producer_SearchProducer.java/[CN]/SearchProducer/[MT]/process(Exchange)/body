{
  String keywords=exchange.getIn().getHeader(TwitterConstants.TWITTER_SEARCH_QUERY,String.class);
  if (keywords == null) {
    keywords=twitterEndpoint.getProperties().getKeywords();
  }
  if (keywords == null) {
    throw new CamelExchangeException("No keywords to use for query",exchange);
  }
  Query query=new Query(keywords);
  if (lastId != 0) {
    query.setSinceId(lastId);
  }
  Twitter twitter=twitterEndpoint.getTwitter();
  log.debug("Searching twitter with keywords: {}",keywords);
  QueryResult results=twitter.search(query);
  List<Tweet> list=results.getTweets();
  for (  Tweet t : list) {
    long newId=t.getId();
    if (newId > lastId) {
      lastId=newId;
    }
  }
  exchange.getIn().setBody(list);
}
