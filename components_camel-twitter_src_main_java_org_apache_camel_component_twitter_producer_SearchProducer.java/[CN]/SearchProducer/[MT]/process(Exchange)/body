{
  long myLastId=lastId;
  String keywords=exchange.getIn().getHeader(TwitterConstants.TWITTER_KEYWORDS,String.class);
  if (keywords == null) {
    keywords=te.getProperties().getKeywords();
  }
  if (keywords == null) {
    throw new CamelExchangeException("No keywords to use for query",exchange);
  }
  Query query=new Query(keywords);
  if (te.getProperties().isFilterOld() && myLastId != 0) {
    query.setSinceId(myLastId);
  }
  Twitter twitter=te.getProperties().getTwitter();
  log.debug("Searching twitter with keywords: {}",keywords);
  QueryResult results=twitter.search(query);
  List<Status> list=results.getTweets();
  if (te.getProperties().isFilterOld()) {
    for (    Status t : list) {
      long newId=t.getId();
      if (newId > myLastId) {
        myLastId=newId;
      }
    }
  }
  exchange.getIn().setBody(list);
  if (myLastId > lastId) {
    lastId=myLastId;
  }
}
