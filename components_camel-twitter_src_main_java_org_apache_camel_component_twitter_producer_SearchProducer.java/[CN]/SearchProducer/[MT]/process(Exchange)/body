{
  String keywords=exchange.getIn().getHeader(TwitterConstants.TWITTER_KEYWORDS,String.class);
  if (keywords == null) {
    keywords=te.getProperties().getKeywords();
  }
  if (keywords == null) {
    throw new CamelExchangeException("No keywords to use for query",exchange);
  }
  Query query=new Query(keywords);
  if (lastId != 0) {
    query.setSinceId(lastId);
  }
  Twitter twitter=te.getProperties().getTwitter();
  log.debug("Searching twitter with keywords: {}",keywords);
  QueryResult results=twitter.search(query);
  List<Status> list=results.getTweets();
  for (  Status t : list) {
    long newId=t.getId();
    if (newId > lastId) {
      lastId=newId;
    }
  }
  exchange.getIn().setBody(list);
}
