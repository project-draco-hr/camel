{
  if (camelJMXAgent != null && camelJMXAgent.isDisabled()) {
    LOG.info("JMXAgent disabled");
    getContext().setLifecycleStrategies(new ArrayList<LifecycleStrategy>());
    getContext().setManagementStrategy(new DefaultManagementStrategy());
  }
 else   if (camelJMXAgent != null) {
    LOG.info("JMXAgent enabled: " + camelJMXAgent);
    DefaultInstrumentationAgent agent=new DefaultInstrumentationAgent();
    agent.setConnectorPort(camelJMXAgent.getConnectorPort());
    agent.setCreateConnector(camelJMXAgent.isCreateConnector());
    agent.setMBeanObjectDomainName(camelJMXAgent.getMbeanObjectDomainName());
    agent.setMBeanServerDefaultDomain(camelJMXAgent.getMbeanServerDefaultDomain());
    agent.setRegistryPort(camelJMXAgent.getRegistryPort());
    agent.setServiceUrlPath(camelJMXAgent.getServiceUrlPath());
    agent.setUsePlatformMBeanServer(camelJMXAgent.isUsePlatformMBeanServer());
    agent.setOnlyRegisterProcessorWithCustomId(camelJMXAgent.getOnlyRegisterProcessorWithCustomId());
    ManagementStrategy managementStrategy=new ManagedManagementStrategy(agent);
    getContext().setManagementStrategy(managementStrategy);
    getContext().setLifecycleStrategies(new ArrayList<LifecycleStrategy>());
    getContext().addLifecycleStrategy(new DefaultManagedLifecycleStrategy(managementStrategy));
    getContext().getManagementStrategy().onlyManageProcessorWithCustomId(camelJMXAgent.getOnlyRegisterProcessorWithCustomId());
  }
}
