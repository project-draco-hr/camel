{
  if (camelJMXAgent != null && camelJMXAgent.isAgentDisabled()) {
    LOG.info("JMXAgent disabled");
    getContext().getLifecycleStrategies().clear();
    getContext().setManagementStrategy(new DefaultManagementStrategy());
  }
 else   if (camelJMXAgent != null) {
    LOG.info("JMXAgent enabled: " + camelJMXAgent);
    DefaultManagementAgent agent=new DefaultManagementAgent();
    agent.setConnectorPort(parseInteger(camelJMXAgent.getConnectorPort()));
    agent.setCreateConnector(parseBoolean(camelJMXAgent.getCreateConnector()));
    agent.setMBeanObjectDomainName(parseText(camelJMXAgent.getMbeanObjectDomainName()));
    agent.setMBeanServerDefaultDomain(parseText(camelJMXAgent.getMbeanServerDefaultDomain()));
    agent.setRegistryPort(parseInteger(camelJMXAgent.getRegistryPort()));
    agent.setServiceUrlPath(parseText(camelJMXAgent.getServiceUrlPath()));
    agent.setUsePlatformMBeanServer(parseBoolean(camelJMXAgent.getUsePlatformMBeanServer()));
    agent.setOnlyRegisterProcessorWithCustomId(parseBoolean(camelJMXAgent.getOnlyRegisterProcessorWithCustomId()));
    ManagementStrategy managementStrategy=new ManagedManagementStrategy(agent);
    getContext().setManagementStrategy(managementStrategy);
    getContext().getLifecycleStrategies().clear();
    getContext().addLifecycleStrategy(new DefaultManagementLifecycleStrategy(getContext()));
    boolean onlyId=agent.getOnlyRegisterProcessorWithCustomId() != null && agent.getOnlyRegisterProcessorWithCustomId();
    getContext().getManagementStrategy().onlyManageProcessorWithCustomId(onlyId);
    getContext().getManagementStrategy().setStatisticsLevel(camelJMXAgent.getStatisticsLevel());
  }
}
