{
  Set<String> ids=new HashSet<String>();
  Map<String,ThreadPoolProfile> profiles=context.getRegistry().lookupByType(ThreadPoolProfile.class);
  if (profiles != null && !profiles.isEmpty()) {
    for (    String id : profiles.keySet()) {
      ThreadPoolProfile profile=profiles.get(id);
      if (profile.isDefaultProfile()) {
        LOG.info("Using custom default ThreadPoolProfile with id: " + id + " and implementation: "+ profile);
        context.getExecutorServiceStrategy().setDefaultThreadPoolProfile(profile);
        ids.add(id);
      }
    }
  }
  if (threadPoolProfiles != null && !threadPoolProfiles.isEmpty()) {
    for (    ThreadPoolProfileDefinition profile : threadPoolProfiles) {
      if (profile.isDefaultProfile()) {
        LOG.info("Using custom default ThreadPoolProfile with id: " + profile.getId() + " and implementation: "+ profile);
        context.getExecutorServiceStrategy().setDefaultThreadPoolProfile(profile);
        ids.add(profile.getId());
      }
    }
  }
  if (ids.size() > 1) {
    throw new IllegalArgumentException("Only exactly one default ThreadPoolProfile is allowed, was " + ids.size() + " ids: "+ ids);
  }
}
