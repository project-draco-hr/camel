{
  InputStream is=null;
  if (checkChunked(message,exchange)) {
    is=message.getBody(InputStream.class);
  }
  if (is != null) {
    ServletOutputStream os=response.getOutputStream();
    try {
      IOHelper.copy(is,os);
    }
  finally {
      IOHelper.close(os);
      IOHelper.close(is);
    }
  }
 else {
    String data=message.getBody(String.class);
    if (data != null) {
      response.setContentLength(data.length());
      response.getWriter().print(data);
      response.getWriter().flush();
    }
  }
}
