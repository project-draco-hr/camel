{
  if (delimiter != null) {
    config.setDelimiter(delimiter.charAt(0));
  }
  strategy.setDelimiter(config.getDelimiter());
  InputStreamReader in=new InputStreamReader(inputStream,IOHelper.getCharsetName(exchange));
  boolean closeStream=false;
  CsvIterator csvIterator=null;
  try {
    CSVParser parser=createParser(in);
    if (parser == null) {
      closeStream=true;
      return ObjectHelper.createIterator(null);
    }
    csvIterator=new CsvIterator(parser,in);
  }
 catch (  IOException ioe) {
    closeStream=true;
  }
 finally {
    if (closeStream) {
      IOHelper.close(in);
    }
  }
  if (lazyLoad) {
    return csvIterator;
  }
  return loadAllAsList(csvIterator);
}
