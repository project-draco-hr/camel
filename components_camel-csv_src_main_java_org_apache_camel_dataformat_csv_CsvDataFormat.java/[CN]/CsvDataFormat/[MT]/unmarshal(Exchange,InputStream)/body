{
  if (delimiter != null) {
    config.setDelimiter(delimiter.charAt(0));
  }
  strategy.setDelimiter(config.getDelimiter());
  Reader reader=null;
  boolean error=false;
  try {
    reader=IOHelper.buffered(new InputStreamReader(inputStream,IOHelper.getCharsetName(exchange)));
    CSVParser parser=new CSVParser(reader,strategy);
    if (skipFirstLine) {
      parser.getLine();
    }
    CsvIterator csvIterator=new CsvIterator(parser,reader);
    return lazyLoad ? csvIterator : loadAllAsList(csvIterator);
  }
 catch (  Exception e) {
    error=true;
    throw e;
  }
 finally {
    if (error) {
      IOHelper.close(reader);
    }
  }
}
