{
  if (delimiter != null) {
    config.setDelimiter(delimiter.charAt(0));
  }
  strategy.setDelimiter(config.getDelimiter());
  InputStreamReader in=null;
  boolean error=false;
  try {
    in=new InputStreamReader(inputStream,IOHelper.getCharsetName(exchange));
    CSVParser parser=new CSVParser(in,strategy);
    if (skipFirstLine) {
      parser.getLine();
    }
    CsvIterator csvIterator=new CsvIterator(parser,in);
    return lazyLoad ? csvIterator : loadAllAsList(csvIterator);
  }
 catch (  Exception e) {
    error=true;
    throw e;
  }
 finally {
    if (error) {
      IOHelper.close(in);
    }
  }
}
