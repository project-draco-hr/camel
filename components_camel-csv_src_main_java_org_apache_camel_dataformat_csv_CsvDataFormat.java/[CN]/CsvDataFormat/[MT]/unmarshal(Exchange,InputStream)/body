{
  if (delimiter != null) {
    config.setDelimiter(delimiter.charAt(0));
  }
  strategy.setDelimiter(config.getDelimiter());
  Reader reader=null;
  boolean error=false;
  try {
    reader=IOHelper.buffered(new InputStreamReader(inputStream,IOHelper.getCharsetName(exchange)));
    CSVParser parser=new CSVParser(reader,strategy);
    if (skipFirstLine) {
      parser.getLine();
    }
    CsvLineConverter<?> lineConverter;
    if (useMaps) {
      final CSVField[] fields=this.config.getFields();
      final String[] fieldS;
      if (fields != null) {
        fieldS=new String[fields.length];
        for (int i=0; i < fields.length; i++) {
          fieldS[i]=fields[i].getName();
        }
      }
 else {
        fieldS=parser.getLine();
      }
      lineConverter=CsvLineConverters.getMapLineConverter(fieldS);
    }
 else {
      lineConverter=CsvLineConverters.getListConverter();
    }
    @SuppressWarnings({"unchecked","rawtypes"}) CsvIterator<?> csvIterator=new CsvIterator(parser,reader,lineConverter);
    return lazyLoad ? csvIterator : loadAllAsList(csvIterator);
  }
 catch (  Exception e) {
    error=true;
    throw e;
  }
 finally {
    if (error) {
      IOHelper.close(reader);
    }
  }
}
