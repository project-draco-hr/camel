{
  if (delimiter != null) {
    config.setDelimiter(delimiter.charAt(0));
  }
  strategy.setDelimiter(config.getDelimiter());
  Reader reader=null;
  boolean error=false;
  try {
    reader=IOHelper.buffered(new InputStreamReader(inputStream,IOHelper.getCharsetName(exchange)));
    CSVParser parser=new CSVParser(reader,strategy);
    CsvLineConverter<?> lineConverter;
    if (useMaps) {
      lineConverter=CsvLineConverters.getMapLineConverter(parser.getLine());
    }
 else {
      lineConverter=CsvLineConverters.getListConverter();
      if (skipFirstLine) {
        parser.getLine();
      }
    }
    @SuppressWarnings({"unchecked","rawtypes"}) CsvIterator<?> csvIterator=new CsvIterator(parser,reader,lineConverter);
    return lazyLoad ? csvIterator : loadAllAsList(csvIterator);
  }
 catch (  Exception e) {
    error=true;
    throw e;
  }
 finally {
    if (error) {
      IOHelper.close(reader);
    }
  }
}
