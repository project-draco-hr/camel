{
  if (delimiter != null) {
    config.setDelimiter(delimiter.charAt(0));
  }
  OutputStreamWriter out=new OutputStreamWriter(outputStream,IOConverter.getCharsetName(exchange));
  CSVWriter csv=new CSVWriter(config);
  csv.setWriter(out);
  try {
    List list=ExchangeHelper.convertToType(exchange,List.class,object);
    if (list != null) {
      for (      Object child : list) {
        Map row=ExchangeHelper.convertToMandatoryType(exchange,Map.class,child);
        doMarshalRecord(exchange,row,out,csv);
      }
    }
 else {
      Map row=ExchangeHelper.convertToMandatoryType(exchange,Map.class,object);
      doMarshalRecord(exchange,row,out,csv);
    }
  }
  finally {
    out.close();
  }
}
