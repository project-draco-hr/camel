{
  boolean received=latch.await(20,TimeUnit.SECONDS);
  assertTrue("Did not receive the message!",received);
  assertNotNull(receivedExchange);
  JmsMessage receivedMessage=receivedExchange.getIn();
  assertEquals("cheese header",123,receivedMessage.getHeader("cheese"));
  Object body=receivedMessage.getBody();
  log.debug("Received body: " + body);
  Message jmsMessage=receivedMessage.getJmsMessage();
  assertTrue("Expected an instance of " + type.getName() + " but was "+ jmsMessage,type.isInstance(jmsMessage));
  log.debug("Received JMS message: " + jmsMessage);
  return body;
}
