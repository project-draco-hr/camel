{
  if (endpoint.isAutoCreate()) {
    String name=FileUtil.normalizePath(fileName);
    File file=new File(name);
    String directory=file.getParent();
    boolean absolute=FileUtil.isAbsolute(file);
    if (directory != null) {
      if (!operations.buildDirectory(directory,absolute)) {
        if (log.isDebugEnabled()) {
          log.debug("Cannot build directory [" + directory + "] (could be because of denied permissions)");
        }
      }
    }
  }
  if (log.isTraceEnabled()) {
    log.trace("About to write [" + fileName + "] to ["+ getEndpoint()+ "] from exchange ["+ exchange+ "]");
  }
  boolean success=operations.storeFile(fileName,exchange);
  if (!success) {
    throw new GenericFileOperationFailedException("Error writing file [" + fileName + "]");
  }
  if (log.isDebugEnabled()) {
    log.debug("Wrote [" + fileName + "] to ["+ getEndpoint()+ "]");
  }
}
