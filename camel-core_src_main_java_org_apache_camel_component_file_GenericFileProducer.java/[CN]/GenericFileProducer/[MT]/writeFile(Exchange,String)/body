{
  if (endpoint.isAutoCreate()) {
    String name=FileUtil.normalizePath(fileName);
    File file=new File(name);
    String directory=file.getParent();
    boolean absolute=FileUtil.isAbsolute(file);
    if (directory != null) {
      if (!operations.buildDirectory(directory,absolute)) {
        log.debug("Cannot build directory [{}] (could be because of denied permissions)",directory);
      }
    }
  }
  if (log.isTraceEnabled()) {
    log.trace("About to write [{}] to [{}] from exchange [{}]",new Object[]{fileName,getEndpoint(),exchange});
  }
  boolean success=operations.storeFile(fileName,exchange);
  if (!success) {
    throw new GenericFileOperationFailedException("Error writing file [" + fileName + "]");
  }
  log.debug("Wrote [{}] to [{}]",fileName,getEndpoint());
}
