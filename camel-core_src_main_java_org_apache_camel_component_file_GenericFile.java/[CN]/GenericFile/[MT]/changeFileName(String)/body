{
  newName=needToNormalize() ? FileUtil.normalizePath(newName) : newName;
  boolean absolute=isAbsolutePath(newName);
  if (absolute) {
    setAbsolute(true);
    setAbsoluteFileName(newName);
    setRelativeFileName(null);
    setCanonicalFileName(null);
    String fileName=newName.substring(newName.lastIndexOf(getFileSeparator()) + 1);
    setFileName(fileName);
    return;
  }
  setAbsolute(false);
  setAbsoluteFileName(getParent() + getFileSeparator() + newName);
  setCanonicalFileName(null);
  String baseNewName=null;
  if (newName.indexOf(getFileSeparator()) != -1) {
    baseNewName=newName.substring(0,newName.lastIndexOf(getFileSeparator()));
    newName=newName.substring(newName.lastIndexOf(getFileSeparator()) + 1);
  }
  if (relativeFileName != null && relativeFileName.indexOf(getFileSeparator()) != -1) {
    String relative=relativeFileName.substring(0,relativeFileName.lastIndexOf(getFileSeparator()));
    if (baseNewName != null) {
      setRelativeFileName(relative + getFileSeparator() + baseNewName+ getFileSeparator()+ newName);
    }
 else {
      setRelativeFileName(relative + getFileSeparator() + newName);
    }
  }
 else {
    if (baseNewName != null) {
      setRelativeFileName(baseNewName + getFileSeparator() + newName);
    }
 else {
      setRelativeFileName(newName);
    }
  }
  setFileName(newName);
}
