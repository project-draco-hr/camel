{
  Endpoint answer;
synchronized (endpoints) {
    answer=endpoints.get(uri);
    if (answer == null) {
      try {
synchronized (components) {
          Collection<Component> componentSet=components.values();
          for (          Component component : componentSet) {
            answer=component.resolveEndpoint(uri);
            if (answer != null) {
              break;
            }
          }
        }
        if (answer == null) {
          Component component=getComponentResolver().resolveComponent(uri,this);
          if (component != null) {
            ServiceHelper.startServices(component);
            answer=component.resolveEndpoint(uri);
          }
        }
        if (answer != null) {
          ServiceHelper.startServices(answer);
          endpoints.put(uri,answer);
        }
      }
 catch (      Exception e) {
        throw new ResolveEndpointFailedException(uri,e);
      }
    }
  }
  return answer;
}
