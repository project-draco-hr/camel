{
  Collection<Endpoint> answer=new ArrayList<Endpoint>();
  Endpoint oldEndpoint=endpoints.remove(getEndpointKey(uri));
  if (oldEndpoint != null) {
    answer.add(oldEndpoint);
    stopServices(oldEndpoint);
  }
 else {
    for (    Map.Entry entry : endpoints.entrySet()) {
      oldEndpoint=(Endpoint)entry.getValue();
      if (EndpointHelper.matchEndpoint(oldEndpoint.getEndpointUri(),uri)) {
        answer.add(oldEndpoint);
        stopServices(oldEndpoint);
      }
    }
    for (    Endpoint endpoint : answer) {
      endpoints.remove(getEndpointKey(endpoint.getEndpointUri()));
    }
  }
  for (  Endpoint endpoint : answer) {
    for (    LifecycleStrategy strategy : lifecycleStrategies) {
      strategy.onEndpointRemove(endpoint);
    }
  }
  return answer;
}
