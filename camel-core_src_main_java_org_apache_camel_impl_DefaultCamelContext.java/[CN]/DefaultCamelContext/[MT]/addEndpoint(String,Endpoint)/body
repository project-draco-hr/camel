{
  Endpoint oldEndpoint;
synchronized (endpoints) {
    startServices(endpoint);
    oldEndpoint=endpoints.remove(uri);
    lifecycleStrategy.onEndpointAdd(endpoint);
    addEndpointToRegistry(uri,endpoint);
    if (oldEndpoint != null) {
      stopServices(oldEndpoint);
    }
  }
  return oldEndpoint;
}
