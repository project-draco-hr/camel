{
  Endpoint oldEndpoint;
synchronized (endpoints) {
    startServices(endpoint);
    oldEndpoint=endpoints.remove(uri);
    for (    LifecycleStrategy strategy : lifecycleStrategies) {
      strategy.onEndpointAdd(endpoint);
    }
    addEndpointToRegistry(endpoint);
    if (oldEndpoint != null) {
      stopServices(oldEndpoint);
    }
  }
  return oldEndpoint;
}
