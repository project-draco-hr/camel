{
  PropertiesComponent pc=getPropertiesComponent();
  if (text != null && !text.startsWith("properties:")) {
    if (pc == null && text.contains(PropertiesComponent.DEFAULT_PREFIX_TOKEN)) {
      Component existing=lookupPropertiesComponent();
      if (existing != null) {
        if (existing instanceof PropertiesComponent) {
          pc=(PropertiesComponent)existing;
        }
 else {
          throw new IllegalArgumentException("Found properties component of type: " + existing.getClass() + " instead of expected: "+ PropertiesComponent.class);
        }
      }
      if (pc == null) {
        log.info("No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties");
        pc=getComponent("properties",PropertiesComponent.class);
      }
    }
    if (pc != null && text.contains(pc.getPrefixToken())) {
      String answer=pc.parseUri(text);
      log.debug("Resolved text: {} -> {}",text,answer);
      return answer;
    }
  }
  return text;
}
