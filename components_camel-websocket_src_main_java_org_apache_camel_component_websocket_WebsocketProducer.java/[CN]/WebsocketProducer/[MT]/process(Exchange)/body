{
  Message in=exchange.getIn();
  String message=in.getMandatoryBody(String.class);
  if (isSendToAllSet(in)) {
    sendToAll(store,message,exchange);
  }
 else {
    String connectionKey=in.getHeader(WebsocketConstants.CONNECTION_KEY,String.class);
    if (connectionKey != null) {
      DefaultWebsocket websocket=store.get(connectionKey);
      sendMessage(websocket,message);
    }
 else {
      throw new IllegalArgumentException("Failed to send message to single connection; connetion key not set.");
    }
  }
}
