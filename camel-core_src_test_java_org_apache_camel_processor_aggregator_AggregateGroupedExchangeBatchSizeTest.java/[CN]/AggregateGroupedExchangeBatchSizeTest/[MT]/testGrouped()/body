{
  MockEndpoint result=getMockEndpoint("mock:result");
  result.expectedMinimumMessageCount(1);
  template.sendBody("direct:start","100");
  template.sendBody("direct:start","150");
  template.sendBody("direct:start","130");
  template.sendBody("direct:start","200");
  assertMockEndpointsSatisfied();
  Exchange out=result.getExchanges().get(0);
  List<Exchange> grouped=out.getProperty(Exchange.GROUPED_EXCHANGE,List.class);
  assertTrue("Should be either 2 or 4, was " + grouped.size(),grouped.size() == 2 || grouped.size() == 4);
  assertEquals("100",grouped.get(0).getIn().getBody(String.class));
  assertEquals("150",grouped.get(1).getIn().getBody(String.class));
  Thread.sleep(1000);
  if (result.getReceivedCounter() == 2) {
    out=result.getExchanges().get(1);
    grouped=out.getProperty(Exchange.GROUPED_EXCHANGE,List.class);
    assertEquals(2,grouped.size());
    assertEquals("130",grouped.get(0).getIn().getBody(String.class));
    assertEquals("200",grouped.get(1).getIn().getBody(String.class));
  }
}
