{
  XmlType xmlType=type.getAnnotation(XmlType.class);
  if (xmlType == null || xmlType.name() == null) {
    throw new RuntimeException("The type " + type.getName() + " needs to have an XmlType annotation with name");
  }
  String nameSpace=xmlType.namespace();
  if ("##default".equals(nameSpace)) {
    XmlSchema xmlSchema=type.getPackage().getAnnotation(XmlSchema.class);
    if (xmlSchema != null) {
      nameSpace=xmlSchema.namespace();
    }
  }
  String localName=xmlType.name();
  if (ObjectHelper.isEmpty(localName)) {
    XmlRootElement root=type.getAnnotation(XmlRootElement.class);
    if (root != null) {
      localName=root.name();
    }
  }
  return new QName(nameSpace,localName);
}
