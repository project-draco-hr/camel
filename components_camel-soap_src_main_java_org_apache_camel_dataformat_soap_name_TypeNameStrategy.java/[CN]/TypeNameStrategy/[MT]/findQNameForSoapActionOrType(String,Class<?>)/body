{
  XmlType xmlType=type.getAnnotation(XmlType.class);
  if (xmlType == null || xmlType.name() == null) {
    throw new RuntimeException("The type " + type.getName() + " needs to have an XmlType annotation with name");
  }
  String nameSpace=xmlType.namespace();
  if ("##default".equals(nameSpace)) {
    XmlSchema xmlSchema=type.getPackage().getAnnotation(XmlSchema.class);
    if (xmlSchema != null) {
      nameSpace=xmlSchema.namespace();
    }
  }
  return new QName(nameSpace,xmlType.name());
}
