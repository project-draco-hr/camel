{
  final Iterator iterator=ObjectHelper.createIterator(value);
  return new Iterable(){
    private final Exchange copy=ExchangeHelper.createCopy(exchange,true);
    private final RouteContext routeContext=exchange.getUnitOfWork() != null ? exchange.getUnitOfWork().getRouteContext() : null;
    public Iterator iterator(){
      return new Iterator(){
        private int index;
        private boolean closed;
        public boolean hasNext(){
          if (closed) {
            return false;
          }
          boolean answer=iterator.hasNext();
          if (!answer) {
            closed=true;
            if (value instanceof Closeable) {
              IOHelper.close((Closeable)value,value.getClass().getName(),LOG);
            }
 else             if (value instanceof Scanner) {
              ((Scanner)value).close();
            }
          }
          return answer;
        }
        public Object next(){
          Object part=iterator.next();
          Exchange newExchange=ExchangeHelper.createCorrelatedCopy(copy,false);
          if (isShareUnitOfWork()) {
            prepareSharedUnitOfWork(newExchange,copy);
          }
          if (part instanceof Message) {
            newExchange.setIn((Message)part);
          }
 else {
            Message in=newExchange.getIn();
            in.setBody(part);
          }
          return createProcessorExchangePair(index++,getProcessors().iterator().next(),newExchange,routeContext);
        }
        public void remove(){
          throw new UnsupportedOperationException("Remove is not supported by this iterator");
        }
      }
;
    }
  }
;
}
