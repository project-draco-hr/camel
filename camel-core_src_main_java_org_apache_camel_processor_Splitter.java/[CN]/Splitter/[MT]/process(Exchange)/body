{
  Object value=expression.evaluate(exchange);
  Integer size=CollectionHelper.size(value);
  Iterator iter=ObjectConverter.iterator(value);
  int counter=0;
  Exchange result=null;
  while (iter.hasNext()) {
    Object part=iter.next();
    Exchange newExchange=exchange.copy();
    Message in=newExchange.getIn();
    in.setBody(part);
    if (size != null) {
      in.setHeader(SPLIT_SIZE,size);
    }
    in.setHeader(SPLIT_COUNTER,counter++);
    processor.process(newExchange);
    if (result == null) {
      result=newExchange;
    }
 else {
      result=aggregationStrategy.aggregate(result,newExchange);
    }
  }
  if (result != null) {
    ExchangeHelper.copyResults(exchange,result);
  }
}
