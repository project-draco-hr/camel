{
  if (runCamel) {
    getLog().info("Running Camel embedded to load jndi.properties file from the classpath");
    List<?> list=project.getTestClasspathElements();
    getLog().debug("Using classpath: " + list);
    EmbeddedMojo mojo=new EmbeddedMojo();
    mojo.setClasspathElements(list);
    mojo.setDotEnabled(true);
    mojo.setMainClass(mainClass);
    if ("true".equals(getAggregate())) {
      mojo.setDotAggregationEnabled(true);
    }
    mojo.setOutputDirectory(outputDirectory.getAbsolutePath());
    mojo.setDuration(duration);
    mojo.setLog(getLog());
    mojo.setPluginContext(getPluginContext());
    try {
      mojo.executeWithoutWrapping();
    }
 catch (    Exception e) {
      getLog().error("Failed to run Camel embedded: " + e,e);
    }
  }
}
