{
  String threadId=exchange.getExchangeId();
  try {
    Chat chat=endpoint.getConnection().getChatManager().getThreadChat(threadId);
    if (chat == null) {
      chat=endpoint.getConnection().getChatManager().createChat(getParticipant(),threadId,new MessageListener(){
        public void processMessage(        Chat chat,        Message message){
        }
      }
);
    }
    Message message=new Message();
    message.setTo(participant);
    message.setFrom(endpoint.getUser());
    message.setThread(threadId);
    message.setType(Message.Type.normal);
    endpoint.getBinding().populateXmppMessage(message,exchange);
    if (LOG.isDebugEnabled()) {
      LOG.debug(">>>> message: " + message.getBody());
    }
    chat.sendMessage(message);
  }
 catch (  XMPPException e) {
    throw new RuntimeXmppException(e);
  }
}
