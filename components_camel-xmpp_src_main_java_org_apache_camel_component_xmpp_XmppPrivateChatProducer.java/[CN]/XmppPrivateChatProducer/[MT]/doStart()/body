{
  if (connection == null) {
    try {
      connection=endpoint.createConnection();
    }
 catch (    XMPPException e) {
      if (endpoint.isTestConnectionOnStartup()) {
        throw new RuntimeException("Could not establish connection to XMPP server:  " + endpoint.getConnectionDescription(),e);
      }
 else {
        LOG.warn("Could not connect to XMPP server. {}  Producer will attempt lazy connection when needed.",XmppEndpoint.getXmppExceptionLogMessage(e));
      }
    }
  }
  super.doStart();
}
