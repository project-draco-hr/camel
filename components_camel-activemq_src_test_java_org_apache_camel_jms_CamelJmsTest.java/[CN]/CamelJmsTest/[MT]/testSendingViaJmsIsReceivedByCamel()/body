{
  MockEndpoint result=resolveMandatoryEndpoint("mock:result",MockEndpoint.class);
  result.expectedBodiesReceived(expectedBody);
  result.message(0).header("foo").isEqualTo("bar");
  Destination destination=getMandatoryBean(Destination.class,"sendTo");
  ConnectionFactory factory=getMandatoryBean(ConnectionFactory.class,"connectionFactory");
  Connection connection=factory.createConnection();
  connection.start();
  Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
  MessageProducer producer=session.createProducer(destination);
  ObjectMessage message=session.createObjectMessage(expectedBody);
  message.setStringProperty("foo","bar");
  producer.send(message);
  result.assertIsSatisfied();
  log.info("Received message: " + result.getReceivedExchanges());
}
