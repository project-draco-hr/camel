{
  Enumeration<URL> resources=classLoader.getResources(META_INF_SERVICES);
  while (resources.hasMoreElements()) {
    URL url=resources.nextElement();
    if (url != null && !visitedURLs.contains(url)) {
      visitedURLs.add(url);
      if (LOG.isDebugEnabled()) {
        LOG.info("Loading file " + META_INF_SERVICES + " to retrieve list of packages, from url: "+ url);
      }
      BufferedReader reader=new BufferedReader(new InputStreamReader(url.openStream()));
      try {
        while (true) {
          String line=reader.readLine();
          if (line == null) {
            break;
          }
          line=line.trim();
          if (line.startsWith("#") || line.length() == 0) {
            continue;
          }
          tokenize(packages,line);
        }
      }
  finally {
        ObjectHelper.close(reader,null,LOG);
      }
    }
  }
}
