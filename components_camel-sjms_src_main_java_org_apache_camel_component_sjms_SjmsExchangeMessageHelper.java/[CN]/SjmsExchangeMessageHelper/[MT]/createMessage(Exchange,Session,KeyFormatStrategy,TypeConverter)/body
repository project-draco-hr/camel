{
  Message answer=null;
  Object body=null;
  Map<String,Object> bodyHeaders=null;
  if (exchange.getOut().getBody() != null) {
    body=exchange.getOut().getBody();
    bodyHeaders=new HashMap<String,Object>(exchange.getOut().getHeaders());
  }
 else {
    body=exchange.getIn().getBody();
    bodyHeaders=new HashMap<String,Object>(exchange.getIn().getHeaders());
  }
  answer=JmsMessageHelper.createMessage(session,body,bodyHeaders,keyFormatStrategy,typeConverter);
  return answer;
}
