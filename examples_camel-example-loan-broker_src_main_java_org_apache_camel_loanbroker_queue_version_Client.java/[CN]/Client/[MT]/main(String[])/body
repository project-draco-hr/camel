{
  CamelContext context=new DefaultCamelContext();
  ConnectionFactory connectionFactory=new ActiveMQConnectionFactory("tcp://localhost:51616");
  context.addComponent("jms",JmsComponent.jmsComponentAutoAcknowledge(connectionFactory));
  context.addRoutes(new Client());
  ProducerTemplate template=context.createProducerTemplate();
  context.start();
  for (int i=0; i < 2; i++) {
    template.sendBodyAndHeader("jms:queue:loanRequestQueue","Quote for the lowerst rate of loaning bank",Constants.PROPERTY_SSN,"Client-A" + i);
    Thread.sleep(100);
  }
  Thread.sleep(2000);
  Exchange exchange=template.send("jms:queue2:parallelLoanRequestQueue",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.setPattern(ExchangePattern.InOut);
      exchange.getIn().setBody("Quote for the lowerst rate of loaning bank");
      exchange.getIn().setHeader(Constants.PROPERTY_SSN,"Client-B");
    }
  }
);
  String bank=(String)exchange.getOut().getHeader(Constants.PROPERTY_BANK);
  Double rate=(Double)exchange.getOut().getHeader(Constants.PROPERTY_RATE);
  String ssn=(String)exchange.getOut().getHeader(Constants.PROPERTY_SSN);
  System.out.println("Loan quotion for Client " + ssn + "."+ " The lowest rate bank is "+ bank+ ", the rate is "+ rate);
  Thread.sleep(1000 * 5);
  context.stop();
}
