{
  try {
    Socket socket;
    SocketFactory socketFactory;
    socketFactory=config.getUsingSSL() && config.getHttpProxyHost() == null ? SSLSocketFactory.getDefault() : SocketFactory.getDefault();
    if (config.getHttpProxyHost() != null) {
      socket=socketFactory.createSocket(config.getHttpProxyHost(),config.getHttpProxyPort());
      connectProxy(host,port,socket);
    }
 else {
      socket=socketFactory.createSocket(host,port);
    }
    if (config.getUsingSSL() && config.getHttpProxyHost() != null) {
      SSLSocketFactory sslSocketFactory=(SSLSocketFactory)SSLSocketFactory.getDefault();
      SSLSocket sslSocket=(SSLSocket)sslSocketFactory.createSocket(socket,host,port,true);
      sslSocket.startHandshake();
      socket=sslSocket;
    }
    return new SocketConnection(socket);
  }
 catch (  Exception e) {
    throw new IOException(e.getMessage());
  }
}
