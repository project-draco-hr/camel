{
  getMockEndpoint("mock:result").expectedMessageCount(1);
  template.sendBody("direct:start","Hello World");
  assertMockEndpointsSatisfied();
  MBeanServer mbeanServer=getMBeanServer();
  Set<ObjectName> set=mbeanServer.queryNames(new ObjectName("*:type=services,*"),null);
  assertEquals(7,set.size());
  List<ObjectName> list=new ArrayList<ObjectName>(set);
  ObjectName on=null;
  for (  ObjectName name : list) {
    if (name.getCanonicalName().contains("EndpointRegistry")) {
      on=name;
      break;
    }
  }
  assertNotNull("Should have found EndpointRegistry",on);
  Integer max=(Integer)mbeanServer.getAttribute(on,"MaximumCacheSize");
  assertEquals(1000,max.intValue());
  Integer current=(Integer)mbeanServer.getAttribute(on,"Size");
  assertEquals(2,current.intValue());
  String source=(String)mbeanServer.getAttribute(on,"Source");
  assertTrue(source.startsWith("EndpointRegistry"));
  assertTrue(source.endsWith("capacity: 1000"));
  mbeanServer.invoke(on,"purge",null,null);
  current=(Integer)mbeanServer.getAttribute(on,"Size");
  assertEquals(0,current.intValue());
}
