{
  doStartExpectations();
  expect(endpoint.getConnectionString()).andReturn("smpp://smppclient@localhost:2775").times(2);
  session.removeSessionStateListener(isA(SessionStateListener.class));
  session.close();
  expect(endpoint.getConnectionString()).andReturn("smpp://smppclient@localhost:2775");
  replay(session,endpoint);
  producer.doStart();
  producer.doStop();
  verify(session,endpoint);
}
