{
  int responseCode=httpExchange.getResponseStatus();
  if (LOG.isDebugEnabled()) {
    LOG.debug("HTTP responseCode: " + responseCode);
  }
  Message in=exchange.getIn();
  HeaderFilterStrategy strategy=getEndpoint().getHeaderFilterStrategy();
  if (!getEndpoint().isThrowExceptionOnFailure()) {
    populateResponse(exchange,httpExchange,exchange.getIn(),strategy,responseCode);
  }
 else {
    if (responseCode >= 100 && responseCode < 300) {
      populateResponse(exchange,httpExchange,in,strategy,responseCode);
    }
 else {
      throw populateHttpOperationFailedException(exchange,httpExchange,responseCode);
    }
  }
}
