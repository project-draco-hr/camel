{
  try {
    org.osgi.framework.Bundle bundle=(org.osgi.framework.Bundle)mth.invoke(loader);
    org.osgi.framework.Bundle[] bundles=bundle.getBundleContext().getBundles();
    Set<String> urls=new HashSet<String>();
    for (    org.osgi.framework.Bundle bd : bundles) {
      if (LOG.isTraceEnabled()) {
        LOG.trace("Searching in bundle:" + bd);
      }
      Enumeration<URL> paths=bd.findEntries("/" + packageName,"*.class",true);
      while (paths != null && paths.hasMoreElements()) {
        URL path=paths.nextElement();
        String pathString=path.getPath();
        String urlString=pathString.substring(pathString.indexOf(packageName));
        urls.add(urlString);
        if (LOG.isTraceEnabled()) {
          LOG.trace("added url " + urlString);
        }
      }
    }
    return urls;
  }
 catch (  Throwable t) {
    LOG.error("Could not search osgi bundles for classes matching criteria: " + test + "due to an Exception: "+ t.getMessage());
    return null;
  }
}
