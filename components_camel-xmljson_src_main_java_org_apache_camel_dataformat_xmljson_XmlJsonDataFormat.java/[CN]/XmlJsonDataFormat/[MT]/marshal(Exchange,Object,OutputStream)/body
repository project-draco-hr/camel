{
  boolean streamTreatment=true;
  Object xml=graph instanceof String ? null : exchange.getContext().getTypeConverter().convertTo(InputStream.class,exchange,graph);
  if (xml == null) {
    xml=exchange.getContext().getTypeConverter().mandatoryConvertTo(String.class,exchange,graph);
    streamTreatment=false;
  }
  JSON json;
  if (streamTreatment) {
    json=serializer.readFromStream((InputStream)xml);
  }
 else {
    json=serializer.read((String)xml);
  }
  OutputStreamWriter osw=new OutputStreamWriter(stream,IOHelper.getCharsetName(exchange));
  json.write(osw);
  osw.flush();
}
