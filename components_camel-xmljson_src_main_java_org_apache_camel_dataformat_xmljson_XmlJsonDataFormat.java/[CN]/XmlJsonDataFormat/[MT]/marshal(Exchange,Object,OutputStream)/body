{
  if (serializer == null) {
    initSerializer();
  }
  boolean streamTreatment=true;
  Object xml=graph instanceof String ? null : exchange.getContext().getTypeConverter().convertTo(InputStream.class,graph);
  if (xml == null) {
    xml=exchange.getContext().getTypeConverter().mandatoryConvertTo(String.class,graph);
    streamTreatment=false;
  }
  JSON json;
  if (streamTreatment) {
    json=serializer.readFromStream((InputStream)xml);
  }
 else {
    json=serializer.read((String)xml);
  }
  OutputStreamWriter osw=new OutputStreamWriter(stream);
  json.write(osw);
  osw.flush();
}
