{
  if (!canTest()) {
    return;
  }
  MockEndpoint resultEndpoint=resolveMandatoryEndpoint("mock:result",MockEndpoint.class);
  resultEndpoint.expectedMessageCount(2);
  resultEndpoint.setResultWaitTime(2000);
  MockEndpoint errorEndpoint=resolveMandatoryEndpoint("mock:error",MockEndpoint.class);
  errorEndpoint.expectedMessageCount(4);
  errorEndpoint.setResultWaitTime(2000);
  for (int i=0; i < 6; i++) {
    template.sendBody("direct:start","<message>" + i + "</message>");
  }
  resultEndpoint.assertIsSatisfied();
  errorEndpoint.assertIsSatisfied();
}
