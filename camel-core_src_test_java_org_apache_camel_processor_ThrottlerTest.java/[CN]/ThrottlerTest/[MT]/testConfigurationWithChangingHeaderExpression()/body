{
  if (!canTest()) {
    return;
  }
  ExecutorService executor=Executors.newFixedThreadPool(messageCount);
  MockEndpoint resultEndpoint=resolveMandatoryEndpoint("mock:result",MockEndpoint.class);
  sendMessagesWithHeaderExpression(executor,resultEndpoint,1);
  resultEndpoint.reset();
  sendMessagesWithHeaderExpression(executor,resultEndpoint,10);
  resultEndpoint.reset();
  sendMessagesWithHeaderExpression(executor,resultEndpoint,1);
  executor.shutdownNow();
}
