{
  LoggingLevel level=getLoggingLevel(parameters);
  Logger providedLogger=getLogger(parameters);
  if (providedLogger == null) {
    Map<String,Logger> availableLoggers=getCamelContext().getRegistry().findByTypeWithName(Logger.class);
    if (availableLoggers.size() == 1) {
      providedLogger=availableLoggers.values().iterator().next();
      LOG.info("Using custom Logger: {}",providedLogger);
    }
 else     if (availableLoggers.size() > 1) {
      LOG.info("More than one {} instance found in the registry. Falling back to creating logger from URI {}.",Logger.class.getName(),uri);
    }
  }
  LogEndpoint endpoint=new LogEndpoint(uri,this);
  endpoint.setLevel(level.name());
  setProperties(endpoint,parameters);
  if (providedLogger == null) {
    endpoint.setLoggerName(remaining);
  }
 else {
    endpoint.setProvidedLogger(providedLogger);
  }
  ExchangeFormatter localFormatter=getCamelContext().getRegistry().lookupByNameAndType("logFormatter",ExchangeFormatter.class);
  if (localFormatter != null) {
    setProperties(localFormatter,parameters);
  }
 else   if (localFormatter == null && exchangeFormatter != null) {
    localFormatter=exchangeFormatter;
  }
 else {
    localFormatter=new DefaultExchangeFormatter();
    setProperties(localFormatter,parameters);
  }
  endpoint.setLocalFormatter(localFormatter);
  return endpoint;
}
