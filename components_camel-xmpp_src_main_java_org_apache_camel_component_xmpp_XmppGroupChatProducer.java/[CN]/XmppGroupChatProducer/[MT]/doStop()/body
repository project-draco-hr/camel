{
  if (chat != null) {
    if (LOG.isInfoEnabled()) {
      LOG.info("Leaving room: " + room);
    }
    chat.leave();
    chat=null;
  }
  if (connection != null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Disconnecting from: " + XmppEndpoint.getConnectionMessage(connection));
    }
    connection.disconnect();
    connection=null;
  }
  super.doStop();
}
