{
  if (policy == null) {
    String ref=getRef();
    if (ObjectHelper.isNotEmpty(ref)) {
      policy=routeContext.lookup(ref,Policy.class);
    }
    if (policy == null && type != null) {
      Map types=routeContext.lookupByType(type);
      if (types.size() == 1) {
        Object found=types.values().iterator().next();
        if (type.isInstance(found)) {
          return type.cast(found);
        }
      }
    }
    if (policy == null && type == TransactedPolicy.class) {
      policy=routeContext.lookup(PROPAGATION_REQUIRED,TransactedPolicy.class);
    }
  }
  return policy;
}
