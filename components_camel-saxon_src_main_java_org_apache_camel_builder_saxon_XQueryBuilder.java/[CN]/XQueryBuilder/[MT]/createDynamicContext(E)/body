{
  Configuration config=getConfiguration();
  DynamicQueryContext dynamicQueryContext=new DynamicQueryContext(config);
  Message in=exchange.getIn();
  Source source=in.getBody(Source.class);
  if (source == null) {
    Item item=in.getBody(Item.class);
    if (item != null) {
      dynamicQueryContext.setContextItem(item);
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("No body available on exchange so using an empty document: " + exchange);
        source=converter.toSource(converter.createDocument());
      }
    }
  }
  if (source != null) {
    DocumentInfo doc=getStaticQueryContext().buildDocument(source);
    dynamicQueryContext.setContextItem(doc);
  }
  configureQuery(dynamicQueryContext,exchange);
  return dynamicQueryContext;
}
