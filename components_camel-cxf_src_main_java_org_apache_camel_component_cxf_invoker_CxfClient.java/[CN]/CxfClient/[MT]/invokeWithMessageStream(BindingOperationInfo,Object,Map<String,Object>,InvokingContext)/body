{
  Object retval=null;
  Map<String,Object> requestContext=null;
  Map<String,Object> responseContext=null;
  if (null != context) {
    requestContext=(Map<String,Object>)context.get(REQUEST_CONTEXT);
    responseContext=(Map<String,Object>)context.get(RESPONSE_CONTEXT);
  }
  Exchange exchange=new ExchangeImpl();
  exchange.put(MessageObserver.class,this);
  exchange.put(InvokingContext.class,invokingContext);
  exchange.put(Bus.class,bus);
  exchange.put(Endpoint.class,getEndpoint());
  exchange.put(BindingInfo.class,getEndpoint().getEndpointInfo().getBinding());
  if (bi != null) {
    exchange.put(BindingOperationInfo.class,bi);
    exchange.put(BindingMessageInfo.class,bi.getInput());
    exchange.setOneWay(bi.getOperationInfo().isOneWay());
  }
  Message message=prepareMessage(exchange,requestContext,param,invokingContext);
  PhaseInterceptorChain chain=setupOutChain(requestContext,message,invokingContext);
  prepareConduitSelector(message);
  chain.doIntercept(message);
  Exception ex=message.getContent(Exception.class);
  if (ex != null) {
    if (LOG.isLoggable(Level.FINE)) {
      LOG.fine("Exception in outgoing chain: " + ex.toString());
    }
    throw ex;
  }
  if (!exchange.isOneWay()) {
    ex=getException(exchange);
    if (ex != null) {
      if (LOG.isLoggable(Level.FINE)) {
        LOG.fine("Exception in incoming chain: " + ex.toString());
      }
      throw ex;
    }
    retval=invokingContext.getResponseObject(exchange,responseContext);
  }
  return retval;
}
