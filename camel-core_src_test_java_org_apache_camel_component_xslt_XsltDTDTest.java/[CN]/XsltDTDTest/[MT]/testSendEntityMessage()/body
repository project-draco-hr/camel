{
  MockEndpoint endpoint=getMockEndpoint("mock:result");
  endpoint.expectedMessageCount(1);
  String message="<!DOCTYPE foo [<!ENTITY xxe SYSTEM \"file:///etc//user//test\">]><task><name>&xxe;</name></task>";
  template.sendBody("direct:start1",message);
  assertMockEndpointsSatisfied();
  List<Exchange> list=endpoint.getReceivedExchanges();
  Exchange exchange=list.get(0);
  String xml=exchange.getIn().getBody(String.class);
  assertTrue("Get a wrong transformed message",xml.indexOf("<transformed subject=\"\">") > 0);
  try {
    template.sendBody("direct:start2",message);
    fail("Expect an exception here");
  }
 catch (  Exception ex) {
    assertTrue("Get a wrong exception",ex instanceof CamelExecutionException);
    assertTrue("Get a wrong exception cause",ex.getCause() instanceof TransformerException);
  }
}
