{
  String addressUri=uri;
  if (!uri.startsWith("http4:") && !uri.startsWith("https4:")) {
    addressUri=remaining;
  }
  Map<String,Object> httpClientParameters=new HashMap<String,Object>(parameters);
  HttpParams clientParams=configureHttpParams(parameters);
  validateParameters(uri,parameters,"httpClient.");
  HttpBinding httpBinding=resolveAndRemoveReferenceParameter(parameters,"httpBindingRef",HttpBinding.class);
  if (httpBinding == null) {
    httpBinding=resolveAndRemoveReferenceParameter(parameters,"httpBinding",HttpBinding.class);
  }
  HttpClientConfigurer httpClientConfigurer=resolveAndRemoveReferenceParameter(parameters,"httpClientConfigurerRef",HttpClientConfigurer.class);
  if (httpClientConfigurer == null) {
    httpClientConfigurer=resolveAndRemoveReferenceParameter(parameters,"httpClientConfigurer",HttpClientConfigurer.class);
  }
  X509HostnameVerifier x509HostnameVerifier=resolveAndRemoveReferenceParameter(parameters,"x509HostnameVerifier",X509HostnameVerifier.class);
  if (x509HostnameVerifier == null) {
    x509HostnameVerifier=this.x509HostnameVerifier;
  }
  HttpClientConfigurer configurer=createHttpClientConfigurer(parameters);
  URI endpointUri=URISupport.createRemainingURI(new URI(addressUri),CastUtils.cast(httpClientParameters));
  URI httpUri=URISupport.createRemainingURI(new URI(addressUri),CastUtils.cast(parameters));
  String part=httpUri.getSchemeSpecificPart();
  if (part != null) {
    part=part.toLowerCase();
    if (part.startsWith("//http//") || part.startsWith("//https//")) {
      throw new ResolveEndpointFailedException(uri,"The uri part is not configured correctly. You have duplicated the http(s) protocol.");
    }
  }
  boolean secure=isSecureConnection(uri);
  int port=getPort(httpUri);
  registerPort(secure,x509HostnameVerifier,port);
  HttpEndpoint endpoint=new HttpEndpoint(endpointUri.toString(),this,httpUri,clientParams,clientConnectionManager,configurer);
  setProperties(endpoint,parameters);
  setEndpointHeaderFilterStrategy(endpoint);
  endpoint.setBinding(getHttpBinding());
  if (httpBinding != null) {
    endpoint.setHttpBinding(httpBinding);
  }
  if (httpClientConfigurer != null) {
    endpoint.setHttpClientConfigurer(httpClientConfigurer);
  }
  return endpoint;
}
