{
  RegistryBuilder<ConnectionSocketFactory> builder=RegistryBuilder.<ConnectionSocketFactory>create();
  builder.register("http",PlainConnectionSocketFactory.getSocketFactory());
  builder.register("http4",PlainConnectionSocketFactory.getSocketFactory());
  if (sslContextParams != null) {
    builder.register("https",new SSLConnectionSocketFactory(sslContextParams.createSSLContext(),x509HostnameVerifier));
    builder.register("https4",new SSLConnectionSocketFactory(sslContextParams.createSSLContext(),x509HostnameVerifier));
  }
 else {
    builder.register("https4",SSLConnectionSocketFactory.getSocketFactory());
    builder.register("https",SSLConnectionSocketFactory.getSocketFactory());
  }
  return builder.build();
}
