{
  if (routeId != null && exchange.getFromRouteId() == null) {
    exchange.setFromRouteId(routeId);
  }
  if (exchange.getUnitOfWork() == null) {
    final UnitOfWork uow=createUnitOfWork(exchange);
    exchange.setUnitOfWork(uow);
    try {
      uow.start();
    }
 catch (    Exception e) {
      callback.done(true);
      exchange.setException(e);
      return true;
    }
    try {
      return processor.process(exchange,new AsyncCallback(){
        public void done(        boolean doneSync){
          try {
            callback.done(doneSync);
          }
  finally {
            doneUow(uow,exchange);
          }
        }
      }
);
    }
 catch (    Throwable e) {
      LOG.warn("Caught unhandled exception while processing ExchangeId: " + exchange.getExchangeId(),e);
      exchange.setException(e);
      try {
        callback.done(true);
      }
  finally {
        doneUow(uow,exchange);
      }
      return true;
    }
  }
 else {
    return processor.process(exchange,callback);
  }
}
