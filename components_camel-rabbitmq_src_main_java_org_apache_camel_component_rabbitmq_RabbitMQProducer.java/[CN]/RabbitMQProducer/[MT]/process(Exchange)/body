{
  String exchangeName=exchange.getIn().getHeader(RabbitMQConstants.EXCHANGE_NAME,String.class);
  if (exchangeName == null || getEndpoint().isBridgeEndpoint()) {
    exchangeName=getEndpoint().getExchangeName();
  }
  String key=exchange.getIn().getHeader(RabbitMQConstants.ROUTING_KEY,null,String.class);
  if (key == null || getEndpoint().isBridgeEndpoint()) {
    key=getEndpoint().getRoutingKey() == null ? "" : getEndpoint().getRoutingKey();
  }
  if (ObjectHelper.isEmpty(key) && ObjectHelper.isEmpty(exchangeName)) {
    throw new IllegalArgumentException("ExchangeName and RoutingKey is not provided in the endpoint: " + getEndpoint());
  }
  byte[] messageBodyBytes=exchange.getIn().getMandatoryBody(byte[].class);
  AMQP.BasicProperties properties=buildProperties(exchange).build();
  Boolean mandatory=exchange.getIn().getHeader(RabbitMQConstants.MANDATORY,getEndpoint().isMandatory(),Boolean.class);
  Boolean immediate=exchange.getIn().getHeader(RabbitMQConstants.IMMEDIATE,getEndpoint().isImmediate(),Boolean.class);
  basicPublish(exchangeName,key,mandatory,immediate,properties,messageBodyBytes);
}
