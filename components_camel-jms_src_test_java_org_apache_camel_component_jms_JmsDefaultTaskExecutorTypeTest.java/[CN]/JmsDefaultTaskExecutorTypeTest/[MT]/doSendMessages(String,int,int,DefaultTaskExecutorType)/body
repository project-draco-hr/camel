{
  ExecutorService executor=Executors.newFixedThreadPool(poolSize);
  final CountDownLatch latch=new CountDownLatch(messages);
  for (int i=0; i < messages; i++) {
    final int index=i;
    executor.submit(new Callable<Object>(){
      public Object call() throws Exception {
        String options=defaultTaskExecutorType == null ? "" : "?defaultTaskExecutorType=" + defaultTaskExecutorType.toString();
        template.requestBody("activemq:queue:" + queueName + options,"Message " + index);
        latch.countDown();
        return null;
      }
    }
);
  }
  latch.await();
  executor.shutdown();
}
