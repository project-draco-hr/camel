{
  HttpContext context=conn.getContext();
  HttpVersion ver=request.getRequestLine().getHttpVersion();
  if (!ver.lessEquals(HttpVersion.HTTP_1_1)) {
    ver=HttpVersion.HTTP_1_1;
  }
  HttpResponse response=this.responseFactory.newHttpResponse(ver,HttpStatus.SC_OK,conn.getContext());
  HttpParamsLinker.link(response,this.params);
  context.setAttribute(HttpExecutionContext.HTTP_REQUEST,request);
  context.setAttribute(HttpExecutionContext.HTTP_CONNECTION,conn);
  context.setAttribute(HttpExecutionContext.HTTP_RESPONSE,response);
  try {
    this.httpProcessor.process(request,context);
    HttpRequestHandler handler=null;
    if (this.handlerResolver != null) {
      String requestURI=request.getRequestLine().getUri();
      handler=this.handlerResolver.lookup(requestURI);
    }
    if (handler != null) {
      handler.handle(request,response,context);
    }
 else {
      response.setStatusCode(HttpStatus.SC_NOT_IMPLEMENTED);
    }
  }
 catch (  HttpException ex) {
    response=this.responseFactory.newHttpResponse(HttpVersion.HTTP_1_0,HttpStatus.SC_INTERNAL_SERVER_ERROR,context);
    HttpParamsLinker.link(response,this.params);
    handleException(ex,response);
  }
  sendResponse(conn,response);
}
