{
  int code=HttpStatus.SC_INTERNAL_SERVER_ERROR;
  if (ex instanceof MethodNotSupportedException) {
    code=HttpStatus.SC_NOT_IMPLEMENTED;
  }
 else   if (ex instanceof UnsupportedHttpVersionException) {
    code=HttpStatus.SC_HTTP_VERSION_NOT_SUPPORTED;
  }
 else   if (ex instanceof ProtocolException) {
    code=HttpStatus.SC_BAD_REQUEST;
  }
  response.setStatusCode(code);
  byte[] msg=EncodingUtils.getAsciiBytes(ex.getMessage());
  ByteArrayEntity entity=new ByteArrayEntity(msg);
  entity.setContentType("text/plain; charset=US-ASCII");
  response.setEntity(entity);
}
