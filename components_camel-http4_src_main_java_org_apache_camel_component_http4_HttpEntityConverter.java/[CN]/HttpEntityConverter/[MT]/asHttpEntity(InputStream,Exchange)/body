{
  String contentEncoding=exchange.getIn().getHeader(Exchange.CONTENT_ENCODING,String.class);
  String contentType=ExchangeHelper.getContentType(exchange);
  InputStreamEntity entity=null;
  if (exchange != null && !exchange.getProperty(Exchange.SKIP_GZIP_ENCODING,Boolean.FALSE,Boolean.class)) {
    entity=new InputStreamEntity(GZIPHelper.compressGzip(contentEncoding,in),-1);
  }
 else {
    entity=new InputStreamEntity(in,-1);
  }
  entity.setContentEncoding(contentEncoding);
  entity.setContentType(contentType);
  return entity;
}
