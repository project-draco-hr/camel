{
  Exchange answer;
  if (copy) {
    answer=configureCopyExchange(exchange);
  }
 else {
    answer=configureNewExchange(exchange);
  }
  answer.setProperty(Exchange.TO_ENDPOINT,destination.getEndpointUri());
  if (newExchangeExpression != null) {
    Object body=newExchangeExpression.evaluate(answer,Object.class);
    if (body != null) {
      answer.getIn().setBody(body);
    }
  }
  if (newExchangeProcessors != null) {
    for (    Processor processor : newExchangeProcessors) {
      try {
        processor.process(answer);
      }
 catch (      Exception e) {
        throw ObjectHelper.wrapRuntimeCamelException(e);
      }
    }
  }
  Message msg=answer.hasOut() ? answer.getOut() : answer.getIn();
  if (msg.getBody() instanceof StreamCache) {
    StreamCache cache=(StreamCache)msg.getBody();
    StreamCache copied=cache.copy();
    if (copied != null) {
      msg.setBody(copied);
    }
  }
  if (onPrepare != null) {
    try {
      onPrepare.process(answer);
    }
 catch (    Exception e) {
      throw ObjectHelper.wrapRuntimeCamelException(e);
    }
  }
  return answer;
}
