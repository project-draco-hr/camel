{
  LOG.trace("onMessage START");
  if (LOG.isDebugEnabled()) {
    LOG.debug(endpoint + " consumer receiving JMS message: " + message);
  }
  RuntimeCamelException rce=null;
  try {
    Object replyDestination=getReplyToDestination(message);
    final Exchange exchange=createExchange(message,replyDestination);
    if (eagerLoadingOfProperties) {
      exchange.getIn().getHeaders();
    }
    if (LOG.isTraceEnabled()) {
      LOG.trace("onMessage.process START");
    }
    processor.process(exchange);
    if (LOG.isTraceEnabled()) {
      LOG.trace("onMessage.process END");
    }
    JmsMessage body=null;
    Exception cause=null;
    boolean sendReply=false;
    if (exchange.isFailed()) {
      if (exchange.getException() != null) {
        if (endpoint.isTransferException()) {
          body=null;
          cause=exchange.getException();
          sendReply=true;
        }
 else {
          rce=wrapRuntimeCamelException(exchange.getException());
        }
      }
 else       if (exchange.getOut().getBody() != null) {
        body=(JmsMessage)exchange.getOut();
        sendReply=true;
      }
    }
 else     if (exchange.hasOut()) {
      body=(JmsMessage)exchange.getOut();
      sendReply=true;
    }
    if (rce == null && sendReply && !disableReplyTo && exchange.getPattern().isOutCapable()) {
      LOG.trace("onMessage.sendReply START");
      if (replyDestination instanceof Destination) {
        sendReply((Destination)replyDestination,message,exchange,body,cause);
      }
 else {
        sendReply((String)replyDestination,message,exchange,body,cause);
      }
      LOG.trace("onMessage.sendReply END");
    }
  }
 catch (  Exception e) {
    rce=wrapRuntimeCamelException(e);
  }
  if (rce != null) {
    getExceptionHandler().handleException(rce);
    if (LOG.isTraceEnabled()) {
      LOG.trace("onMessage END throwing exception: " + rce.getMessage());
    }
    throw rce;
  }
  LOG.trace("onMessage END");
}
