{
  LOG.trace("onMessage.process END");
  org.apache.camel.Message body=null;
  Exception cause=null;
  RuntimeCamelException rce=null;
  if (exchange.isFailed() || exchange.isRollbackOnly()) {
    if (exchange.isRollbackOnly()) {
      rce=wrapRuntimeCamelException(new RollbackExchangeException(exchange));
    }
 else     if (exchange.getException() != null) {
      if (endpoint.isTransferException()) {
        body=null;
        cause=exchange.getException();
      }
 else {
        rce=wrapRuntimeCamelException(exchange.getException());
      }
    }
 else     if (exchange.hasOut() && exchange.getOut().isFault()) {
      body=exchange.getOut();
      cause=null;
    }
  }
 else {
    if (sendReply && exchange.getPattern().isOutCapable() && exchange.hasOut()) {
      body=exchange.getOut();
      cause=null;
    }
  }
  if (rce == null && sendReply && (body != null || cause != null)) {
    LOG.trace("onMessage.sendReply START");
    if (replyDestination instanceof Destination) {
      sendReply((Destination)replyDestination,message,exchange,body,cause);
    }
 else {
      sendReply((String)replyDestination,message,exchange,body,cause);
    }
    LOG.trace("onMessage.sendReply END");
  }
  if (rce != null) {
    if (doneSync) {
      exchange.setException(rce);
    }
 else {
      if (endpoint.getErrorHandler() != null) {
        endpoint.getErrorHandler().handleError(rce);
      }
    }
  }
}
