{
  ObjectHelper.notNull(dataFormat,"dataFormat");
  ByteArrayOutputStream buffer=new ByteArrayOutputStream();
  Message in=exchange.getIn();
  Object body=in.getBody();
  Message out=exchange.getOut();
  out.copyFrom(in);
  try {
    dataFormat.marshal(exchange,body,buffer);
    byte[] data=buffer.toByteArray();
    out.setBody(data);
  }
 catch (  Exception e) {
    exchange.setOut(null);
    throw e;
  }
}
