{
  Object correlationKey=correlationExpression.evaluate(exchange,Object.class);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Evaluated expression: " + correlationExpression + " as CorrelationKey: "+ correlationKey);
  }
  Exchange oldExchange=aggregated.get(correlationKey);
  Exchange newExchange=exchange;
  if (oldExchange != null) {
    Integer count=oldExchange.getProperty(Exchange.AGGREGATED_SIZE,Integer.class);
    if (count == null) {
      count=1;
    }
    count++;
    newExchange=aggregationStrategy.aggregate(oldExchange,newExchange);
    newExchange.setProperty(Exchange.AGGREGATED_SIZE,count);
  }
  if (!newExchange.equals(oldExchange)) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Put exchange:" + newExchange + " with coorelation key:"+ correlationKey);
    }
    if (oldExchange == null) {
      newExchange.setProperty(Exchange.AGGREGATED_SIZE,Integer.valueOf(1));
    }
    aggregated.put(correlationKey,newExchange);
  }
  onAggregation(correlationKey,newExchange);
  return true;
}
