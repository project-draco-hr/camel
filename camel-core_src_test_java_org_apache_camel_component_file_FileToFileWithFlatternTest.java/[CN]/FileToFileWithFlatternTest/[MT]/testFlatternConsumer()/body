{
  context.addRoutes(new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("file://target/flattern-in?recursive=true&flattern=true").to("file://target/flattern-out","mock:result");
    }
  }
);
  context.start();
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedMessageCount(3);
  mock.expectedFileExists("./target/flattern-out/bye.txt");
  mock.expectedFileExists("./target/flattern-out/hello.txt");
  mock.expectedFileExists("./target/flattern-out/goodday.txt");
  mock.expectedFileExists("./target/flattern-in/.camel/bye.txt");
  mock.expectedFileExists("./target/flattern-in/sub/.camel/hello.txt");
  mock.expectedFileExists("./target/flattern-in/sub/sub2/.camel/goodday.txt");
  assertMockEndpointsSatisfied();
}
