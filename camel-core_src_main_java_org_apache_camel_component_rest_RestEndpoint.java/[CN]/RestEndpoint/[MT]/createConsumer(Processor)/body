{
  RestConsumerFactory factory=null;
  String cname=null;
  if (getComponentName() != null) {
    Object comp=getCamelContext().getRegistry().lookupByName(getComponentName());
    if (comp != null && comp instanceof RestConsumerFactory) {
      factory=(RestConsumerFactory)comp;
    }
 else {
      comp=getCamelContext().getComponent(getComponentName());
      if (comp != null && comp instanceof RestConsumerFactory) {
        factory=(RestConsumerFactory)comp;
      }
    }
    if (factory == null) {
      if (comp != null) {
        throw new IllegalArgumentException("Component " + getComponentName() + " is not a RestConsumerFactory");
      }
 else {
        throw new NoSuchBeanException(getComponentName(),RestConsumerFactory.class.getName());
      }
    }
    cname=getComponentName();
  }
  if (factory == null) {
    for (    String name : getCamelContext().getComponentNames()) {
      Component comp=getCamelContext().getComponent(name);
      if (comp != null && comp instanceof RestConsumerFactory) {
        factory=(RestConsumerFactory)comp;
        cname=name;
        break;
      }
    }
  }
  if (factory == null) {
    Set<RestConsumerFactory> factories=getCamelContext().getRegistry().findByType(RestConsumerFactory.class);
    if (factories != null && factories.size() == 1) {
      factory=factories.iterator().next();
    }
  }
  if (factory == null) {
    RestConsumerFactory found=null;
    String foundName=null;
    for (    String name : DEFAULT_REST_CONSUMER_COMPONENTS) {
      Object comp=getCamelContext().getComponent(name,true);
      if (comp != null && comp instanceof RestConsumerFactory) {
        if (found == null) {
          found=(RestConsumerFactory)comp;
          foundName=name;
        }
 else {
          throw new IllegalArgumentException("Multiple RestConsumerFactory found on classpath. Configure explicit which component to use");
        }
      }
    }
    if (found != null) {
      LOG.debug("Auto discovered {} as RestConsumerFactory",foundName);
      factory=found;
    }
  }
  if (factory != null) {
    String scheme="http";
    String host="";
    int port=80;
    RestConfiguration config=getCamelContext().getRestConfiguration(cname,true);
    if (config.getScheme() != null) {
      scheme=config.getScheme();
    }
    if (config.getHost() != null) {
      host=config.getHost();
    }
    int num=config.getPort();
    if (num > 0) {
      port=num;
    }
    if (ObjectHelper.isEmpty(host)) {
      if (config.getRestHostNameResolver() == RestConfiguration.RestHostNameResolver.allLocalIp) {
        host="0.0.0.0";
      }
 else       if (config.getRestHostNameResolver() == RestConfiguration.RestHostNameResolver.localHostName) {
        host=HostUtils.getLocalHostName();
      }
 else       if (config.getRestHostNameResolver() == RestConfiguration.RestHostNameResolver.localIp) {
        host=HostUtils.getLocalIp();
      }
    }
    String path=getPath();
    if (!path.startsWith("/")) {
      path="/" + path;
    }
    String contextPath=config.getContextPath();
    if (contextPath != null) {
      if (!contextPath.startsWith("/")) {
        path="/" + contextPath + path;
      }
 else {
        path=contextPath + path;
      }
    }
    String baseUrl=scheme + "://" + host+ (port != 80 ? ":" + port : "")+ path;
    String url=baseUrl;
    if (uriTemplate != null) {
      if (uriTemplate.startsWith("/")) {
        url=url + uriTemplate;
      }
 else {
        url=url + "/" + uriTemplate;
      }
    }
    Consumer consumer=factory.createConsumer(getCamelContext(),processor,getMethod(),getPath(),getUriTemplate(),getConsumes(),getProduces(),config,getParameters());
    configureConsumer(consumer);
    getCamelContext().getRestRegistry().addRestService(consumer,url,baseUrl,getPath(),getUriTemplate(),getMethod(),getConsumes(),getProduces(),getInType(),getOutType(),getRouteId(),getDescription());
    return consumer;
  }
 else {
    throw new IllegalStateException("Cannot find RestConsumerFactory in Registry or as a Component to use");
  }
}
