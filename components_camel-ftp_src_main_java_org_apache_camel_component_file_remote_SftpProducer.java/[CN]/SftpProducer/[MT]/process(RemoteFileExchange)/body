{
  final String fileName;
  InputStream payload=exchange.getIn().getBody(InputStream.class);
  final String endpointFile=endpoint.getConfiguration().getFile();
  channel.cd(endpointFile);
  if (endpointFile == null) {
    throw new NullPointerException("Null Endpoint File");
  }
 else {
    if (endpoint.getConfiguration().isDirectory()) {
      fileName=endpointFile + "/" + exchange.getIn().getMessageId();
    }
 else {
      fileName=endpointFile;
    }
  }
  buildDirectory(channel,fileName.substring(0,fileName.lastIndexOf('/')));
  try {
    channel.put(payload,fileName);
  }
 catch (  SftpException e) {
    throw new RuntimeCamelException("error sending file",e);
  }
}
