{
  InputStream payload=exchange.getIn().getBody(InputStream.class);
  final String endpointFile=endpoint.getConfiguration().getFile();
  channel.cd(endpointFile);
  String fileName=createFileName(exchange.getIn(),endpoint.getConfiguration());
  buildDirectory(channel,fileName.substring(0,fileName.lastIndexOf('/')));
  try {
    channel.put(payload,fileName);
  }
 catch (  SftpException e) {
    throw new RuntimeCamelException("error sending file",e);
  }
}
