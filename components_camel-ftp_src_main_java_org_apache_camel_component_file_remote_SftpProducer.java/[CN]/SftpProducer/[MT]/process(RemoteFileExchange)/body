{
  InputStream payload=exchange.getIn().getBody(InputStream.class);
  String fileName=createFileName(exchange.getIn(),endpoint.getConfiguration());
  int lastPathIndex=fileName.lastIndexOf('/');
  if (lastPathIndex != -1) {
    boolean success=buildDirectory(channel,fileName.substring(0,lastPathIndex));
    if (!success) {
      LOG.warn("Couldn't buildDirectory: " + fileName.substring(0,lastPathIndex) + " (either permissions deny it, or it already exists)");
    }
  }
  channel.put(payload,fileName);
  LOG.info("Sent: " + fileName + " to "+ endpoint.getConfiguration());
}
