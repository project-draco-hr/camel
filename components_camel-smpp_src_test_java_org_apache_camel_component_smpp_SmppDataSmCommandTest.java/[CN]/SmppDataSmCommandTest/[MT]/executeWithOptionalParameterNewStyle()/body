{
  Exchange exchange=new DefaultExchange(new DefaultCamelContext(),ExchangePattern.InOut);
  exchange.getIn().setHeader(SmppConstants.COMMAND,"DataSm");
  Map<Short,Object> optionalParameters=new LinkedHashMap<Short,Object>();
  optionalParameters.put(Short.valueOf((short)0x0202),"1292".getBytes("UTF-8"));
  optionalParameters.put(Short.valueOf((short)0x001D),"urgent");
  optionalParameters.put(Short.valueOf((short)0x0005),Byte.valueOf("4"));
  optionalParameters.put(Short.valueOf((short)0x0008),Short.valueOf((short)2));
  optionalParameters.put(Short.valueOf((short)0x0017),Integer.valueOf(3600000));
  optionalParameters.put(Short.valueOf((short)0x130C),null);
  optionalParameters.put(Short.valueOf((short)0x2150),"0815".getBytes("UTF-8"));
  optionalParameters.put(Short.valueOf((short)0x2151),"0816");
  optionalParameters.put(Short.valueOf((short)0x2152),Byte.valueOf("6"));
  optionalParameters.put(Short.valueOf((short)0x2153),Short.valueOf((short)9));
  optionalParameters.put(Short.valueOf((short)0x2154),Integer.valueOf(7400000));
  optionalParameters.put(Short.valueOf((short)0x2155),null);
  exchange.getIn().setHeader(SmppConstants.OPTIONAL_PARAMETER,optionalParameters);
  expect(session.dataShortMessage(eq("CMT"),eq(TypeOfNumber.UNKNOWN),eq(NumberingPlanIndicator.UNKNOWN),eq("1616"),eq(TypeOfNumber.UNKNOWN),eq(NumberingPlanIndicator.UNKNOWN),eq("1717"),eq(new ESMClass()),eq(new RegisteredDelivery((byte)1)),eq(DataCoding.newInstance((byte)0)),eq(new OptionalParameter.OctetString(Tag.SOURCE_SUBADDRESS,"1292")),eq(new OptionalParameter.COctetString(Tag.ADDITIONAL_STATUS_INFO_TEXT.code(),"urgent")),eq(new OptionalParameter.Byte(Tag.DEST_ADDR_SUBUNIT,(byte)4)),eq(new OptionalParameter.Short(Tag.DEST_TELEMATICS_ID.code(),(short)2)),eq(new OptionalParameter.Int(Tag.QOS_TIME_TO_LIVE,3600000)),eq(new OptionalParameter.Null(Tag.ALERT_ON_MESSAGE_DELIVERY)),eq(new OptionalParameter.OctetString((short)0x2150,"1292","UTF-8")),eq(new OptionalParameter.COctetString((short)0x2151,"0816")),eq(new OptionalParameter.Byte((short)0x2152,(byte)6)),eq(new OptionalParameter.Short((short)0x2153,(short)9)),eq(new OptionalParameter.Int((short)0x2154,7400000)),eq(new OptionalParameter.Null((short)0x2155)))).andReturn(new DataSmResult(new MessageId("1"),new OptionalParameter[]{new OptionalParameter.OctetString(Tag.SOURCE_SUBADDRESS,"1292"),new OptionalParameter.COctetString(Tag.ADDITIONAL_STATUS_INFO_TEXT.code(),"urgent"),new OptionalParameter.Byte(Tag.DEST_ADDR_SUBUNIT,(byte)4),new OptionalParameter.Short(Tag.DEST_TELEMATICS_ID.code(),(short)2),new OptionalParameter.Int(Tag.QOS_TIME_TO_LIVE,3600000),new OptionalParameter.Null(Tag.ALERT_ON_MESSAGE_DELIVERY)}));
  replay(session);
  command.execute(exchange);
  verify(session);
  assertEquals(3,exchange.getOut().getHeaders().size());
  assertEquals("1",exchange.getOut().getHeader(SmppConstants.ID));
  Map<String,String> optParamMap=exchange.getOut().getHeader(SmppConstants.OPTIONAL_PARAMETERS,Map.class);
  assertEquals(6,optParamMap.size());
  assertEquals("1292",optParamMap.get("SOURCE_SUBADDRESS"));
  assertEquals("4",optParamMap.get("DEST_ADDR_SUBUNIT"));
  assertEquals("2",optParamMap.get("DEST_TELEMATICS_ID"));
  assertEquals("3600000",optParamMap.get("QOS_TIME_TO_LIVE"));
  assertNull(optParamMap.get("ALERT_ON_MESSAGE_DELIVERY"));
  Map<Short,Object> optionalResultParameter=exchange.getOut().getHeader(SmppConstants.OPTIONAL_PARAMETER,Map.class);
  assertEquals(6,optionalResultParameter.size());
  assertArrayEquals("1292".getBytes("UTF-8"),(byte[])optionalResultParameter.get(Short.valueOf((short)0x0202)));
  assertEquals(Byte.valueOf((byte)4),optionalResultParameter.get(Short.valueOf((short)0x0005)));
  assertEquals(Short.valueOf((short)2),optionalResultParameter.get(Short.valueOf((short)0x0008)));
  assertEquals(Integer.valueOf(3600000),optionalResultParameter.get(Short.valueOf((short)0x0017)));
  assertNull(optionalResultParameter.get(Short.valueOf((short)0x130C)));
}
