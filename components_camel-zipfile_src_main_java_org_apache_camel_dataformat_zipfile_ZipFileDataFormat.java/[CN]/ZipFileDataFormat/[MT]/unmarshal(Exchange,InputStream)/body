{
  if (usingIterator) {
    return new ZipIterator(exchange.getIn());
  }
 else {
    ZipInputStream zis=new ZipInputStream(inputStream);
    OutputStreamBuilder osb=OutputStreamBuilder.withExchange(exchange);
    try {
      ZipEntry entry=zis.getNextEntry();
      if (entry != null) {
        exchange.getOut().setHeader(FILE_NAME,entry.getName());
        IOHelper.copy(zis,osb);
      }
      entry=zis.getNextEntry();
      if (entry != null) {
        throw new IllegalStateException("Zip file has more than 1 entry.");
      }
      return osb.build();
    }
  finally {
      IOHelper.close(zis,osb);
    }
  }
}
