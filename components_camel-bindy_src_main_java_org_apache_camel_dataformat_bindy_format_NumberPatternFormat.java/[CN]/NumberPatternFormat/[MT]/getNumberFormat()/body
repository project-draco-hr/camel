{
  if (locale == null) {
    return null;
  }
  NumberFormat format=NumberFormat.getNumberInstance(locale);
  if (format instanceof DecimalFormat) {
    DecimalFormat df=(DecimalFormat)format;
    if (decimalSeparator != null && groupingSeparator != null) {
      if (!decimalSeparator.isEmpty() && !groupingSeparator.isEmpty()) {
        DecimalFormatSymbols dfs=new DecimalFormatSymbols(locale);
        dfs.setDecimalSeparator(decimalSeparator.charAt(0));
        dfs.setGroupingSeparator(groupingSeparator.charAt(0));
        df.setDecimalFormatSymbols(dfs);
      }
    }
    if (!pattern.isEmpty()) {
      df.applyPattern(pattern);
    }
  }
  return format;
}
