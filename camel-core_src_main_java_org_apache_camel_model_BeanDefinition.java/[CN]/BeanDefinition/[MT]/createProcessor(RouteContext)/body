{
  BeanProcessor answer;
  if (ObjectHelper.isNotEmpty(ref)) {
    RegistryBean beanHolder=new RegistryBean(routeContext.getCamelContext(),ref);
    bean=beanHolder.getBean();
    answer=new BeanProcessor(beanHolder);
  }
 else {
    if (bean == null) {
      ObjectHelper.notNull(beanType,"bean, ref or beanType",this);
      bean=CamelContextHelper.newInstance(routeContext.getCamelContext(),beanType);
    }
    ObjectHelper.notNull(bean,"bean",this);
    if (bean instanceof String) {
      throw new IllegalArgumentException("The bean instance is a java.lang.String type: " + bean + ". We suppose you want to refer to a bean instance by its id instead. Please use beanRef.");
    }
    answer=new BeanProcessor(bean,routeContext.getCamelContext());
  }
  if (method != null) {
    answer.setMethod(method);
    BeanInfo info=new BeanInfo(routeContext.getCamelContext(),bean.getClass());
    if (parameterType != null) {
      answer.setParameterType(parameterType);
      List<Class> parameterTypes=new ArrayList<Class>();
      parameterTypes.add(parameterType);
      if (!info.hasMethod(method,parameterTypes)) {
        throw ObjectHelper.wrapRuntimeCamelException(new MethodNotFoundException(null,bean,method,parameterTypes));
      }
    }
 else {
      if (!info.hasMethod(method)) {
        throw ObjectHelper.wrapRuntimeCamelException(new MethodNotFoundException(null,bean,method));
      }
    }
  }
  return answer;
}
