{
  ClassPathXmlApplicationContext serverContext=null;
  ClassPathXmlApplicationContext clientContext=null;
  try {
    serverContext=new ClassPathXmlApplicationContext(new String[]{"spring-config/server-applicationContext.xml"});
    Object server=serverContext.getBean("org.apache.camel.itest.customerrelations.CustomerServiceV1");
    assertNotNull("We should get server here",server);
    EndpointImpl.class.cast(server).getServer().getEndpoint().getInInterceptors().add(new HeaderChecker(Phase.PRE_STREAM));
    clientContext=new ClassPathXmlApplicationContext(new String[]{"spring-config/client-applicationContext.xml"});
    CustomerServiceV1 customerService=(CustomerServiceV1)clientContext.getBean("org.apache.camel.itest.customerrelations.CustomerServiceV1");
    JaxWsClientProxy.class.cast(Proxy.getInvocationHandler(customerService)).getClient().getInInterceptors().add(new HeaderChecker(Phase.PRE_STREAM));
    Customer customer=customerService.getCustomer("12345");
    assertNotNull("We should get Customer here",customer);
  }
  finally {
    if (clientContext != null) {
      clientContext.destroy();
    }
    if (serverContext != null) {
      serverContext.destroy();
    }
  }
}
