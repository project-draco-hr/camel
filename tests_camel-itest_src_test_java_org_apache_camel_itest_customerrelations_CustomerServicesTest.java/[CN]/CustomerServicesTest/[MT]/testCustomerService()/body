{
  ClassPathXmlApplicationContext serverContext=null;
  ClassPathXmlApplicationContext clientContext=null;
  try {
    serverContext=new ClassPathXmlApplicationContext(new String[]{"spring-config/server-applicationContext.xml"});
    Object server=serverContext.getBean("org.apache.camel.itest.customerrelations.CustomerServiceV1");
    assertNotNull("We should get server here",server);
    EndpointImpl.class.cast(server).getServer().getEndpoint().getInInterceptors().add(new HeaderChecker(Phase.READ));
    clientContext=new ClassPathXmlApplicationContext(new String[]{"spring-config/client-applicationContext.xml"});
    CustomerServiceV1 customerService=clientContext.getBean("org.apache.camel.itest.customerrelations.CustomerServiceV1",CustomerServiceV1.class);
    Customer customer=customerService.getCustomer("12345");
    assertNotNull("We should get Customer here",customer);
  }
  finally {
    if (clientContext != null) {
      clientContext.close();
    }
    if (serverContext != null) {
      serverContext.close();
    }
  }
}
