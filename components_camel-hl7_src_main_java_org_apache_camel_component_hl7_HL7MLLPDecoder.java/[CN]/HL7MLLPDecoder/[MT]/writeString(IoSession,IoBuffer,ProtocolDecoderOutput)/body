{
  DecoderState state=decoderState(session);
  if (state.posStart == 0) {
    LOG.warn("No start byte found, reading from beginning of data");
  }
  in.position(state.posStart);
  try {
    String body=in.getString(state.length(),charsetDecoder(session));
    LOG.debug("Decoded HL7 from byte stream of length {} to String of length {}",state.length(),body.length());
    if (config.isConvertLFtoCR()) {
      body=body.replace('\n','\r');
    }
    out.write(body);
    state.reset();
  }
 catch (  CharacterCodingException e) {
    throw new RuntimeException(e);
  }
}
