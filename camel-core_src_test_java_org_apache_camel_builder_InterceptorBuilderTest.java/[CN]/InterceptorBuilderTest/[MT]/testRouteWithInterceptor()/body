{
  CamelContext container=new DefaultCamelContext();
  final ArrayList<String> order=new ArrayList<String>();
  final DelegateProcessor interceptor1=new DelegateProcessor(){
    @Override public void process(    Exchange exchange) throws Exception {
      order.add("START:1");
      super.process(exchange);
      order.add("END:1");
    }
  }
;
  final DelegateProcessor interceptor2=new DelegateProcessor(){
    @Override public void process(    Exchange exchange) throws Exception {
      order.add("START:2");
      super.process(exchange);
      order.add("END:2");
    }
  }
;
  RouteBuilder builder=new RouteBuilder(){
    public void configure(){
      from("direct:a").intercept().add(interceptor1).add(interceptor2).target().to("direct:d");
    }
  }
;
  container.addRoutes(builder);
  container.start();
  Endpoint<Exchange> endpoint=container.getEndpoint("direct:a");
  Exchange exchange=endpoint.createExchange();
  Producer<Exchange> producer=endpoint.createProducer();
  producer.process(exchange);
  ArrayList<String> expected=new ArrayList<String>();
  expected.add("START:1");
  expected.add("START:2");
  expected.add("END:2");
  expected.add("END:1");
  log.debug("Interceptor invocation order:" + order);
  assertEquals(expected,order);
}
