{
  Message inMessage=exchange.getIn();
  WebClient client=cfb.createWebClient();
  String httpMethod=inMessage.getHeader(Exchange.HTTP_METHOD,String.class);
  Class responseClass=inMessage.getHeader(CxfConstants.CAMEL_CXF_RS_RESPONSE_CLASS,Class.class);
  String path=inMessage.getHeader(Exchange.HTTP_PATH,String.class);
  if (LOG.isTraceEnabled()) {
    LOG.trace("HTTP method = " + httpMethod);
    LOG.trace("path = " + path);
    LOG.trace("responseClass = " + responseClass);
  }
  if (path != null) {
    client.path(path);
  }
  CxfRsEndpoint cxfRsEndpoint=(CxfRsEndpoint)getEndpoint();
  Map<String,String> maps=inMessage.getHeader(CxfConstants.CAMEL_CXF_RS_QUERY_MAP,Map.class);
  if (maps == null) {
    maps=cxfRsEndpoint.getParameters();
  }
  if (maps != null) {
    for (    Map.Entry<String,String> entry : maps.entrySet()) {
      client.query(entry.getKey(),entry.getValue());
    }
  }
  CxfRsBinding binding=cxfRsEndpoint.getBinding();
  Object body=null;
  if (!"GET".equals(httpMethod)) {
    body=binding.bindCamelMessageBodyToRequestBody(inMessage,exchange);
    if (LOG.isTraceEnabled()) {
      LOG.trace("Request body = " + body);
    }
  }
  client.headers(binding.bindCamelHeadersToRequestHeaders(inMessage.getHeaders(),exchange));
  Object response=null;
  if (responseClass == null || Response.class.equals(responseClass)) {
    response=client.invoke(httpMethod,body);
  }
 else {
    response=client.invoke(httpMethod,body,responseClass);
  }
  if (exchange.getPattern().isOutCapable()) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Response body = " + response);
    }
    exchange.getOut().setBody(binding.bindResponseToCamelBody(response,exchange));
    exchange.getOut().setHeaders(binding.bindResponseHeadersToCamelHeaders(response,exchange));
  }
}
