{
  if (!configuration.isSsl()) {
    return null;
  }
  if (configuration.getSslHandler() != null) {
    return configuration.getSslHandler();
  }
 else   if (sslContext != null) {
    SSLEngine engine=sslContext.createSSLEngine();
    engine.setUseClientMode(false);
    engine.setNeedClientAuth(configuration.isNeedClientAuth());
    return new SslHandler(engine);
  }
 else {
    if (configuration.getKeyStoreFile() == null && configuration.getKeyStoreResource() == null) {
      LOG.debug("keystorefile is null");
    }
    if (configuration.getTrustStoreFile() == null && configuration.getTrustStoreResource() == null) {
      LOG.debug("truststorefile is null");
    }
    if (configuration.getPassphrase().toCharArray() == null) {
      LOG.debug("passphrase is null");
    }
    SSLEngineFactory sslEngineFactory;
    if (configuration.getKeyStoreFile() != null || configuration.getTrustStoreFile() != null) {
      sslEngineFactory=new SSLEngineFactory(configuration.getKeyStoreFormat(),configuration.getSecurityProvider(),configuration.getKeyStoreFile(),configuration.getTrustStoreFile(),configuration.getPassphrase().toCharArray());
    }
 else {
      sslEngineFactory=new SSLEngineFactory(classResolver,configuration.getKeyStoreFormat(),configuration.getSecurityProvider(),configuration.getKeyStoreResource(),configuration.getTrustStoreResource(),configuration.getPassphrase().toCharArray());
    }
    SSLEngine sslEngine=sslEngineFactory.createServerSSLEngine();
    sslEngine.setUseClientMode(false);
    sslEngine.setNeedClientAuth(configuration.isNeedClientAuth());
    return new SslHandler(sslEngine);
  }
}
