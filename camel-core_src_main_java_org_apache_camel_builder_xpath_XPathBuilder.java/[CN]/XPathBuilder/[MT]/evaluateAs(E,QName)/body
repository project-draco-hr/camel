{
  variableResolver.setExchange(exchange);
  try {
    Object document=getDocument(exchange);
    if (resultType != null) {
      if (document instanceof InputSource) {
        InputSource inputSource=(InputSource)document;
        return getExpression().evaluate(inputSource,resultType);
      }
 else {
        return getExpression().evaluate(document,resultType);
      }
    }
 else {
      if (document instanceof InputSource) {
        InputSource inputSource=(InputSource)document;
        return getExpression().evaluate(inputSource);
      }
 else {
        return getExpression().evaluate(document);
      }
    }
  }
 catch (  XPathExpressionException e) {
    throw new InvalidXPathExpression(getText(),e);
  }
catch (  XPathFactoryConfigurationException e) {
    throw new InvalidXPathExpression(getText(),e);
  }
}
