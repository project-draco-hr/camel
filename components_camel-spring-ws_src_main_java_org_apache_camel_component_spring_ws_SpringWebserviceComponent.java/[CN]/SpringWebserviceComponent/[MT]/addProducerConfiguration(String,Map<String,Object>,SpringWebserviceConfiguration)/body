{
  if (configuration.getEndpointMapping() == null && configuration.getEndpointDispatcher() == null) {
    LOG.debug("Building Spring Web Services producer");
    URI webServiceEndpointUri=new URI(UnsafeUriCharactersEncoder.encode(remaining));
    WebServiceTemplate webServiceTemplate=resolveAndRemoveReferenceParameter(parameters,"webServiceTemplate",WebServiceTemplate.class,new WebServiceTemplate());
    WebServiceMessageSender messageSender=resolveAndRemoveReferenceParameter(parameters,"messageSender",WebServiceMessageSender.class,null);
    WebServiceMessageFactory messageFactory=resolveAndRemoveReferenceParameter(parameters,"messageFactory",WebServiceMessageFactory.class,null);
    if (webServiceTemplate.getDefaultUri() == null) {
      String uri=webServiceEndpointUri.toString();
      webServiceTemplate.setDefaultUri(uri);
      configuration.setWebServiceEndpointUri(uri);
    }
    if (messageSender != null) {
      webServiceTemplate.setMessageSender(messageSender);
    }
    if (messageFactory != null) {
      webServiceTemplate.setMessageFactory(messageFactory);
    }
    configuration.setWebServiceTemplate(webServiceTemplate);
  }
}
