{
  super(endpoint,processor);
  this.endpoint=endpoint;
  try {
    Bus bus=BusFactory.getDefaultBus();
    ServerFactoryBean svrBean=null;
    if (endpoint.isSpringContextEndpoint()) {
      CxfEndpointBean endpointBean=endpoint.getCxfEndpointBean();
      svrBean=CxfEndpointUtils.getServerFactoryBean(endpointBean.getServiceClass());
      endpoint.configure(svrBean);
      CxfEndpointBean cxfEndpointBean=endpoint.getCxfEndpointBean();
      if (cxfEndpointBean.getServiceName() != null) {
        svrBean.setServiceName(cxfEndpointBean.getServiceName());
      }
      if (cxfEndpointBean.getEndpointName() != null) {
        svrBean.setEndpointName(cxfEndpointBean.getEndpointName());
      }
    }
 else {
      Class serviceClass=ClassLoaderUtils.loadClass(endpoint.getServiceClass(),this.getClass());
      svrBean=CxfEndpointUtils.getServerFactoryBean(serviceClass);
      svrBean.setAddress(endpoint.getAddress());
      svrBean.setServiceClass(serviceClass);
      if (endpoint.getServiceName() != null) {
        svrBean.setServiceName(CxfEndpointUtils.getServiceName(endpoint));
      }
      if (endpoint.getPortName() != null) {
        svrBean.setEndpointName(CxfEndpointUtils.getPortName(endpoint));
      }
      if (endpoint.getWsdlURL() != null) {
        svrBean.setWsdlURL(endpoint.getWsdlURL());
      }
    }
    DataFormat dataFormat=CxfEndpointUtils.getDataFormat(endpoint);
    if (dataFormat.equals(DataFormat.POJO)) {
      svrBean.setInvoker(new CamelInvoker(this));
    }
    svrBean.setBus(bus);
    svrBean.setStart(false);
    server=svrBean.create();
    if (!dataFormat.equals(DataFormat.POJO)) {
      CxfMessageObserver observer=new CxfMessageObserver(this,server.getEndpoint(),bus,dataFormat);
      ServerImpl serverImpl=(ServerImpl)server;
      serverImpl.setMessageObserver(observer);
    }
  }
 catch (  Exception ex) {
    ex.printStackTrace();
  }
}
