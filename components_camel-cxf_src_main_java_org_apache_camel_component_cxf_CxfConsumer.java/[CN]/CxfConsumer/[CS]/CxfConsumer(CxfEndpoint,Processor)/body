{
  super(endpoint,processor);
  this.endpoint=endpoint;
  try {
    Bus bus=BusFactory.getDefaultBus();
    Class serviceClass=ClassLoaderUtils.loadClass(endpoint.getServiceClass(),this.getClass());
    ServerFactoryBean svrBean=CxfEndpointUtils.getServerFactoryBean(serviceClass);
    svrBean.setAddress(endpoint.getAddress());
    svrBean.setServiceClass(serviceClass);
    if (endpoint.getServiceName() != null) {
      svrBean.getServiceFactory().setServiceName(CxfEndpointUtils.getServiceName(endpoint));
    }
    if (endpoint.getPortName() != null) {
      svrBean.getServiceFactory().setEndpointName(CxfEndpointUtils.getPortName(endpoint));
    }
    if (endpoint.getWsdlURL() != null) {
      svrBean.setWsdlURL(endpoint.getWsdlURL());
    }
    DataFormat dataFormat=CxfEndpointUtils.getDataFormat(endpoint);
    if (dataFormat.equals(DataFormat.POJO)) {
      svrBean.setInvoker(new CamelInvoker(this));
    }
    svrBean.setBus(bus);
    svrBean.setStart(false);
    server=svrBean.create();
    if (!dataFormat.equals(DataFormat.POJO)) {
      CxfMessageObserver observer=new CxfMessageObserver(this,server.getEndpoint(),bus,dataFormat);
      ServerImpl serverImpl=(ServerImpl)server;
      serverImpl.setMessageObserver(observer);
    }
  }
 catch (  Exception ex) {
    ex.printStackTrace();
  }
}
