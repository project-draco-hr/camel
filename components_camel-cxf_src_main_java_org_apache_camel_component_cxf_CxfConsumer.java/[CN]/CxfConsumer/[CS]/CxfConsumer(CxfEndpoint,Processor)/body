{
  super(endpoint,processor);
  Bus bus=null;
  this.endpoint=endpoint;
  boolean isWebServiceProvider=false;
  if (endpoint.getApplicationContext() != null) {
    SpringBusFactory bf=new SpringBusFactory(endpoint.getApplicationContext());
    bus=bf.createBus();
    if (CxfEndpointUtils.getSetDefaultBus(endpoint)) {
      BusFactory.setDefaultBus(bus);
    }
  }
 else {
    bus=BusFactory.getDefaultBus();
  }
  ServerFactoryBean svrBean=null;
  if (endpoint.isSpringContextEndpoint()) {
    CxfEndpointBean endpointBean=endpoint.getCxfEndpointBean();
    CxfEndpointUtils.checkServiceClass(endpointBean.getServiceClass());
    svrBean=CxfEndpointUtils.getServerFactoryBean(endpointBean.getServiceClass());
    isWebServiceProvider=CxfEndpointUtils.hasAnnotation(endpointBean.getServiceClass(),WebServiceProvider.class);
    endpoint.configure(svrBean);
  }
 else {
    CxfEndpointUtils.checkServiceClassName(endpoint.getServiceClass());
    Class serviceClass=ClassLoaderUtils.loadClass(endpoint.getServiceClass(),this.getClass());
    svrBean=CxfEndpointUtils.getServerFactoryBean(serviceClass);
    isWebServiceProvider=CxfEndpointUtils.hasAnnotation(serviceClass,WebServiceProvider.class);
    svrBean.setAddress(endpoint.getAddress());
    svrBean.setServiceClass(serviceClass);
    if (endpoint.getWsdlURL() != null) {
      svrBean.setWsdlURL(endpoint.getWsdlURL());
    }
  }
  if (CxfEndpointUtils.getServiceName(endpoint) != null) {
    svrBean.setServiceName(CxfEndpointUtils.getServiceName(endpoint));
  }
  if (CxfEndpointUtils.getServiceName(endpoint) != null) {
    svrBean.setEndpointName(CxfEndpointUtils.getPortName(endpoint));
  }
  DataFormat dataFormat=CxfEndpointUtils.getDataFormat(endpoint);
  svrBean.setInvoker(new CamelInvoker(this));
  if (!dataFormat.equals(DataFormat.POJO) && !isWebServiceProvider) {
    if (dataFormat.equals(DataFormat.PAYLOAD)) {
      svrBean.getFeatures().add(new PayLoadDataFormatFeature());
    }
 else     if (dataFormat.equals(DataFormat.MESSAGE)) {
      svrBean.getFeatures().add(new MessageDataFormatFeature());
    }
  }
  svrBean.setBus(bus);
  svrBean.setStart(false);
  server=svrBean.create();
}
