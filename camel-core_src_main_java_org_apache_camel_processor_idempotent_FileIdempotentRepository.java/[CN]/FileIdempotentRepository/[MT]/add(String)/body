{
synchronized (cache) {
    if (init.compareAndSet(false,true)) {
      loadStore();
    }
    if (cache.containsKey(messageId)) {
      return false;
    }
 else {
      cache.put(messageId,messageId);
      if (fileStore.length() < maxFileStoreSize) {
        appendToStore(messageId);
      }
 else {
        trunkStore();
      }
      return true;
    }
  }
}
