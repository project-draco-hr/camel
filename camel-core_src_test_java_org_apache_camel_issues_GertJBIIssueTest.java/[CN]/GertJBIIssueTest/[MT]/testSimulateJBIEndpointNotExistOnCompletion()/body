{
  cause=null;
  context.addRoutes(new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("direct:start").threads(2).to("mock:done").throwException(new IllegalArgumentException("Forced"));
    }
  }
);
  context.start();
  getMockEndpoint("mock:done").expectedMessageCount(1);
  final CountDownLatch latch=new CountDownLatch(1);
  template.send("direct:start",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      exchange.addOnCompletion(new SynchronizationAdapter(){
        @Override public void onDone(        Exchange exchange){
          cause=exchange.getException();
          latch.countDown();
        }
      }
);
    }
  }
);
  assertTrue(latch.await(10,TimeUnit.SECONDS));
  assertNotNull("Should have failed",cause);
  assertIsInstanceOf(IllegalArgumentException.class,cause);
  assertEquals("Forced",cause.getMessage());
}
