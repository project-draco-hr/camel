{
  if (pairs != null && pairs instanceof Closeable) {
    IOHelper.close((Closeable)pairs,"pairs",LOG);
  }
  removeAggregationStrategyFromExchange(original);
  boolean stoppedOnException=false;
  if (original.getException() != null || subExchange != null && subExchange.getException() != null) {
    stoppedOnException=isStopOnException();
    original.setProperty(Exchange.REDELIVERY_EXHAUSTED,exhaust);
  }
  if (subExchange != null) {
    if (stoppedOnException) {
      original.setException(subExchange.getException());
    }
 else {
      ExchangeHelper.copyResults(original,subExchange);
    }
  }
  callback.done(doneSync);
}
