{
  File camelMetaDir=new File(outDir,"META-INF/services/org/apache/camel/");
  StringBuilder buffer=new StringBuilder();
  boolean found=false;
  int count=0;
  for (  Resource r : project.getBuild().getResources()) {
    File f=new File(r.getDirectory());
    if (!f.exists()) {
      f=new File(project.getBasedir(),r.getDirectory());
    }
    f=new File(f,"META-INF/services/org/apache/camel/component");
    if (f.exists()) {
      File[] files=f.listFiles();
      for (      File file : files) {
        found=true;
        count++;
        String name=file.getName();
        if (buffer.length() > 0) {
          buffer.append(" ");
        }
        buffer.append(name);
      }
    }
  }
  if (found) {
    Properties properties=new Properties();
    String names=buffer.toString();
    properties.put("components",names);
    properties.put("groupId",project.getGroupId());
    properties.put("artifactId",project.getArtifactId());
    properties.put("version",project.getVersion());
    properties.put("projectName",project.getName());
    properties.put("projectDescription",project.getDescription());
    camelMetaDir.mkdirs();
    File outFile=new File(camelMetaDir,"component.properties");
    try {
      properties.store(new FileWriter(outFile),"Generated by camel-package-maven-plugin");
      getLog().info("Generated " + outFile + " containing the Camel "+ (count > 1 ? "components " : "component ")+ names);
      if (projectHelper != null) {
        List<String> includes=new ArrayList<String>();
        includes.add("**/component.properties");
        projectHelper.addResource(this.project,outDir.getPath(),includes,new ArrayList<String>());
        projectHelper.attachArtifact(this.project,"properties","camelComponent",outFile);
      }
    }
 catch (    IOException e) {
      throw new MojoExecutionException("Failed to write properties to " + outFile + ". Reason: "+ e,e);
    }
  }
 else {
    getLog().debug("No META-INF/services/org/apache/camel/component directory found. Are you sure you have created a Camel component?");
  }
}
