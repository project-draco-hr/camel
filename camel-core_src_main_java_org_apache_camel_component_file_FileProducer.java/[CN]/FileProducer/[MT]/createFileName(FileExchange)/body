{
  String fileName=exchange.getIn().getMessageId();
  File endpointFile=endpoint.getFile();
  String name=exchange.getIn().getHeader(FileComponent.HEADER_FILE_NAME,String.class);
  if (name != null) {
    File answer=new File(endpointFile,name);
    if (answer.isDirectory()) {
      return new File(answer,fileName);
    }
 else {
      return answer;
    }
  }
  if (endpointFile != null && endpointFile.isDirectory()) {
    return new File(endpointFile,fileName);
  }
 else {
    return new File(fileName);
  }
}
