{
  boolean fileSource=exchange.getIn().getBody() instanceof File;
  File target=createFileName(exchange.getIn());
  buildDirectory(target);
  if (LOG.isDebugEnabled()) {
    LOG.debug("About to write to: " + target + " from exchange: "+ exchange);
  }
  if (fileSource) {
    File source=ExchangeHelper.getMandatoryInBody(exchange,File.class);
    writeFileByFile(source,target);
  }
 else {
    InputStream in=ExchangeHelper.getMandatoryInBody(exchange,InputStream.class);
    writeFileByStream(in,target);
  }
}
