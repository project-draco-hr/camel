{
  byte[] input=(byte[])exchange.getIn().getBody(byte[].class);
  Deflater deflater=new Deflater(compressionLevel);
  deflater.setInput(input);
  deflater.finish();
  byte[] output=new byte[INITIALBYTEARRAYSIZE];
  while (!deflater.finished()) {
    int count=deflater.deflate(output);
    stream.write(output,0,count);
  }
}
