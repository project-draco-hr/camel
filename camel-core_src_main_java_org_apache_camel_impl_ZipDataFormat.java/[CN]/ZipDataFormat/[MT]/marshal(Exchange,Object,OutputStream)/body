{
  InputStream is=exchange.getContext().getTypeConverter().convertTo(InputStream.class,graph);
  DeflaterOutputStream zipOutput=new DeflaterOutputStream(stream,new Deflater(compressionLevel));
  try {
    IOHelper.copy(is,zipOutput);
  }
  finally {
    IOHelper.close(is);
    IOHelper.close(zipOutput);
  }
}
