{
  Endpoint endpoint=context.getEndpoint("direct:start");
  Exchange exchange=endpoint.createExchange();
  exchange.getIn().setBody("Hello");
  long start=System.currentTimeMillis();
  Producer producer=endpoint.createProducer();
  ExecutorService executor=Executors.newSingleThreadExecutor();
  @SuppressWarnings("deprecation") Future<Exchange> future=AsyncProcessorHelper.asyncProcess(executor,producer,exchange);
  String echo=template.requestBody("direct:echo","Hi",String.class);
  assertEquals("HiHi",echo);
  String result=template.extractFutureBody(CastUtils.cast(future),5,TimeUnit.SECONDS,String.class);
  assertMockEndpointsSatisfied();
  long delta=System.currentTimeMillis() - start;
  assertEquals("Hello World",result);
  assertTrue("Should take longer than: " + delta,delta > 250);
}
