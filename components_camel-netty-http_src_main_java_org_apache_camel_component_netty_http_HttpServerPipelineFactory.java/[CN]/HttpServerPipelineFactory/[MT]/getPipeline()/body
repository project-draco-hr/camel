{
  ChannelPipeline pipeline=Channels.pipeline();
  if (sslContext != null) {
    SSLEngine engine=sslContext.createSSLEngine();
    engine.setUseClientMode(false);
    engine.setNeedClientAuth(consumer.getConfiguration().isNeedClientAuth());
    pipeline.addLast("ssl",new SslHandler(engine));
  }
  pipeline.addLast("decoder",new HttpRequestDecoder());
  if (supportChunked()) {
    pipeline.addLast("aggregator",new HttpChunkAggregator(1048576));
  }
  pipeline.addLast("encoder",new HttpResponseEncoder());
  if (supportCompressed()) {
    pipeline.addLast("deflater",new HttpContentCompressor());
  }
  pipeline.addLast("handler",new HttpServerChannelHandler(consumer));
  return pipeline;
}
