{
  ChannelPipeline pipeline=Channels.pipeline();
  SslHandler sslHandler=configureServerSSLOnDemand();
  if (sslHandler != null) {
    sslHandler.setCloseOnSSLException(true);
    LOG.debug("Server SSL handler configured and added as an interceptor against the ChannelPipeline: {}",sslHandler);
    pipeline.addLast("ssl",sslHandler);
  }
  pipeline.addLast("decoder",new HttpRequestDecoder());
  pipeline.addLast("aggregator",new HttpChunkAggregator(configuration.getChunkedMaxContentLength()));
  pipeline.addLast("encoder",new HttpResponseEncoder());
  if (supportCompressed()) {
    pipeline.addLast("deflater",new HttpContentCompressor());
  }
  if (consumer.getConfiguration().isOrderedThreadPoolExecutor()) {
    ExecutionHandler executionHandler=new ExecutionHandler(consumer.getEndpoint().getComponent().getExecutorService());
    pipeline.addLast("executionHandler",executionHandler);
    LOG.debug("Using OrderedMemoryAwareThreadPoolExecutor with core pool size: {}",consumer.getConfiguration().getMaximumPoolSize());
  }
  int port=consumer.getConfiguration().getPort();
  ChannelHandler handler=consumer.getEndpoint().getComponent().getMultiplexChannelHandler(port).getChannelHandler();
  pipeline.addLast("handler",handler);
  return pipeline;
}
