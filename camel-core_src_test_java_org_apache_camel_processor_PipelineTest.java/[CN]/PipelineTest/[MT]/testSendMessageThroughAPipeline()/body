{
  resultEndpoint.expectedBodiesReceived(4);
  Exchange results=template.request("direct:a",new Processor(){
    public void process(    Exchange exchange){
      Message in=exchange.getIn();
      in.setBody(1);
      in.setHeader("foo","bar");
    }
  }
);
  resultEndpoint.assertIsSatisfied();
  assertEquals("Result body",4,results.getOut().getBody());
}
