{
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedMessageCount(1);
  mock.setAssertPeriod(2000);
  template.sendBody("direct:a","A");
  ExecutorService executor=Executors.newSingleThreadExecutor();
  executor.execute(new Runnable(){
    public void run(){
      try {
        Thread.sleep(1000);
      }
 catch (      Exception e) {
      }
      if (isStarted(template)) {
        template.sendBody("direct:a","B");
      }
    }
  }
);
  try {
    mock.assertIsSatisfied();
    fail("Should have thrown an exception");
  }
 catch (  AssertionError e) {
    assertEquals("mock://result Received message count. Expected: <1> but was: <2>",e.getMessage());
  }
  executor.shutdownNow();
}
