{
  if (session == null) {
    if (this.configuration.isLazySessionCreation()) {
      if (connectLock.tryLock()) {
        try {
          if (session == null) {
            Message in=exchange.getIn();
            String systemId=in.getHeader(SmppConstants.SYSTEM_ID,String.class);
            String password=in.getHeader(SmppConstants.PASSWORD,String.class);
            if (systemId != null && password != null) {
              log.info("using the system id '{}' to connect to the SMSC...",systemId);
              this.configuration.setSystemId(systemId);
              this.configuration.setPassword(password);
            }
            session=createSession();
          }
        }
  finally {
          connectLock.unlock();
        }
      }
    }
  }
  if (this.session == null) {
    throw new IOException("Lost connection to " + getEndpoint().getConnectionString() + " and yet not reconnected");
  }
  SmppCommand command=getEndpoint().getBinding().createSmppCommand(session,exchange);
  command.execute(exchange);
}
