{
  if (path == null) {
    return null;
  }
  if (path.indexOf("..") == -1) {
    return path;
  }
  if (path.indexOf(File.separator) == -1) {
    return path;
  }
  Stack<String> stack=new Stack<String>();
  String separatorRegex=File.separator;
  if (FileUtil.isWindows()) {
    separatorRegex="////";
  }
  String[] parts=path.split(separatorRegex);
  for (  String part : parts) {
    if (part.equals("..") && !stack.isEmpty()) {
      stack.pop();
    }
 else {
      stack.push(part);
    }
  }
  StringBuilder sb=new StringBuilder();
  for (Iterator it=stack.iterator(); it.hasNext(); ) {
    sb.append(it.next());
    if (it.hasNext()) {
      sb.append(File.separator);
    }
  }
  return sb.toString();
}
