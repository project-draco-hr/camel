{
  if (defaultTempDir != null && defaultTempDir.exists()) {
    return defaultTempDir;
  }
  String s=System.getProperty("java.io.tmpdir");
  File checkExists=new File(s);
  if (!checkExists.exists()) {
    throw new RuntimeException("The directory " + checkExists.getAbsolutePath() + " does not exist, please set java.io.tempdir"+ " to an existing directory");
  }
  Random ran=new Random();
  int x=ran.nextInt(1000000);
  File f=new File(s,"camel-tmp-" + x);
  while (!f.mkdir()) {
    x=ran.nextInt(1000000);
    f=new File(s,"camel-tmp-" + x);
  }
  defaultTempDir=f;
  Thread hook=new Thread(){
    @Override public void run(){
      removeDir(defaultTempDir);
    }
  }
;
  Runtime.getRuntime().addShutdownHook(hook);
  return defaultTempDir;
}
