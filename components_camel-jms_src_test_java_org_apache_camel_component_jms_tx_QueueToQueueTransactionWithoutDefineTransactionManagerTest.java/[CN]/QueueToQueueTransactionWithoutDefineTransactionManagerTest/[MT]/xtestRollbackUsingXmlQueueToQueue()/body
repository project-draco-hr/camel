{
  context.addRoutes(new SpringRouteBuilder(){
    @Override public void configure() throws Exception {
      errorHandler(noErrorHandler());
      from("activemq:queue:foo?transacted=true").process(new ConditionalExceptionProcessor()).to("activemq:queue:bar?transacted=true");
      from("activemq:queue:bar?transacted=true").to("mock:endpoint");
    }
  }
);
  MockEndpoint endpoint=(MockEndpoint)context.getEndpoint("mock:endpoint");
  endpoint.expectedMessageCount(1);
  endpoint.expectedBodiesReceived("blah");
  assertResult();
  endpoint.assertIsSatisfied();
}
