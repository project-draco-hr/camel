{
  Session session=openSession();
  try {
    Node base=findOrCreateNode(session.getRootNode(),getJcrEndpoint().getBase());
    Node node=findOrCreateNode(base,getNodeName(exchange));
    TypeConverter converter=exchange.getContext().getTypeConverter();
    for (    String key : exchange.getProperties().keySet()) {
      Value value=converter.convertTo(Value.class,exchange,exchange.getProperty(key));
      node.setProperty(key,value);
    }
    node.addMixin("mix:referenceable");
    session.save();
    exchange.getOut().setBody(node.getUUID());
  }
  finally {
    if (session != null && session.isLive()) {
      session.logout();
    }
  }
}
