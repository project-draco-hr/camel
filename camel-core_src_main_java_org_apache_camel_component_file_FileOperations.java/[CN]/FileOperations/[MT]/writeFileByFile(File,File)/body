{
  FileChannel in=new FileInputStream(source).getChannel();
  FileChannel out=null;
  try {
    out=prepareOutputFileChannel(target,out);
    LOG.debug("Using FileChannel to write file: {}",target);
    long size=in.size();
    long position=0;
    while (position < size) {
      position+=in.transferTo(position,endpoint.getBufferSize(),out);
    }
  }
  finally {
    IOHelper.close(in,source.getName(),LOG);
    IOHelper.force(out,target.getName(),LOG);
    IOHelper.close(out,target.getName(),LOG);
  }
}
