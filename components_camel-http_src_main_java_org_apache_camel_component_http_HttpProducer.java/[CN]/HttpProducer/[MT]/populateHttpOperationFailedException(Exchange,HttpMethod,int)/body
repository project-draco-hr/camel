{
  HttpOperationFailedException exception;
  Header[] headers=method.getResponseHeaders();
  InputStream is=extractResponseBody(method,exchange);
  if (responseCode >= 300 && responseCode < 400) {
    String redirectLocation;
    Header locationHeader=method.getResponseHeader("location");
    if (locationHeader != null) {
      redirectLocation=locationHeader.getValue();
      exception=new HttpOperationFailedException(responseCode,method.getStatusLine(),redirectLocation,headers,is);
    }
 else {
      exception=new HttpOperationFailedException(responseCode,method.getStatusLine(),headers,is);
    }
  }
 else {
    exception=new HttpOperationFailedException(responseCode,method.getStatusLine(),headers,is);
  }
  return exception;
}
