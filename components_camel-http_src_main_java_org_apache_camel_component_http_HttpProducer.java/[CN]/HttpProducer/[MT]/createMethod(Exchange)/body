{
  String uri=((HttpEndpoint)getEndpoint()).getHttpUri().toString();
  RequestEntity requestEntity=createRequestEntity(exchange);
  Object m=exchange.getIn().getHeader(HTTP_METHOD);
  HttpMethods ms=requestEntity == null ? HttpMethods.GET : HttpMethods.POST;
  ms=m instanceof HttpMethods ? (HttpMethods)m : m == null ? ms : HttpMethods.valueOf(m.toString());
  HttpMethod method=ms.createMethod(uri);
  if (exchange.getIn().getHeader(QUERY) != null) {
    method.setQueryString(exchange.getIn().getHeader(QUERY,String.class));
  }
  if (ms.isEntityEnclosing()) {
    ((EntityEnclosingMethod)method).setRequestEntity(requestEntity);
  }
  return method;
}
