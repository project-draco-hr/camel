{
  InputStreamPayload payload=new InputStreamPayload(is);
  if (is.markSupported()) {
    long contentLength=ByteStreams.length(new InputSupplier<InputStream>(){
      @Override public InputStream getInput() throws IOException {
        return is;
      }
    }
);
    is.reset();
    payload.getContentMetadata().setContentLength(contentLength);
  }
  return payload;
}
