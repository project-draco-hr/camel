{
  BeanHolder holder;
  if (bean == null) {
    holder=new RegistryBean(exchange.getContext(),beanName);
  }
 else {
    holder=new ConstantBeanHolder(bean,exchange.getContext());
  }
  BeanProcessor processor=new BeanProcessor(holder);
  if (method != null) {
    processor.setMethod(method);
  }
  try {
    Exchange newExchange=exchange.copy();
    if (!newExchange.getPattern().isOutCapable()) {
      newExchange.setPattern(ExchangePattern.InOut);
    }
    processor.process(newExchange);
    return newExchange.getOut(true).getBody();
  }
 catch (  Exception e) {
    throw new RuntimeBeanExpressionException(exchange,beanName,method,e);
  }
}
