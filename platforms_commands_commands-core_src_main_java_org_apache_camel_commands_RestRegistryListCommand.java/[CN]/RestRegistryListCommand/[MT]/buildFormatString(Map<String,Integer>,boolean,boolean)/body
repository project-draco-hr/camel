{
  final String fieldPreamble;
  final String fieldPostamble;
  final int columnWidthIncrement;
  if (isHeader) {
    fieldPreamble=DEFAULT_HEADER_PREAMBLE;
    fieldPostamble=DEFAULT_HEADER_POSTAMBLE;
  }
 else {
    fieldPreamble=DEFAULT_FIELD_PREAMBLE;
    fieldPostamble=DEFAULT_FIELD_POSTAMBLE;
  }
  columnWidthIncrement=DEFAULT_COLUMN_WIDTH_INCREMENT;
  int contextLen=Math.min(columnWidths.get(CONTEXT_COLUMN_LABEL) + columnWidthIncrement,getMaxColumnWidth());
  int uriLen=Math.min(columnWidths.get(URL_COLUMN_NAME) + columnWidthIncrement,getMaxColumnWidth());
  int basePathLen=Math.min(columnWidths.get(BASE_PATH_LABEL) + columnWidthIncrement,getMaxColumnWidth());
  int uriTemplateLen=Math.min(columnWidths.get(URI_TEMPLATE_LABEL) + columnWidthIncrement,getMaxColumnWidth());
  int methodLen=Math.min(columnWidths.get(METHOD_COLUMN_LABEL) + columnWidthIncrement,getMaxColumnWidth());
  int statusLen=Math.min(columnWidths.get(STATE_COLUMN_LABEL) + columnWidthIncrement,getMaxColumnWidth());
  int routeLen=Math.min(columnWidths.get(ROUTE_COLUMN_LABEL) + columnWidthIncrement,getMaxColumnWidth());
  contextLen=Math.max(MIN_COLUMN_WIDTH,contextLen);
  basePathLen=Math.max(MIN_COLUMN_WIDTH,basePathLen);
  uriLen=Math.max(MIN_COLUMN_WIDTH,uriLen);
  uriTemplateLen=Math.max(MIN_COLUMN_WIDTH,uriTemplateLen);
  methodLen=Math.max(MIN_COLUMN_WIDTH,methodLen);
  routeLen=Math.max(MIN_COLUMN_WIDTH,routeLen);
  final StringBuilder retval=new StringBuilder(DEFAULT_FORMAT_BUFFER_LENGTH);
  retval.append(fieldPreamble).append("%-").append(contextLen).append('.').append(contextLen).append('s').append(fieldPostamble).append(' ');
  if (isVerbose) {
    retval.append(fieldPreamble).append("%-").append(uriLen).append('.').append(uriLen).append('s').append(fieldPostamble).append(' ');
  }
  retval.append(fieldPreamble).append("%-").append(basePathLen).append('.').append(basePathLen).append('s').append(fieldPostamble).append(' ');
  retval.append(fieldPreamble).append("%-").append(uriTemplateLen).append('.').append(uriTemplateLen).append('s').append(fieldPostamble).append(' ');
  retval.append(fieldPreamble).append("%-").append(methodLen).append('.').append(methodLen).append('s').append(fieldPostamble).append(' ');
  retval.append(fieldPreamble).append("%-").append(statusLen).append('.').append(statusLen).append('s').append(fieldPostamble).append(' ');
  retval.append(fieldPreamble).append("%-").append(routeLen).append('.').append(routeLen).append('s').append(fieldPostamble).append(' ');
  return retval.toString();
}
