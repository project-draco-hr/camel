{
  List<T> list=template.find(getFindByKeyQuery(),key);
  T entity=null;
  if (!list.isEmpty()) {
    entity=list.get(0);
  }
  if (entity == null) {
    entity=createEntity(exchange,key);
    setKeyProperty(entity,key);
    ProcessDefinition definition=ProcessDefinition.getRefreshedProcessDefinition(template,getActivityRules().getProcessRules().getProcessDefinition());
    setProcessDefinitionProperty(entity,definition);
    template.persist(entity);
  }
  return entity;
}
