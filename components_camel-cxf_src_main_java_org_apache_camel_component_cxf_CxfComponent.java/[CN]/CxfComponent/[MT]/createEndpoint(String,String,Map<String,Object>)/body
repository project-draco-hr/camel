{
  CxfEndpoint result;
  Object value=parameters.remove("setDefaultBus");
  if (value != null) {
    LOG.warn("The option setDefaultBus is @deprecated, use name defaultBus instead");
    if (!parameters.containsKey("defaultBus")) {
      parameters.put("defaultBus",value);
    }
  }
  if (allowStreaming != null && !parameters.containsKey("allowStreaming")) {
    parameters.put("allowStreaming",Boolean.toString(allowStreaming));
  }
  if (remaining.startsWith(CxfConstants.SPRING_CONTEXT_ENDPOINT)) {
    String beanId=remaining.substring(CxfConstants.SPRING_CONTEXT_ENDPOINT.length());
    if (beanId.startsWith("//")) {
      beanId=beanId.substring(2);
    }
    result=createCxfSpringEndpoint(beanId);
    if (getCamelContext().equals(result.getCamelContext())) {
      result.setCamelContext(getCamelContext());
    }
    result.setBeanId(beanId);
  }
 else {
    result=createCxfEndpoint(remaining);
  }
  if (result.getCamelContext() == null) {
    result.setCamelContext(getCamelContext());
  }
  setEndpointHeaderFilterStrategy(result);
  setProperties(result,parameters);
  Map<String,Object> properties=IntrospectionSupport.extractProperties(parameters,"properties.");
  if (properties != null) {
    result.setProperties(properties);
  }
  if (result.getProperties() != null) {
    result.setMtomEnabled(Boolean.valueOf((String)result.getProperties().get(Message.MTOM_ENABLED)));
  }
  return result;
}
