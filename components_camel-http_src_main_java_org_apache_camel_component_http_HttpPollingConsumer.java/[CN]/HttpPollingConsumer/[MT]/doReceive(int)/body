{
  Exchange exchange=endpoint.createExchange();
  HttpMethod method=createMethod();
  if (timeout > 0) {
    method.getParams().setSoTimeout(timeout);
  }
  try {
    int responseCode=httpClient.executeMethod(method);
    LoadingByteArrayOutputStream bos=new LoadingByteArrayOutputStream();
    InputStream is=method.getResponseBodyAsStream();
    try {
      IOHelper.copy(is,bos);
      bos.flush();
    }
  finally {
      IOHelper.close(is,"input stream",null);
    }
    Message message=exchange.getIn();
    message.setBody(bos.createInputStream());
    Header[] headers=method.getResponseHeaders();
    HeaderFilterStrategy strategy=endpoint.getHeaderFilterStrategy();
    for (    Header header : headers) {
      String name=header.getName();
      String value=header.getValue();
      if (strategy != null && !strategy.applyFilterToExternalHeaders(name,value,exchange)) {
        message.setHeader(name,value);
      }
    }
    message.setHeader(Exchange.HTTP_RESPONSE_CODE,responseCode);
    return exchange;
  }
 catch (  IOException e) {
    throw new RuntimeCamelException(e);
  }
 finally {
    method.releaseConnection();
  }
}
