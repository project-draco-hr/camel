{
  port=AvailablePortFinder.getNextAvailable(16331);
  String uri="websocket://localhost:" + port + "/bar?bufferSize=65000&maxIdleTime=3000";
  WebsocketEndpoint websocketEndpoint=(WebsocketEndpoint)context.getEndpoint(uri);
  WebsocketComponent component=websocketEndpoint.getComponent();
  Consumer consumer=websocketEndpoint.createConsumer(processor);
  component.connect((WebsocketProducerConsumer)consumer);
  assertNotNull(consumer);
  assertEquals(WebsocketConsumer.class,consumer.getClass());
  ConnectorRef conector=WebsocketComponent.getConnectors().values().iterator().next();
  ServletContextHandler context=(ServletContextHandler)conector.server.getHandler();
  String buffersize=context.getInitParameter("bufferSize");
  assertEquals("Get a wrong buffersize","65000",buffersize);
  String maxIdleTime=context.getInitParameter("maxIdleTime");
  assertEquals("Get a worng maxIdleTime","3000",maxIdleTime);
}
