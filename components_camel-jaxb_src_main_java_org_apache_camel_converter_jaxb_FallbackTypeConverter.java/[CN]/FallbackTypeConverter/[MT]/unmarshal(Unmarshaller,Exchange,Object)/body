{
  try {
    XMLStreamReader xmlReader=null;
    if (value instanceof XMLStreamReader) {
      xmlReader=(XMLStreamReader)value;
    }
 else     if (value instanceof InputStream) {
      if (needFiltering(exchange)) {
        xmlReader=staxConverter.createXMLStreamReader(new NonXmlFilterReader(new InputStreamReader((InputStream)value,IOHelper.getCharsetName(exchange))));
      }
 else {
        xmlReader=staxConverter.createXMLStreamReader((InputStream)value,exchange);
      }
    }
 else     if (value instanceof Reader) {
      Reader reader=(Reader)value;
      if (needFiltering(exchange)) {
        if (!(value instanceof NonXmlFilterReader)) {
          reader=new NonXmlFilterReader((Reader)value);
        }
      }
      xmlReader=staxConverter.createXMLStreamReader(reader);
    }
 else     if (value instanceof Source) {
      xmlReader=staxConverter.createXMLStreamReader((Source)value);
    }
 else {
      throw new IllegalArgumentException("Cannot convert from " + value.getClass());
    }
    return unmarshaller.unmarshal(xmlReader);
  }
  finally {
    if (value instanceof Closeable) {
      IOHelper.close((Closeable)value,"Unmarshalling",LOG);
    }
  }
}
