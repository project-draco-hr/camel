{
  AnnotatedElement ae=hasXmlRootElement(type) ? type : type.getPackage();
  JAXBContext context=contexts.get(ae);
  if (context == null) {
    if (hasXmlRootElement(type)) {
      context=JAXBContext.newInstance(type);
      contexts.put(type,context);
    }
 else {
      context=JAXBContext.newInstance(type.getPackage().getName());
      contexts.put(type.getPackage(),context);
    }
  }
  return context;
}
