{
  Trigger result;
  Date startTime=new Date();
  if (getComponent().getScheduler().isStarted()) {
    startTime=new Date(System.currentTimeMillis() + triggerStartDelay);
  }
  if (cron != null) {
    LOG.debug("Creating CronTrigger: {}",cron);
    String timeZone=(String)triggerParameters.get("timeZone");
    if (timeZone != null) {
      result=TriggerBuilder.newTrigger().withIdentity(triggerKey).startAt(startTime).withSchedule(cronSchedule(cron).withMisfireHandlingInstructionFireAndProceed().inTimeZone(TimeZone.getTimeZone(timeZone))).build();
      jobDetail.getJobDataMap().put(QuartzConstants.QUARTZ_TRIGGER_CRON_TIMEZONE,timeZone);
    }
 else {
      result=TriggerBuilder.newTrigger().withIdentity(triggerKey).startAt(startTime).withSchedule(cronSchedule(cron).withMisfireHandlingInstructionFireAndProceed()).build();
    }
    jobDetail.getJobDataMap().put(QuartzConstants.QUARTZ_TRIGGER_TYPE,"cron");
    jobDetail.getJobDataMap().put(QuartzConstants.QUARTZ_TRIGGER_CRON_EXPRESSION,cron);
  }
 else {
    LOG.debug("Creating SimpleTrigger.");
    int repeat=SimpleTrigger.REPEAT_INDEFINITELY;
    String repeatString=(String)triggerParameters.get("repeatCount");
    if (repeatString != null) {
      repeat=EndpointHelper.resloveStringParameter(getCamelContext(),repeatString,Integer.class);
      triggerParameters.put("repeatCount",repeat);
    }
    long interval=1000;
    String intervalString=(String)triggerParameters.get("repeatInterval");
    if (intervalString != null) {
      interval=EndpointHelper.resloveStringParameter(getCamelContext(),intervalString,Long.class);
      triggerParameters.put("repeatInterval",interval);
    }
    TriggerBuilder<SimpleTrigger> triggerBuilder=TriggerBuilder.newTrigger().withIdentity(triggerKey).startAt(startTime).withSchedule(simpleSchedule().withMisfireHandlingInstructionFireNow().withRepeatCount(repeat).withIntervalInMilliseconds(interval));
    if (fireNow) {
      triggerBuilder=triggerBuilder.startNow();
    }
    result=triggerBuilder.build();
    jobDetail.getJobDataMap().put(QuartzConstants.QUARTZ_TRIGGER_TYPE,"simple");
    jobDetail.getJobDataMap().put(QuartzConstants.QUARTZ_TRIGGER_SIMPLE_REPEAT_COUNTER,repeat);
    jobDetail.getJobDataMap().put(QuartzConstants.QUARTZ_TRIGGER_SIMPLE_REPEAT_INTERVAL,interval);
  }
  if (triggerParameters != null && triggerParameters.size() > 0) {
    LOG.debug("Setting user extra triggerParameters {}",triggerParameters);
    setProperties(result,triggerParameters);
  }
  LOG.debug("Created trigger={}",result);
  return result;
}
