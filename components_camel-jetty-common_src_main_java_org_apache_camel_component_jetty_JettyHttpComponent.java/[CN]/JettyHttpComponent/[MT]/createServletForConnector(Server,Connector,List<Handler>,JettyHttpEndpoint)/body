{
  ServletContextHandler context=new ServletContextHandler(server,"/",ServletContextHandler.NO_SECURITY | ServletContextHandler.NO_SESSIONS);
  if (Server.getVersion().startsWith("8")) {
    context.getClass().getMethod("setConnectorNames",new Class[]{String[].class}).invoke(context,new Object[]{new String[]{connector.getName()}});
  }
  addJettyHandlers(server,handlers);
  CamelServlet camelServlet;
  boolean jetty=endpoint.getUseContinuation() != null ? endpoint.getUseContinuation() : isUseContinuation();
  if (jetty) {
    CamelContinuationServlet jettyServlet=new CamelContinuationServlet();
    Long timeout=endpoint.getContinuationTimeout() != null ? endpoint.getContinuationTimeout() : getContinuationTimeout();
    if (timeout != null) {
      LOG.info("Using Jetty continuation timeout: " + timeout + " millis for: "+ endpoint);
      jettyServlet.setContinuationTimeout(timeout);
    }
 else {
      LOG.info("Using default Jetty continuation timeout for: " + endpoint);
    }
    camelServlet=jettyServlet;
  }
 else {
    camelServlet=new CamelServlet();
    LOG.info("Jetty continuation is disabled for: " + endpoint);
  }
  ServletHolder holder=new ServletHolder();
  holder.setServlet(camelServlet);
  context.addServlet(holder,"/*");
  camelServlet.setServletResolveConsumerStrategy(new JettyRestServletResolveConsumerStrategy());
  return camelServlet;
}
