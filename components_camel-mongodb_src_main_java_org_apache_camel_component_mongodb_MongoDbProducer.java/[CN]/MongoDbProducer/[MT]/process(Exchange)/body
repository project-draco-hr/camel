{
  MongoDbOperation operation=endpoint.getOperation();
  Object header=exchange.getIn().getHeader(MongoDbConstants.OPERATION_HEADER);
  if (header != null) {
    LOG.debug("Overriding default operation with operation specified on header: {}",header);
    try {
      if (header instanceof MongoDbOperation) {
        operation=ObjectHelper.cast(MongoDbOperation.class,header);
      }
 else {
        operation=MongoDbOperation.valueOf(exchange.getIn().getHeader(MongoDbConstants.OPERATION_HEADER,String.class));
      }
    }
 catch (    Exception e) {
      LOG.error("Operation not supported: {}",header);
      exchange.setException(new CamelMongoDbException("Operation specified on header is not supported. Value: " + header,e));
      return;
    }
  }
  try {
    invokeOperation(operation,exchange);
  }
 catch (  Exception e) {
    CamelMongoDbException partEx=MongoDbComponent.wrapInCamelMongoDbException(e);
    LOG.error("Breaking MongoDB operation due to exception",partEx);
    exchange.setException(partEx);
  }
}
