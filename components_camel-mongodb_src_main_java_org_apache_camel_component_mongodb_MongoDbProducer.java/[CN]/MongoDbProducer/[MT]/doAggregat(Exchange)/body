{
  DBCollection dbCol=calculateCollection(exchange);
  DBObject query=exchange.getIn().getMandatoryBody(DBObject.class);
  Iterable<DBObject> dbIterator=null;
  try {
    AggregationOutput agregationResult=null;
    if (query instanceof BasicDBList) {
      BasicDBList queryList=(BasicDBList)query;
      agregationResult=dbCol.aggregate((DBObject)queryList.get(0),(BasicDBObject[])queryList.subList(1,queryList.size()).toArray(new BasicDBObject[queryList.size() - 1]));
    }
 else {
      agregationResult=dbCol.aggregate(query);
    }
    dbIterator=agregationResult.results();
    Message resultMessage=prepareResponseMessage(exchange,MongoDbOperation.aggregat);
    resultMessage.setBody(dbIterator);
  }
 catch (  Exception e) {
    throw e;
  }
}
