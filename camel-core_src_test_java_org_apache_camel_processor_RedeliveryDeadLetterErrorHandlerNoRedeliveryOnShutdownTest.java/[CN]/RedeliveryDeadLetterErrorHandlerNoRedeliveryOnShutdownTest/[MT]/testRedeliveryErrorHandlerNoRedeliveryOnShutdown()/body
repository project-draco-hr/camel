{
  getMockEndpoint("mock:foo").expectedMessageCount(1);
  getMockEndpoint("mock:deadLetter").expectedMessageCount(1);
  getMockEndpoint("mock:deadLetter").setResultWaitTime(25000);
  template.sendBody("seda:foo","Hello World");
  getMockEndpoint("mock:foo").assertIsSatisfied();
  StopWatch watch=new StopWatch();
  Thread.sleep(3000);
  log.info("==== stopping route foo ====");
  context.stopRoute("foo");
  watch.stop();
  getMockEndpoint("mock:deadLetter").assertIsSatisfied();
  log.info("OnRedelivery processor counter {}",counter.get());
  assertTrue("Should stop route faster, was " + watch.taken(),watch.taken() < 7000);
  assertTrue("Redelivery counter should be >= 2 and < 12, was: " + counter.get(),counter.get() >= 2 && counter.get() < 12);
}
