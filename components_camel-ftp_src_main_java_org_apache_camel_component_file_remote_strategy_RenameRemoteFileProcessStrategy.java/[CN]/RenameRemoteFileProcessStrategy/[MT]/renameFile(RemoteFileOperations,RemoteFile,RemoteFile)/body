{
  boolean deleted=operations.deleteFile(to.getAbsolutelFileName());
  if (!deleted) {
    String name=to.getAbsolutelFileName();
    int lastPathIndex=name.lastIndexOf('/');
    if (lastPathIndex != -1) {
      String directory=name.substring(0,lastPathIndex);
      if (!operations.buildDirectory(directory)) {
        LOG.warn("Cannot build directory: " + directory + " (maybe because of denied permissions)");
      }
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Renaming file: " + from + " to: "+ to);
  }
  boolean renamed=operations.renameFile(from.getAbsolutelFileName(),to.getAbsolutelFileName());
  if (!renamed) {
    throw new RemoteFileOperationFailedException("Cannot rename file: " + from + " to: "+ to);
  }
  return to;
}
