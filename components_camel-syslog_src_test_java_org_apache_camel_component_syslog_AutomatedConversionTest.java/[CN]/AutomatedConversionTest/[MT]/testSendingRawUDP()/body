{
  MockEndpoint mock=getMockEndpoint("mock:syslogReceiver");
  MockEndpoint mock2=getMockEndpoint("mock:syslogReceiver2");
  mock.expectedMessageCount(2);
  mock2.expectedMessageCount(2);
  mock2.expectedBodiesReceived(rfc3164Message,rfc5424Message);
  DatagramSocket socket=new DatagramSocket();
  try {
    InetAddress address=InetAddress.getByName("127.0.0.1");
    for (int i=0; i < messageCount; i++) {
      byte[] data=rfc3164Message.getBytes();
      DatagramPacket packet=new DatagramPacket(data,data.length,address,serverPort);
      socket.send(packet);
      Thread.sleep(100);
    }
    for (int i=0; i < messageCount; i++) {
      byte[] data=rfc5424Message.getBytes();
      DatagramPacket packet=new DatagramPacket(data,data.length,address,serverPort);
      socket.send(packet);
      Thread.sleep(100);
    }
  }
  finally {
    socket.close();
  }
  assertMockEndpointsSatisfied();
}
