{
  SmppMessage smppMessage=new SmppMessage(deliverSm,configuration);
  if (deliverSm.isSmscDeliveryReceipt()) {
    smppMessage.setHeader(MESSAGE_TYPE,SmppMessageType.DeliveryReceipt.toString());
    DeliveryReceipt smscDeliveryReceipt=deliverSm.getShortMessageAsDeliveryReceipt();
    smppMessage.setBody(smscDeliveryReceipt.getText());
    smppMessage.setHeader(ID,smscDeliveryReceipt.getId());
    smppMessage.setHeader(DELIVERED,smscDeliveryReceipt.getDelivered());
    smppMessage.setHeader(DONE_DATE,smscDeliveryReceipt.getDoneDate());
    if (!"000".equals(smscDeliveryReceipt.getError())) {
      smppMessage.setHeader(ERROR,smscDeliveryReceipt.getError());
    }
    smppMessage.setHeader(SUBMIT_DATE,smscDeliveryReceipt.getSubmitDate());
    smppMessage.setHeader(SUBMITTED,smscDeliveryReceipt.getSubmitted());
    smppMessage.setHeader(FINAL_STATUS,smscDeliveryReceipt.getFinalStatus());
  }
 else {
    smppMessage.setHeader(MESSAGE_TYPE,SmppMessageType.DeliverSm.toString());
    if (deliverSm.getShortMessage() != null) {
      smppMessage.setBody(String.valueOf(new String(deliverSm.getShortMessage(),configuration.getEncoding())));
    }
 else     if (deliverSm.getOptionalParametes() != null && deliverSm.getOptionalParametes().length > 0) {
      List<OptionalParameter> oplist=Arrays.asList(deliverSm.getOptionalParametes());
      for (      OptionalParameter optPara : oplist) {
        if (OptionalParameter.Tag.MESSAGE_PAYLOAD.code() == optPara.tag && OctetString.class.isInstance(optPara)) {
          smppMessage.setBody(((OctetString)optPara).getValueAsString());
          break;
        }
      }
    }
    smppMessage.setHeader(SEQUENCE_NUMBER,deliverSm.getSequenceNumber());
    smppMessage.setHeader(COMMAND_ID,deliverSm.getCommandId());
    smppMessage.setHeader(SOURCE_ADDR,deliverSm.getSourceAddr());
    smppMessage.setHeader(DEST_ADDR,deliverSm.getDestAddress());
    smppMessage.setHeader(SCHEDULE_DELIVERY_TIME,deliverSm.getScheduleDeliveryTime());
    smppMessage.setHeader(VALIDITY_PERIOD,deliverSm.getValidityPeriod());
    smppMessage.setHeader(SERVICE_TYPE,deliverSm.getServiceType());
  }
  return smppMessage;
}
