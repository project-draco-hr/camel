{
  Class<?> cls=getSEIClass();
  ServerFactoryBean answer=null;
  if (cls == null) {
    if (!getDataFormat().equals(DataFormat.POJO)) {
      answer=new ServerFactoryBean(new WSDLServiceFactoryBean());
    }
 else {
      ObjectHelper.notNull(cls,CxfConstants.SERVICE_CLASS);
    }
  }
 else   if (CxfEndpointUtils.hasWebServiceAnnotation(cls)) {
    answer=new JaxWsServerFactoryBean();
  }
 else {
    answer=new ServerFactoryBean();
  }
  configure(answer);
  setupServerFactoryBean(answer,cls);
  if (answer.getServiceName() == null && getServiceLocalName() != null) {
    answer.setServiceName(new QName(getServiceNamespace(),getServiceLocalName()));
  }
  if (answer.getEndpointName() == null && getEndpointLocalName() != null) {
    answer.setEndpointName(new QName(getEndpointNamespace(),getEndpointLocalName()));
  }
  if (cls == null) {
    ObjectHelper.notNull(answer.getEndpointName(),"Please provide endpoint/port name");
    ObjectHelper.notNull(answer.getServiceName(),"Please provide service name");
  }
  return answer;
}
