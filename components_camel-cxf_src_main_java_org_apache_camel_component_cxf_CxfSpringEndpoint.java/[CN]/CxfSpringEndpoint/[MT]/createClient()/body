{
  Class<?> cls=getSEIClass();
  if (getDataFormat().equals(DataFormat.POJO)) {
    ObjectHelper.notNull(cls,CxfConstants.SERVICE_CLASS);
  }
  if (cls != null) {
    ClientProxyFactoryBean factoryBean=createClientFactoryBean(cls);
    configure(factoryBean);
    setupClientFactoryBean(factoryBean,cls);
    QName serviceQName=null;
    try {
      serviceQName=factoryBean.getServiceName();
    }
 catch (    IllegalStateException e) {
    }
    if (serviceQName == null && getServiceLocalName() != null) {
      factoryBean.setServiceName(new QName(getServiceNamespace(),getServiceLocalName()));
    }
    if (factoryBean.getEndpointName() == null && getEndpointLocalName() != null) {
      factoryBean.setEndpointName(new QName(getEndpointNamespace(),getEndpointLocalName()));
    }
    return ((ClientProxy)Proxy.getInvocationHandler(factoryBean.create())).getClient();
  }
 else {
    ClientFactoryBean factoryBean=createClientFactoryBean();
    configure(factoryBean);
    setupClientFactoryBean(factoryBean);
    QName serviceQName=null;
    try {
      serviceQName=factoryBean.getServiceName();
    }
 catch (    IllegalStateException e) {
    }
    if (serviceQName == null && getServiceLocalName() != null) {
      factoryBean.setServiceName(new QName(getServiceNamespace(),getServiceLocalName()));
    }
    if (factoryBean.getEndpointName() == null && getEndpointLocalName() != null) {
      factoryBean.setEndpointName(new QName(getEndpointNamespace(),getEndpointLocalName()));
    }
    checkName(factoryBean.getEndpointName(),"endpoint/port name");
    checkName(factoryBean.getServiceName(),"service name");
    return (Client)factoryBean.create();
  }
}
