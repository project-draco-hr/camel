{
  Iterator<ProducerRecord> c=createRecorder(exchange);
  List<Future<RecordMetadata>> futures=new LinkedList<Future<RecordMetadata>>();
  List<RecordMetadata> recordMetadatas=new ArrayList<RecordMetadata>();
  if (endpoint.getConfiguration().isRecordMetadata()) {
    if (exchange.hasOut()) {
      exchange.getOut().setHeader(KafkaConstants.KAFKA_RECORDMETA,recordMetadatas);
    }
 else {
      exchange.getIn().setHeader(KafkaConstants.KAFKA_RECORDMETA,recordMetadatas);
    }
  }
  while (c.hasNext()) {
    futures.add(kafkaProducer.send(c.next()));
  }
  for (  Future<RecordMetadata> f : futures) {
    recordMetadatas.add(f.get());
  }
}
