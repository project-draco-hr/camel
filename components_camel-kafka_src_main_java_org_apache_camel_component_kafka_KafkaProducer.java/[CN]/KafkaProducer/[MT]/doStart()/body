{
  Properties props=getProps();
  if (kafkaProducer == null) {
    ClassLoader threadClassLoader=Thread.currentThread().getContextClassLoader();
    try {
      Thread.currentThread().setContextClassLoader(null);
      kafkaProducer=new org.apache.kafka.clients.producer.KafkaProducer(props);
    }
  finally {
      Thread.currentThread().setContextClassLoader(threadClassLoader);
    }
  }
  if (!endpoint.isSynchronous() && workerPool == null) {
    workerPool=endpoint.createProducerExecutor();
    shutdownWorkerPool=true;
  }
}
