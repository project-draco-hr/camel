{
  if (configuration == null) {
    configuration=new Configuration();
    configuration.setTemplateLoader(new URLTemplateLoader(){
      @Override protected URL getURL(      String name){
        ClassLoader[] loaders={beanClassLoader,Thread.currentThread().getContextClassLoader(),this.getClass().getClassLoader()};
        for (        ClassLoader classLoader : loaders) {
          if (classLoader != null) {
            URL resource=classLoader.getResource(name);
            if (resource != null) {
              return resource;
            }
          }
        }
        return null;
      }
    }
);
  }
  return (Configuration)configuration.clone();
}
