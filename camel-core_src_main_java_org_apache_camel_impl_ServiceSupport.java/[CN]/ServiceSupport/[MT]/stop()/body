{
  if (stopped.compareAndSet(false,true)) {
    stopping.set(true);
    try {
      doStop();
    }
  finally {
      stopped.set(true);
      started.set(false);
      stopping.set(false);
    }
  }
}
