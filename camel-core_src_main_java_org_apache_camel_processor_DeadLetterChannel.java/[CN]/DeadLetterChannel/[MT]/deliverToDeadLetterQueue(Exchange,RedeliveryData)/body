{
  if (data.deadLetterQueue == null) {
    return;
  }
  ExchangeHelper.setFailureHandled(exchange);
  decrementRedeliveryCounter(exchange);
  MessageHelper.resetStreamCache(exchange.getIn());
  if (data.useOriginalInBody) {
    if (log.isTraceEnabled()) {
      log.trace("Using the original IN body in the DedLetterQueue instead of the current IN body");
    }
    Object original=exchange.getUnitOfWork().getOriginalInBody();
    exchange.getIn().setBody(original);
  }
  if (log.isTraceEnabled()) {
    log.trace("DeadLetterQueue " + data.deadLetterQueue + " is processing Exchange: "+ exchange);
  }
  try {
    data.deadLetterQueue.process(exchange);
  }
 catch (  Exception e) {
    exchange.setException(e);
  }
  log.trace("DedLetterQueue processor done");
  prepareExchangeAfterMovedToDeadLetterQueue(exchange,data.handledPredicate);
  String msg="Failed delivery for exchangeId: " + exchange.getExchangeId() + ". Moved to the dead letter queue: "+ data.deadLetterQueue;
  logFailedDelivery(false,exchange,msg,data,null);
}
