{
  Message in=exchange.getIn();
  Integer counter=in.getHeader(REDELIVERY_COUNTER,Integer.class);
  if (counter != null) {
    int prev=counter - 1;
    in.setHeader(REDELIVERY_COUNTER,prev);
    in.setHeader(REDELIVERED,prev > 0 ? Boolean.TRUE : Boolean.FALSE);
  }
 else {
    in.setHeader(REDELIVERY_COUNTER,0);
    in.setHeader(REDELIVERED,Boolean.FALSE);
  }
}
