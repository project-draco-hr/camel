{
  if (handledPredicate == null || !handledPredicate.matches(exchange)) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("This exchange is not handled so its marked as failed: " + exchange);
    }
    exchange.setException(exchange.getProperty(Exchange.EXCEPTION_CAUGHT,Throwable.class));
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("This exchange is handled so its marked as not failed: " + exchange);
    }
    exchange.setProperty(Exchange.EXCEPTION_HANDLED,Boolean.TRUE);
  }
}
