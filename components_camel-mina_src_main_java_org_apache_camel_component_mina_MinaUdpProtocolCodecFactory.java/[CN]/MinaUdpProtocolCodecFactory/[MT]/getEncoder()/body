{
  return new ProtocolEncoder(){
    private CharsetEncoder encoder;
    public void encode(    IoSession session,    Object message,    ProtocolEncoderOutput out) throws Exception {
      if (encoder == null) {
        encoder=charset.newEncoder();
      }
      ByteBuffer buf=toByteBuffer(message,encoder);
      buf.flip();
      out.write(buf);
    }
    public void dispose(    IoSession session) throws Exception {
    }
  }
;
}
