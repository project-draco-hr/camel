{
  boolean exceptionHandled=hasExceptionBeenHandledByErrorHandler(exchange);
  if (exchange.isFailed() || exchange.isRollbackOnly() || exceptionHandled) {
    Message msg=exchange.hasOut() ? exchange.getOut() : exchange.getIn();
    if (msg.isFault() && exchange.getException() != null) {
      StringBuilder sb=new StringBuilder();
      sb.append("Message exchange has failed: " + message + " for exchange: ").append(exchange);
      sb.append(" Warning: Both fault and exception exists on the exchange, its best practice to only set one of them.");
      sb.append(" Exception: ").append(exchange.getException());
      sb.append(" Fault: ").append(msg);
      if (exceptionHandled) {
        sb.append(" Handled by the error handler.");
      }
      log.warn(sb.toString());
    }
    if (log.isDebugEnabled()) {
      StringBuilder sb=new StringBuilder();
      sb.append("Message exchange has failed: " + message + " for exchange: ").append(exchange);
      if (exchange.isRollbackOnly()) {
        sb.append(" Marked as rollback only.");
      }
      if (exchange.getException() != null) {
        sb.append(" Exception: ").append(exchange.getException());
      }
      if (msg.isFault()) {
        sb.append(" Fault: ").append(msg);
      }
      if (exceptionHandled) {
        sb.append(" Handled by the error handler.");
      }
      log.debug(sb.toString());
    }
    return false;
  }
  Object stop=exchange.getProperty(Exchange.ROUTE_STOP);
  if (stop != null) {
    boolean doStop=exchange.getContext().getTypeConverter().convertTo(Boolean.class,exchange,stop);
    if (doStop) {
      log.debug("ExchangeId: {} is marked to stop routing: {}",exchange.getExchangeId(),exchange);
      return false;
    }
  }
  return true;
}
