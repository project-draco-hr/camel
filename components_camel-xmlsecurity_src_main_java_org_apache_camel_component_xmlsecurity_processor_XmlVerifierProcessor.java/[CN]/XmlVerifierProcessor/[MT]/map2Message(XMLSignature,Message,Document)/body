{
  @SuppressWarnings("unchecked") final List<Reference> refs=new ArrayList<Reference>(signature.getSignedInfo().getReferences());
  @SuppressWarnings("unchecked") final List<XMLObject> objs=new ArrayList<XMLObject>(signature.getObjects());
  XmlSignature2Message.Input refsAndObjects=new XmlSignature2Message.Input(){
    @Override public List<Reference> getReferences(){
      return refs;
    }
    @Override public List<XMLObject> getObjects(){
      return objs;
    }
    @Override public Document getMessageBodyDocument(){
      return messageBodyDocument;
    }
    @Override public Boolean omitXmlDeclaration(){
      return getConfiguration().getOmitXmlDeclaration();
    }
    @Override public Object getOutputNodeSearch(){
      return getConfiguration().getOutputNodeSearch();
    }
    @Override public String getOutputNodeSearchType(){
      return getConfiguration().getOutputNodeSearchType();
    }
    public Boolean getRemoveSignatureElements(){
      return getConfiguration().getRemoveSignatureElements();
    }
  }
;
  getConfiguration().getXmlSignature2Message().mapToMessage(refsAndObjects,out);
}
