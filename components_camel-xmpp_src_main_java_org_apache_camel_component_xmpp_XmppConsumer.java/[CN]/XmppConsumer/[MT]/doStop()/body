{
  super.doStop();
  if (muc != null) {
    if (LOG.isInfoEnabled()) {
      LOG.info("Leaving room: " + muc.getRoom());
    }
    muc.removeMessageListener(this);
    muc.leave();
    muc=null;
  }
  if (connection != null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Disconnecting from: " + XmppEndpoint.getConnectionMessage(connection));
    }
    connection.disconnect();
    connection=null;
  }
}
