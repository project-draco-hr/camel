{
  boolean existing=this == endpoint.getConsumer();
  if (!existing && endpoint.hasConsumer(this)) {
    throw new IllegalArgumentException("Cannot add a 2nd consumer to the same endpoint. Endpoint " + endpoint + " only allows one consumer.");
  }
  if (!existing) {
    endpoint.addConsumer(this);
  }
}
