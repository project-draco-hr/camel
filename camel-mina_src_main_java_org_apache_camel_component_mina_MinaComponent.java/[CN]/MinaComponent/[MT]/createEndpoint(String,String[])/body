{
  String remainingUrl=uri.substring("mina:".length());
  URI u=new URI(remainingUrl);
  String protocol=u.getScheme();
  if (protocol.equals("tcp")) {
    return createSocketEndpoint(uri,u);
  }
 else   if (protocol.equals("udp") || protocol.equals("mcast") || protocol.equals("multicast")) {
    return createDatagramEndpoint(uri,u);
  }
 else   if (protocol.equals("vm")) {
    return createVmEndpoint(uri,u);
  }
 else {
    throw new IOException("Unrecognised MINA protocol: " + protocol + " for uri: "+ uri);
  }
}
