{
  Configuration config=getConfiguration();
  DynamicQueryContext dynamicQueryContext=new DynamicQueryContext(config);
  Message in=exchange.getIn();
  Item item=in.getBody(Item.class);
  if (item != null) {
    dynamicQueryContext.setContextItem(item);
  }
 else {
    Source source=in.getMandatoryBody(Source.class);
    DocumentInfo doc=getStaticQueryContext().buildDocument(source);
    dynamicQueryContext.setContextItem(doc);
  }
  configureQuery(dynamicQueryContext,exchange);
  MessageHelper.resetStreamCache(exchange.getIn());
  return dynamicQueryContext;
}
