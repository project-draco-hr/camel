{
  if (LOG.isTraceEnabled()) {
    LOG.trace("Exception caught at Channel: " + ctx.channel(),cause);
  }
  if (exceptionHandled) {
    return;
  }
  exceptionHandled=true;
  if (LOG.isDebugEnabled()) {
    LOG.debug("Closing channel as an exception was thrown from Netty",cause);
  }
  Exchange exchange=getExchange(ctx);
  AsyncCallback callback=getAsyncCallback(ctx);
  if (exchange != null && callback != null) {
    Throwable initialCause=exchange.getException();
    if (initialCause != null && initialCause.getCause() == null) {
      initialCause.initCause(cause);
    }
 else {
      exchange.setException(cause);
    }
    NettyHelper.close(ctx.channel());
    callback.done(false);
  }
  super.exceptionCaught(ctx,cause);
}
