{
  if (event instanceof RouteStartedEvent) {
    RouteStartedEvent rse=(RouteStartedEvent)event;
    Endpoint endpoint=rse.getRoute().getEndpoint();
    String routeId=rse.getRoute().getId();
    Set<String> routes=inputs.get(endpoint);
    if (routeId != null && (routes == null || !routes.contains(routeId))) {
      if (routes == null) {
        routes=new ConcurrentSkipListSet<String>();
      }
      routes.add(routeId);
      inputs.put(endpoint.getEndpointUri(),routes);
    }
  }
 else {
    ExchangeSendingEvent ese=(ExchangeSendingEvent)event;
    Endpoint endpoint=ese.getEndpoint();
    String routeId=getRouteId(ese.getExchange());
    Set<String> routes=outputs.get(endpoint);
    if (routeId != null && (routes == null || !routes.contains(routeId))) {
      if (routes == null) {
        routes=new ConcurrentSkipListSet<String>();
      }
      routes.add(routeId);
      outputs.put(endpoint.getEndpointUri(),routes);
    }
  }
}
