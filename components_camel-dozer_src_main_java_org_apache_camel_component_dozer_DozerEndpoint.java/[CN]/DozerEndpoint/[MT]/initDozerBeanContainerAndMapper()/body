{
  LOG.info("Configuring DozerBeanContainer and DozerBeanMapper");
  ClassLoader oldCl=Thread.currentThread().getContextClassLoader();
  ExpressionFactoryImpl factory=new ExpressionFactoryImpl();
  ClassLoader cl=factory.getClass().getClassLoader();
  Thread.currentThread().setContextClassLoader(cl);
  System.setProperty("javax.el.ExpressionFactory","com.sun.el.ExpressionFactoryImpl");
  try {
    ELEngine engine=new ELEngine();
    engine.init();
    BeanContainer.getInstance().setElEngine(engine);
    ElementReader reader=new ExpressionElementReader(engine);
    BeanContainer.getInstance().setElementReader(reader);
  }
 catch (  Throwable e) {
    throw new IllegalStateException("Error configuring DozerBeanContainer/DozerBeanMapper due " + e.getMessage(),e);
  }
 finally {
    System.clearProperty("javax.el.ExpressionFactory");
    Thread.currentThread().setContextClassLoader(oldCl);
  }
  if (mapper == null) {
    if (configuration.getMappingConfiguration() != null) {
      mapper=DozerTypeConverterLoader.createDozerBeanMapper(configuration.getMappingConfiguration());
    }
 else {
      mapper=createDozerBeanMapper();
    }
    configureMapper(mapper);
  }
}
