{
  if (configuration.getQueryBuilderStrategy() == null) {
    throw new RuntimeException("QueryBuilderStrategy is required for executing queries!");
  }
  QueryFactory factory;
  if (cache instanceof RemoteCache) {
    factory=Search.getQueryFactory((RemoteCache)cache);
  }
 else {
    SearchManager searchManager=org.infinispan.query.Search.getSearchManager((Cache)cache);
    factory=searchManager.getQueryFactory();
  }
  QueryBuilder queryBuilder=configuration.getQueryBuilderStrategy().createQueryBuilder(factory);
  if (queryBuilder == null) {
    throw new RuntimeException("QueryBuilder not created!");
  }
  List<?> result=queryBuilder.build().list();
  setResult(result,exchange);
}
