{
  ChannelFuture future;
  Object body;
  if (ExchangeHelper.isOutCapable(exchange)) {
    body=exchange.getOut().getBody();
  }
 else {
    body=exchange.getIn().getBody();
  }
  if (exchange.isFailed()) {
    if (exchange.getException() == null) {
      body=exchange.getOut().getBody();
    }
 else {
      body=exchange.getException();
    }
  }
  if (body == null) {
    LOG.warn("No Oubound Response received following route completion: " + exchange);
    LOG.warn("A response cannot be sent to the Client");
    messageEvent.getChannel().close();
  }
  if (consumer.getConfiguration().getProtocol().equalsIgnoreCase("udp")) {
    future=messageEvent.getChannel().write(body,messageEvent.getRemoteAddress());
  }
 else {
    future=messageEvent.getChannel().write(body);
  }
  if (!future.isSuccess()) {
    String hostname=((InetSocketAddress)messageEvent.getChannel().getRemoteAddress()).getHostName();
    int port=((InetSocketAddress)messageEvent.getChannel().getRemoteAddress()).getPort();
    throw new CamelExchangeException("Could not send response via Channel to remote host " + hostname + " and port "+ port,exchange);
  }
  if (LOG.isDebugEnabled()) {
    if (body instanceof byte[]) {
      body=consumer.getEndpoint().getCamelContext().getTypeConverter().convertTo(String.class,body);
    }
    LOG.debug("Sent Outgoing message: " + body);
  }
}
