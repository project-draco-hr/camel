{
  Object body=exchange.getIn().getBody();
  if (body instanceof String) {
    Charset charset=endpoint.getCharset();
    Writer writer=new OutputStreamWriter(outputStream,charset);
    BufferedWriter bw=new BufferedWriter(writer);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Writing as text: " + body + " to "+ outputStream+ " using encoding:"+ charset);
    }
    bw.write((String)body);
    bw.write("\n");
    bw.flush();
  }
 else   if (body instanceof byte[]) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Writing as byte[]: " + body + " to "+ outputStream);
    }
    outputStream.write((byte[])body);
  }
 else {
    throw new CamelExchangeException("The body is neither a String or byte array. " + "Cannot write body to output stream",exchange);
  }
}
