{
  MBeanServer mbeanServer=getMBeanServer();
  ObjectName on=ObjectName.getInstance("org.apache.camel:context=localhost/camel-1,type=routes,name=\"foo\"");
  getMockEndpoint("mock:result").expectedMessageCount(1);
  template.sendBody("direct:foo","Hello World");
  assertMockEndpointsSatisfied();
  Set<ObjectName> before=mbeanServer.queryNames(new ObjectName("*:type=threadpools,*"),null);
  mbeanServer.invoke(on,"stop",null,null);
  mbeanServer.invoke(on,"remove",null,null);
  boolean registered=mbeanServer.isRegistered(on);
  assertFalse("Route mbean should have been unregistered",registered);
  Set<ObjectName> after=mbeanServer.queryNames(new ObjectName("*:type=threadpools,*"),null);
  assertTrue("There should be one less thread pool",before.size() - 1 == after.size());
}
