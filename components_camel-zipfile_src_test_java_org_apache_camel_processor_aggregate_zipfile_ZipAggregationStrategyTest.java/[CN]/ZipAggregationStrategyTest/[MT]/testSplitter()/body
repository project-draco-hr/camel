{
  MockEndpoint mock=getMockEndpoint("mock:aggregateToZipEntry");
  mock.expectedMessageCount(1);
  assertMockEndpointsSatisfied();
  Thread.sleep(500);
  File[] files=new File("target/out").listFiles();
  assertTrue("Should be a file in target/out directory",files.length > 0);
  File resultFile=files[0];
  ZipInputStream zin=new ZipInputStream(new FileInputStream(resultFile));
  try {
    int fileCount=0;
    for (ZipEntry ze=zin.getNextEntry(); ze != null; ze=zin.getNextEntry()) {
      fileCount++;
    }
    assertTrue("Zip file should contains " + ZipAggregationStrategyTest.EXPECTED_NO_FILES + " files",fileCount == ZipAggregationStrategyTest.EXPECTED_NO_FILES);
  }
  finally {
    IOHelper.close(zin);
  }
}
