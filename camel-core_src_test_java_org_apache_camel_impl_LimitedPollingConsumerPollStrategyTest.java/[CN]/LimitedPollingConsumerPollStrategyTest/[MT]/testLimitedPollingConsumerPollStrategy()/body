{
  Exception expectedException=new Exception("Hello");
  strategy=new LimitedPollingConsumerPollStrategy();
  strategy.setLimit(3);
  final Endpoint endpoint=getMockEndpoint("mock:foo");
  MockScheduledPollConsumer consumer=new MockScheduledPollConsumer(endpoint,expectedException);
  consumer.setPollStrategy(strategy);
  consumer.start();
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should be suspended",consumer.isSuspended());
  consumer.stop();
}
