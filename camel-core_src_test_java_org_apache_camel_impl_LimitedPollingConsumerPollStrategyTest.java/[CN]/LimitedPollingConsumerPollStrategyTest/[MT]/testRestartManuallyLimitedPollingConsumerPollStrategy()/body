{
  Exception expectedException=new Exception("Hello");
  strategy=new LimitedPollingConsumerPollStrategy();
  strategy.setLimit(3);
  MockScheduledPollConsumer consumer=new MockScheduledPollConsumer(expectedException);
  consumer.setPollStrategy(strategy);
  consumer.start();
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should be suspended",consumer.isSuspended());
  ServiceHelper.resumeService(consumer);
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should be suspended",consumer.isSuspended());
  ServiceHelper.resumeService(consumer);
  consumer.setExceptionToThrowOnPoll(null);
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.run();
  assertTrue("Should still be started",consumer.isStarted());
  consumer.stop();
}
