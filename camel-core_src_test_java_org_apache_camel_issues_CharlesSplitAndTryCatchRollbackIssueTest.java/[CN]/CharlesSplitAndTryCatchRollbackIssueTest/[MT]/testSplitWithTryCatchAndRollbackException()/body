{
  MockEndpoint split=getMockEndpoint("mock:split");
  MockEndpoint ile=getMockEndpoint("mock:ile");
  MockEndpoint exception=getMockEndpoint("mock:exception");
  split.expectedBodiesReceived("A","B");
  ile.expectedMessageCount(0);
  exception.expectedMessageCount(1);
  try {
    template.sendBody("direct:start","A,B,Kaboom,C");
    fail("Should thrown an exception");
  }
 catch (  CamelExecutionException e) {
    CamelExchangeException ee=assertIsInstanceOf(CamelExchangeException.class,e.getCause());
    assertTrue(ee.getMessage().startsWith("Sequential processing failed for number 2."));
    RollbackExchangeException re=assertIsInstanceOf(RollbackExchangeException.class,ee.getCause());
    assertTrue(re.getMessage().startsWith("Intended rollback"));
  }
  assertMockEndpointsSatisfied();
}
