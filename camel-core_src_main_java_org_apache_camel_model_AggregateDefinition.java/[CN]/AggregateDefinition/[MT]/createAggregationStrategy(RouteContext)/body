{
  AggregationStrategy strategy=getAggregationStrategy();
  if (strategy == null && strategyRef != null) {
    strategy=routeContext.lookup(strategyRef,AggregationStrategy.class);
  }
  if (groupExchanges != null && groupExchanges) {
    if (strategy != null || strategyRef != null) {
      throw new IllegalArgumentException("Options groupExchanges and AggregationStrategy cannot be enabled at the same time");
    }
    if (eagerCheckCompletion != null && !eagerCheckCompletion) {
      throw new IllegalArgumentException("Option eagerCheckCompletion cannot be false when groupExchanges has been enabled");
    }
    setEagerCheckCompletion(true);
    strategy=new GroupedExchangeAggregationStrategy();
  }
  if (strategy == null) {
    throw new IllegalArgumentException("AggregationStrategy or AggregationStrategyRef must be set on " + this);
  }
  return strategy;
}
