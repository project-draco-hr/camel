{
  Processor processor=routeContext.createProcessor(this);
  processor=new UnitOfWorkProcessor(routeContext,processor);
  Expression correlation=getExpression().createExpression(routeContext);
  AggregationStrategy strategy=createAggregationStrategy(routeContext);
  executorService=ExecutorServiceHelper.getConfiguredExecutorService(routeContext,"Aggregator",this);
  if (executorService == null) {
    if (isParallelProcessing()) {
      executorService=routeContext.getCamelContext().getExecutorServiceStrategy().newDefaultThreadPool(this,"Aggregator");
    }
 else {
      executorService=routeContext.getCamelContext().getExecutorServiceStrategy().newSingleThreadExecutor(this,"Aggregator");
    }
  }
  AggregateProcessor answer=new AggregateProcessor(routeContext.getCamelContext(),processor,correlation,strategy,executorService);
  AggregationRepository repository=createAggregationRepository(routeContext);
  if (repository != null) {
    answer.setAggregationRepository(repository);
  }
  answer.setParallelProcessing(isParallelProcessing());
  if (getCompletionPredicate() != null) {
    Predicate predicate=getCompletionPredicate().createPredicate(routeContext);
    answer.setCompletionPredicate(predicate);
  }
  if (getCompletionTimeoutExpression() != null) {
    Expression expression=getCompletionTimeoutExpression().createExpression(routeContext);
    answer.setCompletionTimeoutExpression(expression);
  }
  if (getCompletionTimeout() != null) {
    answer.setCompletionTimeout(getCompletionTimeout());
  }
  if (getCompletionSizeExpression() != null) {
    Expression expression=getCompletionSizeExpression().createExpression(routeContext);
    answer.setCompletionSizeExpression(expression);
  }
  if (getCompletionSize() != null) {
    answer.setCompletionSize(getCompletionSize());
  }
  if (isCompletionFromBatchConsumer() != null) {
    answer.setCompletionFromBatchConsumer(isCompletionFromBatchConsumer());
  }
  if (isEagerCheckCompletion() != null) {
    answer.setEagerCheckCompletion(isEagerCheckCompletion());
  }
  if (isIgnoreBadCorrelationKeys() != null) {
    answer.setIgnoreBadCorrelationKeys(isIgnoreBadCorrelationKeys());
  }
  if (getCloseCorrelationKeyOnCompletion() != null) {
    answer.setCloseCorrelationKeyOnCompletion(getCloseCorrelationKeyOnCompletion());
  }
  return answer;
}
