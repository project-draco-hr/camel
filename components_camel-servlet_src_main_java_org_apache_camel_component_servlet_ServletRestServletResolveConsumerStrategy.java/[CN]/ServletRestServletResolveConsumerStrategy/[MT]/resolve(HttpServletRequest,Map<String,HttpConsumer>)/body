{
  HttpConsumer answer=null;
  String path=request.getPathInfo();
  if (path == null) {
    return null;
  }
  String method=request.getMethod();
  if (method == null) {
    return null;
  }
  List<HttpConsumer> candidates=new ArrayList<HttpConsumer>();
  for (  Map.Entry<String,HttpConsumer> entry : consumers.entrySet()) {
    String restrict=entry.getValue().getEndpoint().getHttpMethodRestrict();
    if (matchRestMethod(method,restrict)) {
      candidates.add(entry.getValue());
    }
  }
  Iterator<HttpConsumer> it=candidates.iterator();
  while (it.hasNext()) {
    HttpConsumer consumer=it.next();
    String consumerPath=consumer.getPath();
    if (matchRestPath(path,consumerPath,false)) {
      answer=consumer;
      break;
    }
  }
  if (answer == null) {
    it=candidates.iterator();
    while (it.hasNext()) {
      HttpConsumer consumer=it.next();
      String consumerPath=consumer.getPath();
      if (!matchRestPath(path,consumerPath,true)) {
        it.remove();
      }
    }
    int bestWildcard=Integer.MAX_VALUE;
    HttpConsumer best=null;
    if (candidates.size() > 1) {
      it=candidates.iterator();
      while (it.hasNext()) {
        HttpConsumer entry=it.next();
        String consumerPath=entry.getPath();
        int wildcards=countWildcards(consumerPath);
        if (wildcards > 0) {
          if (best == null || wildcards < bestWildcard) {
            best=entry;
            bestWildcard=wildcards;
          }
        }
      }
      if (best != null) {
        answer=best;
      }
    }
    if (answer == null && candidates.size() == 1) {
      answer=candidates.get(0);
    }
  }
  if (answer == null) {
    answer=super.resolve(request,consumers);
  }
  return answer;
}
