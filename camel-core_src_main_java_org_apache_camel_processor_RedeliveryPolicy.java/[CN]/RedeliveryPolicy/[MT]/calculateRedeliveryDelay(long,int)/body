{
  if (ObjectHelper.isNotEmpty(delayPattern)) {
    return calculateRedeliverDelayUsingPattern(delayPattern,redeliveryCounter);
  }
  long redeliveryDelay;
  if (previousDelay == 0) {
    redeliveryDelay=redeliverDelay;
  }
 else   if (useExponentialBackOff && backOffMultiplier > 1) {
    redeliveryDelay=Math.round(backOffMultiplier * previousDelay);
  }
 else {
    redeliveryDelay=previousDelay;
  }
  if (useCollisionAvoidance) {
    Random random=getRandomNumberGenerator();
    double variance=(random.nextBoolean() ? collisionAvoidanceFactor : -collisionAvoidanceFactor) * random.nextDouble();
    redeliveryDelay+=redeliveryDelay * variance;
  }
  if (maximumRedeliveryDelay > 0 && redeliveryDelay > maximumRedeliveryDelay) {
    redeliveryDelay=maximumRedeliveryDelay;
  }
  return redeliveryDelay;
}
