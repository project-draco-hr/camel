{
  Map<String,Object> parameters=null;
  URI uriObj=new URI(uri);
  if (query == null) {
    parameters=URISupport.parseParameters(uriObj);
  }
 else {
    parameters=URISupport.parseQuery(query,false,true);
  }
  if (uriObj.getScheme().equals(GHTTPS_SCHEME)) {
    uriObj=new URI(HTTPS_SCHEME + ":" + uriObj.getRawSchemeSpecificPart());
  }
 else {
    uriObj=new URI(HTTP_SCHEME + ":" + uriObj.getRawSchemeSpecificPart());
  }
  return URISupport.createRemainingURI(uriObj,parameters).toURL();
}
