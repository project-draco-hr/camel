{
  Class<?> testClass=getTestClass();
  if (LOG.isDebugEnabled()) {
    LOG.debug(String.format("Loading ApplicationContext for merged context configuration [%s].",mergedConfig));
  }
  try {
    GenericApplicationContext context=createContext(testClass);
    context.getEnvironment().setActiveProfiles(mergedConfig.getActiveProfiles());
    loadBeanDefinitions(context,mergedConfig);
    return loadContext(context,testClass);
  }
  finally {
    cleanup(testClass);
  }
}
