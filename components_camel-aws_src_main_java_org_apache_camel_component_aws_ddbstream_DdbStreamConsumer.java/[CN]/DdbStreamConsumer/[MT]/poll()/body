{
  GetRecordsRequest req=new GetRecordsRequest().withShardIterator(shardIteratorHandler.getShardIterator()).withLimit(getEndpoint().getMaxResultsPerRequest());
  GetRecordsResult result=getClient().getRecords(req);
  Queue<Exchange> exchanges=createExchanges(result.getRecords());
  int processedExchangeCount=processBatch(CastUtils.cast(exchanges));
  shardIteratorHandler.updateShardIterator(result.getNextShardIterator());
  return processedExchangeCount;
}
