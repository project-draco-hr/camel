{
  if (currentShardIterator == null) {
    ListStreamsRequest req0=new ListStreamsRequest().withTableName(getEndpoint().getTableName());
    ListStreamsResult res0=getClient().listStreams(req0);
    final String streamArn=res0.getStreams().get(0).getStreamArn();
    DescribeStreamRequest req1=new DescribeStreamRequest().withStreamArn(streamArn);
    DescribeStreamResult res1=getClient().describeStream(req1);
    shardList.addAll(res1.getStreamDescription().getShards());
    LOG.trace("Current shard is: {} (in {})",currentShard,shardList);
    if (currentShard == null) {
switch (getEndpoint().getIteratorType()) {
case AFTER_SEQUENCE_NUMBER:
        currentShard=shardList.afterSeq(getEndpoint().getSequenceNumber());
      break;
case AT_SEQUENCE_NUMBER:
    currentShard=shardList.atSeq(getEndpoint().getSequenceNumber());
  break;
case TRIM_HORIZON:
currentShard=shardList.first();
break;
case LATEST:
default :
currentShard=shardList.last();
break;
}
}
 else {
currentShard=shardList.nextAfter(currentShard);
}
shardList.removeOlderThan(currentShard);
LOG.trace("Next shard is: {} (in {})",currentShard,shardList);
GetShardIteratorRequest req=new GetShardIteratorRequest().withStreamArn(streamArn).withShardId(currentShard.getShardId()).withShardIteratorType(getEndpoint().getIteratorType());
GetShardIteratorResult result=getClient().getShardIterator(req);
currentShardIterator=result.getShardIterator();
}
LOG.trace("Shard Iterator is: {}",currentShardIterator);
return currentShardIterator;
}
