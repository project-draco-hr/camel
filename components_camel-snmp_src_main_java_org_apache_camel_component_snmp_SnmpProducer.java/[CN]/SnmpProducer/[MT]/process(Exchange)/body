{
  Snmp snmp=null;
  TransportMapping<? extends Address> transport=null;
  try {
    LOG.debug("Starting SNMP producer on {}",this.endpoint.getAddress());
    if ("tcp".equals(this.endpoint.getProtocol())) {
      transport=new DefaultTcpTransportMapping();
    }
 else     if ("udp".equals(this.endpoint.getProtocol())) {
      transport=new DefaultUdpTransportMapping();
    }
 else {
      throw new IllegalArgumentException("Unknown protocol: {} " + this.endpoint.getProtocol());
    }
    snmp=new Snmp(transport);
    LOG.debug("Snmp: i am sending");
    snmp.listen();
    ResponseEvent responseEvent=snmp.send(this.pdu,this.target);
    LOG.debug("Snmp: sended");
    if (responseEvent.getResponse() != null) {
      exchange.getIn().setBody(new SnmpMessage(responseEvent.getResponse()));
    }
 else {
      throw new TimeoutException("SNMP Producer Timeout");
    }
  }
  finally {
    try {
      transport.close();
    }
 catch (    Exception e) {
    }
    try {
      snmp.close();
    }
 catch (    Exception e) {
    }
  }
}
