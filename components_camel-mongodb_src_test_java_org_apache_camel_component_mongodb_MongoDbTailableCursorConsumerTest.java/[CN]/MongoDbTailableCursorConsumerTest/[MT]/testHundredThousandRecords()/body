{
  assertEquals(0,cappedTestCollection.count());
  final MockEndpoint mock=getMockEndpoint("mock:test");
  mock.expectedMessageCount(1000);
  cappedTestCollection=db.createCollection(cappedTestCollectionName,BasicDBObjectBuilder.start().add("capped",true).add("size",1000000000).add("max",1000).get());
  addTestRoutes();
  context.startRoute("tailableCursorConsumer1");
  Thread t=new Thread(new Runnable(){
    @Override public void run(){
      for (int i=1; i <= 100000; i++) {
        cappedTestCollection.insert(BasicDBObjectBuilder.start("increasing",i).add("string","value" + i).get(),WriteConcern.SAFE);
        if (i % 1000 == 0) {
          try {
            MongoDbTailableCursorConsumerTest.this.assertAndResetMockEndpoint(mock);
          }
 catch (          Exception e) {
            return;
          }
        }
      }
    }
  }
);
  t.start();
  t.join();
  context.stopRoute("tailableCursorConsumer1");
}
