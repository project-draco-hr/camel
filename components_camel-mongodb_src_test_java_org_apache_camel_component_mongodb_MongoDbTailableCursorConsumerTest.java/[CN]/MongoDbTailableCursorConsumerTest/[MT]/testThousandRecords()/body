{
  assertEquals(0,cappedTestCollection.count());
  MockEndpoint mock=getMockEndpoint("mock:test");
  mock.expectedMessageCount(1000);
  cappedTestCollection=db.createCollection(cappedTestCollectionName,BasicDBObjectBuilder.start().add("capped",true).add("size",1000000000).add("max",1000).get());
  for (int i=0; i < 1000; i++) {
    cappedTestCollection.insert(BasicDBObjectBuilder.start("increasing",i).add("string","value" + i).get(),WriteConcern.SAFE);
  }
  assertEquals(1000,cappedTestCollection.count());
  addTestRoutes();
  context.startRoute("tailableCursorConsumer1");
  Thread.sleep(1000);
  mock.assertIsSatisfied();
  context.stopRoute("tailableCursorConsumer1");
}
