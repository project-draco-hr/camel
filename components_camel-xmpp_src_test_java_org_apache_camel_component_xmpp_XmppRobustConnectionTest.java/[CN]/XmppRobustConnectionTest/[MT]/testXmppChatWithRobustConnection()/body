{
  if (isPlatform("aix") || isPlatform("sunos")) {
    return;
  }
  MockEndpoint consumerEndpoint=context.getEndpoint("mock:out",MockEndpoint.class);
  MockEndpoint errorEndpoint=context.getEndpoint("mock:error",MockEndpoint.class);
  consumerEndpoint.setExpectedMessageCount(10);
  errorEndpoint.setExpectedMessageCount(5);
  for (int i=0; i < 5; i++) {
    template.sendBody("direct:start","Test message [ " + i + " ]");
  }
  consumerEndpoint.assertIsNotSatisfied();
  errorEndpoint.assertIsNotSatisfied();
  EmbeddedXmppTestServer.instance().stopXmppEndpoint();
  Thread.sleep(2000);
  for (int i=0; i < 5; i++) {
    template.sendBody("direct:start","Test message [ " + i + " ]");
  }
  errorEndpoint.assertIsSatisfied();
  consumerEndpoint.assertIsNotSatisfied();
  EmbeddedXmppTestServer.instance().startXmppEndpoint();
  Thread.sleep(2000);
  for (int i=0; i < 5; i++) {
    template.sendBody("direct:start","Test message [ " + i + " ]");
  }
  consumerEndpoint.assertIsSatisfied();
}
