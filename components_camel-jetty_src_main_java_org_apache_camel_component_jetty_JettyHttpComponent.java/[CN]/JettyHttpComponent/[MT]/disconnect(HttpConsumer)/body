{
  HttpEndpoint endpoint=consumer.getEndpoint();
  String connectorKey=getConnectorKey(endpoint);
synchronized (CONNECTORS) {
    ConnectorRef connectorRef=CONNECTORS.get(connectorKey);
    if (connectorRef != null) {
      connectorRef.servlet.disconnect(consumer);
      if (connectorRef.decrement() == 0) {
        connectorRef.server.removeConnector(connectorRef.connector);
        connectorRef.connector.stop();
        connectorRef.server.stop();
        CONNECTORS.remove(connectorKey);
        MBeanContainer containerToClean=getMbContainer();
        if (containerToClean != null) {
          containerToClean.removeBean(connectorRef.server);
          containerToClean.removeBean(connectorRef.connector);
        }
      }
    }
  }
}
