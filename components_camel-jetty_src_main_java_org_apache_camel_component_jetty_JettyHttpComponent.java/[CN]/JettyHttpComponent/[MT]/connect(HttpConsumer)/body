{
  JettyHttpEndpoint endpoint=(JettyHttpEndpoint)consumer.getEndpoint();
  String connectorKey=getConnectorKey(endpoint);
synchronized (connectors) {
    ConnectorRef connectorRef=connectors.get(connectorKey);
    if (connectorRef == null) {
      Connector connector;
      if ("https".equals(endpoint.getProtocol())) {
        connector=getSslSocketConnector();
      }
 else {
        connector=new SelectChannelConnector();
      }
      connector.setPort(endpoint.getPort());
      connector.setHost(endpoint.getHttpUri().getHost());
      if ("localhost".equalsIgnoreCase(endpoint.getHttpUri().getHost())) {
        LOG.warn("You use localhost interface! It means that no external connections will be available. Don't you want to use 0.0.0.0 instead (all network interfaces)?");
      }
      getServer().addConnector(connector);
      connectorRef=new ConnectorRef(connector,createServletForConnector(connector));
      connector.start();
      connectors.put(connectorKey,connectorRef);
    }
 else {
      connectorRef.increment();
    }
    if (endpoint.isSessionSupport()) {
      enableSessionSupport();
    }
    connectorRef.servlet.connect(consumer);
  }
}
