{
  Producer producer=endpoint.createProducer();
  producer.start();
  producer.process(exchange);
  Thread.sleep(2000);
  MockEndpoint mock=getMockEndpoint("mock:split");
  mock.expectedMessageCount(2);
  mock.assertIsSatisfied();
  Message first=mock.getReceivedExchanges().get(0).getIn();
  Message second=mock.getReceivedExchanges().get(1).getIn();
  assertEquals(1,first.getAttachments().size());
  assertEquals(1,second.getAttachments().size());
  String file1=first.getAttachments().keySet().iterator().next();
  String file2=second.getAttachments().keySet().iterator().next();
  boolean logo=file1.equals("logo.jpeg") || file2.equals("logo.jpeg");
  boolean license=file1.equals("license.txt") || file2.equals("license.txt");
  assertTrue("Should have logo.jpeg file attachment",logo);
  assertTrue("Should have license.txt file attachment",license);
}
