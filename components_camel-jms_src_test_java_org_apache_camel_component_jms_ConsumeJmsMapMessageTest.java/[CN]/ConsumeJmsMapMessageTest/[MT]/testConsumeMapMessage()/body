{
  MockEndpoint endpoint=getMockEndpoint("mock:result");
  endpoint.expectedMessageCount(1);
  jmsTemplate.setPubSubDomain(false);
  jmsTemplate.send("test.map",new MessageCreator(){
    public Message createMessage(    Session session) throws JMSException {
      MapMessage mapMessage=session.createMapMessage();
      mapMessage.setString("foo","abc");
      mapMessage.setString("bar","xyz");
      return mapMessage;
    }
  }
);
  endpoint.assertIsSatisfied();
  Exchange exchange=endpoint.getReceivedExchanges().get(0);
  Map map=exchange.getIn().getBody(Map.class);
  log.info("Received map: " + map);
  assertNotNull("Should have received a map message!",map);
  assertEquals("map.foo","abc",map.get("foo"));
  assertEquals("map.bar","xyz",map.get("bar"));
  assertEquals("map.size",2,map.size());
}
