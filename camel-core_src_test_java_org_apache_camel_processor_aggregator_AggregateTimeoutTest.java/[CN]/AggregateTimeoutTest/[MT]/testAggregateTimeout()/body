{
  MockEndpoint mock=getMockEndpoint("mock:aggregated");
  mock.expectedMessageCount(0);
  template.sendBodyAndHeader("direct:start","A","id",123);
  template.sendBodyAndHeader("direct:start","B","id",123);
  Thread.sleep(3000);
  mock.assertIsSatisfied();
  assertEquals(1,INVOKED.get());
  assertNotNull(receivedExchange);
  assertEquals("AB",receivedExchange.getIn().getBody());
  assertEquals(-1,receivedIndex);
  assertEquals(-1,receivedTotal);
  assertEquals(2000,receivedTimeout);
  mock.reset();
  mock.expectedBodiesReceived("ABC");
  template.sendBodyAndHeader("direct:start","A","id",123);
  template.sendBodyAndHeader("direct:start","B","id",123);
  template.sendBodyAndHeader("direct:start","C","id",123);
  mock.assertIsSatisfied(1500);
  assertEquals(1,INVOKED.get());
}
