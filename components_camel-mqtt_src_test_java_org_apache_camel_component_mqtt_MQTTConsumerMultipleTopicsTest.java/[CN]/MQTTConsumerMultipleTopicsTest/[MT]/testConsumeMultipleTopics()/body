{
  MQTT mqtt=new MQTT();
  mqtt.setHost(MQTTTestSupport.getHostForMQTTEndpoint());
  BlockingConnection publisherConnection=mqtt.blockingConnection();
  Topic topic1=new Topic(TEST_TOPIC,QoS.AT_MOST_ONCE);
  Topic topic2=new Topic(TEST_TOPIC_2,QoS.AT_MOST_ONCE);
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedMinimumMessageCount(numberOfMessages * 2);
  publisherConnection.connect();
  String payload;
  for (int i=0; i < numberOfMessages; i++) {
    payload="Topic 1, Message " + i;
    publisherConnection.publish(topic1.name().toString(),payload.getBytes(),QoS.AT_LEAST_ONCE,false);
    payload="Topic 2, Message " + i;
    publisherConnection.publish(topic2.name().toString(),payload.getBytes(),QoS.AT_LEAST_ONCE,false);
  }
  mock.await(5,TimeUnit.SECONDS);
  mock.assertIsSatisfied();
}
