{
  if (resource == null) {
    resource=getResource();
  }
  InputStream is=null;
  if (contentCache) {
synchronized (resource) {
      if (buffer == null) {
        if (log.isDebugEnabled()) {
          log.debug("Reading resource: " + resourceUri + " into the content cache");
        }
        is=getResourceAsInputStreamWithoutCache();
        buffer=IOConverter.toBytes(is);
      }
    }
    if (log.isDebugEnabled()) {
      log.debug("Using resource: " + resourceUri + " from the content cache");
    }
    return new ByteArrayInputStream(buffer);
  }
  return getResourceAsInputStreamWithoutCache();
}
