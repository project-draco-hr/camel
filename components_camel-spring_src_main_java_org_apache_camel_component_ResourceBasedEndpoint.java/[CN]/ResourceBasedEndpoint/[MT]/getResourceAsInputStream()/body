{
  if (resource == null) {
    resource=getResource();
  }
  if (contentCache) {
synchronized (resource) {
      if (buffer == null) {
        if (log.isDebugEnabled()) {
          log.debug("Reading resource: " + resourceUri + " into the content cache");
        }
        buffer=IOConverter.toBytes(resource.getInputStream());
      }
    }
    if (log.isDebugEnabled()) {
      log.debug("Using resource: " + resourceUri + " from the content cache");
    }
    return new ByteArrayInputStream(buffer);
  }
  return resource.getInputStream();
}
