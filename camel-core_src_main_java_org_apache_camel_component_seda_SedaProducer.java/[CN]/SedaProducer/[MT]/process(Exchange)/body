{
  Exchange copy=ExchangeHelper.createCorrelatedCopy(exchange,true);
  copy.setFromEndpoint(endpoint);
  WaitForTaskToComplete wait=waitForTaskToComplete;
  if (exchange.getProperty(Exchange.ASYNC_WAIT) != null) {
    wait=exchange.getProperty(Exchange.ASYNC_WAIT,WaitForTaskToComplete.class);
  }
  if (wait == WaitForTaskToComplete.Always || (wait == WaitForTaskToComplete.IfReplyExpected && ExchangeHelper.isOutCapable(exchange))) {
    final CountDownLatch latch=new CountDownLatch(1);
    copy.addOnCompletion(new SynchronizationAdapter(){
      @Override public void onDone(      Exchange response){
        try {
          ExchangeHelper.copyResults(exchange,response);
        }
  finally {
          latch.countDown();
        }
      }
    }
);
    queue.add(copy);
    boolean done=latch.await(timeout,TimeUnit.MILLISECONDS);
    if (!done) {
      exchange.setException(new ExchangeTimedOutException(exchange,timeout));
    }
  }
 else {
    queue.add(copy);
  }
}
