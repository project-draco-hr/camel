{
  DataFormat dataFormat=context.getRegistry().lookup(ref,DataFormat.class);
  if (dataFormat == null) {
    DataFormatDefinition type=context.getRegistry().lookup(ref,DataFormatDefinition.class);
    if (type == null && context.getDataFormats() != null) {
      type=context.getDataFormats().get(ref);
    }
    if (type != null) {
      dataFormat=resolveDataFormat(type,context);
    }
  }
  if (dataFormat == null) {
    throw new IllegalArgumentException("Cannot find data format in registry with ref: " + ref);
  }
  return dataFormat;
}
