{
  OutputStream os=null;
  boolean result;
  try {
    os=new ByteArrayOutputStream();
    GenericFile<FTPFile> target=(GenericFile<FTPFile>)exchange.getProperty(FileComponent.FILE_EXCHANGE_FILE);
    ObjectHelper.notNull(target,"Exchange should have the " + FileComponent.FILE_EXCHANGE_FILE + " set");
    target.setBody(os);
    String currentDir=getCurrentDirectory();
    String path=FileUtil.onlyPath(name);
    if (path != null) {
      changeCurrentDirectory(path);
    }
    String onlyName=FileUtil.stripPath(name);
    result=client.retrieveFile(onlyName,os);
    changeCurrentDirectory(currentDir);
  }
 catch (  IOException e) {
    throw new GenericFileOperationFailedException(client.getReplyCode(),client.getReplyString(),e.getMessage(),e);
  }
 finally {
    IOHelper.close(os,"retrieve: " + name,log);
  }
  return result;
}
