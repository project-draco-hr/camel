{
  Exchange request=template.request("direct:start",new Processor(){
    @Override public void process(    Exchange exchange) throws Exception {
      Message in=exchange.getIn();
      in.setHeader(OPERATION,QUERY);
      in.setHeader(QUERY_BUILDER,new InfinispanQueryBuilder(){
        public Query build(        QueryFactory<Query> queryFactory){
          return queryFactory.from(User.class).having("name").like("%A").toBuilder().build();
        }
      }
);
    }
  }
);
  assertNull(request.getException());
  @SuppressWarnings("unchecked") List<User> queryResult=(List<User>)request.getIn().getHeader(RESULT);
  assertNotNull(queryResult);
  assertEquals(2,queryResult.size());
  assertTrue(hasUser(queryResult,"nameA","surnameA"));
  assertTrue(hasUser(queryResult,"nameA","surnameB"));
}
