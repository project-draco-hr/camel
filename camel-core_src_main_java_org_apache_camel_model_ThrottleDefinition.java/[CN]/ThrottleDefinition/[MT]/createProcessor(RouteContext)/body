{
  Processor childProcessor=this.createChildProcessor(routeContext,true);
  boolean async=getAsyncDelayed() != null && getAsyncDelayed();
  boolean shutdownThreadPool=ProcessorDefinitionHelper.willCreateNewThreadPool(routeContext,this,async);
  ScheduledExecutorService threadPool=ProcessorDefinitionHelper.getConfiguredScheduledExecutorService(routeContext,"Throttle",this,async);
  long period=getTimePeriodMillis() != null ? getTimePeriodMillis() : 1000L;
  Expression maxRequestsExpression=createMaxRequestsPerPeriodExpression(routeContext);
  if (maxRequestsExpression == null) {
    throw new IllegalArgumentException("MaxRequestsPerPeriod expression must be provided on " + this);
  }
  boolean reject=getRejectExecution() != null && getRejectExecution();
  Throttler answer=new Throttler(routeContext.getCamelContext(),childProcessor,maxRequestsExpression,period,threadPool,shutdownThreadPool,reject);
  answer.setAsyncDelayed(async);
  if (getCallerRunsWhenRejected() == null) {
    answer.setCallerRunsWhenRejected(true);
  }
 else {
    answer.setCallerRunsWhenRejected(getCallerRunsWhenRejected());
  }
  return answer;
}
