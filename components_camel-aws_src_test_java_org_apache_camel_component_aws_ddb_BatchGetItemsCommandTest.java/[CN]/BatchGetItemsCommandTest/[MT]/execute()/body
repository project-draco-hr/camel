{
  Key key=new Key(new AttributeValue("Key_1"));
  Key unprocessedKey=new Key(new AttributeValue("UNPROCESSED_KEY"));
  Map<String,KeysAndAttributes> keysAndAttributesMap=new HashMap<String,KeysAndAttributes>();
  KeysAndAttributes keysAndAttributes=new KeysAndAttributes().withKeys(key);
  keysAndAttributesMap.put("DOMAIN1",keysAndAttributes);
  exchange.getIn().setHeader(DdbConstants.BATCH_ITEMS,keysAndAttributesMap);
  command.execute();
  assertEquals(keysAndAttributesMap,ddbClient.batchGetItemRequest.getRequestItems());
  BatchResponse batchResponse=(BatchResponse)exchange.getIn().getHeader(DdbConstants.BATCH_RESPONSE,Map.class).get("DOMAIN1");
  AttributeValue value=batchResponse.getItems().get(0).get("attrName");
  KeysAndAttributes unProcessedAttributes=(KeysAndAttributes)exchange.getIn().getHeader(DdbConstants.UNPROCESSED_KEYS,Map.class).get("DOMAIN1");
  Key next=unProcessedAttributes.getKeys().iterator().next();
  assertEquals(new AttributeValue("attrValue"),value);
  assertEquals(unprocessedKey,next);
}
