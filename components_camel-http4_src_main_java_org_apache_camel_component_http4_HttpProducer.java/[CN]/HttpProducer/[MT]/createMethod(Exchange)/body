{
  String url=HttpHelper.createURL(exchange,getEndpoint());
  URI uri=new URI(url);
  HttpEntity requestEntity=createRequestEntity(exchange);
  HttpMethods methodToUse=HttpHelper.createMethod(exchange,getEndpoint(),requestEntity != null);
  String queryString=exchange.getIn().getHeader(Exchange.HTTP_QUERY,String.class);
  if (queryString == null) {
    queryString=getEndpoint().getHttpUri().getRawQuery();
  }
  if (uri.getScheme() == null || uri.getHost() == null) {
    throw new IllegalArgumentException("Invalid uri: " + uri + ". If you are forwarding/bridging http endpoints, then enable the bridgeEndpoint option on the endpoint: "+ getEndpoint());
  }
  StringBuilder builder=new StringBuilder(uri.getScheme()).append("://").append(uri.getHost());
  if (uri.getPort() != -1) {
    builder.append(":").append(uri.getPort());
  }
  if (uri.getPath() != null) {
    builder.append(uri.getRawPath());
  }
  if (queryString != null) {
    builder.append('?');
    builder.append(queryString);
  }
  HttpRequestBase httpRequest=methodToUse.createMethod(builder.toString());
  if (methodToUse.isEntityEnclosing()) {
    ((HttpEntityEnclosingRequestBase)httpRequest).setEntity(requestEntity);
    if (requestEntity != null && requestEntity.getContentType() == null) {
      LOG.debug("No Content-Type provided for URL: {} with exchange: {}",url,exchange);
    }
  }
  return httpRequest;
}
