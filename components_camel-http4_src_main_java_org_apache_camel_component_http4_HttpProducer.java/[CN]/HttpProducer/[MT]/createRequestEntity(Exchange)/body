{
  Message in=exchange.getIn();
  if (in.getBody() == null) {
    return null;
  }
  HttpEntity answer=in.getBody(HttpEntity.class);
  if (answer == null) {
    try {
      Object data=in.getBody();
      if (data != null) {
        String contentType=ExchangeHelper.getContentType(exchange);
        if (data instanceof File || data instanceof GenericFile) {
          File file=in.getBody(File.class);
          if (file != null) {
            answer=new FileEntity(file,contentType);
          }
        }
 else         if (data instanceof String) {
          String charset=IOConverter.getCharsetName(exchange,false);
          answer=new StringEntity((String)data,charset);
          if (contentType != null) {
            ((StringEntity)answer).setContentType(contentType);
          }
        }
        if (answer == null) {
          in.getMandatoryBody(InputStream.class);
          answer=new InputStreamEntity(in.getBody(InputStream.class),-1);
          if (contentType != null) {
            ((InputStreamEntity)answer).setContentType(contentType);
          }
        }
      }
    }
 catch (    UnsupportedEncodingException e) {
      throw new RuntimeCamelException(e);
    }
  }
  return answer;
}
