{
  if (event instanceof CamelContextStartedEvent) {
    CamelContext context=((CamelContextStartedEvent)event).getContext();
    Properties props=new Properties();
    props.put(CONTEXT_SYMBOLIC_NAME_PROPERTY,bundleContext.getBundle().getSymbolicName());
    props.put(CONTEXT_VERSION_PROPERTY,getBundleVersion(bundleContext.getBundle()));
    if (log.isDebugEnabled()) {
      log.debug("Registering CamelContext [{}] in OSGi registry",context.getName());
    }
    ServiceRegistration reg=bundleContext.registerService(CamelContext.class.getName(),context,props);
    registrations.put(context,reg);
  }
 else   if (event instanceof CamelContextStoppingEvent) {
    CamelContext context=((CamelContextStoppingEvent)event).getContext();
    ServiceRegistration reg=registrations.get(context);
    if (reg != null) {
      if (log.isDebugEnabled()) {
        log.debug("Unregistering CamelContext [{}] from OSGi registry",context.getName());
      }
      reg.unregister();
    }
  }
}
