{
  if (event instanceof CamelContextStartedEvent) {
    CamelContext context=((CamelContextStartedEvent)event).getContext();
    Dictionary<String,Object> props=new Hashtable<String,Object>();
    props.put(CONTEXT_SYMBOLIC_NAME_PROPERTY,bundleContext.getBundle().getSymbolicName());
    props.put(CONTEXT_VERSION_PROPERTY,getBundleVersion(bundleContext.getBundle()));
    props.put(CONTEXT_NAME_PROPERTY,context.getName());
    if (log.isDebugEnabled()) {
      log.debug("Registering CamelContext [{}] of in OSGi registry",context.getName());
    }
    ServiceRegistration reg=bundleContext.registerService(CamelContext.class.getName(),context,props);
    registrations.put(context,reg);
  }
 else   if (event instanceof CamelContextStoppingEvent) {
    CamelContext context=((CamelContextStoppingEvent)event).getContext();
    ServiceRegistration reg=registrations.remove(context);
    if (reg != null) {
      if (log.isDebugEnabled()) {
        log.debug("Unregistering CamelContext [{}] from OSGi registry",context.getName());
      }
      try {
        reg.unregister();
      }
 catch (      Exception e) {
        log.warn("Error unregistering CamelContext [{}] from OSGi registry. This exception will be ignored.",context.getName(),e);
      }
    }
  }
}
