{
  ServiceReference[] refs=bundleContext.getServiceReferences(CamelContext.class.getName(),"(camel.context.symbolicname=" + bundleContext.getBundle().getSymbolicName() + ")");
  if (refs == null) {
    Dictionary<String,Object> props=new Hashtable<String,Object>();
    props.put(CONTEXT_SYMBOLIC_NAME_PROPERTY,bundleContext.getBundle().getSymbolicName());
    props.put(CONTEXT_VERSION_PROPERTY,getBundleVersion(bundleContext.getBundle()));
    props.put(CONTEXT_NAME_PROPERTY,camelContext.getName());
    if (log.isDebugEnabled()) {
      log.debug("Registering CamelContext [{}] of in OSGi registry",camelContext.getName());
    }
    ServiceRegistration reg=bundleContext.registerService(CamelContext.class.getName(),camelContext,props);
    if (reg != null) {
      registrations.put(camelContext,reg);
    }
    return reg;
  }
 else {
    return null;
  }
}
