{
  String name=camelContext.getName();
  String symbolicName=bundleContext.getBundle().getSymbolicName() + "-" + name;
  Version bundleVersion=getBundleVersion(bundleContext.getBundle());
  ServiceReference[] refs=bundleContext.getServiceReferences(CamelContext.class.getName(),"(&(" + CONTEXT_SYMBOLIC_NAME_PROPERTY + "="+ symbolicName+ ")("+ CONTEXT_VERSION_PROPERTY+ "="+ bundleVersion+ "))");
  if (refs == null) {
    Dictionary<String,Object> props=new Hashtable<String,Object>();
    props.put(CONTEXT_SYMBOLIC_NAME_PROPERTY,symbolicName);
    props.put(CONTEXT_VERSION_PROPERTY,bundleVersion);
    props.put(CONTEXT_NAME_PROPERTY,name);
    if (log.isDebugEnabled()) {
      log.debug("Registering CamelContext [{}] of in OSGi registry",camelContext.getName());
    }
    ServiceRegistration reg=bundleContext.registerService(CamelContext.class.getName(),camelContext,props);
    if (reg != null) {
      registrations.put(camelContext,reg);
    }
    return reg;
  }
 else {
    return null;
  }
}
