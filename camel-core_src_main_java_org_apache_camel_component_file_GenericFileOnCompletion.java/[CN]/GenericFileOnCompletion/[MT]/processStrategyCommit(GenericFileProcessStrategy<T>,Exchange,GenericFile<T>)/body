{
  if (endpoint.isIdempotent()) {
    String key=absoluteFileName;
    if (endpoint.getIdempotentKey() != null) {
      Exchange dummy=endpoint.createExchange(file);
      key=endpoint.getIdempotentKey().evaluate(dummy,String.class);
    }
    if (key != null) {
      endpoint.getIdempotentRepository().add(key);
    }
  }
  handleDoneFile(exchange);
  try {
    log.trace("Commit file strategy: {} for file: {}",processStrategy,file);
    processStrategy.commit(operations,endpoint,exchange,file);
  }
 catch (  Exception e) {
    handleException("Error during commit",exchange,e);
  }
}
