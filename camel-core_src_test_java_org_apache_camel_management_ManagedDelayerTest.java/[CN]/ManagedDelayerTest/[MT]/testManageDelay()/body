{
  getMockEndpoint("mock:result").expectedMessageCount(1);
  template.sendBody("direct:start","Hello World");
  assertMockEndpointsSatisfied();
  MBeanServer mbeanServer=getMBeanServer();
  ObjectName delayerName=ObjectName.getInstance("org.apache.camel:context=localhost/camel-1,type=processors,name=\"mydelayer\"");
  ObjectName routeName=ObjectName.getInstance("org.apache.camel:context=localhost/camel-1,type=routes,name=\"route1\"");
  Long completed=(Long)mbeanServer.getAttribute(routeName,"ExchangesCompleted");
  assertEquals(1,completed.longValue());
  Long last=(Long)mbeanServer.getAttribute(routeName,"LastProcessingTime");
  Long total=(Long)mbeanServer.getAttribute(routeName,"TotalProcessingTime");
  assertTrue("Should take around 1 sec: was " + last,last > 900);
  assertTrue("Should take around 1 sec: was " + total,total > 900);
  mbeanServer.invoke(delayerName,"constantDelay",new Object[]{2000},new String[]{"java.lang.Integer"});
  template.sendBody("direct:start","Bye World");
  Long delay=(Long)mbeanServer.getAttribute(delayerName,"Delay");
  assertNotNull(delay);
  completed=(Long)mbeanServer.getAttribute(routeName,"ExchangesCompleted");
  assertEquals(2,completed.longValue());
  last=(Long)mbeanServer.getAttribute(routeName,"LastProcessingTime");
  total=(Long)mbeanServer.getAttribute(routeName,"TotalProcessingTime");
  assertTrue("Should take around 2 sec: was " + last,last > 1900);
  assertTrue("Should be around 3 sec now: was " + total,total > 2900);
}
