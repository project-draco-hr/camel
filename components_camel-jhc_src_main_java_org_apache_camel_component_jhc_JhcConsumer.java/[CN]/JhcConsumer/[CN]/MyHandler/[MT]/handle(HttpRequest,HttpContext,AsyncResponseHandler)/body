{
  final Exchange exchange=getEndpoint().createExchange();
  exchange.getIn().setHeader("http.uri",request.getRequestLine().getUri());
  if (request instanceof HttpEntityEnclosingRequest) {
    exchange.getIn().setBody(((HttpEntityEnclosingRequest)request).getEntity());
  }
  try {
    getProcessor().process(exchange);
  }
 catch (  Exception e) {
    exchange.setException(e);
  }
  LOG.debug("handleExchange");
  ProtocolVersion httpVersion=(HttpVersion)request.getRequestLine().getProtocolVersion();
  Integer responseCode=exchange.getOut().getHeader(Exchange.HTTP_RESPONSE_CODE,Integer.class);
  if (responseCode == null) {
    responseCode=HttpStatus.SC_OK;
  }
  HttpResponse response=responseFactory.newHttpResponse(httpVersion,responseCode,context);
  response.setParams(params);
  HttpEntity entity=exchange.getOut().getBody(HttpEntity.class);
  response.setEntity(entity);
  response.setParams(getEndpoint().getParams());
  try {
    handler.sendResponse(response);
  }
 catch (  Exception e) {
    LOG.info("Get exception when send the reponse" + e);
  }
}
