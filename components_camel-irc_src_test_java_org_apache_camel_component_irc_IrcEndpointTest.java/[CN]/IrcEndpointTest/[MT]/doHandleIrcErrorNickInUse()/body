{
  when(connection.getNick()).thenReturn("nick");
  endpoint.handleIrcError(IRCConstants.ERR_NICKNAMEINUSE,"foo");
  verify(connection).doNick("nick-");
  when(connection.getNick()).thenReturn("nick---");
  verify(connection,never()).doNick("foo");
}
