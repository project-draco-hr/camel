{
  File file=new File(path);
  FileOutputStream fos=new FileOutputStream(file,true);
  try {
    IOHelper.copy(bundle.build(),fos);
  }
  finally {
    IOHelper.close(fos);
  }
  FileInputStream fis=null;
  JarInputStream jis=null;
  try {
    fis=new FileInputStream(file);
    jis=new JarInputStream(fis);
    Map<String,String> headers=new HashMap<String,String>();
    for (    Map.Entry<Object,Object> entry : jis.getManifest().getMainAttributes().entrySet()) {
      headers.put(entry.getKey().toString(),entry.getValue().toString());
    }
    return new BundleDescriptor(getClass().getClassLoader(),new URL("jar:" + file.toURI().toString() + "!/"),headers);
  }
  finally {
    IOHelper.close(fis,jis);
  }
}
