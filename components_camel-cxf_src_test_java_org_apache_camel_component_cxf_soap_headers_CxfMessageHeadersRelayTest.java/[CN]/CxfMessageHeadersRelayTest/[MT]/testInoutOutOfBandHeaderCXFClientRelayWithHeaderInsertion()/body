{
  HeaderService s=new HeaderService(getClass().getClassLoader().getResource("soap_header.wsdl"),HeaderService.SERVICE);
  HeaderTester proxy=s.getSoapPortRelayWithInsertion();
  ((BindingProvider)proxy).getRequestContext().put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY,"http://localhost:" + portE2 + "/CxfMessageHeadersRelayTest/HeaderService/");
  addOutOfBoundHeader(proxy,false);
  Me me=new Me();
  me.setFirstName("john");
  me.setLastName("Doh");
  Me response=proxy.inoutOutOfBandHeader(me);
  assertTrue("Expected the out of band header to propagate but it didn't",response.getFirstName().equals("pass"));
  InvocationHandler handler=Proxy.getInvocationHandler(proxy);
  BindingProvider bp=null;
  if (!(handler instanceof BindingProvider)) {
    fail("Unable to cast dynamic proxy InocationHandler to BindingProvider type");
  }
  bp=(BindingProvider)handler;
  Map<String,Object> responseContext=bp.getResponseContext();
  validateReturnedOutOfBandHeaderWithInsertion(responseContext,true);
}
