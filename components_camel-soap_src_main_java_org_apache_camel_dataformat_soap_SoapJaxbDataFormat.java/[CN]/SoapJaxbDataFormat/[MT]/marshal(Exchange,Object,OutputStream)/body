{
  checkElementNameStrategy(exchange);
  String soapAction=(String)exchange.getIn().getHeader(Exchange.SOAP_ACTION);
  if (soapAction == null && inputObject instanceof BeanInvocation) {
    BeanInvocation beanInvocation=(BeanInvocation)inputObject;
    WebMethod webMethod=beanInvocation.getMethod().getAnnotation(WebMethod.class);
    if (webMethod != null && webMethod.action() != null) {
      soapAction=webMethod.action();
    }
  }
  Body body=new Body();
  Throwable exception=exchange.getProperty(Exchange.EXCEPTION_CAUGHT,Throwable.class);
  if (exception == null) {
    exception=exchange.getIn().getHeader(Exchange.EXCEPTION_CAUGHT,Throwable.class);
  }
  final JAXBElement<?> content;
  if (exception != null) {
    content=createFaultFromException(exception,soapAction);
  }
 else {
    content=createBodyContentFromObject(inputObject,soapAction);
  }
  body.getAny().add(content);
  Envelope envelope=new Envelope();
  envelope.setBody(body);
  JAXBElement<Envelope> envelopeEl=new ObjectFactory().createEnvelope(envelope);
  super.marshal(exchange,envelopeEl,stream);
}
