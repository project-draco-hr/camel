{
  if (exchange.getIn().getAttachments().isEmpty()) {
    return null;
  }
  try {
    List<Message> answer=new ArrayList<Message>();
    Message inMessage=exchange.getIn();
    for (    Map.Entry<String,DataHandler> entry : inMessage.getAttachments().entrySet()) {
      Message attachmentMessage;
      if (extractAttachments) {
        attachmentMessage=extractAttachment(inMessage,entry.getKey());
      }
 else {
        attachmentMessage=splitAttachment(inMessage,entry.getKey(),entry.getValue());
      }
      if (attachmentMessage != null) {
        answer.add(attachmentMessage);
      }
    }
    return answer;
  }
 catch (  Exception e) {
    throw new RuntimeCamelException("Unable to split attachments from MimeMultipart message",e);
  }
}
