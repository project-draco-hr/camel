{
  HttpRequestBase httpRequest=createMethod(exchange);
  Message in=exchange.getIn();
  HeaderFilterStrategy strategy=getEndpoint().getHeaderFilterStrategy();
  for (  String headerName : in.getHeaders().keySet()) {
    String headerValue=in.getHeader(headerName,String.class);
    if (strategy != null && !strategy.applyFilterToCamelHeaders(headerName,headerValue,exchange)) {
      httpRequest.addHeader(headerName,headerValue);
    }
  }
  HttpResponse httpResponse=null;
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Executing http " + httpRequest.getMethod() + " method: "+ httpRequest.getURI().toString());
    }
    httpResponse=executeMethod(httpRequest);
    int responseCode=httpResponse.getStatusLine().getStatusCode();
    if (LOG.isDebugEnabled()) {
      LOG.debug("Http responseCode: " + responseCode);
    }
    if (throwException && (responseCode < 100 || responseCode >= 300)) {
      throw populateHttpOperationFailedException(exchange,httpRequest,httpResponse,responseCode);
    }
 else {
      populateResponse(exchange,httpRequest,httpResponse,in,strategy,responseCode);
    }
  }
  finally {
    if (httpResponse != null && httpResponse.getEntity() != null) {
      try {
        httpResponse.getEntity().consumeContent();
      }
 catch (      IOException e) {
      }
    }
  }
}
