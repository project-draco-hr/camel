{
  if (!isMatched(file,isDirectory,files)) {
    log.trace("File did not match. Will skip this file: {}",file);
    return false;
  }
  if (!isDirectory && isInProgress(file)) {
    if (log.isTraceEnabled()) {
      log.trace("Skipping as file is already in progress: {}",file.getFileName());
    }
    return false;
  }
  if (!isDirectory && endpoint.isIdempotent()) {
    String key=file.getAbsoluteFilePath();
    if (endpoint.getIdempotentKey() != null) {
      Exchange dummy=endpoint.createExchange(file);
      key=endpoint.getIdempotentKey().evaluate(dummy,String.class);
    }
    if (key != null && endpoint.getIdempotentRepository().contains(key)) {
      log.trace("This consumer is idempotent and the file has been consumed before. Will skip this file: {}",file);
      return false;
    }
  }
  return true;
}
