{
  fileExpressionResult=null;
  if (!prePollCheck()) {
    log.debug("Skipping pool as pre poll check returned false");
  }
  List<GenericFile<T>> files=new ArrayList<GenericFile<T>>();
  String name=endpoint.getConfiguration().getDirectory();
  pollDirectory(name,files);
  if (endpoint.getSorter() != null) {
    Collections.sort(files,endpoint.getSorter());
  }
  List<GenericFileExchange<T>> exchanges=new ArrayList<GenericFileExchange<T>>(files.size());
  for (  GenericFile<T> file : files) {
    GenericFileExchange<T> exchange=endpoint.createExchange(file);
    endpoint.configureMessage(file,exchange.getIn());
    exchanges.add(exchange);
  }
  if (endpoint.getSortBy() != null) {
    Collections.sort(exchanges,endpoint.getSortBy());
  }
  int total=exchanges.size();
  if (total > 0 && log.isDebugEnabled()) {
    log.debug("Total " + total + " files to consume");
  }
  processBatch(new ArrayList<Exchange>(exchanges));
}
