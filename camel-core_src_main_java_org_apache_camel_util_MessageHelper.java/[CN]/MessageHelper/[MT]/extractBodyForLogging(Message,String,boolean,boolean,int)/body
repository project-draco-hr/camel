{
  if (maxChars < 0) {
    return prepend + "[Body is not logged]";
  }
  Object obj=message.getBody();
  if (obj == null) {
    return prepend + "[Body is null]";
  }
  if (!allowStreams) {
    if (obj instanceof Source && !(obj instanceof StringSource || obj instanceof BytesSource)) {
      return prepend + "[Body is instance of java.xml.transform.Source]";
    }
 else     if (obj instanceof StreamCache) {
      return prepend + "[Body is instance of org.apache.camel.StreamCache]";
    }
 else     if (obj instanceof InputStream) {
      return prepend + "[Body is instance of java.io.InputStream]";
    }
 else     if (obj instanceof OutputStream) {
      return prepend + "[Body is instance of java.io.OutputStream]";
    }
 else     if (obj instanceof Reader) {
      return prepend + "[Body is instance of java.io.Reader]";
    }
 else     if (obj instanceof Writer) {
      return prepend + "[Body is instance of java.io.Writer]";
    }
 else     if (obj instanceof WrappedFile || obj instanceof File) {
      if (!allowFiles) {
        return prepend + "[Body is file based: " + obj+ "]";
      }
    }
  }
  if (!allowFiles) {
    if (obj instanceof WrappedFile || obj instanceof File) {
      return prepend + "[Body is file based: " + obj+ "]";
    }
  }
  StreamCache cache;
  if (obj instanceof StreamCache) {
    cache=(StreamCache)obj;
  }
 else {
    cache=null;
  }
  String body=null;
  if (message.getExchange() != null) {
    try {
      body=message.getExchange().getContext().getTypeConverter().convertTo(String.class,message.getExchange(),obj);
    }
 catch (    Exception e) {
    }
  }
  if (body == null) {
    body=obj.toString();
  }
  if (cache != null) {
    cache.reset();
  }
  if (body == null) {
    return prepend + "[Body is null]";
  }
  if (maxChars > 0 && body.length() > maxChars) {
    body=body.substring(0,maxChars) + "... [Body clipped after " + maxChars+ " chars, total length is "+ body.length()+ "]";
  }
  return prepend + body;
}
