{
  Processor childProcessor=this.createChildProcessor(routeContext,true);
  aggregationStrategy=createAggregationStrategy(routeContext);
  executorService=ExecutorServiceHelper.getConfiguredExecutorService(routeContext,"Split",this);
  if (isParallelProcessing() && executorService == null) {
    executorService=routeContext.getCamelContext().getExecutorServiceStrategy().newDefaultThreadPool(this,"Split");
  }
  if (getTimeout() > 0 && !isParallelProcessing()) {
    throw new IllegalArgumentException("Timeout is used but ParallelProcessing has not been enabled.");
  }
  if (onPrepareRef != null) {
    onPrepare=CamelContextHelper.mandatoryLookup(routeContext.getCamelContext(),onPrepareRef,Processor.class);
  }
  Expression exp=getExpression().createExpression(routeContext);
  return new Splitter(routeContext.getCamelContext(),exp,childProcessor,aggregationStrategy,isParallelProcessing(),executorService,isStreaming(),isStopOnException(),getTimeout(),onPrepare);
}
