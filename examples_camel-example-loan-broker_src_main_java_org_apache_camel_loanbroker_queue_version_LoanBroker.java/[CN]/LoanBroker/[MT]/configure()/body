{
  from("test-jms:queue:loanRequestQueue").to("test-jms:queue:creditRequestQueue");
  from("test-jms:queue:creditRequestQueue").process(new CreditAgency()).to("test-jms:queue:creditResponseQueue");
  from("test-jms:queue:creditResponseQueue").multicast().to("test-jms:queue:bank1","test-jms:queue:bank2","test-jms:queue:bank3");
  from("test-jms:queue:bank1").process(new Bank("bank1")).to("direct:queue:bankReplyQueue");
  from("test-jms:queue:bank2").process(new Bank("bank2")).to("direct:queue:bankReplyQueue");
  from("test-jms:queue:bank3").process(new Bank("bank3")).to("direct:queue:bankReplyQueue");
  from("direct:queue:bankReplyQueue").aggregator(header(Constants.PROPERTY_SSN),new BankResponseAggregationStrategy()).completedPredicate(header("aggregated").isEqualTo(3)).process(new Translator()).to("test-jms:queue:loanReplyQueue");
}
