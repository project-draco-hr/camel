{
  from("jms:queue:loanRequestQueue").to("jms:queue:creditRequestQueue");
  from("jms:queue:creditRequestQueue").process(new CreditAgency()).to("jms:queue:creditResponseQueue");
  from("jms:queue:creditResponseQueue").multicast().to("jms:queue:bank1","jms:queue:bank2","jms:queue:bank3");
  from("jms:queue:bank1").process(new Bank("bank1")).to("jms:queue:bankReplyQueue");
  from("jms:queue:bank2").process(new Bank("bank2")).to("jms:queue:bankReplyQueue");
  from("jms:queue:bank3").process(new Bank("bank3")).to("jms:queue:bankReplyQueue");
  from("jms:queue:bankReplyQueue").aggregate(header(Constants.PROPERTY_SSN),new BankResponseAggregationStrategy()).completedPredicate(header(Exchange.AGGREGATED_COUNT).isEqualTo(3)).process(new Translator()).to("jms:queue:loanReplyQueue");
  from("jms:queue2:parallelLoanRequestQueue").process(new CreditAgency()).multicast(new BankResponseAggregationStrategy().setAggregatingOutMessage(true)).setParallelProcessing(true).to("jms:queue2:bank1","jms:queue2:bank2","jms:queue2:bank3");
  from("jms:queue2:bank1").process(new Bank("bank1"));
  from("jms:queue2:bank2").process(new Bank("bank2"));
  from("jms:queue2:bank3").process(new Bank("bank3"));
}
