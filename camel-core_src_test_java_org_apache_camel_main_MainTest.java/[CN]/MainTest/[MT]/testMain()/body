{
  Main main=new Main();
  main.addRouteBuilder(new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("direct:start").to("mock:results");
    }
  }
);
  main.bind("foo",new Integer(31));
  main.start();
  main.getCamelTemplate().sendBody("direct:start","<message>1</message>");
  List<CamelContext> contextList=main.getCamelContexts();
  assertNotNull(contextList);
  assertEquals("Did not get the expected count of Camel contexts",1,contextList.size());
  CamelContext camelContext=contextList.get(0);
  assertEquals("Could not find the registry bound object",31,((DefaultCamelContext)camelContext).getRegistry().lookup("foo"));
  MockEndpoint endpoint=camelContext.getEndpoint("mock:results",MockEndpoint.class);
  endpoint.expectedMinimumMessageCount(1);
  endpoint.assertIsSatisfied();
  main.stop();
}
