{
  byte buffer[]=new byte[BUFFER_SIZE];
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  int count;
  count=in.read(buffer);
  while (count != -1) {
    baos.write(buffer,0,count);
    count=in.read(buffer);
  }
  String str=null;
  String charsetName=exchange.getProperty(Exchange.CHARSET_NAME,String.class);
  if (charsetName != null) {
    try {
      str=baos.toString(charsetName);
    }
 catch (    UnsupportedEncodingException e) {
      LOG.warn("Cannot convert the byte[] into String with the charset: " + charsetName,e);
      str=baos.toString();
    }
  }
 else {
    str=baos.toString();
  }
  in.close();
  return new Message(str);
}
