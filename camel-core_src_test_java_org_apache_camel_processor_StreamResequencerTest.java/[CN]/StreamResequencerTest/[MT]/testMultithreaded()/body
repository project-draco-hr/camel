{
  int numMessages=500;
  Thread t1=new Sender(context.createProducerTemplate(),0,numMessages,2);
  Thread t2=new Sender(context.createProducerTemplate(),1,numMessages + 1,2);
  Object[] bodies=new Object[numMessages];
  for (int i=0; i < numMessages; i++) {
    bodies[i]="msg" + i;
  }
  resultEndpoint.expectedBodiesReceived(bodies);
  t1.start();
  t2.start();
  t1.join();
  t2.join();
  resultEndpoint.assertIsSatisfied();
}
