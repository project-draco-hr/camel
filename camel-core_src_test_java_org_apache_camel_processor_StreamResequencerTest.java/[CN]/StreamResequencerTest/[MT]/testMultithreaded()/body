{
  int numMessages=100;
  ExecutorService service=Executors.newFixedThreadPool(2);
  service.execute(new Sender(context.createProducerTemplate(),0,numMessages,2));
  service.execute(new Sender(context.createProducerTemplate(),1,numMessages + 1,2));
  Object[] bodies=new Object[numMessages];
  for (int i=0; i < numMessages; i++) {
    bodies[i]="msg" + i;
  }
  resultEndpoint.expectedBodiesReceived(bodies);
  resultEndpoint.setResultWaitTime(20000);
  resultEndpoint.assertIsSatisfied();
  service.shutdownNow();
}
