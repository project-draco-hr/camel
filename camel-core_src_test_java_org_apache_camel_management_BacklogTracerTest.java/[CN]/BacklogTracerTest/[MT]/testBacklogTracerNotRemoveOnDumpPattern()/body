{
  MBeanServer mbeanServer=getMBeanServer();
  ObjectName on=new ObjectName("org.apache.camel:context=localhost/camel-1,type=tracer,name=BacklogTracer");
  assertNotNull(on);
  mbeanServer.isRegistered(on);
  Boolean removeOnDump=(Boolean)mbeanServer.getAttribute(on,"RemoveOnDump");
  assertEquals(Boolean.TRUE,removeOnDump);
  mbeanServer.setAttribute(on,new Attribute("RemoveOnDump",Boolean.FALSE));
  Boolean enabled=(Boolean)mbeanServer.getAttribute(on,"Enabled");
  assertEquals("Should not be enabled",Boolean.FALSE,enabled);
  mbeanServer.setAttribute(on,new Attribute("Enabled",Boolean.TRUE));
  getMockEndpoint("mock:foo").expectedMessageCount(2);
  getMockEndpoint("mock:bar").expectedMessageCount(2);
  template.sendBody("direct:start","Hello World");
  template.sendBody("direct:start","Bye World");
  assertMockEndpointsSatisfied();
  List<BacklogTracerEventMessage> events=(List<BacklogTracerEventMessage>)mbeanServer.invoke(on,"dumpTracedMessages",new Object[]{"foo"},new String[]{"java.lang.String"});
  assertNotNull(events);
  assertEquals(2,events.size());
  events=(List<BacklogTracerEventMessage>)mbeanServer.invoke(on,"dumpTracedMessages",new Object[]{"foo"},new String[]{"java.lang.String"});
  assertEquals(2,events.size());
  resetMocks();
  getMockEndpoint("mock:foo").expectedMessageCount(1);
  getMockEndpoint("mock:bar").expectedMessageCount(1);
  template.sendBody("direct:start","Hi World");
  assertMockEndpointsSatisfied();
  events=(List<BacklogTracerEventMessage>)mbeanServer.invoke(on,"dumpTracedMessages",new Object[]{"foo"},new String[]{"java.lang.String"});
  assertNotNull(events);
  assertEquals(3,events.size());
  events=(List<BacklogTracerEventMessage>)mbeanServer.invoke(on,"dumpTracedMessages",new Object[]{"bar"},new String[]{"java.lang.String"});
  assertNotNull(events);
  assertEquals(3,events.size());
}
