{
  Context context=super.createJndiContext();
  File config=new File(CONFIG_FILE);
  if (!config.exists()) {
    throw new Exception("missing config file: " + config.getPath());
  }
  repository=new TransientRepository(CONFIG_FILE,"target/repository_with_auth");
  SessionImpl session=(SessionImpl)repository.login(new SimpleCredentials("admin","admin".toCharArray()));
  UserManager userManager=session.getUserManager();
  User user=(User)userManager.getAuthorizable("test");
  if (user == null) {
    user=userManager.createUser("test","quatloos");
  }
  String path=session.getRootNode().getPath();
  AccessControlManager accessControlManager=session.getAccessControlManager();
  AccessControlPolicyIterator acls=accessControlManager.getApplicablePolicies(path);
  AccessControlList acl=null;
  if (acls.hasNext()) {
    acl=(AccessControlList)acls.nextAccessControlPolicy();
  }
 else {
    acl=(AccessControlList)accessControlManager.getPolicies(path)[0];
  }
  acl.addAccessControlEntry(user.getPrincipal(),accessControlManager.getSupportedPrivileges(path));
  accessControlManager.setPolicy(path,acl);
  session.save();
  session.logout();
  context.bind("repository",repository);
  return context;
}
