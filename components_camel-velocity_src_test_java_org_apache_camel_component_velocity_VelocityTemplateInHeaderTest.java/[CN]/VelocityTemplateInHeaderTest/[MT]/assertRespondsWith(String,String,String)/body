{
  Exchange response=template.request("direct:a",new Processor(){
    public void process(    Exchange exchange) throws Exception {
      Message in=exchange.getIn();
      in.setHeader(VelocityConstants.VELOCITY_TEMPLATE,"<hello>${headers." + headerName + "}</hello>");
      in.setHeader(headerName,headerValue);
    }
  }
);
  assertOutMessageBodyEquals(response,expectedBody);
  Object template=response.getOut().getHeader(VelocityConstants.VELOCITY_TEMPLATE);
  assertNull("Template header should have been removed",template);
  Set<Entry<String,Object>> entrySet=response.getOut().getHeaders().entrySet();
  boolean keyFound=false;
  for (  Entry<String,Object> entry : entrySet) {
    if (entry.getKey().equals(headerName)) {
      keyFound=true;
    }
  }
  assertTrue("Header should been found",keyFound);
}
