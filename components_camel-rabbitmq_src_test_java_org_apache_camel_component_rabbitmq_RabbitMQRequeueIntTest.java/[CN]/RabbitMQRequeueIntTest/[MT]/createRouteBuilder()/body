{
  return new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("direct:rabbitMQ").id("producingRoute").log("Sending message").inOnly(rabbitMQEndpoint).to(producingMockEndpoint);
      from(rabbitMQEndpoint).id("consumingRoute").log("Receiving message").inOnly(consumingMockEndpoint).choice().when(body().isEqualTo("requeue header false")).log("Setting REQUEUE flag to false").setHeader(RabbitMQConstants.REQUEUE,constant(false)).when(body().isEqualTo("requeue header true")).log("Setting REQUEUE flag to true").setHeader(RabbitMQConstants.REQUEUE,constant(true)).when(body().isEqualTo("non-boolean header")).log("Setting REQUEUE flag to non-boolean").setHeader(RabbitMQConstants.REQUEUE,constant(4l)).end().throwException(new Exception("Simulated exception"));
    }
  }
;
}
