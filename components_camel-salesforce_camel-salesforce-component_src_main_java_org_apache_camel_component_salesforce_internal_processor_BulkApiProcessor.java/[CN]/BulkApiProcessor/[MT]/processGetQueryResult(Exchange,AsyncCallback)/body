{
  String jobId;
  BatchInfo batchBody;
  String batchId;
  batchBody=exchange.getIn().getBody(BatchInfo.class);
  String resultId;
  if (batchBody != null) {
    jobId=batchBody.getJobId();
    batchId=batchBody.getId();
    resultId=getParameter(RESULT_ID,exchange,IGNORE_BODY,NOT_OPTIONAL);
  }
 else {
    jobId=getParameter(JOB_ID,exchange,IGNORE_BODY,NOT_OPTIONAL);
    batchId=getParameter(BATCH_ID,exchange,IGNORE_BODY,NOT_OPTIONAL);
    resultId=getParameter(RESULT_ID,exchange,USE_BODY,NOT_OPTIONAL);
  }
  bulkClient.getQueryResult(jobId,batchId,resultId,new BulkApiClient.StreamResponseCallback(){
    @Override public void onResponse(    InputStream inputStream,    SalesforceException ex){
      StreamCache body=null;
      if (inputStream != null) {
        try {
          body=StreamCacheConverter.convertToStreamCache(inputStream,exchange);
        }
 catch (        IOException e) {
          String msg="Error retrieving query result: " + e.getMessage();
          ex=new SalesforceException(msg,e);
        }
 finally {
          try {
            inputStream.close();
          }
 catch (          IOException e) {
          }
        }
      }
      processResponse(exchange,body,ex,callback);
    }
  }
);
}
