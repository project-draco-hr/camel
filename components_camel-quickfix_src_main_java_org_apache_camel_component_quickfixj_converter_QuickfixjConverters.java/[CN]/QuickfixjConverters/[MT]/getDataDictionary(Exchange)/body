{
  DataDictionary dataDictionary=null;
  Object dictionaryValue=exchange.getProperties().get(QuickfixjEndpoint.DATA_DICTIONARY_KEY);
  if (dictionaryValue instanceof DataDictionary) {
    dataDictionary=(DataDictionary)dictionaryValue;
  }
 else   if (dictionaryValue instanceof String) {
    dataDictionary=new DataDictionary((String)dictionaryValue);
  }
 else {
    SessionID sessionID=(SessionID)exchange.getIn().getHeader(QuickfixjEndpoint.SESSION_ID_KEY);
    Session session=Session.lookupSession(sessionID);
    dataDictionary=session != null ? session.getDataDictionary() : null;
  }
  return dataDictionary;
}
