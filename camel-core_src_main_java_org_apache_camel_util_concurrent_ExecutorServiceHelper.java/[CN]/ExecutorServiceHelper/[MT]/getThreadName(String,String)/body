{
  String answer=pattern.replaceFirst("\\$\\{counter\\}","" + nextThreadCounter());
  answer=answer.replaceFirst("\\$\\{name\\}",name);
  if (answer.indexOf("$") > -1 || answer.indexOf("${") > -1 || answer.indexOf("}") > -1) {
    throw new IllegalArgumentException("Pattern is invalid: " + pattern);
  }
  return answer;
}
