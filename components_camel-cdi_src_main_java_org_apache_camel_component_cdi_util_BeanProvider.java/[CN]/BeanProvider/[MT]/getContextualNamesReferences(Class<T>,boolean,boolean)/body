{
  BeanManager beanManager=getBeanManager();
  Set<Bean<?>> beans=beanManager.getBeans(type,new AnyLiteral());
  if (beans == null || beans.isEmpty()) {
    if (optional) {
      return Collections.emptyMap();
    }
    throw new IllegalStateException("Could not find beans for Type=" + type);
  }
  if (!includeDefaultScopedBeans) {
    beans=filterDefaultScopedBeans(beans);
  }
  Map<String,T> result=new HashMap<String,T>(beans.size());
  for (  Bean<?> bean : beans) {
    result.put(bean.getName(),getContextualReference(type,beanManager,new HashSet<Bean<?>>((Collection)Arrays.asList(new Object[]{bean}))));
  }
  return result;
}
