{
  BeanManager beanManager=getBeanManager();
  Set<Bean<?>> beans=beanManager.getBeans(type,qualifiers);
  if (beans == null || beans.isEmpty()) {
    if (optional) {
      return null;
    }
    throw new IllegalStateException("Could not find beans for Type=" + type + " and qualifiers:"+ Arrays.toString(qualifiers));
  }
  return getContextualReference(type,beanManager,beans);
}
