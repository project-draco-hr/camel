{
  ChannelPipeline pipeline=ch.pipeline();
  SslHandler sslHandler=configureClientSSLOnDemand();
  if (sslHandler != null) {
    LOG.debug("Client SSL handler configured and added as an interceptor against the ChannelPipeline: {}",sslHandler);
    pipeline.addLast("ssl",sslHandler);
  }
  pipeline.addLast("http",new HttpClientCodec());
  pipeline.addLast("aggregator",new HttpObjectAggregator(configuration.getChunkedMaxContentLength()));
  if (producer.getConfiguration().getRequestTimeout() > 0) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Using request timeout {} millis",producer.getConfiguration().getRequestTimeout());
    }
    ChannelHandler timeout=new ReadTimeoutHandler(producer.getConfiguration().getRequestTimeout(),TimeUnit.MILLISECONDS);
    pipeline.addLast("timeout",timeout);
  }
  pipeline.addLast("handler",new HttpClientChannelHandler(producer));
}
