{
  QuickfixjEngine engine;
synchronized (engineInstancesLock) {
    QuickfixjEndpoint endpoint=endpoints.get(uri);
    if (endpoint == null) {
      engine=engines.get(remaining);
      if (engine == null) {
        QuickfixjConfiguration configuration=configurations.get(remaining);
        if (configuration != null) {
          SessionSettings settings=configuration.createSessionSettings();
          engine=new QuickfixjEngine(uri,settings,forcedShutdown,messageStoreFactory,logFactory,messageFactory);
        }
 else {
          engine=new QuickfixjEngine(uri,remaining,forcedShutdown,messageStoreFactory,logFactory,messageFactory);
        }
        engines.put(remaining,engine);
        if (getCamelContext().getStatus().isStarted()) {
          startQuickfixjEngine(engine);
        }
      }
      endpoint=new QuickfixjEndpoint(engine,uri,this);
      engine.addEventListener(endpoint);
      endpoints.put(uri,endpoint);
    }
    return endpoint;
  }
}
