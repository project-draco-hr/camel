{
  QuickfixjEngine engine;
synchronized (engineInstancesLock) {
    QuickfixjEndpoint endpoint=endpoints.get(uri);
    if (endpoint == null) {
      engine=engines.get(remaining);
      if (engine == null) {
        LOG.info("Creating QuickFIX/J engine using settings: " + remaining);
        SessionSettings settings=engineSettings.get(remaining);
        if (settings != null) {
          engine=new QuickfixjEngine(uri,settings,forcedShutdown,messageStoreFactory,logFactory,messageFactory);
        }
 else {
          engine=new QuickfixjEngine(uri,remaining,forcedShutdown,messageStoreFactory,logFactory,messageFactory);
        }
        engines.put(remaining,engine);
        if (isStarted()) {
          startQuickfixjEngine(engine);
        }
      }
      endpoint=new QuickfixjEndpoint(engine,uri,getCamelContext());
      engine.addEventListener(endpoint);
      endpoints.put(uri,endpoint);
    }
    return endpoint;
  }
}
