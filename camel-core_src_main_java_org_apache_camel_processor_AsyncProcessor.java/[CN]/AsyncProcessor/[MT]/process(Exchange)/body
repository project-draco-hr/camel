{
  final Processor output=getProcessor();
  if (output == null) {
    return;
  }
  final Exchange copy=exchange.newCopy(true);
  Callable<Exchange> task=new Callable<Exchange>(){
    public Exchange call() throws Exception {
      output.process(copy);
      return copy;
    }
  }
;
  Future<Exchange> future=getExecutorService().submit(task);
  WaitForTaskToComplete wait=waitTaskComplete;
  if (exchange.getIn().getHeader(Exchange.ASYNC_WAIT) != null) {
    wait=exchange.getIn().getHeader(Exchange.ASYNC_WAIT,WaitForTaskToComplete.class);
  }
  if (wait == WaitForTaskToComplete.Always) {
    Exchange response=future.get();
    ExchangeHelper.copyResults(exchange,response);
  }
 else   if (wait == WaitForTaskToComplete.IfReplyExpected && ExchangeHelper.isOutCapable(exchange)) {
    Exchange response=future.get();
    ExchangeHelper.copyResults(exchange,response);
  }
 else {
    exchange.getOut().setBody(future);
  }
}
