{
  IOHelper.close(inputStreamToClose);
  if ("in".equals(uri)) {
    inputStream=System.in;
    inputStreamToClose=null;
  }
 else   if ("file".equals(uri)) {
    inputStream=resolveStreamFromFile();
    inputStreamToClose=inputStream;
  }
 else   if ("url".equals(uri)) {
    inputStream=resolveStreamFromUrl();
    inputStreamToClose=inputStream;
  }
  if (inputStream != null) {
    Charset charset=endpoint.getCharset();
    return IOHelper.buffered(new InputStreamReader(inputStream,charset));
  }
 else {
    return null;
  }
}
