{
  Charset charset=endpoint.getCharset();
  BufferedReader br=new BufferedReader(new InputStreamReader(inputStream,charset));
  String line;
  boolean eos=false;
  while (!eos) {
    if (endpoint.getPromptMessage() != null) {
      doPromptMessage();
    }
    line=br.readLine();
    eos=line == null;
    if (!eos) {
      consumeLine(line);
    }
  }
}
