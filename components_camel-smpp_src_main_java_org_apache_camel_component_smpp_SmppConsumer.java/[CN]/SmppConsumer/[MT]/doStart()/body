{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Connecting to: " + getEndpoint().getConnectionString() + "...");
  }
  super.doStart();
  session=createSMPPSession();
  session.setEnquireLinkTimer(this.configuration.getEnquireLinkTimer());
  session.setTransactionTimer(this.configuration.getTransactionTimer());
  session.setMessageReceiverListener(new MessageReceiverListener(){
    private final MessageIDGenerator messageIDGenerator=new RandomMessageIDGenerator();
    public void onAcceptAlertNotification(    AlertNotification alertNotification){
      if (LOG.isDebugEnabled()) {
        LOG.debug("Received an alertNotification " + alertNotification);
      }
      try {
        Exchange exchange=getEndpoint().createOnAcceptAlertNotificationExchange(alertNotification);
        LOG.trace("Processing the new smpp exchange...");
        getProcessor().process(exchange);
        LOG.trace("Processed the new smpp exchange");
      }
 catch (      Exception e) {
        getExceptionHandler().handleException(e);
      }
    }
    public void onAcceptDeliverSm(    DeliverSm deliverSm){
      if (LOG.isDebugEnabled()) {
        LOG.debug("Received a deliverSm " + deliverSm);
      }
      try {
        Exchange exchange=getEndpoint().createOnAcceptDeliverSmExchange(deliverSm);
        LOG.trace("processing the new smpp exchange...");
        getProcessor().process(exchange);
        LOG.trace("processed the new smpp exchange");
      }
 catch (      Exception e) {
        getExceptionHandler().handleException(e);
      }
    }
    public DataSmResult onAcceptDataSm(    DataSm dataSm,    Session session) throws ProcessRequestException {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Received a dataSm " + dataSm);
      }
      MessageId newMessageId=messageIDGenerator.newMessageId();
      try {
        Exchange exchange=getEndpoint().createOnAcceptDataSm(dataSm,newMessageId.getValue());
        LOG.trace("processing the new smpp exchange...");
        getProcessor().process(exchange);
        LOG.trace("processed the new smpp exchange");
      }
 catch (      Exception e) {
        getExceptionHandler().handleException(e);
        throw new ProcessRequestException(e.getMessage(),255,e);
      }
      return new DataSmResult(newMessageId,dataSm.getOptionalParametes());
    }
  }
);
  session.connectAndBind(this.configuration.getHost(),this.configuration.getPort(),new BindParameter(BindType.BIND_RX,this.configuration.getSystemId(),this.configuration.getPassword(),this.configuration.getSystemType(),TypeOfNumber.UNKNOWN,NumberingPlanIndicator.UNKNOWN,""));
  LOG.info("Connected to: " + getEndpoint().getConnectionString());
}
