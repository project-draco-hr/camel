{
  return new RouteBuilder(){
    public void configure(){
      from("direct:a").multicast(new BodyOutAggregatingStrategy()).to("direct:x","direct:y","direct:z");
      from("direct:x").process(new AppendingProcessor("x")).to("direct:aggregater");
      from("direct:y").process(new AppendingProcessor("y")).to("direct:aggregater");
      from("direct:z").process(new AppendingProcessor("z")).to("direct:aggregater");
      from("direct:aggregater").aggregator(header("cheese"),new BodyInAggregatingStrategy()).completedPredicate(header("aggregated").isEqualTo(3)).to("mock:result");
    }
  }
;
}
