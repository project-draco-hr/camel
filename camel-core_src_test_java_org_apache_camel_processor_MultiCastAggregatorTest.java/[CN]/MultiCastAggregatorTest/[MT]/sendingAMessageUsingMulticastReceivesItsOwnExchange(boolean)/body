{
  result.expectedBodiesReceived("inputx+inputy+inputz");
  String url;
  if (isParallel) {
    url="direct:parallel";
  }
 else {
    url="direct:sequential";
  }
  Exchange result=template.send(url,new Processor(){
    public void process(    Exchange exchange){
      Message in=exchange.getIn();
      in.setBody("input");
      in.setHeader("foo","bar");
    }
  }
);
  assertNotNull("We should get result here",result);
  assertEquals("Can't get the right result","inputx+inputy+inputz",result.getOut().getBody(String.class));
  assertMockEndpointsSatisifed();
}
