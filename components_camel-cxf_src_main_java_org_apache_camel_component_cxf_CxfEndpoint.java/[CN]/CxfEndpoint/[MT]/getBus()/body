{
  if (bus == null) {
    bus=doGetBus();
    if (LOG.isDebugEnabled()) {
      LOG.debug("Using ThreadDefaultBus " + bus);
    }
  }
  if (!getBusHasBeenCalled.getAndSet(true) && isSetDefaultBus) {
    BusFactory.setThreadDefaultBus(bus);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Set bus " + bus + " as thread default bus");
    }
  }
  return bus;
}
